<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目 | Year 21's Blog</title><meta name="keywords" content="SpringCloud Vue Nuxt ElementUi"><meta name="author" content="Year 21"><meta name="copyright" content="Year 21"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="项目简介项目功能点本项目分为了 后台管理系统 和 前台用户系统  后台管理系统  1.登录模块，实现对登录者ip和登录地址的显示 2.权限管理模块(基于SpringSecurity框架实现) ①后台权限列表管理：后台管理列表的增删改查 ②角色管理：后台管理系统角色的增删改查以及对不同的角色赋于不同查看后台管理列表的权限 ③用户管理：登录该系统的用户的增删改查以及为不同用户分配不同角色  3.讲师管">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目">
<meta property="og:url" content="http://xxxccc1986.github.io/2022/09/14/OnlineEducation/index.html">
<meta property="og:site_name" content="Year 21&#39;s Blog">
<meta property="og:description" content="项目简介项目功能点本项目分为了 后台管理系统 和 前台用户系统  后台管理系统  1.登录模块，实现对登录者ip和登录地址的显示 2.权限管理模块(基于SpringSecurity框架实现) ①后台权限列表管理：后台管理列表的增删改查 ②角色管理：后台管理系统角色的增删改查以及对不同的角色赋于不同查看后台管理列表的权限 ③用户管理：登录该系统的用户的增删改查以及为不同用户分配不同角色  3.讲师管">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg">
<meta property="article:published_time" content="2022-09-14T13:45:02.000Z">
<meta property="article:modified_time" content="2022-09-14T13:45:02.000Z">
<meta property="article:author" content="Year 21">
<meta property="article:tag" content="SpringCloud">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="Nuxt">
<meta property="article:tag" content="ElementUi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xxxccc1986.github.io/2022/09/14/OnlineEducation/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Year 21","link":"链接: ","source":"来源: Year 21's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-09-14 21:45:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Year 21's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-14T13:45:02.000Z" title="发表于 2022-09-14 21:45:02">2022-09-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-14T13:45:02.000Z" title="更新于 2022-09-14 21:45:02">2022-09-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/">个人项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">34.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>152分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h1><h2 id="项目功能点"><a href="#项目功能点" class="headerlink" title="项目功能点"></a>项目功能点</h2><p>本项目分为了 后台管理系统 和 前台用户系统</p>
<ul>
<li>后台管理系统</li>
</ul>
<p>1.登录模块，实现对登录者ip和登录地址的显示</p>
<p>2.权限管理模块(基于SpringSecurity框架实现)</p>
<p>①后台权限列表管理：后台管理列表的增删改查</p>
<p>②角色管理：后台管理系统角色的增删改查以及对不同的角色赋于不同查看后台管理列表的权限</p>
<p>③用户管理：登录该系统的用户的增删改查以及为不同用户分配不同角色 </p>
<p>3.讲师管理模块</p>
<p>①讲师列表常规的分页查询、模糊查询、添加、删除、修改等操作</p>
<p>4.课程分类模块</p>
<p>①课程分类的添加(通过easyExcel读取上传的excel表中数据实现)</p>
<p>②使用树形结构展示课程分类的列表以及搜索当前存在的课程分类</p>
<p>5.课程管理模块</p>
<p>①课程列表常规的分页展示、特定查询、添加、删除、修改等操作</p>
<p>②添加课程，通过以下步骤完成：填写课程信息 –&gt;  添加课程大纲 –&gt; 课程信息确认 –&gt; 最终发布</p>
<p>③课程图片和视频添加功能，可以添加课程图片和视频(基于阿里云oss和视频点播实现)</p>
<p>6.统计分析模块</p>
<p>①统计数据生成</p>
<p>②统计数据展示(基于ECharts实现)</p>
<p>7.banner管理模块</p>
<p>①前台banner轮播图列表常规的分页查询、模糊搜索、添加、删除、修改等操作</p>
<p>8.评论管理模块</p>
<p>①所有评论的展示和删除，支持对某一用户、某个讲师、某个课程的评论特定查询</p>
<p>②对被举报评论进行特定处理，可根据评论内容决定删除或置为正常评论</p>
<p>9.订单管理模块</p>
<p>支持对某一用户、某个讲师、某个课程订单的特定查询</p>
<p>①对所有已支付订单的查看</p>
<p>②对所有尚未支付订单的查看</p>
<ul>
<li>前台用户系统</li>
</ul>
<p>1.首页模块</p>
<p>①轮播图显示 (根据添加时间进行排序)</p>
<p>②显示热门课程(根据点击次数进行排序)</p>
<p>③显示著名讲师(根据排序值间进行排序)</p>
<p>④根据课程名进行模糊搜索</p>
<p>2.注册功能(接入阿里云短信服务以及微信扫码注册) </p>
<p>3.登录功能 </p>
<p>①手机登录</p>
<p>使用了SSO单点登录，通过JWT框架生成token字符串实现，JWT字符串分为了头信息、有效载荷、签名哈希</p>
<p>②微信扫码登录</p>
<p>通过微信提供的接口获取类似临时票据，通过临时票据再访问微信提供的地址获取访问凭证和扫描人的唯一</p>
<p>标识，根据这两个值最终访问另一个微信提供的接口即可获取扫描人的全部信息</p>
<p>4.名师模块</p>
<p>①名师列表功能</p>
<p>②名师详情功能</p>
<p>5.课程模块</p>
<p>①课程列表功能(包含常规的分页查询)</p>
<p>②课程详情功能(包含课程所有的基本信息以及判断课程是否收费)</p>
<p>③课程视频在线播放(基于阿里云视频点播实现)</p>
<p>④课程购买功能(通过微信支付实现)</p>
<p>⑤课程评论功能</p>
<p>6.用户个人中心模块</p>
<p>①用户可通过已支付订单和未支付订单功能查询账户订单</p>
<p>②个人资料功能和上传头像功能支持用户对自己资料的修改</p>
<p>③通过修改密码功能对密码进行修改</p>
<p>④退出登录功能</p>
<h2 id="项目技术点"><a href="#项目技术点" class="headerlink" title="项目技术点"></a>项目技术点</h2><p><font color='red'><strong>本项目采用微服务架构，前后端分离开发</strong></font>，B2C商业模式。</p>
<ul>
<li>前端技术</li>
</ul>
<p>Vue	Element-UI	Node.js(JavaScript运行时环境)	Npm(依赖管理器)</p>
<p>Babel(转码器)	前端模块化技术	Nuxt框架(服务端渲染技术，基于vue实现)</p>
<p>Echarts(图表显示工具)</p>
<ul>
<li>后端技术</li>
</ul>
<p>SpringBoot	SpringCloud	MyBatisPlus	EasyExcel	SpringSecurity	Redis	Jwt</p>
<ul>
<li>其他技术</li>
</ul>
<p>阿里云oss	阿里云视频点播服务	阿里云短信服务	微信支付和登录</p>
<hr>
<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><ul>
<li>创建数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS online_edu CHARSET &#x27;utf8&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建部分数据表</p>
</li>
<li><p>创建pom类型父工程online_edu_parent(用于管理依赖版本和放置公共工程)</p>
</li>
</ul>
<p>主要是需要修改父工程pom文件，具体内容在这不做展示</p>
<h1 id="公共模块"><a href="#公共模块" class="headerlink" title="公共模块"></a>公共模块</h1><ul>
<li><font color='red'><strong>在online_parent模块下创建子模块common_apis</strong></font></li>
</ul>
<h2 id="整合Swagger"><a href="#整合Swagger" class="headerlink" title="整合Swagger"></a>整合Swagger</h2><ul>
<li>swagger有什么作用？</li>
</ul>
<p>①生成在线接口文档 ②方便接口测试</p>
<ul>
<li>整合步骤</li>
</ul>
<p>①在子模块common_apis下创建service_base子模块</p>
<p>②在service_base子模块中创建swagger配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span> <span class="comment">//swagger注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">            .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">            .apiInfo(webApiInfo())</span><br><span class="line">            .select()</span><br><span class="line">            .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/admin/.*&quot;</span>)))</span><br><span class="line">            .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">            .title(<span class="string">&quot;网站-课程中心API文档&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;本文档描述了课程中心微服务接口定义&quot;</span>)</span><br><span class="line">            .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">            .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;year21&quot;</span>, <span class="string">&quot;http://year21.top&quot;</span>, <span class="string">&quot;masicjokersic@gmail.com&quot;</span>))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用教程</li>
</ul>
<p>①在service模块下引入servie_base的坐标依赖</p>
<p>在servie模块引入了，在service_edu也能使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  引入service_base的依赖      --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.year21.onlineedu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service_base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②在service_edu主启动类设置包扫描规则，因为默认只扫描主动类所在的包及其子包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.year21.onlineedu&quot;&#125;)</span> <span class="comment">//扫描top.year21.onlineedu包下的所有组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceEduMain8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        SpringApplication.run(ServiceEduMain8001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③进行访问测试，测试地址为：<a href="http://localhost:工程端口号/swagger-ui.html">http://localhost:工程端口号/swagger-ui.html</a></p>
<h2 id="统一结果返回"><a href="#统一结果返回" class="headerlink" title="统一结果返回"></a>统一结果返回</h2><ul>
<li>创建步骤</li>
</ul>
<p>①在子模块common_apis下创建common_utils子模块</p>
<p>②common_utils子模块中创建返回统一结果的实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonResult</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义响应码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="number">20000</span>; <span class="comment">//成功</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">ERROR</span> <span class="operator">=</span> <span class="number">30000</span>; <span class="comment">//失败</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean result;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> E data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Boolean result,String message,E data)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result)&#123;</span><br><span class="line">            <span class="built_in">this</span>.result = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">this</span>.code = SUCCESS;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.result = <span class="literal">false</span>;</span><br><span class="line">            <span class="built_in">this</span>.code = ERROR;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Boolean result)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result)&#123;</span><br><span class="line">            <span class="built_in">this</span>.result = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">this</span>.code = SUCCESS;</span><br><span class="line">            <span class="built_in">this</span>.message = <span class="string">&quot;处理成功&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.result = <span class="literal">false</span>;</span><br><span class="line">            <span class="built_in">this</span>.code = ERROR;</span><br><span class="line">            <span class="built_in">this</span>.message = <span class="string">&quot;处理失败&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Boolean result,Integer code,String message)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result)&#123;</span><br><span class="line">            <span class="built_in">this</span>.result = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.result = <span class="literal">false</span>;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用步骤</li>
</ul>
<p>①需要使用的工程pom文件中引入此模块依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--   引入公用数据返回实体类     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.year21.onlineedu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_utils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②修改控制层返回结果测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除讲师</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/delTeacher/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">deleteTeacher</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> teacherService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h2><p>1.在service_base子模块创建一个用于异常处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//是Controller增强器，作用是给Controller控制器添加统一的操作或处理。</span></span><br><span class="line"><span class="comment">//经常配合@ExceptionHandler来处理异常</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//全局异常处理方法，当出现异常后就会来执行这个方法，</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = &#123;Throwable.class&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">//@ResponseBody将这个方法信息返回</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">globalExceptionHandle</span><span class="params">(Throwable e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;服务出现一点小异常，异常信息是&quot;</span>,e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//特定常处理方法，当出现特定异常后就会来执行这个方法，</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = &#123;ArithmeticException.class&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">//@ResponseBody将这个方法信息返回</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">specificExceptionHandle</span><span class="params">(Throwable e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;出现了特定异常，异常信息是&quot;</span>,e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义异常处理方法，当出现自定义异常后就会来执行这个方法，</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = &#123;InsertException.class&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">//@ResponseBody将这个方法信息返回</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">customerExceptionHandle</span><span class="params">(InsertException e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,e.getCode(),e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>记录一下自定义异常创建步骤</li>
</ul>
<p>①创建一个自定义异常类继承RuntimeException类</p>
<p>这里可以选择直接重写RuntimeException类的方法或者按照下方的方式来</p>
<p>另一种方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;<span class="comment">//状态码</span></span><br><span class="line">    <span class="keyword">private</span> String message; <span class="comment">//异常信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在编写业务过程中只需要抛出这个异常即可</p>
<h2 id="统一日志处理"><a href="#统一日志处理" class="headerlink" title="统一日志处理"></a>统一日志处理</h2><ul>
<li><font color='red'><strong>日志级别：ERROR、WARN、INFO、DEBUG</strong></font>，越往右信息越详细</li>
</ul>
<p>yml设置日志级别</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置日志级别</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure>

<ul>
<li>logback日志工具(不仅可以把日志输出到控制台同时输出到文件中)</li>
</ul>
<p>使用步骤</p>
<p>①删除yml中日志级别和mybatis的日志设置</p>
<p>②在resources文件夹下创建logback-spring.xml文件</p>
<h1 id="后台系统"><a href="#后台系统" class="headerlink" title="后台系统"></a>后台系统</h1><h2 id="前端页面工程"><a href="#前端页面工程" class="headerlink" title="前端页面工程"></a>前端页面工程</h2><p>1、使用vue提供的vue-admin-template-master模板文件</p>
<p>vue-admin-template-master模板是基于Vue+element-ui实现的</p>
<p>2、将模板文件解压到VSCode的工作区</p>
<p>3、通过集成终端键入npm install 根据package.json安装依赖</p>
<ul>
<li>目录结构说明</li>
</ul>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220820153907585.png"></p>
<hr>
<h2 id="新功能开发"><a href="#新功能开发" class="headerlink" title="新功能开发"></a>新功能开发</h2><p>1.在router文件夹下的index.js添加路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/teacher&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/teacher/list&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;teacher&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;讲师管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;example&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;讲师列表&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/edu/teacher/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;讲师列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;eye&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;添加讲师&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/edu/teacher/add&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;添加讲师&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>2.在views文件下创建对应页面的vue文件，用于路由转发的引入</p>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220820193126182.png"></p>
<p>3.在api文件下创建定义需要调用的方法js文件，用于特定页面的调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//查询讲师列表(条件查询)</span></span><br><span class="line">    <span class="title function_">getTeacherList</span>(<span class="params">pageNum,pageSize,voTeacher</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/condition/&#x27;</span> + pageNum +<span class="string">&quot;/&quot;</span> + pageSize,</span><br><span class="line">            <span class="comment">//url: &#x27;/serviceedu/condition/$&#123;pageNum&#125;/$&#123;pageSize&#125;,</span></span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="comment">//后端使用了@RequestBody接收此参数，必须用data传输</span></span><br><span class="line">            <span class="comment">//data表示把对象转换json进行传输到接口中</span></span><br><span class="line">            <span class="attr">data</span>: voTeacher</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//添加讲师</span></span><br><span class="line">    <span class="title function_">addTeacher</span>(<span class="params">voTeacher</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/add&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: voTeacher</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.在views文件夹下对应的vue文件中引入上方定义的js文件，用于发送业务请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">//引入需要调用的js文件</span><br><span class="line">import teacher from &#x27;@/api/teacher/teacher.js&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    name: &#x27;list&#x27;,</span><br><span class="line">    data() &#123; //定义变量和初始值</span><br><span class="line">        return &#123;</span><br><span class="line">            pageNum: 1, //当前页</span><br><span class="line">            pageSize: 5, //每页数量</span><br><span class="line">            voTeacher: &#123; &#125;, //值对象</span><br><span class="line">            list: [],//查询接口后返回的数据</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created()&#123; //在vue对象创建之后，数据转载之前执行，一般调用methods中定义的方法</span><br><span class="line">        this.getList();</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123; //创建具体的方法，调用teacher.js定义的方法</span><br><span class="line">        //查询讲师列表</span><br><span class="line">        getList(page = 1)&#123;</span><br><span class="line">            this.pageNum = page</span><br><span class="line">            teacher.getTeacherList(this.pageNum,this.pageSize,this.voTeacher)</span><br><span class="line">                    .then(response =&gt; &#123;</span><br><span class="line">                        this.list = response.data.records</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .catch(error =&gt; &#123;</span><br><span class="line">                        console.log(error);</span><br><span class="line">                    &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>5.最后通过element-ui组件库实现对数据的展示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    讲师列表</span><br><span class="line">    &lt;!-- 数据展示 --&gt;</span><br><span class="line">  &lt;el-table</span><br><span class="line">    :data=&quot;list&quot;</span><br><span class="line">    border</span><br><span class="line">    style=&quot;width: 100%&quot;&gt;</span><br><span class="line">    &lt;el-table-column</span><br><span class="line">      sortable</span><br><span class="line">      prop=&quot;id&quot;</span><br><span class="line">      label=&quot;id&quot;</span><br><span class="line">      width=&quot;180&quot;&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">    &lt;el-table-column</span><br><span class="line">      prop=&quot;name&quot;</span><br><span class="line">      label=&quot;姓名&quot;</span><br><span class="line">      width=&quot;180&quot;&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">    &lt;el-table-column</span><br><span class="line">      prop=&quot;intro&quot;</span><br><span class="line">      label=&quot;简介&quot;&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">    &lt;el-table-column</span><br><span class="line">      prop=&quot;career&quot;</span><br><span class="line">      label=&quot;头衔&quot;&gt;</span><br><span class="line">    &lt;template slot-scope=&quot;scope&quot;&gt; &lt;!--  slot-scope=&quot;scope&quot; 可以获取数据--&gt;</span><br><span class="line">        &#123;&#123;scope.row.level === 1?&#x27;高級讲师&#x27;:&#x27;首席讲师&#x27;&#125;&#125;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">    &lt;el-table-column</span><br><span class="line">      prop=&quot;gmtCreate&quot;</span><br><span class="line">      label=&quot;添加时间&quot;&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br><span class="line">  &lt;/el-table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="nginx反向代理"><a href="#nginx反向代理" class="headerlink" title="nginx反向代理"></a>nginx反向代理</h2><p>考虑到前端页面请求后端多个微服务，前端请求地址不可能固定某个微服务端口，使用nginx反向代理完成请求</p>
<ul>
<li>步骤(本次使用的是虚拟机)</li>
</ul>
<p>①为了安全起见，没有选择监听80端口，选择监听9001端口</p>
<p>②添加转发规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen       9001;</span><br><span class="line">	server_name  localhost;</span><br><span class="line"></span><br><span class="line">	location ~ /serviceedu/ &#123;</span><br><span class="line">	    proxy_pass http://192.168.231.1:8001;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location ~ /serviceoss/ &#123;</span><br><span class="line">	    proxy_pass http://192.168.231.1:8002;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location ~ /user &#123;</span><br><span class="line">	    proxy_pass http://192.168.231.1:8001;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③修改前端页面请求地址为请求nginx</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(prodEnv, &#123;</span><br><span class="line">  <span class="attr">NODE_ENV</span>: <span class="string">&#x27;&quot;development&quot;&#x27;</span>,</span><br><span class="line">  <span class="attr">BASE_API</span>: <span class="string">&#x27;&quot;http://192.168.231.134:9001&quot;&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="首页管理"><a href="#首页管理" class="headerlink" title="首页管理"></a>首页管理</h2><h3 id="登录显示"><a href="#登录显示" class="headerlink" title="登录显示"></a>登录显示</h3><p>①使用后端模拟浏览器发送post请求访问查询ip的接口，将返回的数据转为json传回前端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title function_">getIpInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> sendPost(<span class="string">&quot;http://pv.sohu.com/cityjson/&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> text.substring(text.indexOf(<span class="string">&quot;=&quot;</span>) + <span class="number">1</span>,text.lastIndexOf(<span class="string">&quot;;&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> JSONObject.parseObject(info);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sendPost</span><span class="params">(String url)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BasicResponseHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicResponseHandler</span>();</span><br><span class="line">            <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(<span class="string">&quot;utf-8&quot;</span>);<span class="comment">//解决中文乱码问题</span></span><br><span class="line">            entity.setContentEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            httpPost.setEntity(entity);</span><br><span class="line">            result = httpClient.execute(httpPost, handler);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                httpClient.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="讲师管理"><a href="#讲师管理" class="headerlink" title="讲师管理"></a>讲师管理</h2><h3 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h3><h4 id="讲师列表"><a href="#讲师列表" class="headerlink" title="讲师列表"></a>讲师列表</h4><ul>
<li>新功能开发的内容就是实现讲师列表的</li>
</ul>
<h4 id="分页条"><a href="#分页条" class="headerlink" title="分页条"></a>分页条</h4><p>①通过element-ui的组件库修改模板</p>
<p>②修改一个getList方法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页条 --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- @current-change是饿了么已经实现的，绑定了一个点击事件</span></span><br><span class="line"><span class="comment">      当currentPage改变时会触发，传的参数是当前页数，即:current-page绑定的值--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:current-page</span>=<span class="string">&quot;pageNum&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:page-size</span>=<span class="string">&quot;pageSize&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:total</span> = <span class="string">&quot;total&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;padding: 30px 0; text-align:center;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">layout</span>=<span class="string">&quot;total,prev, pager, next,jumper&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">current-change</span>=<span class="string">&quot;getList&quot;</span> </span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line"></span><br><span class="line">		getList(page = 1)&#123; //表示当不传值是pageNum是1</span><br><span class="line">            this.pageNum = page</span><br><span class="line">            teacher.getTeacherList(this.pageNum,this.pageSize,this.voTeacher)&#123;..&#125;</span><br></pre></td></tr></table></figure>

<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><p>①定义一个封装查询属性的voteacher对象，使用v-mode将查询表单的属性value值中l绑定到voteacher对象中</p>
<p>②绑定查询按钮的点击事件，调用讲师列表中的可用于条件查询的方法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;getList()&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="删除讲师"><a href="#删除讲师" class="headerlink" title="删除讲师"></a>删除讲师</h4><p>①在每一行数据后面添加删除按钮、绑定点击事件、传递删除的id</p>
<p>②在api文件夹teacher.js文件中定义被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除讲师</span></span><br><span class="line"><span class="title function_">delTacher</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceedu/delTeacher/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③在list.vue页面进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleDelete</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$confirm(<span class="string">&quot;此操作将永久删除该文件, 是否继续?&quot;</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//调用删除方法</span></span><br><span class="line">        teacher.<span class="title function_">delTeacher</span>(id)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//删除成功弹窗</span></span><br><span class="line">            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&quot;删除成功!&quot;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">//刷新页面</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">getList</span>(<span class="variable language_">this</span>.<span class="property">pageNum</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加讲师"><a href="#添加讲师" class="headerlink" title="添加讲师"></a>添加讲师</h4><p>①基于element-ui实现表单编写</p>
<p>②在api中的teacher.js中定义被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加讲师</span></span><br><span class="line"><span class="title function_">addTeacher</span>(<span class="params">teacher</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/add&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: teacher,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③在add.vue页面调用上方方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加讲师</span></span><br><span class="line"><span class="title function_">addTeacher</span>(<span class="params"></span>)&#123;</span><br><span class="line">    teacherApi.<span class="title function_">addTeacher</span>(<span class="variable language_">this</span>.<span class="property">teacher</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//提示添加成功</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>:<span class="string">&#x27;添加成功&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//回到数据展示的列表,通过路由跳转</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>:<span class="string">&#x27;/teacher/list&#x27;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="修改讲师"><a href="#修改讲师" class="headerlink" title="修改讲师"></a>修改讲师</h4><p>①通过添加一个隐藏路由，实现携带id跳转到某个公共页面进行修改操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下方是个隐藏路由，:id相当于是个占位符，表示要带一个参数，例如 add/123456</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;edit/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;编辑讲师&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/edu/teacher/add&#x27;</span>),</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;编辑讲师&#x27;</span>, <span class="attr">noCache</span>:<span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#x27;/teacher/edit/&#x27; + scope.row.id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②在api文件夹teacher.js文件中定义被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询指定讲师</span></span><br><span class="line"><span class="title function_">getTeacherInfo</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/query/&#x27;</span> + id,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//修改指定id讲师的信息</span></span><br><span class="line"><span class="title function_">updateInfoById</span>(<span class="params">teacher</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/serviceedu//update/&#x27;</span> + teacher.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: teacher,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③在add.vue页面进行调用</p>
<ul>
<li>由于和save方法共同使用一个页面，因此必须判断地址url中是否有id值来决定使用哪个方法</li>
</ul>
<p>在created()方法，即在数据装载之前执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>) &#123;</span><br><span class="line">        <span class="comment">// this.$route.params获取uri中的参数，id需要和在隐藏路由设置的一致</span></span><br><span class="line">        <span class="keyword">const</span> id = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getTeacherInfo</span>(id)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>修改数据填充以及添加修改方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询讲师信息</span></span><br><span class="line"><span class="title function_">getTeacherInfo</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    teacherApi.<span class="title function_">getTeacherInfo</span>(id)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">teacher</span> = response.<span class="property">data</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//根据id修改讲师信息</span></span><br><span class="line"><span class="title function_">updateInfoById</span>(<span class="params">teacher</span>)&#123;</span><br><span class="line">    teacherApi.<span class="title function_">updateInfoById</span>(teacher)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//提示添加成功</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>:<span class="string">&#x27;修改成功&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//回到数据展示的列表,通过路由跳转</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>:<span class="string">&#x27;/teacher/list&#x27;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">//为了能够让修改和添加同时使用</span></span><br><span class="line">    <span class="title function_">addOrUpdate</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//通过判断id值是否为空判断修改还是添加</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">teacher</span>.<span class="property">id</span>)&#123;</span><br><span class="line">            <span class="comment">//添加</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">addTeacher</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//修改</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateInfoById</span>(<span class="variable language_">this</span>.<span class="property">teacher</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="讲师头像"><a href="#讲师头像" class="headerlink" title="讲师头像"></a>讲师头像</h4><ul>
<li>导入需要使用的组件，并在页面下方中进行变量赋初始值和局部注册</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 头衔缩略图 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">pan-thumb</span> <span class="attr">:image</span>=<span class="string">&quot;teacher.avatar&quot;</span>/&gt;</span></span></span><br><span class="line">&lt;!-- 文件上传按钮 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-upload&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;imagecropperShow=true&quot;</span>&gt;</span>更换头像</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">v-show：是否显示上传组件</span><br><span class="line">:key：类似于id，如果一个页面多个图片上传控件，可以做区分</span><br><span class="line">:url：后台上传的url地址</span><br><span class="line">@close：关闭上传组件</span><br><span class="line">@crop-upload-success：上传成功后的回调 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">image-cropper</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">v-show</span>=<span class="string">&quot;imagecropperShow&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">:width</span>=<span class="string">&quot;300&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">:height</span>=<span class="string">&quot;300&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">:key</span>=<span class="string">&quot;imagecropperKey&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">:url</span>=<span class="string">&quot;BASE_API+&#x27;/serviceoss/upload&#x27;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               <span class="attr">field</span>=<span class="string">&quot;file&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               @<span class="attr">close</span>=<span class="string">&quot;close&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">               @<span class="attr">crop-upload-success</span>=<span class="string">&quot;cropSuccess&quot;</span>/&gt;</span></span></span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">  <span class="attr">components</span>:&#123;</span><br><span class="line">    <span class="title class_">ImageCropper</span>,</span><br><span class="line">    <span class="title class_">PanThumb</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">teacher</span>: &#123;&#125;,</span><br><span class="line">      <span class="comment">//上传弹框是否显示</span></span><br><span class="line">      <span class="attr">imagecropperShow</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">//图片唯一标识</span></span><br><span class="line">      <span class="attr">imagecropperKey</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">//获取dev.env.js里面的请求地址</span></span><br><span class="line">      <span class="attr">BASE_API</span>: process.<span class="property">env</span>.<span class="property">BASE_API</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">   <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">//关闭上传弹框的方法</span></span><br><span class="line">    <span class="title function_">close</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">imagecropperShow</span> = <span class="literal">false</span>;</span><br><span class="line">      <span class="comment">//上传组件初始化，解决二次上传的缓存bug</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">imagecropperKey</span> += <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/*上传成功后的回调方法</span></span><br><span class="line"><span class="comment">    这个方法中封装了响应的赋值，此处的photo接收的就是上传成功后回传回来的访问地址</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="title function_">cropSuccess</span>(<span class="params">photo</span>)&#123;</span><br><span class="line">      <span class="comment">//回显上传头像</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">teacher</span>.<span class="property">avatar</span> = photo</span><br><span class="line">      <span class="comment">//关闭上传弹窗</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">imagecropperShow</span> = <span class="literal">false</span></span><br><span class="line">      <span class="comment">//上传组件初始化，解决二次上传的缓存bug</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">imagecropperKey</span> += <span class="number">1</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="后端接口"><a href="#后端接口" class="headerlink" title="后端接口"></a>后端接口</h3><ul>
<li>在父工程online_edu_parent下创建子模块service</li>
</ul>
<p>主要是需要修改子模块service的pom文件</p>
<ul>
<li><font color='red'><strong>由于使用了MyBatis-Plus因此简单sql语句不再需要手写</strong></font></li>
</ul>
<p>1、在子模块service下再次创建子模块service_edu</p>
<p>2、修改pom文件</p>
<p>3、编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-edu</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_edu?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.slf4j.Slf4jImpl</span></span><br></pre></td></tr></table></figure>

<p>4、业务类</p>
<ul>
<li>使用mybatis-plus的代码生成器快速生成实体类、控制层、业务层、持久层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastAutoGeneratorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 设置我们需要创建在哪的路径</span></span><br><span class="line">        FastAutoGenerator.create(<span class="string">&quot;jdbc:mysql://localhost:3306/online_edu?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">            .globalConfig(builder -&gt; &#123;</span><br><span class="line">                builder.author(<span class="string">&quot;year21&quot;</span>) <span class="comment">// 设置作者</span></span><br><span class="line">                    .enableSwagger() <span class="comment">// 开启 swagger 模式</span></span><br><span class="line">                    .fileOverride() <span class="comment">// 覆盖已生成文件</span></span><br><span class="line">                    .outputDir(<span class="string">&quot;C://Users//hcxs1986//IdeaProjects//online_edu_parent//service//service_edu//src//main//java&quot;</span>); <span class="comment">// 指定输出目录</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .packageConfig(builder -&gt; &#123;</span><br><span class="line">                builder.parent(<span class="string">&quot;top.year21.onlineedu&quot;</span>) <span class="comment">// 设置父包名</span></span><br><span class="line">                    .moduleName(<span class="string">&quot;serviceedu&quot;</span>) <span class="comment">// 设置父包模块名</span></span><br><span class="line">                    .pathInfo(Collections.singletonMap(OutputFile.mapperXml, <span class="string">&quot;C://Users//hcxs1986//IdeaProjects//online_edu_parent//service//service_edu//src//main//resources//mybatis//mapper&quot;</span>)); <span class="comment">// 设置mapperXml生成路径</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .strategyConfig(builder -&gt; &#123;</span><br><span class="line">                builder.addInclude(<span class="string">&quot;edu_teacher&quot;</span>) <span class="comment">// 设置需要生成的表名</span></span><br><span class="line">                    .addTablePrefix(<span class="string">&quot;t_&quot;</span>, <span class="string">&quot;c_&quot;</span>); <span class="comment">// 设置过滤表前缀</span></span><br><span class="line">            &#125;).templateEngine(<span class="keyword">new</span> <span class="title class_">FreemarkerTemplateEngine</span>()) <span class="comment">// 使用Freemarker 引擎模板，默认的是Velocity引擎模板</span></span><br><span class="line">            .execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、主启动类</p>
<p>6、在控制层编写代码进行接口测试</p>
<h4 id="删除讲师-1"><a href="#删除讲师-1" class="headerlink" title="删除讲师"></a>删除讲师</h4><p>1、在实体类isDeleted属性上添加@TableLogic注解</p>
<p>2、编写控制层方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除讲师</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/delTeacher/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">deleteTeacher</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> teacherService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询讲师"><a href="#查询讲师" class="headerlink" title="查询讲师"></a>查询讲师</h4><p>1、配置分页插件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册MyBatisPlus的分页插件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//拦截器</span></span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"></span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、编写控制层方法</p>
<ul>
<li>不带查询条件的分页查询</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询讲师数据</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/pages/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Page&gt; <span class="title function_">queryAllTeachersByPages</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize)</span>&#123;</span><br><span class="line">    Page&lt;EduTeacher&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize);</span><br><span class="line">    teacherService.page(page,<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多条件组合分页查询讲师信息</li>
</ul>
<p>①一般使用一个值对象来封装查询条件参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VOTeacher</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line">    <span class="keyword">private</span> String begin;</span><br><span class="line">    <span class="keyword">private</span> String end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②编写接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多条件组合分页查询讲师信息</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/condition/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Page&gt; <span class="title function_">queryByPagesWithCondition</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@RequestBody(required = false)</span> VOTeacher voTeacher)</span>&#123;</span><br><span class="line">    <span class="comment">//创建page对象，查询的数据都封装在这个对象中</span></span><br><span class="line">    Page&lt;EduTeacher&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize);</span><br><span class="line">    <span class="comment">//创建条件构造器对象</span></span><br><span class="line">    QueryWrapper&lt;EduTeacher&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//获取传入的参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> voTeacher.getName();</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">level</span> <span class="operator">=</span> voTeacher.getLevel();</span><br><span class="line">    <span class="type">String</span> <span class="variable">begin</span> <span class="operator">=</span> voTeacher.getBegin();</span><br><span class="line">    <span class="type">String</span> <span class="variable">end</span> <span class="operator">=</span> voTeacher.getEnd();</span><br><span class="line"></span><br><span class="line">    <span class="comment">///判断属性值是否为空，以决定是否添加该查询条件</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(name))&#123;</span><br><span class="line">        queryWrapper.like(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(level))&#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;level&quot;</span>,level);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(begin))&#123;</span><br><span class="line">        queryWrapper.ge(<span class="string">&quot;gmt_create&quot;</span>,begin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(end))&#123;</span><br><span class="line">        queryWrapper.le(<span class="string">&quot;gmt_create&quot;</span>,end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    teacherService.page(page,queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="新增讲师"><a href="#新增讲师" class="headerlink" title="新增讲师"></a>新增讲师</h4><p>1.在需要在执行插入操作后自动填充属性添加注解@TableFiled</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModelProperty(&quot;创建时间&quot;)</span></span><br><span class="line"><span class="comment">//FieldFill.INSERT表示插入操作时自动填充</span></span><br><span class="line"><span class="meta">@TableField(value = &quot;gmt_create&quot;,fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime gmtCreate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;更新时间&quot;)</span></span><br><span class="line"><span class="comment">//FieldFill.INSERT_UPDATE表示插入和更新操作时自动填充</span></span><br><span class="line"><span class="meta">@TableField(value = &quot;gmt_modified&quot;,fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime gmtModified;</span><br></pre></td></tr></table></figure>

<p>2.在service_base模块使用一个类实现MetaObjectHandler接口并交由spring管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtCreate&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.编写控制层方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addTeacher</span><span class="params">(<span class="meta">@RequestBody</span> EduTeacher eduTeacher)</span>&#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> teacherService.save(eduTeacher);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改讲师-1"><a href="#修改讲师-1" class="headerlink" title="修改讲师"></a>修改讲师</h4><p>1.编写控制层方法</p>
<p>①根据指定的id进行查询</p>
<p>②根据指定的id进行修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/query/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;EduTeacher&gt; <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    <span class="type">EduTeacher</span> <span class="variable">teacher</span> <span class="operator">=</span> teacherService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,teacher);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/update/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Boolean&gt; <span class="title function_">updateTeacher</span><span class="params">(<span class="meta">@RequestBody</span> EduTeacher eduTeacher)</span>&#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> teacherService.updateById(eduTeacher);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="讲师头像-1"><a href="#讲师头像-1" class="headerlink" title="讲师头像"></a>讲师头像</h4><ul>
<li>使用阿里云oss完成头像存储</li>
</ul>
<p><font color='red'><strong>1、在子模块service下再次创建用于云存储微服务子模块service-oss</strong></font></p>
<p>2、在pom文件中添加下列依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 阿里云oss依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日期工具栏依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-oss</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#阿里云 OSS配置信息</span></span><br><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">  <span class="attr">oss:</span></span><br><span class="line">    <span class="attr">file:</span></span><br><span class="line">      <span class="attr">endpoint:</span> <span class="string">oss-cn-guangzhou.aliyuncs.com</span> <span class="comment">#节点地域</span></span><br><span class="line">      <span class="attr">keyid:</span> <span class="string">LTAI5tHuNsemaiLnP3yro4vD</span> <span class="comment">#访问id</span></span><br><span class="line">      <span class="attr">keysecret:</span> <span class="string">ed1Zxok1SklTEI40HhRKkJeRcQdyWc</span> <span class="comment">#访问密码</span></span><br><span class="line">      <span class="attr">bucketname:</span> <span class="string">onlineedufile</span> <span class="comment">#访问bucketname名</span></span><br></pre></td></tr></table></figure>

<p>4、业务类</p>
<p>①创建常量类读取yml配置文件内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OSSConfigurationClass</span>&#123;</span><br><span class="line">    <span class="comment">//从yml配置文件中读取下列配置内容</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keyid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keyid;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keysecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keysecret;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.bucketname&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucketname;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String END_POINT;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    在项目启动的时候执行该方法，也可以理解为在spring容器初始化的时候执行该方法。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        END_POINT = endpoint;</span><br><span class="line">        ACCESS_KEY_ID = keyid;</span><br><span class="line">        ACCESS_KEY_SECRET = keysecret;</span><br><span class="line">        BUCKET_NAME = bucketname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②service层负责实现文件上传逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OSSServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OSSService</span>&#123;</span><br><span class="line">     <span class="comment">//上传头像到oss</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="comment">// Endpoint地址</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> OSSConfigurationClass.END_POINT;</span><br><span class="line">        <span class="comment">// 阿里云账号AccessKey</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> OSSConfigurationClass.ACCESS_KEY_ID;</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> OSSConfigurationClass.ACCESS_KEY_SECRET;</span><br><span class="line">        <span class="comment">// 填写Bucket名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> OSSConfigurationClass.BUCKET_NAME;</span><br><span class="line">        <span class="comment">// 获取原始文件名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取文件后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> objectName.substring(objectName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//拼接新的文件名用于上传,防止上传文件名字相同被覆盖</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileUploadName</span> <span class="operator">=</span> fileName + suffix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将文件按照日期进行分类</span></span><br><span class="line">        <span class="comment">//获取当前日期</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">datePath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>().toString(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拼接最终上传的文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endUploadPath</span> <span class="operator">=</span> datePath + <span class="string">&quot;/&quot;</span> + fileUploadName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取上传文件的输入流</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line">            <span class="comment">/* 调用oss方法实现上传</span></span><br><span class="line"><span class="comment">           第一个参数为bucker名称</span></span><br><span class="line"><span class="comment">           第二个参数为上传到oss文件路径和文件名称</span></span><br><span class="line"><span class="comment">           第三个参数为文件的上传流</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            ossClient.putObject(bucketName, endUploadPath, inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将上传成功后的路径返回,需要手动拼接，oss没有方法实现</span></span><br><span class="line">            <span class="comment">//oss的访问路径为https://onlineedufile.oss-cn-guangzhou.aliyuncs.com/2.jpg</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uploadPath</span> <span class="operator">=</span> <span class="string">&quot;https://&quot;</span>+ bucketName+ <span class="string">&quot;.&quot;</span> + endpoint + <span class="string">&quot;/&quot;</span> + endUploadPath;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> uploadPath;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ossClient != <span class="literal">null</span>) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③控制层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//上传文件的方法</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">    <span class="comment">//当上传成功后，返回存储的图片地址</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">filePathFromOSS</span> <span class="operator">=</span> ossService.uploadFile(file);</span><br><span class="line">    <span class="comment">//将图片地址返回</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;上传成功&quot;</span>,filePathFromOSS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、主启动类</p>
<ul>
<li><p>由于这个微服务仅仅需要上传图片吗，不需要去数据库查询信息，而在service引入的数据库依赖</p>
<p>会通过依赖传递到这个serviceoss的微服务中，因此需要在启动类中排除自动装配数据源类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span> <span class="comment">//不自动装配数据源，不排除有可能报错</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.year21.onlineedu&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceOSS8002</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        SpringApplication.run(ServiceOSS8002.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、在控制层编写代码进行接口测试</p>
<hr>
<h2 id="课程分类管理"><a href="#课程分类管理" class="headerlink" title="课程分类管理"></a>课程分类管理</h2><ul>
<li><p>基于新功能开发的步骤完成课程分类管理</p>
</li>
<li><p>使用EasyExcel完成对excel文件的读取与写入</p>
</li>
<li><p>使用代码生成器快速生成对应表的相关信息</p>
<h3 id="前端页面-1"><a href="#前端页面-1" class="headerlink" title="前端页面"></a>前端页面</h3></li>
</ul>
<h4 id="添加课程"><a href="#添加课程" class="headerlink" title="添加课程"></a>添加课程</h4><ul>
<li>在添加课程界面提供一个上传文件功能，将上传的文件传到后端接口中即可</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;选择Excel&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">          <span class="attr">ref</span>=<span class="string">&quot;upload&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:auto-upload</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:on-success</span>=<span class="string">&quot;fileUploadSuccess&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:on-error</span>=<span class="string">&quot;fileUploadError&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:disabled</span>=<span class="string">&quot;importBtnDisabled&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:limit</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:action</span>=<span class="string">&quot;BASE_API+&#x27;/serviceedu/subject/add&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">name</span>=<span class="string">&quot;file&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">accept</span>=<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">slot</span>=<span class="string">&quot;trigger&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>选取文件<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:loading</span>=<span class="string">&quot;loading&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">&quot;margin-left: 10px;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;success&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">click</span>=<span class="string">&quot;submitUpload&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;add&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">BASE_API</span>: process.<span class="property">env</span>.<span class="property">BASE_API</span>, <span class="comment">// 接口API地址</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">importBtnDisabled</span>: <span class="literal">false</span>, <span class="comment">// 按钮是否禁用,</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">loading</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//点击上传按钮进行上传表单的提交</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">submitUpload</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">importBtnDisabled</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//表单提交 原生js写法是这样 ==&gt; document.getElementById(&quot;upload&quot;).submit()</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">upload</span>.<span class="title function_">submit</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//上传成功的回调方法</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fileUploadSuccess</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//提示信息</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>:<span class="string">&#x27;success&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">message</span>:<span class="string">&#x27;上传成功&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//跳转到课程分类列表页面</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>:<span class="string">&#x27;/subject/list&#x27;</span>&#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//上传失败的回调方法</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fileUploadError</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//提示信息</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>:<span class="string">&#x27;error&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">message</span>:<span class="string">&#x27;上传失败&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="课程显示"><a href="#课程显示" class="headerlink" title="课程显示"></a>课程显示</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;filterText&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Filter keyword&quot;</span> <span class="attr">clearable</span> <span class="attr">style</span>=<span class="string">&quot;margin-bottom:30px;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-tree</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">&quot;tree2&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:data</span>=<span class="string">&quot;list&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:props</span>=<span class="string">&quot;defaultProps&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:filter-node-method</span>=<span class="string">&quot;filterNode&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;filter-tree&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">default-expand-all</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> subject <span class="keyword">from</span> <span class="string">&#x27;@/api/edu/subject.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;list&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">filterText</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">list</span>: [], </span></span><br><span class="line"><span class="language-javascript">        <span class="attr">defaultProps</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">children</span>: <span class="string">&#x27;children&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">label</span>: <span class="string">&#x27;title&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">getSubjectList</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">filterText</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tree2</span>.<span class="title function_">filter</span>(val)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">filterNode</span>(<span class="params">value, data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> data.<span class="property">title</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(value) !== -<span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getSubjectList</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            subject.<span class="title function_">getSubjectList</span>()</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">list</span> = response.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="后端接口-1"><a href="#后端接口-1" class="headerlink" title="后端接口"></a>后端接口</h3><h4 id="添加课程-1"><a href="#添加课程-1" class="headerlink" title="添加课程"></a>添加课程</h4><p>①控制层创建接收excel文件上传的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IEduSubjectService eduSubjectService;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加课程分类</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addSubject</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//获取上传文件</span></span><br><span class="line">    eduSubjectService.addFile(file,eduSubjectService);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②业务层负责将上传的文件以流的方式传输给ExcelReadListener监听器对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IEduSubjectService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;EduSubject&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addFile</span><span class="params">(MultipartFile file,IEduSubjectService eduSubjectService)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EduSubjectServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;EduSubjectMapper, EduSubject&gt; <span class="keyword">implements</span> <span class="title class_">IEduSubjectService</span> &#123;</span><br><span class="line">    <span class="comment">//添加课程分类</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFile</span><span class="params">(MultipartFile file,IEduSubjectService eduSubjectService)</span> &#123;</span><br><span class="line">        <span class="comment">//获取上传文件的流形式</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inputStream = file.getInputStream();</span><br><span class="line">            EasyExcel.read(inputStream, SubjectData.class,<span class="keyword">new</span> <span class="title class_">ExcelReadListener</span>(eduSubjectService)).sheet().doRead();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③ExcelReadListener监听器对象负责读取文件和写入数据库</p>
<ul>
<li><p><font color='red'><strong>由于spring不建议在new的对象里面依赖注入bean，或说禁止在自己new的对象里面依赖注入，</strong></font></p>
<p>因为没有交给spring管理的对象，无法实现对其依赖的对象进行依赖注入，导致依赖对象为mull</p>
<p>因此为了使用eduSubjectService将数据插入数据库，必须在业务层将eduSubjectService对象传入</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelReadListener</span> <span class="keyword">extends</span> <span class="title class_">AnalysisEventListener</span>&lt;SubjectData&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    因为在ExcelReadListener是手动new出来的对象，没有交给spring进行管理，</span></span><br><span class="line"><span class="comment">    因此不能在ExcelReadListener内使用@Autowired自动装配在spring管理的的对象，</span></span><br><span class="line"><span class="comment">    需要在这一层使用eduSubjectService进行数据库操作必须通过上一层传入这个参数</span></span><br><span class="line"><span class="comment">    在ExcelReadListener中的eduSubjectService不传值的话是null的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> IEduSubjectService eduSubjectService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExcelReadListener</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExcelReadListener</span><span class="params">(IEduSubjectService eduSubjectService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.eduSubjectService = eduSubjectService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//逐行读取excel的内容</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(SubjectData subjectData, AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (subjectData == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30000</span>,<span class="string">&quot;文件内容为空&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//一行一行读取，每次读取都有两个值，第一个值为一级分类，第二个值为二级分类，</span></span><br><span class="line">            <span class="comment">//先判断一级分类是否重复</span></span><br><span class="line">        <span class="type">EduSubject</span> <span class="variable">eduSubject</span> <span class="operator">=</span> oneSubjectIsExists(eduSubjectService, subjectData.getOneSubjectName());</span><br><span class="line">            <span class="keyword">if</span> (eduSubject == <span class="literal">null</span>)&#123; <span class="comment">//若一级分类查询为空，则可以进行添加</span></span><br><span class="line">                eduSubject = <span class="keyword">new</span> <span class="title class_">EduSubject</span>();</span><br><span class="line">                eduSubject.setTitle(subjectData.getOneSubjectName());</span><br><span class="line">                eduSubject.setParentId(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                eduSubjectService.save(eduSubject);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取一级分类的id，作为二级分类的parent_id</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">parentId</span> <span class="operator">=</span> eduSubject.getId();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//判断二级分类是否重复</span></span><br><span class="line">        <span class="type">EduSubject</span> <span class="variable">twoSubject</span> <span class="operator">=</span> twoSubjectIsExists(eduSubjectService, subjectData.getTwoSubjectName(), parentId);</span><br><span class="line">            <span class="keyword">if</span> (twoSubject == <span class="literal">null</span>)&#123;</span><br><span class="line">                twoSubject = <span class="keyword">new</span> <span class="title class_">EduSubject</span>();</span><br><span class="line">                twoSubject.setTitle(subjectData.getTwoSubjectName());</span><br><span class="line">                twoSubject.setParentId(parentId);</span><br><span class="line">                eduSubjectService.save(twoSubject);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取完成之后执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断一级分类不能重复添加</span></span><br><span class="line">    <span class="keyword">public</span> EduSubject <span class="title function_">oneSubjectIsExists</span><span class="params">(IEduSubjectService eduSubjectService,String oneSubjectName)</span>&#123;</span><br><span class="line">        QueryWrapper&lt;EduSubject&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;title&quot;</span>,oneSubjectName);</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;parent_id&quot;</span>,<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> eduSubjectService.getOne(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断二级分类不能重复添加</span></span><br><span class="line">    <span class="keyword">public</span> EduSubject <span class="title function_">twoSubjectIsExists</span><span class="params">(IEduSubjectService eduSubjectService,String twoSubjectName,String parentId)</span>&#123;</span><br><span class="line">        QueryWrapper&lt;EduSubject&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;title&quot;</span>,twoSubjectName);</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;parent_id&quot;</span>,parentId);</span><br><span class="line">        <span class="keyword">return</span> eduSubjectService.getOne(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="课程显示-1"><a href="#课程显示-1" class="headerlink" title="课程显示"></a>课程显示</h4><ul>
<li>需要返回一个json数组，类似这种 &#x3D;&#x3D;&gt; [{id:1, label:’一级’, children:[{id:2, label:’二级’,}]}]</li>
</ul>
<p>①针对返回数据创建对应的实体类，此处需要创建两个实体类</p>
<p>②建立两个实体类之间的关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OneSubject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//表示一级分类中有多个二级分类</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;TwoSubject&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TwoSubject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③控制层返回<code>List&lt;OneSubject&gt;</code>，业务层负责返回数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/serviceedu/subject&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EduSubjectController</span> &#123;</span><br><span class="line">    <span class="comment">//课程分类显示</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;OneSubject&gt;&gt; <span class="title function_">getSubjectList</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;OneSubject&gt; subjects = eduSubjectService.selectAllSubject();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,subjects);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EduSubjectServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;EduSubjectMapper, EduSubject&gt; <span class="keyword">implements</span> <span class="title class_">IEduSubjectService</span> &#123;	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OneSubject&gt; <span class="title function_">selectAllSubject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//用于封装最终返回数据的一级实体类</span></span><br><span class="line">        List&lt;OneSubject&gt; oneDataEntity = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询所有一级分类</span></span><br><span class="line">        QueryWrapper&lt;EduSubject&gt; oneWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        oneWrapper.eq(<span class="string">&quot;parent_id&quot;</span>,<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        List&lt;EduSubject&gt; oneSubjectList = eduSubjectMapper.selectList(oneWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//逐个遍历一级分类获取二级分类</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; oneSubjectList.size(); i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//当前i索引指向集合中的一级分类对象</span></span><br><span class="line">            <span class="type">EduSubject</span> <span class="variable">one</span> <span class="operator">=</span> oneSubjectList.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//查询所有二级分类</span></span><br><span class="line">            QueryWrapper&lt;EduSubject&gt; twoWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">            twoWrapper.eq(<span class="string">&quot;parent_id&quot;</span>,one.getId());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//用于封装二级分类数据的二级实体类</span></span><br><span class="line">            List&lt;TwoSubject&gt; twoDataEntity  = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//二级分类对象集合</span></span><br><span class="line">            List&lt;EduSubject&gt; towSubjectList = eduSubjectMapper.selectList(twoWrapper);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//遍历查找当前一级分类下的二级分类</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; towSubjectList.size(); j++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//当前符合一级分类为parent_id的二级分类对象</span></span><br><span class="line">                <span class="type">EduSubject</span> <span class="variable">two</span> <span class="operator">=</span> towSubjectList.get(j);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//将每个二级分类对象赋值给二级封装对象并加入二级封装对象集合</span></span><br><span class="line">                <span class="type">TwoSubject</span> <span class="variable">tSubject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TwoSubject</span>();</span><br><span class="line"><span class="comment">//                原生写法</span></span><br><span class="line"><span class="comment">//                tSubject.setId(two.getId());</span></span><br><span class="line"><span class="comment">//                tSubject.setTitle(two.getTitle());</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//spring提供的工具类，此方法是将two的属性值复制到tSubject中</span></span><br><span class="line">                BeanUtils.copyProperties(two,tSubject);</span><br><span class="line">                twoDataEntity.add(tSubject);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将每个一级分类对象赋值给一级封装对象并加入一级封装对象集合</span></span><br><span class="line">            <span class="type">OneSubject</span> <span class="variable">oSubject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OneSubject</span>();</span><br><span class="line"><span class="comment">//            oSubject.setId(one.getId());</span></span><br><span class="line"><span class="comment">//            oSubject.setTitle(one.getTitle());</span></span><br><span class="line"><span class="comment">//            oSubject.setChildren(twoDataEntity);</span></span><br><span class="line">            <span class="comment">//spring提供的工具类，此方法是将one的属性值复制到oSubject中,</span></span><br><span class="line">            <span class="comment">// 但只能赋值对应的属性，若属性不存在则不能赋值</span></span><br><span class="line">            BeanUtils.copyProperties(one,oSubject);</span><br><span class="line">            oSubject.setChildren(twoDataEntity);</span><br><span class="line">            oneDataEntity.add(oSubject);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oneDataEntity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="课程管理"><a href="#课程管理" class="headerlink" title="课程管理"></a>课程管理</h2><h3 id="前端页面-2"><a href="#前端页面-2" class="headerlink" title="前端页面"></a>前端页面</h3><h4 id="添加课程-2"><a href="#添加课程-2" class="headerlink" title="添加课程"></a>添加课程</h4><blockquote>
<p>还是新功能开发那一套</p>
</blockquote>
<p>①基于element组件库的step步骤实现顺序切换</p>
<p>②在router文件夹中定义一个显示路由和两个隐藏路由，用于切换步骤</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/course&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/course/list&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;课程管理&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;课程管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;example&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;课程列表&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/edu/course/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;课程列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;info/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;添加课程&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/edu/course/info&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;添加课程&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;chapter/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;课程大纲&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/edu/course/chapter&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;课程大纲&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;eye&#x27;</span> &#125;,</span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;publish/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;发布课程&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/edu/course/publish&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;发布课程&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;eye&#x27;</span> &#125;,</span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>③在info、chapter、publish各自的vue页面添加内容</p>
<h4 id="课程大纲"><a href="#课程大纲" class="headerlink" title="课程大纲"></a>课程大纲</h4><ul>
<li>使用树形空间显示课程章节和课程小节</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-tree</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">:data</span>=<span class="string">&quot;chapterList&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">:props</span>=<span class="string">&quot;defaultProps&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">:expand-on-click-node</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">:highlight-current</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">default-expand-all</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 两个参数node和data，分别表示当前节点的 Node 对象和当前节点的数据。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;custom-tree-node&quot;</span> <span class="attr">slot-scope</span>=<span class="string">&quot;&#123;node,data&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; node.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> &gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  data.courseBarList != null表示是个一级分类，因此可以增加课时--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">v-if</span>=<span class="string">&quot;data.courseBarList != null&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">style</span>=<span class="string">&quot;padding:10px&quot;</span></span></span><br><span class="line"><span class="tag">                       @<span class="attr">click</span>=<span class="string">&quot;addChapter&quot;</span>&gt;</span></span><br><span class="line">                添加课时</span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tree</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="确认课程"><a href="#确认课程" class="headerlink" title="确认课程"></a>确认课程</h4><p>①在api&#x2F;edu&#x2F;下的course.文件中添加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">queryVOPublishInfoById</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/course/&#x27;</span>+id,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>②并在对应的页面进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">queryVOPublishInfoById</span>()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line"><span class="comment">//根据课程id查询用于显示确认的课程信息</span></span><br><span class="line"><span class="title function_">queryVOPublishInfoById</span>(<span class="params"></span>)&#123;</span><br><span class="line">    course.<span class="title function_">queryVOPublishInfoById</span>(<span class="variable language_">this</span>.<span class="property">courseId</span>)</span><br><span class="line">       .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">VOPublish</span> = response.<span class="property">data</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最终发布"><a href="#最终发布" class="headerlink" title="最终发布"></a>最终发布</h4><p>①在api&#x2F;edu&#x2F;下的course.文件中添加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">updateCourseStatusById</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/course/status/&#x27;</span> + id,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>②并在对应的页面进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//最终提交，修改状态</span></span><br><span class="line"><span class="title function_">next</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updateCourseStatusById</span>()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//根据课程id修改课程最终状态</span></span><br><span class="line"><span class="title function_">updateCourseStatusById</span>(<span class="params"></span>)&#123;</span><br><span class="line">    course.<span class="title function_">updateCourseStatusById</span>(<span class="variable language_">this</span>.<span class="property">courseId</span>)</span><br><span class="line">         .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;发布成功！&quot;</span>)</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>:<span class="string">&quot;/course/list&quot;</span>&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="课程列表"><a href="#课程列表" class="headerlink" title="课程列表"></a>课程列表</h4><ul>
<li>与讲师列表的展示差不多类似，只需要根据讲师列表页面将参数以及一些内容修改即可</li>
</ul>
<h4 id="查询课程信息"><a href="#查询课程信息" class="headerlink" title="查询课程信息"></a>查询课程信息</h4><ul>
<li>根据url中的参数值查询信息并赋值给voCourse对象即可</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id查询课程信息</span></span><br><span class="line"><span class="title function_">queryCourseInfoById</span>(<span class="params"></span>)&#123;</span><br><span class="line">course.<span class="title function_">queryCourseInfoById</span>(<span class="variable language_">this</span>.<span class="property">courseId</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">voCourse</span> = response.<span class="property">data</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="更新课程信息"><a href="#更新课程信息" class="headerlink" title="更新课程信息"></a>更新课程信息</h4><ul>
<li>在这个页面需要解决更新信息和添加课程共用一个按钮问题</li>
</ul>
<p>解决思路是根据判断voCourse中的id是否为空，在执行添加操作时id值是为空的，反之则不为空</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据voCourse的id来判断是添加还是更新操作</span></span><br><span class="line"><span class="title function_">addOrUpdate</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">voCourse</span>.<span class="property">id</span> === <span class="string">&#x27;&#x27;</span>)&#123;<span class="comment">//为空代表是添加操作</span></span><br><span class="line">        <span class="comment">//阻止空页面和内容添加</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">voCourse</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">voCourse</span>.<span class="property">subjectId</span> === <span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;请先添加数据再执行下一步！！！&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addCourse</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; <span class="comment">//不为空代表是更新操作</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateCourseInfoById</span>()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除课程"><a href="#删除课程" class="headerlink" title="删除课程"></a>删除课程</h4><p>①在api&#x2F;edu&#x2F;下的course.文件中添加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">delCourseById</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceedu/course/del/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②并在对应的页面进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除指定id的课程 </span></span><br><span class="line"><span class="title function_">handleDelete</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$confirm(<span class="string">&quot;此操作将永久删除该文件, 是否继续?&quot;</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//调用删除方法</span></span><br><span class="line">        course.<span class="title function_">delCourseById</span>(id)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//删除成功弹窗</span></span><br><span class="line">            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&quot;删除成功!&quot;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//刷新页面</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getList</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, </span><br></pre></td></tr></table></figure>

<h4 id="添加-x2F-修改-x2F-删除章节"><a href="#添加-x2F-修改-x2F-删除章节" class="headerlink" title="添加&#x2F;修改&#x2F;删除章节"></a>添加&#x2F;修改&#x2F;删除章节</h4><ul>
<li>内容过于繁琐，在views&#x2F;edu&#x2F;course&#x2F;chapter.vue下可详细查看</li>
<li><font color='red'><strong>添加&#x2F;修改&#x2F;删除课程小节的前端逻辑与添加课程章节几乎是一模一样的</strong></font></li>
</ul>
<h4 id="添加-删除-小节视频"><a href="#添加-删除-小节视频" class="headerlink" title="添加(删除)小节视频"></a>添加(删除)小节视频</h4><p>①在api&#x2F;edu&#x2F;下创建barvideos.js文件并添加方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">delAliyunVideoById</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/servicevod/videoDel/&#x27;</span>+id,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>②在对应页面添加上传功能组件和调用对应的上传或删除方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label=<span class="string">&quot;上传视频&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-upload</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">ref</span>=<span class="string">&quot;upload&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:auto-upload</span>=<span class="string">&quot;true&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:on-success</span>=<span class="string">&quot;fileUploadSuccess&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:on-error</span>=<span class="string">&quot;fileUploadError&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:before-remove</span>=<span class="string">&quot;beforeRemove&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:on-remove</span>=<span class="string">&quot;removeVideo&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:disabled</span>=<span class="string">&quot;importBtnDisabled&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:limit</span>=<span class="string">&quot;1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">:action</span>=<span class="string">&quot;BASE_API+&#x27;/servicevod/videoUpload&#x27;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">name</span>=<span class="string">&quot;file&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">accept</span>=<span class="string">&quot;video/*&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">slot</span>=<span class="string">&quot;trigger&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>选取视频<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span> </span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除视频之前的钩子方法</span></span><br><span class="line"><span class="title function_">beforeRemove</span>(<span class="params">file</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.$confirm(<span class="string">`确定移除 <span class="subst">$&#123; file.name &#125;</span>？`</span>)  </span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//删除视频的方法</span></span><br><span class="line"><span class="title function_">removeVideo</span>(<span class="params"></span>)&#123;</span><br><span class="line">   barvideo.<span class="title function_">delAliyunVideoById</span>(<span class="variable language_">this</span>.<span class="property">eduVoder</span>.<span class="property">videoSourceId</span>)</span><br><span class="line">       .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">       <span class="comment">//提示信息</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;移除成功&quot;</span>)</span><br><span class="line">       <span class="comment">//清空文件列表</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">fileList</span> = []</span><br><span class="line">       <span class="comment">//清空eduVoder的文件名字和文件id</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">eduVoder</span>.<span class="property">videoSourceId</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">eduVoder</span>.<span class="property">videoOriginalName</span>= <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//视频上传成功的回调方法</span></span><br><span class="line"><span class="title function_">fileUploadSuccess</span>(<span class="params">response,flie</span>)&#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">//提示信息</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;上传成功&#x27;</span>)(&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">eduVoder</span>.<span class="property">videoSourceId</span> = response.<span class="property">data</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">eduVoder</span>.<span class="property">videoOriginalName</span> = file.<span class="property">name</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//视频上传失败的回调方法</span></span><br><span class="line"><span class="title function_">fileUploadError</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">//提示信息</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;上传失败&#x27;</span>)</span><br><span class="line">    <span class="comment">//清空文件列表</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fileList</span> = []</span><br><span class="line">    <span class="comment">//清空eduVoder的文件名字和文件id</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">eduVoder</span>.<span class="property">videoSourceId</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">eduVoder</span>.<span class="property">videoOriginalName</span>= <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>





<h3 id="后端接口-2"><a href="#后端接口-2" class="headerlink" title="后端接口"></a>后端接口</h3><ul>
<li>使用代码生成器快速生成对应实体类以及其他信息</li>
</ul>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220822221918179.png"></p>
<h4 id="添加课程-3"><a href="#添加课程-3" class="headerlink" title="添加课程"></a>添加课程</h4><ul>
<li>使用一个vo值对象接收参数</li>
<li>需要将数据插入课程表和课程简介表两张表中</li>
<li>需要将所有讲师和所有课表通过下列列表显示</li>
</ul>
<p> ①创建vo值对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VOCourse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line">    <span class="keyword">private</span> String subjectId;</span><br><span class="line">    <span class="keyword">private</span> String subjectParentId;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②控制层接收参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加课程</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult <span class="title function_">addCourse</span><span class="params">(<span class="meta">@RequestBody</span> VOCourse voCourse)</span>&#123;</span><br><span class="line">    eduCourseService.addCourse(voCourse);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③在业务类中将数据插入课程表和课程信息表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加课程</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCourse</span><span class="params">(VOCourse voCourse)</span> &#123;</span><br><span class="line">    <span class="comment">//1.添加课程信息</span></span><br><span class="line">    <span class="type">EduCourse</span> <span class="variable">eduCourse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EduCourse</span>();</span><br><span class="line">    BeanUtils.copyProperties(voCourse,eduCourse);</span><br><span class="line">    <span class="type">int</span> result= baseMapper.insert(eduCourse);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30000</span>,<span class="string">&quot;出现异常,课程添加失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取已经插入数据库的课程信息主键</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">courseId</span> <span class="operator">=</span> eduCourse.getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.添加课程简介信息</span></span><br><span class="line">    <span class="type">EduCourseDescription</span> <span class="variable">description</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EduCourseDescription</span>();</span><br><span class="line">    <span class="comment">//设置课程简介信息对象id，用于和课程信息对象维持关联</span></span><br><span class="line">    description.setId(courseId);</span><br><span class="line">    description.setDescription(voCourse.getDescription());</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">insertResult</span> <span class="operator">=</span> descriptionService.save(description);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!insertResult)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30000</span>,<span class="string">&quot;出现异常,课程简介信息添加失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="课程大纲-1"><a href="#课程大纲-1" class="headerlink" title="课程大纲"></a>课程大纲</h4><ul>
<li>与课程分类管理类似，都是通过拼装对应属性的对象最后回传</li>
</ul>
<p>①创建CourseChapter、CourseBar对象并建立关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseChapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> List&lt;CourseBar&gt; courseBarList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseBar</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②控制层接收指定id的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询指定课程章节</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;CourseChapter&gt;&gt; <span class="title function_">getCourseChaptersByCid</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span>&#123;</span><br><span class="line">    List&lt;CourseChapter&gt; chapterList = eduChapterService.getChapterListByCid(courseId);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,chapterList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③业务层负责查询指定的id数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询课程章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CourseChapter&gt; <span class="title function_">getChapterListByCid</span><span class="params">(String courseId)</span> &#123;</span><br><span class="line">    <span class="comment">//用于封装最终返回所有课程章节对象的集合</span></span><br><span class="line">    List&lt;CourseChapter&gt; courseChapterList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据指定id查询课程章节</span></span><br><span class="line">    QueryWrapper&lt;EduChapter&gt; chapterWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    chapterWrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId);</span><br><span class="line">    chapterWrapper.orderByAsc(<span class="string">&quot;sort&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到指定id对应的课程章节集合</span></span><br><span class="line">    List&lt;EduChapter&gt; chapterList = <span class="built_in">this</span>.baseMapper.selectList(chapterWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历查询课程小节</span></span><br><span class="line">    <span class="keyword">for</span> (EduChapter chapter : chapterList) &#123;</span><br><span class="line">        <span class="comment">//创建一个用个封装从数据库得到的章节对象到值对象CourseChapter中</span></span><br><span class="line">        <span class="type">CourseChapter</span> <span class="variable">courseChapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CourseChapter</span>();</span><br><span class="line">        BeanUtils.copyProperties(chapter,courseChapter);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据章节id查询所有小节集合</span></span><br><span class="line">        QueryWrapper&lt;EduVideo&gt; barWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        barWrapper.eq(<span class="string">&quot;chapter_id&quot;</span>,chapter.getId());</span><br><span class="line">        barWrapper.orderByAsc(<span class="string">&quot;sort&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到指定课程章节的课程小节集合</span></span><br><span class="line">        List&lt;EduVideo&gt; videoList = eduVideoMapper.selectList(barWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先创建一个用于封装课程小节对象的集合</span></span><br><span class="line">        List&lt;CourseBar&gt; courseBarList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(EduVideo video : videoList)&#123;</span><br><span class="line">            <span class="comment">//创建一个用个封装从数据库得到的小节对象到值对象CourseBar中</span></span><br><span class="line">            <span class="type">CourseBar</span> <span class="variable">courseBar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CourseBar</span>();</span><br><span class="line">            BeanUtils.copyProperties(video,courseBar);</span><br><span class="line">            <span class="comment">//没查出一个就加入到courseBarList集合中</span></span><br><span class="line">            courseBarList.add(courseBar);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//设置值对象courseChapter的第三个参数值</span></span><br><span class="line">        courseChapter.setCourseBarList(courseBarList);</span><br><span class="line">        <span class="comment">//加入到封装courseChapter值对象的集合中</span></span><br><span class="line">        courseChapterList.add(courseChapter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> courseChapterList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="确认课程-1"><a href="#确认课程-1" class="headerlink" title="确认课程"></a>确认课程</h4><p>①根据前端需要的属性构造值对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VOPublish</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String lessonNum;</span><br><span class="line">    <span class="keyword">private</span> String oneSubject;</span><br><span class="line">    <span class="keyword">private</span> String twoSubject;</span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②编写sql语句查询课程信息新并封装到值对象中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;vopublish&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.year21.onlineedu.serviceedu.vo.VOPublish&quot;</span>&gt;</span></span><br><span class="line">       	<span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;lessonNum&quot;</span> <span class="attr">column</span>=<span class="string">&quot;lesson_num&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;oneSubject&quot;</span> <span class="attr">column</span>=<span class="string">&quot;oneSubject&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;twoSubject&quot;</span> <span class="attr">column</span>=<span class="string">&quot;twoSubject&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;teacherName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;lessonNum&quot;</span> <span class="attr">column</span>=<span class="string">&quot;lessonNum&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cover&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    根据课程id查询相关信息 VOPublish getVOPublishById(@Param(&quot;id&quot;)String id);--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getVOPublishById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;vopublish&quot;</span>&gt;</span></span><br><span class="line">        SELECT c.`id`,c.`title`,c.`lesson_num`,c.`cover`,c.`price`,</span><br><span class="line">            t.`name`,temp2.title AS oneSubject,s.`title` AS twoSubject</span><br><span class="line">        FROM edu_course c</span><br><span class="line">        LEFT JOIN edu_teacher t</span><br><span class="line">        ON c.`teacher_id` = t.`id`</span><br><span class="line">        LEFT JOIN edu_subject s</span><br><span class="line">        ON c.`subject_id` = s.`id`</span><br><span class="line">        LEFT JOIN (</span><br><span class="line">               SELECT * FROM (</span><br><span class="line">                      SELECT</span><br><span class="line">                      id,title</span><br><span class="line">                      FROM edu_subject</span><br><span class="line">                      )AS temp</span><br><span class="line">               )AS temp2</span><br><span class="line">        ON c.`subject_parent_id` = temp2.id</span><br><span class="line">        WHERE c.`id` = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③持久层、④业务层、⑤控制层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EduCourseMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;EduCourse&gt; &#123;</span><br><span class="line">    <span class="comment">//根据课程id查询相关信息</span></span><br><span class="line">    VOPublish <span class="title function_">getVOPublishById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>String id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定课程id查询章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> EduChapter <span class="title function_">queryChapterById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.selectById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定id查询复合封装的课程信息对象</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;VOPublish&gt; <span class="title function_">queryVOPublishById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span>&#123;</span><br><span class="line">    <span class="type">VOPublish</span> <span class="variable">voPublish</span> <span class="operator">=</span> eduCourseService.queryVOPublishById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,voPublish);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最终发布-1"><a href="#最终发布-1" class="headerlink" title="最终发布"></a>最终发布</h4><p>②编写xml映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    int updateStatus(String courseId);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStatus&quot;</span>&gt;</span></span><br><span class="line">    update edu_course set status = &#x27;Normal&#x27; where id = #&#123;courseId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③持久层、④业务层、⑤控制层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据指定id修改课程状态为已发布</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@Param(&quot;courseId&quot;)</span> String courseId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定id修改课程状态为已发布</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateStatus</span><span class="params">(String courseId)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.updateStatus(courseId);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;修改失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定id修改课程状态为已发布</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateCourseStatusById</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span>&#123;</span><br><span class="line">    eduCourseService.updateStatus(courseId);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="课程列表-1"><a href="#课程列表-1" class="headerlink" title="课程列表"></a>课程列表</h4><p>①控制层接收参数</p>
<p>②业务层负责执行查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/conditionQuery/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Page&lt;EduCourse&gt;&gt; <span class="title function_">queryCondition</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize)</span>&#123;</span><br><span class="line">    Page&lt;EduCourse&gt; page = eduCourseService.queryCondition(pageNum,pageSize);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,page);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//条件查询</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Page&lt;EduCourse&gt; <span class="title function_">queryCondition</span><span class="params">(Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">    Page&lt;EduCourse&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.selectPage(page, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询课程信息-1"><a href="#查询课程信息-1" class="headerlink" title="查询课程信息"></a>查询课程信息</h4><p>①控制层接收参数，传至业务层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id查询指定课程信息</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/query/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;VOCourse&gt; <span class="title function_">queryInfoById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span>&#123;</span><br><span class="line">    <span class="type">VOCourse</span> <span class="variable">voCourse</span> <span class="operator">=</span> eduCourseService.queryCourseInfoById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,voCourse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②业务层负责查询指定id的信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id查询信息</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> VOCourse <span class="title function_">queryCourseInfoById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">//创建一个对象封装查询出的信息</span></span><br><span class="line">    <span class="type">VOCourse</span> <span class="variable">voCourse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VOCourse</span>();</span><br><span class="line">    <span class="comment">//根据id查询课程信息并填充至封装对象</span></span><br><span class="line">    <span class="type">EduCourse</span> <span class="variable">eduCourse</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.selectById(id);</span><br><span class="line">    BeanUtils.copyProperties(eduCourse,voCourse);</span><br><span class="line">    <span class="comment">//根据id课程简介信息并填充至封装对象</span></span><br><span class="line">    <span class="type">EduCourseDescription</span> <span class="variable">description</span> <span class="operator">=</span> descriptionService.getById(id);</span><br><span class="line">    voCourse.setDescription(description.getDescription());</span><br><span class="line">    <span class="comment">//返回封装对象</span></span><br><span class="line">    <span class="keyword">return</span> voCourse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新课程信息-1"><a href="#更新课程信息-1" class="headerlink" title="更新课程信息"></a>更新课程信息</h4><p>①控制层接收参数，传至业务层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id修改指定课程信息</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateInfoById</span><span class="params">(<span class="meta">@RequestBody</span> VOCourse voCourse)</span>&#123;</span><br><span class="line">    eduCourseService.updateCourseInfoById(voCourse);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②业务层负责修改指定id的信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id修改信息</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCourseInfoById</span><span class="params">(VOCourse voCourse)</span> &#123;</span><br><span class="line">    <span class="type">EduCourse</span> <span class="variable">eduCourse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EduCourse</span>();</span><br><span class="line">    BeanUtils.copyProperties(voCourse,eduCourse);</span><br><span class="line">    <span class="comment">//根据id修改课程信息</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.updateById(eduCourse);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30001</span>,<span class="string">&quot;修改课程信息失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据id修改课程简介信息</span></span><br><span class="line">    <span class="type">EduCourseDescription</span> <span class="variable">description</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EduCourseDescription</span>();</span><br><span class="line">    description.setId(voCourse.getId());</span><br><span class="line">    description.setDescription(voCourse.getDescription());</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">updateResult</span> <span class="operator">=</span> descriptionService.updateById(description);</span><br><span class="line">    <span class="keyword">if</span> (!updateResult)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30001</span>,<span class="string">&quot;修改课程信息失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除课程-1"><a href="#删除课程-1" class="headerlink" title="删除课程"></a>删除课程</h4><p>①控制层接收参数</p>
<p>②业务层负责执行处理删除，在这个删除课程中需要调用其他业务层来执行删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除指定课程及其下属的所有章节和小节</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/del/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delCourseById</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span>&#123;</span><br><span class="line">    eduCourseService.delCourseById(courseId);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IEduChapterService eduChapterService;</span><br><span class="line"><span class="comment">//删除课程</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delCourseById</span><span class="params">(String courseId)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;EduChapter&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId);</span><br><span class="line">    List&lt;EduChapter&gt; chapters = eduChapterService.list(queryWrapper);</span><br><span class="line">    <span class="comment">//表示当前课程下有章节和小节，需要批量删除</span></span><br><span class="line">    <span class="keyword">if</span> (chapters.size() != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(EduChapter chapter : chapters)&#123;</span><br><span class="line">            eduChapterService.delChapterById(chapter.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//以及删除课程描述</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">remove</span> <span class="operator">=</span> descriptionService.removeById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (!remove)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;删除指定课程描述失败，课程id是：&quot;</span> + courseId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当chapters.size()长度为0时，表示这个课程没有章节和小节，因此只需要删除当前课程即可</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.deleteById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;删除指定课程失败，课程id是：&quot;</span> + courseId);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="章节管理"><a href="#章节管理" class="headerlink" title="章节管理"></a>章节管理</h4><p>①控制层接收参数，传至业务层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加指定课程章节</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addChapterById</span><span class="params">(<span class="meta">@RequestBody</span> EduChapter eduChapter)</span>&#123;</span><br><span class="line">    eduChapterService.addNewChapterById(eduChapter);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改指定课程章节</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateChapterById</span><span class="params">(<span class="meta">@RequestBody</span> EduChapter eduChapter)</span>&#123;</span><br><span class="line">    eduChapterService.updateChapterById(eduChapter);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除指定课程章节</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/del/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delChapterById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span>&#123;</span><br><span class="line">    eduChapterService.delChapterById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询指定课程章节</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/query/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;EduChapter&gt; <span class="title function_">queryChapterById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span>&#123;</span><br><span class="line">    <span class="type">EduChapter</span> <span class="variable">chapter</span> <span class="operator">=</span> eduChapterService.queryChapterById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,chapter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②业务层负责修改指定id的信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据指定课程id添加章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNewChapterById</span><span class="params">(EduChapter eduChapter)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.insert(eduChapter);</span><br><span class="line">    <span class="keyword">if</span> (result ==<span class="number">0</span> )&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30001</span>,<span class="string">&quot;添加章节失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定课程id修改章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateChapterById</span><span class="params">(EduChapter eduChapter)</span> &#123;</span><br><span class="line">    UpdateWrapper&lt;EduChapter&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(<span class="string">&quot;course_id&quot;</span>,eduChapter.getCourseId());</span><br><span class="line">    <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.update(eduChapter, updateWrapper);</span><br><span class="line">    <span class="keyword">if</span> (update ==<span class="number">0</span> )&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30001</span>,<span class="string">&quot;更新章节失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定课程id删除章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delChapterById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">//先判断是否存在小节需要删除</span></span><br><span class="line">    UpdateWrapper&lt;EduVideo&gt; wrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;chapter_id&quot;</span>,id);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> eduVideoMapper.selectCount(wrapper);</span><br><span class="line">    <span class="keyword">if</span> (count != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">videoDelResult</span> <span class="operator">=</span> eduVideoMapper.delete(wrapper);</span><br><span class="line">        <span class="keyword">if</span> (videoDelResult == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;删除指定小节失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//再删除章节</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.deleteById(id);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;删除指定章节失败,章节id是：&quot;</span> + id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定课程id查询章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> EduChapter <span class="title function_">queryChapterById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.selectById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><font color='red'><strong>课程小节的后端接口与课程章节几乎是一模一样的，就不再重复书写了</strong></font></li>
</ul>
<h4 id="添加小节视频"><a href="#添加小节视频" class="headerlink" title="添加小节视频"></a>添加小节视频</h4><p>①在service模块下创建子模式service_vod负责视频上传相关内容</p>
<p>②引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--aliyun--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③编写控制层，接收参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/serviceedu/video&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoUploadService videoUploadService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">uploadVideoToAliyun</span><span class="params">(<span class="meta">@RequestPart</span> MultipartFile file)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">videoSourceId</span> <span class="operator">=</span> videoUploadService.uploadVideo(file);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;上传成功&quot;</span>,videoSourceId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>④业务层负责执行文件的上传</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理视频文件上传</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">uploadVideo</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> UUID.randomUUID().toString(); <span class="comment">//上传成功到阿里云显示的名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename(); <span class="comment">//上传文件的原始名称</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        inputStream = file.getInputStream();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">UploadStreamRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadStreamRequest</span>(UploadConfigClass.ACCESS_KEY_ID,UploadConfigClass.ACCESS_KEY_SECRET, title, fileName, inputStream);</span><br><span class="line">    <span class="type">UploadVideoImpl</span> <span class="variable">uploader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadVideoImpl</span>();</span><br><span class="line">    <span class="type">UploadStreamResponse</span> <span class="variable">response</span> <span class="operator">=</span> uploader.uploadStream(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (response.isSuccess()) &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;VideoId=&quot;</span> + response.getVideoId() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> response.getVideoId();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//如果设置回调URL无效，不影响视频上传，可以返回VideoId同时会返回错误码。其他情况上传失败时，VideoId为空，此时需要根据返回错误码分析具体错误原因</span></span><br><span class="line">        System.out.print(<span class="string">&quot;VideoId=&quot;</span> + response.getVideoId() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;ErrorCode=&quot;</span> + response.getCode() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;ErrorMessage=&quot;</span> + response.getMessage() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> response.getVideoId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除小节视频"><a href="#删除小节视频" class="headerlink" title="删除小节视频"></a>删除小节视频</h4><p>①创建一个类初始化删除阿里云视频的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadConfigClass</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.vod.file.keyid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keyid;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.vod.file.keysecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keysecret;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_SECRET;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        ACCESS_KEY_ID = keyid;</span><br><span class="line">        ACCESS_KEY_SECRET = keysecret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②创建控制层接收删除视频的id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/videoDel/&#123;videoSourceId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delVideoInAliyun</span><span class="params">(<span class="meta">@PathVariable(&quot;videoSourceId&quot;)</span> String videoSourceId)</span>&#123;</span><br><span class="line">    videoUploadService.delUploadVideo(videoSourceId);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③业务层负责处理将阿里云中的指定id视频删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据视频id删除视频</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delUploadVideo</span><span class="params">(String videoSourceId)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1.创建初始化对象</span></span><br><span class="line">        <span class="type">DefaultAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> VodInitClass.initVodClient(UploadConfigClass.ACCESS_KEY_ID, UploadConfigClass.ACCESS_KEY_SECRET);</span><br><span class="line">        <span class="comment">//2.创建删除视频的request对象</span></span><br><span class="line">        <span class="type">DeleteVideoRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteVideoRequest</span>();</span><br><span class="line">        <span class="comment">//3.向request对象中设置需要删除的视频id</span></span><br><span class="line">        request.setVideoIds(videoSourceId);</span><br><span class="line">        <span class="comment">//4.调用初始化对象方法将request传入删除视频</span></span><br><span class="line">        client.getAcsResponse(request);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="统计分析"><a href="#统计分析" class="headerlink" title="统计分析"></a>统计分析</h2><h3 id="前端页面-3"><a href="#前端页面-3" class="headerlink" title="前端页面"></a>前端页面</h3><ul>
<li>整合echarts，使用npm install –save <a href="mailto:&#101;&#x63;&#x68;&#x61;&#x72;&#x74;&#115;&#x40;&#52;&#x2e;&#49;&#x2e;&#48;">&#101;&#x63;&#x68;&#x61;&#x72;&#x74;&#115;&#x40;&#52;&#x2e;&#49;&#x2e;&#48;</a></li>
</ul>
<p>①在api文件下创建statistic.js文件，创建被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="comment">//创建数据</span></span><br><span class="line">    <span class="title function_">countRegister</span>(<span class="params">day</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicedaily/countNum/<span class="subst">$&#123;day&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取图表显示需要的数据</span></span><br><span class="line">    <span class="title function_">showData</span>(<span class="params">seacheObj</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicedaily/showTableData/<span class="subst">$&#123;seacheObj.type&#125;</span>/<span class="subst">$&#123;seacheObj.begin&#125;</span>/<span class="subst">$&#123;seacheObj.end&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应的页面进行调用</p>
<h3 id="后端接口-3"><a href="#后端接口-3" class="headerlink" title="后端接口"></a>后端接口</h3><p>①创建新的数据表存储统计分析所需的数据</p>
<p>②在service模块下创建子模块service_statistics</p>
<p>③改pom文件</p>
<p>④编写yml配置文件</p>
<p>⑤主启动类</p>
<p>⑥业务类</p>
<p>需要创建两个接口</p>
<ul>
<li>在userCenter模块创建被调用接口，查询userCenter表中某个时间的注册人数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询某一天的注册人数</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;count/&#123;day&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">countRegisterNumInOneDay</span><span class="params">(<span class="meta">@PathVariable(&quot;day&quot;)</span>String day)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  userCenterService.countRegisterNumInOneDay(day);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询某一天的注册人数</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">countRegisterNumInOneDay</span><span class="params">(String day)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.countRegisterNumInOneDay(day);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Integer <span class="title function_">countRegisterNumInOneDay</span><span class="params">(<span class="meta">@Param(&quot;day&quot;)</span> String day)</span>;</span><br><span class="line"></span><br><span class="line">&lt;!--    Integer <span class="title function_">countRegisterNumInOneDay</span><span class="params">(String day)</span>;--&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;countRegisterNumInOneDay&quot;</span> resultType=<span class="string">&quot;integer&quot;</span>&gt;</span><br><span class="line">    select <span class="title function_">count</span><span class="params">(*)</span> from usercenter_member <span class="title function_">DATE</span><span class="params">(gmt_create)</span> = #&#123;day&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在statistics模块创建接口，调用其他模块接口并插入一条新数据到daily表中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//统计某一天的注册人数</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/countNum/&#123;day&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">countRegisterNum</span><span class="params">(<span class="meta">@PathVariable(&quot;day&quot;)</span> String day)</span>&#123;</span><br><span class="line">    dailyService.countRegisterNumInOneDay(day);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countRegisterNumInOneDay</span><span class="params">(String day)</span> &#123;</span><br><span class="line">    <span class="comment">//获取指定日期的注册人数</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> uSerCenterTransfer.countRegisterNumInOneDay(day);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插入之前先判断是否存在该日期的记录</span></span><br><span class="line">    QueryWrapper&lt;Daily&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;date_calculated&quot;</span>,day);</span><br><span class="line">    <span class="type">Daily</span> <span class="variable">one</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.selectOne(wrapper);</span><br><span class="line">    <span class="keyword">if</span> (one != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//将注册人数记录更新</span></span><br><span class="line">        one.setRegisterNum(num);</span><br><span class="line">        <span class="comment">//插入数据库</span></span><br><span class="line">        <span class="built_in">this</span>.baseMapper.update(one,wrapper);</span><br><span class="line">        <span class="comment">//结束操作</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将注册人数的结果插入daily表中</span></span><br><span class="line">    <span class="type">Daily</span> <span class="variable">daily</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Daily</span>();</span><br><span class="line">    daily.setRegisterNum(num);</span><br><span class="line">    daily.setDateCalculated(day);</span><br><span class="line">    daily.setLoginNum(RandomNum.createRandomNum());</span><br><span class="line">    daily.setVideoViewNum(RandomNum.createRandomNum());</span><br><span class="line">    daily.setCourseNum(RandomNum.createRandomNum());</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.insert(daily);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30001</span>,<span class="string">&quot;插入统计数据异常!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><font color='red'><strong>使用定时任务完成统计分析</strong></font></li>
</ul>
<p>①在主启动类上添加@EnableScheduLing注解</p>
<p>②创建定时任务类并给spring管理，使用cron表达式(又称七子表达式或七域表达式)</p>
<p>七子表达式(七域表达式)：秒 分 时 日 月 周 年  –&gt; <a target="_blank" rel="noopener" href="https://www.pppet.net/">在线cron表达式生成器</a></p>
<p>③在需要执行定时任务的方法上使用@Scheduled注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduleTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IDailyService dailyService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//0/5 * * * * ?表示每到每天凌晨1点执行一次此方法</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ? &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ScheduleTask</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取前一天的日期</span></span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.now().plusDays(-<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//执行查询并添加操作</span></span><br><span class="line">        dailyService.countRegisterNumInOneDay(date.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>整合echarts，实现数据的图表显示</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询图标显示数据  控制层</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/showTableData/&#123;type&#125;/&#123;begin&#125;/&#123;end&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">showTableData</span><span class="params">(<span class="meta">@PathVariable(&quot;type&quot;)</span> String type,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@PathVariable(&quot;begin&quot;)</span> String begin,</span></span><br><span class="line"><span class="params">                                                    <span class="meta">@PathVariable(&quot;end&quot;)</span> String end)</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; data = dailyService.showTableData(type,begin,end);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据类型和时间查询图标数据  业务层</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">showTableData</span><span class="params">(String type, String begin, String end)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Daily&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//select()方法是根据指定的type字段进行查询</span></span><br><span class="line">    <span class="comment">//between()方法是在指定的时间范围之内</span></span><br><span class="line">    wrapper.select(<span class="string">&quot;date_calculated&quot;</span>,type).between(<span class="string">&quot;date_calculated&quot;</span>,begin,end);</span><br><span class="line">    List&lt;Daily&gt; list = <span class="built_in">this</span>.baseMapper.selectList(wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//拼凑返回前端的数组</span></span><br><span class="line">    List&lt;String&gt; dateList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; numList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Daily d: list) &#123;</span><br><span class="line">        <span class="comment">//封装日期</span></span><br><span class="line">        dateList.add(d.getDateCalculated());</span><br><span class="line">        <span class="comment">//封装数字</span></span><br><span class="line">        <span class="keyword">switch</span> (type)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;register_num&quot;</span>:</span><br><span class="line">                numList.add(d.getRegisterNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;login_num&quot;</span>:</span><br><span class="line">                numList.add(d.getLoginNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;video_view_num&quot;</span>:</span><br><span class="line">                numList.add(d.getVideoViewNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;course_num&quot;</span>:</span><br><span class="line">                numList.add(d.getCourseNum());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//封装到map中并返回</span></span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;date&quot;</span>,dateList);</span><br><span class="line">    map.put(<span class="string">&quot;num&quot;</span>,numList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="CMS管理"><a href="#CMS管理" class="headerlink" title="CMS管理"></a>CMS管理</h2><h3 id="前端页面-4"><a href="#前端页面-4" class="headerlink" title="前端页面"></a>前端页面</h3><p>①在api文件下创建comment.js文件并编写被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">queryBannerList</span>(<span class="params">pageNum,PageSize</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">`/servicecms/banneradmin/query/<span class="subst">$&#123;pageNum&#125;</span>/<span class="subst">$&#123;PageSize&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">addBanner</span>(<span class="params">banner</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&#x27;/servicecms/banneradmin/add&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: banner</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">updateBanner</span>(<span class="params">banner</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&#x27;/servicecms/banneradmin/update&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: banner</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">delBanner</span>(<span class="params">id</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">`/servicecms/banneradmin/del/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">queryBanner</span>(<span class="params">id</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">`/servicecms/banneradmin/query/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">queryBannerByTitle</span>(<span class="params">title,pageNum,pageSize</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">`/servicecms/banneradmin//queryByTitle/<span class="subst">$&#123;title&#125;</span>/<span class="subst">$&#123;pageNum&#125;</span>/<span class="subst">$&#123;pageSize&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应页面进行调用</p>
<h3 id="后端接口-4"><a href="#后端接口-4" class="headerlink" title="后端接口"></a>后端接口</h3><p>①通过代码生成器快速生成对应实体类等</p>
<p>②在service模块下创建子模块service_cms</p>
<p>③改pom文件(使用父类依赖，不需要导入什么)</p>
<p>④编写yml配置文件</p>
<p>⑤主启动类</p>
<p>⑥业务类</p>
<ul>
<li>所有过程与评论管理模块相似且篇幅过长，不再此赘述，可到service_cms下细看</li>
</ul>
<hr>
<h2 id="评论管理"><a href="#评论管理" class="headerlink" title="评论管理"></a>评论管理</h2><h3 id="前端页面-5"><a href="#前端页面-5" class="headerlink" title="前端页面"></a>前端页面</h3><p>①在api文件下创建comment.js文件并编写被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">getAllComment</span>(<span class="params">pageNum,pageSize,VOComment</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/servicecomment/getAllComment/<span class="subst">$&#123;pageNum&#125;</span>/<span class="subst">$&#123;pageSize&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>:<span class="title class_">VOComment</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">delComment</span>(<span class="params">commentIds</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/servicecomment/del/<span class="subst">$&#123;commentIds&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">reportComment</span>(<span class="params">commentId</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicecomment/report/<span class="subst">$&#123;commentId&#125;</span>/0`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">showTeacher</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicecomment/showTeacher`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">showCourse</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicecomment/showCourse`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应页面进行调用</p>
<h3 id="后端接口-5"><a href="#后端接口-5" class="headerlink" title="后端接口"></a>后端接口</h3><p>①通过代码生成器快速生成对应实体类等</p>
<p>②在service模块下创建子模块service_comment</p>
<p>③改pom文件(使用父类依赖，不需要导入什么)</p>
<p>④编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8009</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-comment</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_edu?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="comment">#设置时间格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="comment">#将edu_service注册到nacos服务注册中心</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露所有的监控端点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">  <span class="comment">#设置不检查redis的健康状态，因为引入了actuator依赖会自带检查一些东西的健康状态</span></span><br><span class="line">  <span class="comment">#因为还没用到redis，若不设置会报一个无法连接redis的错误</span></span><br><span class="line">  <span class="attr">health:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#一旦使用xml映射文件就必须设置这个路径,建议每次在创建时就加上</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.slf4j.Slf4jImpl</span></span><br></pre></td></tr></table></figure>

<p>⑤主启动类</p>
<p>⑥业务类</p>
<ul>
<li>篇幅过长，不再此赘述，可到service_comment下细看</li>
</ul>
<hr>
<h2 id="订单管理"><a href="#订单管理" class="headerlink" title="订单管理"></a>订单管理</h2><h3 id="前端页面-6"><a href="#前端页面-6" class="headerlink" title="前端页面"></a>前端页面</h3><p>①在api文件下创建comment.js文件并编写被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">getOrders</span>(<span class="params">pageNum,pageSize,voOrder,status</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/serviceorder/order/allOrder/<span class="subst">$&#123;pageNum&#125;</span>/<span class="subst">$&#123;pageSize&#125;</span>/<span class="subst">$&#123;status&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: voOrder,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">delOrder</span>(<span class="params">ids</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/serviceorder/order/del/<span class="subst">$&#123;ids&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应页面进行调用</p>
<h3 id="后端接口-6"><a href="#后端接口-6" class="headerlink" title="后端接口"></a>后端接口</h3><p>①通过代码生成器快速生成对应实体类等</p>
<p>②在service模块下创建子模块service_order</p>
<p>③改pom文件(使用父类依赖，不需要导入什么)</p>
<p>④编写yml配置文件</p>
<p>⑤主启动类</p>
<p>⑥业务类</p>
<ul>
<li>篇幅过长，不再此赘述，可到service_order下细看</li>
</ul>
<hr>
<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><h3 id="整合Spring-Security"><a href="#整合Spring-Security" class="headerlink" title="整合Spring Security"></a>整合Spring Security</h3><ul>
<li>整合步骤</li>
</ul>
<p>①在公共模块下创建子模块Spring Security</p>
<p>②引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.year21.onlineedu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_utils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Security依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③创建下图的核心配置类、实体类、过滤器、工具类等</p>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220904151051702.png"></p>
<p>④在acl模块中引入spring security的依赖</p>
<p>⑤在acl模块中创建查询用户登录权限类并实现UserDetails接口，以接收和保存查询到的登录信息</p>
<p>⑥在acl模块中创建一个业务类并实现UserDetailsService接口，在这个实现类中编写查询数据库的逻辑</p>
<ul>
<li>用户认证和用户授权的过程</li>
</ul>
<p>①TokenLoginFilter过滤器会在attemptAuthentication方法中通过请求拿到登录的用户信息</p>
<p>②通过实现类重写的loadUserByUsername的方法中判断用户登录信息是否正确并查询该用户</p>
<p>对应的权限列表保存在实现了UserDetails接口的自定义用户登录权限类中，决定调用认证</p>
<p>成功的方法还是认证失败的方法</p>
<p>③如果认证成功，调用认证成功的方法，在这个方法中根据用户名生成token并返回，在返回之前</p>
<p>将用户名和其对应的权限列表存入redis缓存中</p>
<p>④在前端接收到token后会放入cookie中，而在每次发起访问请求又会将token从cookie中取出</p>
<p>放到请求头上。</p>
<p>⑤后端接受到请求后，TokenAuthenticationFilter过滤器的UsernamePasswordAuthenticationToken</p>
<p>方法会从请求头中取出token，根据token获取用户名，再利用用户名从redis中获取到对应用户的访问</p>
<p>权限列表，最终进行授权</p>
<h3 id="前端页面-7"><a href="#前端页面-7" class="headerlink" title="前端页面"></a>前端页面</h3><ul>
<li>前端页面需要替换很多文件，在此不再赘述</li>
</ul>
<h3 id="后台接口"><a href="#后台接口" class="headerlink" title="后台接口"></a>后台接口</h3><p>目的：不同角色的用户在登录后，在后台管理系统中应拥有不同的菜单和功能权限</p>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220904004526222.png"></p>
<ul>
<li>步骤</li>
</ul>
<p>①在service模块下创建子模块service_acl</p>
<p>②改pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.year21.onlineedu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring_security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8011</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-acl</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_edu?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="comment">#设置时间格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.slf4j.Slf4jImpl</span></span><br></pre></td></tr></table></figure>

<p>④业务类</p>
<ul>
<li><p>递归查询所有菜单思路：</p>
<p>先查询出所有的数据，遍历所有数据列表根据pid值为1查询出所有的顶级分类列表，</p>
<p>遍历顶级分类列表，通过一个递归方法传入当前顶级分类对象和所有的数据列表，将当前</p>
<p>顶级分类的id与数据列表每一个对象的pid做对比，当相同则代表此对象为当前顶级分类下</p>
<p>的子分类，则添加进当前顶级分类的子节点数组中，此后将此对象和所有的数据列表中放入</p>
<p>递归方法中，反复调用，直至循环结束</p>
</li>
<li><p>递归删除菜单思路：</p>
<p>先根据指定的id查询所有的子节点，判断是否有子节点，有则反复调用自己，本身就是递归方法</p>
<p>没有则直接删除即可。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;PermissionMapper, Permission&gt; <span class="keyword">implements</span> <span class="title class_">IPermissionService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有权限列表</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Permission&gt; <span class="title function_">queryAllPermission</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取所有数据</span></span><br><span class="line">        QueryWrapper&lt;Permission&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        List&lt;Permission&gt; permissionList = <span class="built_in">this</span>.baseMapper.selectList(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装成需要的树形结构</span></span><br><span class="line">        List&lt;Permission&gt; resultList = buildNeedTreePermission(permissionList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装树形结构的具体方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Permission&gt; <span class="title function_">buildNeedTreePermission</span><span class="params">(List&lt;Permission&gt; permissionList)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//用于封装权限树形结构的数组</span></span><br><span class="line">        List&lt;Permission&gt; finalTreePermissionList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历获取顶层权限并设置其等级为1</span></span><br><span class="line">        <span class="keyword">for</span> (Permission p: permissionList) &#123;</span><br><span class="line">            <span class="comment">//顶层权限</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span>.equals(p.getPid()))&#123;</span><br><span class="line">                <span class="comment">//设置等级为1</span></span><br><span class="line">                p.setLevel(<span class="number">1</span>);</span><br><span class="line">                <span class="comment">//获取子节点</span></span><br><span class="line">                finalTreePermissionList.add(selectChildren(p,permissionList));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> finalTreePermissionList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取某个一级菜单下的所有子节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Permission <span class="title function_">selectChildren</span><span class="params">(Permission p, List&lt;Permission&gt; permissionList)</span> &#123;</span><br><span class="line">        <span class="comment">//先将当前一级菜单的子节点对象初始化</span></span><br><span class="line">        p.setChildren(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装子节点并递归查询所有子节点</span></span><br><span class="line">        <span class="keyword">for</span> (Permission obj : permissionList )&#123;</span><br><span class="line">            <span class="keyword">if</span> (p.getId().equals(obj.getPid()))&#123; <span class="comment">//说明此obj是当前一级菜单的子节点</span></span><br><span class="line">                <span class="comment">//设置obj对象为二级菜单</span></span><br><span class="line">                obj.setLevel(p.getLevel()+<span class="number">1</span>);</span><br><span class="line">                <span class="comment">//放入一级菜单的子节点列表中</span></span><br><span class="line">                p.getChildren().add(selectChildren(obj,permissionList));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除菜单(递归删除所有节点)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delPermissionById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">//先查询是否有子节点</span></span><br><span class="line">        QueryWrapper&lt;Permission&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;pid&quot;</span>,id);</span><br><span class="line">        List&lt;Permission&gt; delList = <span class="built_in">this</span>.baseMapper.selectList(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (delList.size() != <span class="number">0</span>)&#123;<span class="comment">//表示有子节点，需要递归删除</span></span><br><span class="line">            <span class="keyword">for</span> (Permission node : delList)&#123;</span><br><span class="line">                delPermissionById(node.getId());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//表示没有子节点，直接删除</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.deleteById(id);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;删除菜单失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//给角色分配权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">givePermission</span><span class="params">(String roleId, String[] permissionIds)</span> &#123;</span><br><span class="line">        <span class="comment">//创建封装RolePermission的集合</span></span><br><span class="line">        List&lt;RolePermission&gt; rolePermissionList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//遍历permissionIds</span></span><br><span class="line">        <span class="keyword">for</span> (String pid : permissionIds)&#123;</span><br><span class="line">            <span class="type">RolePermission</span> <span class="variable">rolePermission</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RolePermission</span>();</span><br><span class="line">            rolePermission.setRoleId(roleId);</span><br><span class="line">            rolePermission.setPermissionId(pid);</span><br><span class="line">            rolePermissionList.add(rolePermission);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//插入数据库</span></span><br><span class="line">        rolePermissionService.saveBatch(rolePermissionList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="登录过程分析"><a href="#登录过程分析" class="headerlink" title="登录过程分析"></a>登录过程分析</h3><blockquote>
<p>好像没被spring security放行的请求都会每次都会被拦截去请求selectPermissionValueByUserId</p>
<p>方法去获取用户id对应的权限列表 做鉴权</p>
</blockquote>
<p>①在前端发送登录请求之后，在拦截器中对登录用户进行判断，判断用户存在之后会去查询用户信息和</p>
<p>其对应权限列表，并将这些信息保存在spring security保存登录信息的实体类中</p>
<p>②在经过登录拦截器之后调用登录成功的方法根据用户名生成的token并返回到前端，将用户名和用户名</p>
<p>对应的权限值列表存储到redis中，而在前端会将该token存储在cookie中，在接下来的任何请求的请求头</p>
<p>中都携带着token信息，在每次发起访问请求又会将token从cookie中取出放到请求头上。</p>
<p>③<font color='red'><strong>并且由于vue配置了全局路由卫士permission.js在每访问一个页面都会查看token判断是否登录，</strong></font></p>
<p>经过上面的操作此时token时有登录信息的，因此会发起请求获取对应用户的信息和能够访问的菜单</p>
<p>④后端在接受请求后会从请求头中取token信息中，根据token信息获取用户名，根据用户名从redis中</p>
<p>查询数据，给该用户授权，再发送info请求获取用户信息的请求并返回查询出的数据，在这个方法中会</p>
<p>获取用户信息(页面展示需要)、用户角色列表(页面展示需要)、用户权限列表(判断页面按钮是否显示需要)</p>
<p>前端会将这些信息存储在vuex负责管理应用状态的store对象中</p>
<p>⑤后端还会接受到menu动态获取对应用户的路由菜单的请求，在这个方法中，会先判断用户角色，</p>
<p>如果是管理员获取全部，否则只获取对应用户的权限列表，通过递归方法获得权限列表，再进行封装，</p>
<p>最后返回类似前端路由形式的数据。前端接受这些数据后，经过vue渲染，从而能够在侧边栏和路由界面</p>
<p>进行访问</p>
<hr>
<h1 id="前台系统"><a href="#前台系统" class="headerlink" title="前台系统"></a>前台系统</h1><p>使用NUXT框架搭建前台系统，NUXT是一种服务端渲染技术框架，且NUXT是对node.js进行了封装</p>
<ul>
<li>搭建步骤</li>
</ul>
<p>1、使用NUXT提供的starter-template-master模板文件</p>
<p>starter-template-master模板是基于Vue实现的</p>
<p>2、将模板文件中的template文件中的内容解压到VSCode的工作区的某个文件中</p>
<p>3、修改模板文件中的配置信息</p>
<p>4、通过集成终端键入npm install 根据package.json安装依赖</p>
<ul>
<li>项目结构说明</li>
</ul>
<p>.nuxt是前端工程编译后的文件，不允许更改</p>
<p>.asset是存储项目中使用的静态资源，js、img、css等</p>
<p>.component是项目中需要使用的公共组件</p>
<p>layouts中的default.vue是定义网页布局的方式</p>
<p>.node_modules是项目的依赖文件</p>
<p>pages是放在项目中的具体页面</p>
<p>nuxt.config.js是nuxy框架中的核心配置文件</p>
<p>（1）资源目录 assets</p>
<p> 用于组织未编译的静态资源如 LESS、SASS 或 JavaScript。</p>
<p>（2）组件目录 components</p>
<p>用于组织应用的 Vue.js 组件。Nuxt.js 不会扩展增强该目录下 Vue.js 组件，即这些组件不会像页面组件那样有 asyncData 方法的特性。</p>
<p>（3）布局目录 layouts</p>
<p>用于组织应用的布局组件。</p>
<p>（4）页面目录 pages</p>
<p>用于组织应用的路由及视图。Nuxt.js 框架读取该目录下所有的 .vue 文件并自动生成对应的路由配置。</p>
<p>（5）插件目录 plugins</p>
<p>用于组织那些需要在 根vue.js应用 实例化之前需要运行的 Javascript 插件。</p>
<p>（6）nuxt.config.js 文件</p>
<p>nuxt.config.js 文件用于组织Nuxt.js 应用的个性化配置，以便覆盖默认配置。</p>
<h2 id="NUXT路由"><a href="#NUXT路由" class="headerlink" title="NUXT路由"></a>NUXT路由</h2><p>1、固定路由：路径是固定地址，不会发生变化</p>
<p>①使用router-link构建路由，通过设置to属性跳转到指定地址，地址是&#x2F;course</p>
<ul>
<li>当点击此路由，会先到page文件夹下找course文件夹，再从course文件夹下找到index.vue文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/course&quot;</span> <span class="attr">tag</span>=<span class="string">&quot;li&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;current&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>课程<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②在page目录创建文件夹course ，在course目录创建index.vue</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">跳转过来了course</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、动态路由：每次生成的路由地址都不一样</p>
<p>①NUXT的动态路由是以下划线开头的vue文件，参数名为下划线后边的文件名</p>
<p>②在pages下的course目录下创建_id.vue</p>
<hr>
<h2 id="引入axios"><a href="#引入axios" class="headerlink" title="引入axios"></a>引入axios</h2><ul>
<li>由于NUXT框架没有像vue一样自带封装了ajax的axios，因此需要手动引入并封装</li>
</ul>
<p>在一个文件夹下创建request.js文件并写入以下内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://192.168.231.134:9001&#x27;</span>, <span class="comment">// api的base_url</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">20000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>

<h2 id="整合redis"><a href="#整合redis" class="headerlink" title="整合redis"></a>整合redis</h2><p><font color='red'><strong>一般将经常进行查询的，不太重要的，而又不经常修改的数据放入nosql的redis(基于内存的数据库)中</strong></font></p>
<h3 id="整合步骤"><a href="#整合步骤" class="headerlink" title="整合步骤"></a>整合步骤</h3><p>①引入依赖</p>
<p>由于redis缓存是公共应用，所以把依赖与配置添加到common模块里，在这个模块的pom文件添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②创建redis缓存配置类，配置插件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span> <span class="comment">//开启redis缓存注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//key序列化方式</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">//value序列化</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//value hashmap序列化</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="comment">//解决查询缓存转换异常的问题</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span></span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="type">RedisCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③在yml文件中设置redis的配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.231</span><span class="number">.134</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment">#最大阻塞等待时间(负数表示无限制)</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>④在需要缓存的方法上添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">/*@Cacheable注解表示将此查询方法的返回结果缓存在redis中</span></span><br><span class="line"><span class="comment">    value = &quot;banner&quot;,key = &quot;&#x27;selectIndexList&#x27;&quot;两个属性构成了此缓存在redis中的名字</span></span><br><span class="line"><span class="comment">    且key的值还需要额外再添加一对&#x27;&#x27;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;banner&quot;,key = &quot;&#x27;selectIndexList&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Banner&gt; <span class="title function_">queryAllBanner</span><span class="params">()</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Banner&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;sort&quot;</span>);</span><br><span class="line">    <span class="comment">//last方法，拼接sql语句</span></span><br><span class="line">    queryWrapper.last(<span class="string">&quot;limit 2&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.selectList(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SpringBoot缓存注解"><a href="#SpringBoot缓存注解" class="headerlink" title="SpringBoot缓存注解"></a>SpringBoot缓存注解</h3><p>（1）缓存@Cacheable，<font color='red'><strong>一般用在查询方法上</strong></font></p>
<p>根据方法对其返回结果进行缓存，下次请求时，如果缓存存在，则直接读取缓存数据返回；</p>
<p>如果缓存不存在，则执行方法，并把返回的结果存入缓存中。</p>
<table>
<thead>
<tr>
<th align="left"><strong>属性&#x2F;方法名</strong></th>
<th align="left"><strong>解释</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">value</td>
<td align="left">缓存名，必填，它指定了你的缓存存放在哪块命名空间</td>
</tr>
<tr>
<td align="left">cacheNames</td>
<td align="left">与 value 差不多，二选一即可</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">可选属性，可以使用 SpEL 标签自定义缓存的key</td>
</tr>
</tbody></table>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220828005052215.png"></p>
<p>（2）缓存@CachePut，<font color='red'><strong>一般用在新增方法上</strong></font></p>
<p>使用该注解标志的方法，每次都会执行，并将结果存入指定的缓存中。</p>
<p>其他方法可以直接从响应的缓存中读取缓存数据，而不需要再去查询数据库。</p>
<table>
<thead>
<tr>
<th><strong>属性&#x2F;方法名</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>缓存名，必填，它指定了你的缓存存放在哪块命名空间</td>
</tr>
<tr>
<td>cacheNames</td>
<td>与 value 差不多，二选一即可</td>
</tr>
<tr>
<td>key</td>
<td>可选属性，可以使用 SpEL 标签自定义缓存的key</td>
</tr>
</tbody></table>
<p>（3）缓存@CacheEvict，<font color='red'><strong>一般用在更新或者删除方法上</strong></font></p>
<p>使用该注解标志的方法，会清空指定的缓存。</p>
<table>
<thead>
<tr>
<th><strong>属性&#x2F;方法名</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>缓存名，必填，它指定了你的缓存存放在哪块命名空间</td>
</tr>
<tr>
<td>cacheNames</td>
<td>与 value 差不多，二选一即可</td>
</tr>
<tr>
<td>key</td>
<td>可选属性，可以使用 SpEL 标签自定义缓存的key</td>
</tr>
<tr>
<td>allEntries</td>
<td>是否清空所有缓存，默认为 false。如果指定为 true，则方法调用后将立即清空所有的缓存</td>
</tr>
<tr>
<td>beforeInvocation</td>
<td>是否在方法执行前就清空，默认为 false。如果指定为 true，则在方法执行前就会清空缓存</td>
</tr>
</tbody></table>
<h2 id="banner轮播图"><a href="#banner轮播图" class="headerlink" title="banner轮播图"></a>banner轮播图</h2><h3 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h3><ul>
<li>在数据库中创建一个新表维护banner所需的图片</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `crm_banner` (</span><br><span class="line">  `id` char(19) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;ID&#x27;,</span><br><span class="line">  `title` varchar(20) DEFAULT &#x27;&#x27; COMMENT &#x27;标题&#x27;,</span><br><span class="line">  `image_url` varchar(500) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;图片地址&#x27;,</span><br><span class="line">  `link_url` varchar(500) DEFAULT &#x27;&#x27; COMMENT &#x27;链接地址&#x27;,</span><br><span class="line">  `sort` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;排序&#x27;,</span><br><span class="line">  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,</span><br><span class="line">  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `uk_name` (`title`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;首页banner表&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="前端页面-8"><a href="#前端页面-8" class="headerlink" title="前端页面"></a>前端页面</h3><ul>
<li>需要先配置nginx的代理转发规则</li>
</ul>
<p>①创建用于被调用的js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">getBanner</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/servicecms/bannerfront/queryAll&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应页面进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line"><span class="title function_">getBanner</span>(<span class="params"></span>)&#123;</span><br><span class="line">   banner.<span class="title function_">getBanner</span>()</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">bannerList</span> = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端接口-7"><a href="#后端接口-7" class="headerlink" title="后端接口"></a>后端接口</h3><p>①在父工程service下创建子模块service-cms</p>
<p>②改pom文件</p>
<p>③编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-cms</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_edu?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="comment">#设置时间格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line"><span class="comment">#一旦使用xml映射文件就必须设置这个路径,建议每次在创建时就加上</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.slf4j.Slf4jImpl</span></span><br></pre></td></tr></table></figure>

<p>④主启动类需要加上这些注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.year21.onlineedu&quot;&#125;)</span> <span class="comment">//扫描整个项目中top.year21.onlineedu包下的组件，为了能够用其他模块的公用组件</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;top.year21.onlineedu.servicecms.mapper&quot;)</span><span class="comment">//配置扫描mapper在那个位置，也需在yml中配置mapper映射文件的位置</span></span><br></pre></td></tr></table></figure>

<p>⑤业务类</p>
<ul>
<li>创建两个controller层区分前台系统和后台系统的请求</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/servicecms/banneradmin&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BannerAdminController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ICrmBannerService bannerService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页查询banner</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Page&lt;Banner&gt;&gt; <span class="title function_">queryBannerByCondition</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                           <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize)</span>&#123;</span><br><span class="line">        Page&lt;Banner&gt; page = bannerService.page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,page);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加banner</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addBanner</span><span class="params">(<span class="meta">@RequestBody</span> Banner banner)</span>&#123;</span><br><span class="line">        bannerService.save(banner);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改banner</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateBanner</span><span class="params">(<span class="meta">@RequestBody</span> Banner banner)</span>&#123;</span><br><span class="line">        bannerService.update(banner,<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除banner</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/del/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delBanner</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span>&#123;</span><br><span class="line">        bannerService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/servicecms/bannerfront&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BannerFrontController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ICrmBannerService bannerService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询所有banner</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/queryAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;Banner&gt;&gt; <span class="title function_">queryBanners</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Banner&gt; banners = bannerService.queryAllBanner();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,banners);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="首页展示"><a href="#首页展示" class="headerlink" title="首页展示"></a>首页展示</h2><ul>
<li>首页需要显示热门课程和部分讲师信息</li>
</ul>
<h3 id="前端页面-9"><a href="#前端页面-9" class="headerlink" title="前端页面"></a>前端页面</h3><p>①创建用于被调用的js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">getHotCourse</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/front/querycourse&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">getSortTeacher</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/front/queryteaher&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应页面进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line"><span class="title function_">getHotCourse</span>(<span class="params"></span>)&#123;</span><br><span class="line">      course.<span class="title function_">getHotCourse</span>()</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">courseList</span> = response.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getSortTeacher</span>(<span class="params"></span>)&#123;</span><br><span class="line">      teacher.<span class="title function_">getSortTeacher</span>()</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">teacherList</span> = response.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后端接口-8"><a href="#后端接口-8" class="headerlink" title="后端接口"></a>后端接口</h3><p>①控制层</p>
<ul>
<li>这个控制层本应该写在service_cms模块中，但由于使用到了teacher和course类，为了方便就写在service_edu中</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/serviceedu/front&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FrontIndexController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IEduCourseService eduCourseService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IEduTeacherService eduTeacherService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询创建时间最新的四名老师</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/queryteaher&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;EduTeacher&gt;&gt; <span class="title function_">queryTeacherByCondition</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;EduTeacher&gt; list = eduTeacherService.getSortTeacher();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询前8条热门课程</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/querycourse&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;EduCourse&gt;&gt; <span class="title function_">queryCourseByCondition</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;EduCourse&gt; list =  eduCourseService.getHotCourse();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②业务层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IEduCourseService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;EduCourse&gt; &#123;</span><br><span class="line"><span class="comment">//查询排序后的课程信息，用于首页展示</span></span><br><span class="line">List&lt;EduCourse&gt; <span class="title function_">getHotCourse</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询排序后的课程信息，用于首页展示</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;course&quot;,key = &quot;&#x27;selectCourse&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;EduCourse&gt; <span class="title function_">getHotCourse</span><span class="params">()</span> &#123;</span><br><span class="line">    QueryWrapper&lt;EduCourse&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;view_count&quot;</span>)</span><br><span class="line">        .ne(<span class="string">&quot;is_deleted&quot;</span>,<span class="number">1</span>)</span><br><span class="line">        .last(<span class="string">&quot;limit 8&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.selectList(queryWrapper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IEduTeacherService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;EduTeacher&gt; &#123;</span><br><span class="line">    <span class="comment">//查询排序后的讲师信息，用于首页展示</span></span><br><span class="line">    List&lt;EduTeacher&gt; <span class="title function_">getSortTeacher</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询排序后的讲师信息，用于首页展示</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;teacher&quot;,key = &quot;&#x27;selectTeacher&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;EduTeacher&gt; <span class="title function_">getSortTeacher</span><span class="params">()</span> &#123;</span><br><span class="line">    QueryWrapper&lt;EduTeacher&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;gmt_create&quot;</span>)</span><br><span class="line">        .ne(<span class="string">&quot;is_deleted&quot;</span>,<span class="number">1</span>)</span><br><span class="line">        .last(<span class="string">&quot;limit 4&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.selectList(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="注册功能"><a href="#注册功能" class="headerlink" title="注册功能"></a>注册功能</h2><h3 id="前端页面-10"><a href="#前端页面-10" class="headerlink" title="前端页面"></a>前端页面</h3><p>①由于nuxt没有集成element-ui，因此需要下载此依赖</p>
<p>npm install element-ui</p>
<p>②在plugins创建js文件进行引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span> <span class="comment">//element-ui的全部组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span><span class="comment">//element-ui的css</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>) <span class="comment">//使用elementUI</span></span><br></pre></td></tr></table></figure>

<p>③在layout文件夹中创建一个vue文件，目的是为注册页面换个页面布局样式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sign&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 标题 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;~/assets/img/logo.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;logo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 表单 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nuxt</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>④在pages文件夹中创建注册页面，前提是先修改default.vue中关于注册页面的路由地址</p>
<p>⑤在api文件夹下创建register.js文件，编写需要被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">userRegister</span>(<span class="params">VoRegister</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/serviceusercenter/register&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="title class_">VoRegister</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getCode</span>(<span class="params">phone</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/servicemsm/send/&#x27;</span>+ phone,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>⑥在对应页面进行调用即可</p>
<h3 id="短信注册"><a href="#短信注册" class="headerlink" title="短信注册"></a>短信注册</h3><ul>
<li>此处是购买了阿里云的第三方短信接口</li>
</ul>
<p>①在service模块下创建service_msm模块，处理短信服务</p>
<p>②在service_msm的pom文件加入下列依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    短信服务和HttpUtils所需依赖    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jetty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jetty-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.3.7.v20160115<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8005</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-msm</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_edu?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="comment">#设置时间格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.231</span><span class="number">.134</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment">#最大阻塞等待时间(负数表示无限制)</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.slf4j.Slf4jImpl</span></span><br></pre></td></tr></table></figure>

<p>④主启动类</p>
<p>⑤业务类</p>
<ul>
<li>控制层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/servicemsm&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(value = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MsgService msgService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/send/&#123;phone&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable(&quot;phone&quot;)</span> String phone)</span>&#123;</span><br><span class="line">        <span class="comment">//从redis中获取验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(code))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果不能从redis中取到验证码则调用方法生成验证码</span></span><br><span class="line">        code = RandomUtil.getFourBitRandom();</span><br><span class="line">        <span class="comment">//调用service发送短信的方法</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> msgService.sendMessage(phone,code);</span><br><span class="line">        <span class="keyword">if</span> (result)&#123;</span><br><span class="line">            <span class="comment">/*发送成功则将验证码放入到redis中并设置过期时间</span></span><br><span class="line"><span class="comment">            set()中的参数说明，第一个是key，第二个是value，第三个是过期时间，第四个是时间单位</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            redisTemplate.opsForValue().set(phone,code,<span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;短信发送成功&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">false</span>,<span class="string">&quot;短信发送失败&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>业务层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MsgService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">sendMessage</span><span class="params">(String phone, String code)</span> &#123;</span><br><span class="line">        <span class="comment">//判断验证码是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(phone))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;https://gyytz.market.alicloudapi.com&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/sms/smsSend&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">appcode</span> <span class="operator">=</span> <span class="string">&quot;e9323c6105394949a1c1a7dbb05253f0&quot;</span>;</span><br><span class="line">        Map&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        <span class="comment">//最后在header中的格式(中间是英文空格)为Authorization:APPCODE 83359fd73fe94948385f570e3c139105</span></span><br><span class="line">        headers.put(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;APPCODE &quot;</span> + appcode);</span><br><span class="line">        Map&lt;String, String&gt; querys = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        querys.put(<span class="string">&quot;mobile&quot;</span>,phone);</span><br><span class="line">        querys.put(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;**code**:&quot;</span> + code);</span><br><span class="line">        querys.put(<span class="string">&quot;smsSignId&quot;</span>, <span class="string">&quot;2e65b1bb3d054466b82f0c9d125465e2&quot;</span>);</span><br><span class="line">        querys.put(<span class="string">&quot;templateId&quot;</span>, <span class="string">&quot;63698e3463bd490dbc3edc46a20c55f5&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; bodys = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 重要提示如下:</span></span><br><span class="line"><span class="comment">             * HttpUtils请从</span></span><br><span class="line"><span class="comment">             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java</span></span><br><span class="line"><span class="comment">             * 下载</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * 相应的依赖请参照</span></span><br><span class="line"><span class="comment">             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> HttpUtils.doPost(host, path, method, headers, querys, bodys);</span><br><span class="line">            System.out.println(response.toString());</span><br><span class="line">            <span class="comment">//获取请求头中的响应状态码判断短信发送情况</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">            <span class="keyword">if</span> (statusCode == <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取response的body</span></span><br><span class="line">            <span class="comment">//System.out.println(EntityUtils.toString(response.getEntity()));</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后台接口-1"><a href="#后台接口-1" class="headerlink" title="后台接口"></a>后台接口</h3><p>①创建一个值对象VOregister封装注册的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VORegister</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②业务层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">userRegister</span><span class="params">(<span class="meta">@RequestBody</span> VORegister voRegister)</span>&#123;</span><br><span class="line">    userCenterService.userRegister(voRegister);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③控制层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用户注册</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userRegister</span><span class="params">(VORegister voRegister)</span> &#123;</span><br><span class="line">    <span class="comment">//获取输入的手机号</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> voRegister.getPhone();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断手机号是否已被注册</span></span><br><span class="line">    QueryWrapper&lt;UserCenter&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;mobile&quot;</span>,phone);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.selectCount(queryWrapper);</span><br><span class="line">    <span class="keyword">if</span> (count != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;手机号已注册！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据手机号获取redis中的验证码是否可用</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">redisCode</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(redisCode))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;验证码已过期,注册失败，请重新获取验证码&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取输入的验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">inputCode</span> <span class="operator">=</span> voRegister.getCode();</span><br><span class="line">    <span class="comment">//判断验证码是否正确</span></span><br><span class="line">    <span class="keyword">if</span> (!inputCode.equals(redisCode))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;验证码错误,注册失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取输入的密码进行加密操作</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">inputPwd</span> <span class="operator">=</span> voRegister.getPassword();</span><br><span class="line">    <span class="comment">//将此时的时间戳作为盐值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> UUID.randomUUID().toString().toUpperCase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进行加密</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">pwdByMd5</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(inputPwd, salt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个User对象封装这些数据</span></span><br><span class="line">    <span class="type">UserCenter</span> <span class="variable">userCenter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserCenter</span>();</span><br><span class="line">    <span class="comment">//填充属性</span></span><br><span class="line">    userCenter.setMobile(phone);</span><br><span class="line">    userCenter.setPassword(pwdByMd5);</span><br><span class="line">    userCenter.setNickname(voRegister.getNickName());</span><br><span class="line">    userCenter.setAvatar(<span class="string">&quot;https://onlineedufile.oss-cn-guangzhou.aliyuncs.com/2022-08-23/ee578e07-753c-4ddc-8ff3-73ff79f749d8.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//保存盐值用于登录验证</span></span><br><span class="line">    userCenter.setSalt(salt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行插入操作</span></span><br><span class="line">    <span class="built_in">this</span>.baseMapper.insert(userCenter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h2><p><font color='red'><strong>单点登录模式：在任一模块登录后，访问其他模块不需要进行二次登录</strong></font></p>
<p>本项目的单点登录，利用了JWT框架</p>
<ul>
<li>SSO(single sign on)模式 也称为单点登录模式，有三种方式</li>
</ul>
<p>1、通过session广播机制实现，通过将session复制到其他模块中，缺点是比较浪费资源</p>
<p>2、通过cookie+redis实现</p>
<p>步骤一：在任一模块登录后，将数据放入redis和cookie中</p>
<p>①redis：在key：生成唯一随机值(ip、用户id等)，value：用户数据</p>
<p>②cookie：把redis里面生成的key值放到cookie中</p>
<p>步骤二：在访问其他模块时，发送的请求中携带cookie，通过获取此cookie的值，到redis中进行查询，</p>
<p>根据此cookie即key查询，如果能查询到数据代表已经登录</p>
<p>3、通过token实现</p>
<p>token是按照一定规则生成的字符串，而这个字符串中可以包含用户信息</p>
<p>步骤一：在某个模块进行登录之后，将按照规则生成的token字符串通过cookie或地址栏参数返回</p>
<p>步骤二：当再去访问其他模块时，在每次访问时在地址栏或者cookie中都会携带token字符串，从</p>
<p>地址栏或者cookie中获取token，根据此token获取用户信息，如果获取成功则表示是登录状态</p>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220828154023588.png"></p>
<h3 id="前端页面-11"><a href="#前端页面-11" class="headerlink" title="前端页面"></a>前端页面</h3><ul>
<li>前提步骤</li>
</ul>
<p>①在pages文件夹中创建登录页面，前提是先修改default.vue中关于登录页面的路由地址</p>
<p>②下载 cookie插件，用于传输用户数据，npm install js-cookie</p>
<p>③在api文件夹下创建login.js文件，编写需要被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">userLogin</span>(<span class="params">user</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/serviceusercenter/login&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: user</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getInfoByToken</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/serviceusercenter/queryInfo&#x27;</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③在对应页面进行调用即可</p>
<ul>
<li>实现思路</li>
</ul>
<p>①在登录成功后，将服务器生成的token返回</p>
<p>②将返回的token存入cookie中，根据此token去服务器中调用接口查询用户数据</p>
<p>③创建拦截器，在请求正在发送之前，先拦截判断cookie中是否存储了token，如果发现存储了，</p>
<p>则从cookie中取出放入到请求头中，因为后端接口就是从请求头中获取token的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://192.168.231.134:9001&#x27;</span>, <span class="comment">// api的base_url</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">20000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// http request 拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//判断cookie中是否存储名为onlineedu_token</span></span><br><span class="line">  <span class="keyword">if</span> (cookie.<span class="title function_">get</span>(<span class="string">&#x27;onlineedu_token&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//把获取的cookie值放到header中</span></span><br><span class="line">    config.<span class="property">headers</span>[<span class="string">&#x27;token&#x27;</span>] = cookie.<span class="title function_">get</span>(<span class="string">&#x27;onlineedu_token&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>④将经过服务接口查询返回的用户信息放入cookie中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用户登录</span></span><br><span class="line"><span class="title function_">login</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//第一步</span></span><br><span class="line">    login.<span class="title function_">userLogin</span>(<span class="variable language_">this</span>.<span class="property">user</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">code</span> === <span class="number">20000</span>)&#123; </span><br><span class="line">            <span class="comment">//第二步，获取生成的token字符串并放入cookie中</span></span><br><span class="line">            <span class="keyword">let</span> token = response.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">            <span class="comment">//第一个参数为cookie名称，第二个参数为cookie值，第三个参数为此cookie的作用域范围，即只在localhost下传递</span></span><br><span class="line">            cookie.<span class="title function_">set</span>(<span class="string">&#x27;onlineedu_token&#x27;</span>,token,&#123;<span class="attr">domian</span>:<span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//第三步，根据token获取用户信息并放入cookie中</span></span><br><span class="line">            login.<span class="title function_">getInfoByToken</span>()</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">code</span> === <span class="number">20000</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">userInfo</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response.<span class="property">data</span>.<span class="property">data</span>)</span><br><span class="line">                    cookie.<span class="title function_">set</span>(<span class="string">&#x27;userInfo&#x27;</span>,<span class="variable language_">this</span>.<span class="property">userInfo</span>,&#123;<span class="attr">domian</span>:<span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)   </span><br><span class="line">            <span class="comment">//提示</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//跳转至首页</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>:<span class="string">&quot;/&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//提示</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">response</span>.<span class="property">data</span>.<span class="property">message</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>⑤在主页从cookie中取出用户信息，填充页面内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从cookie中获取信息</span></span><br><span class="line"><span class="title function_">getUserInfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//在cookie中只能存储字符串，因此必须把取出的字符串转化为json对象</span></span><br><span class="line">    <span class="keyword">let</span> user = cookie.<span class="title function_">get</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(user)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">userInfo</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(user)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//退出登录</span></span><br><span class="line"><span class="title function_">logout</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="comment">//清空cookie</span></span><br><span class="line">    cookie.<span class="title function_">set</span>(<span class="string">&quot;userInfo&quot;</span>,<span class="string">&#x27;&#x27;</span>,&#123;<span class="attr">domain</span>:<span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">    cookie.<span class="title function_">set</span>(<span class="string">&#x27;onlineedu_token&#x27;</span>,<span class="string">&#x27;&#x27;</span>,&#123;<span class="attr">domian</span>:<span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">	 <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;退出成功&quot;</span>)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="整合微信登录"><a href="#整合微信登录" class="headerlink" title="整合微信登录"></a>整合微信登录</h3><ul>
<li>步骤</li>
</ul>
<p>①在service-usercenter模块中的yml文件配置微信相关的信息</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#微信登录配置信息</span></span><br><span class="line"><span class="attr">wx:</span></span><br><span class="line">  <span class="attr">open:</span></span><br><span class="line">    <span class="comment"># 微信开放平台 appid</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">wxed9954c01bb89b47</span></span><br><span class="line">    <span class="comment"># 微信开放平台 appsecret</span></span><br><span class="line">    <span class="attr">appsecret:</span> <span class="string">a7482517235173ddb4083788de60b90e</span></span><br><span class="line">    <span class="comment"># 微信开放平台 重定向url</span></span><br><span class="line">    <span class="attr">redirecturl:</span> <span class="string">http://localhost:8160/wx/callback</span></span><br></pre></td></tr></table></figure>

<p>②创建一个类读取配置yml配置文件的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WXUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.appid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.appsecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appSecret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.redirecturl&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redirectUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_REDIRECT_URL;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        WX_OPEN_APP_ID = appId;</span><br><span class="line">        WX_OPEN_APP_SECRET = appSecret;</span><br><span class="line">        WX_OPEN_REDIRECT_URL = redirectUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③创建一个controller用于创建扫描登录的二维码</p>
<p>④在扫描二维码后从控制类中获取code(随机唯一的值，用于识别身份)</p>
<p>⑤用获取到的code值请求微信提供的固定地址，获取access_token(访问凭证)和openId(区分不同标识)</p>
<p>⑥用access_token和openId再去获取微信提供的固定地址，从而得到微信扫码人的信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/ucenter/wx&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserCenterService userCenterService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.生成微信扫描二维码</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getWxCode</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 微信开放平台授权baseUrl %s相当于一个占位符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;https://open.weixin.qq.com/connect/qrconnect&quot;</span> +</span><br><span class="line">            <span class="string">&quot;?appid=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;redirect_uri=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;response_type=code&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;scope=snsapi_login&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;state=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;#wechat_redirect&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对redirect_url进行URLEncoder编码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> WXUtils.WX_OPEN_REDIRECT_URL;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redirectUrl = URLEncoder.encode(redirectUrl,<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//填充占位符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">codeUrl</span> <span class="operator">=</span> String.format(</span><br><span class="line">            baseUrl,</span><br><span class="line">            WXUtils.WX_OPEN_APP_ID,</span><br><span class="line">            WXUtils.WX_OPEN_REDIRECT_URL,</span><br><span class="line">            <span class="string">&quot;success&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回微信请求地址</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + codeUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/callback&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">callback</span><span class="params">(String code,String state)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取code值，这个code相当于一个临时票据</span></span><br><span class="line">            <span class="comment">//拼接请求地址</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">baseAccessTokenUrl</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token&quot;</span> +</span><br><span class="line">                <span class="string">&quot;?appid=%s&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;secret=%s&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;code=%s&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line">            <span class="comment">//填充请求地址中的三个占位符，id和密匙和code值</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessTokenUrl</span> <span class="operator">=</span> String.format(baseAccessTokenUrl,</span><br><span class="line">                                                  WXUtils.WX_OPEN_APP_ID,</span><br><span class="line">                                                  WXUtils.WX_OPEN_APP_SECRET,</span><br><span class="line">                                                  code);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//使用HttpClient 发送请求，通过code值向认证服务器获取access_token和openId</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessTokenInfo</span> <span class="operator">=</span> HttpClientUtils.get(accessTokenUrl);</span><br><span class="line">            log.info(<span class="string">&quot;accessTokenInfo:&quot;</span> + accessTokenInfo);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将access_token和openId从返回的字符串中取出</span></span><br><span class="line">            <span class="comment">//先将此字符串转换为map对象</span></span><br><span class="line">            <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">            HashMap&lt;String,String&gt; hashMap = gson.fromJson(accessTokenInfo, HashMap.class);</span><br><span class="line">            <span class="type">String</span> <span class="variable">accessToken</span> <span class="operator">=</span> hashMap.get(<span class="string">&quot;access_token&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> hashMap.get(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将这些信息插入数据库，但需先判断此账户的openId是否已经存在</span></span><br><span class="line">            QueryWrapper&lt;UserCenter&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">            wrapper.eq(<span class="string">&quot;openid&quot;</span>,openid);</span><br><span class="line">            <span class="type">UserCenter</span> <span class="variable">queryUser</span> <span class="operator">=</span> userCenterService.getOne(wrapper);</span><br><span class="line">            <span class="comment">//queryUser == null表示新注册用户</span></span><br><span class="line">            <span class="keyword">if</span> (queryUser == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//通过access_token和openId从微信提供的接口中获取扫码人的信息</span></span><br><span class="line">                <span class="comment">//拼接即将要请求的地址访问微信的即可，获取用户信息</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">baseUserInfoUrl</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/sns/userinfo&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;?access_token=%s&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&amp;openid=%s&quot;</span>;</span><br><span class="line">                <span class="comment">//填充参数</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">userInfoUrl</span> <span class="operator">=</span> String.format(baseUserInfoUrl, accessToken, openid);</span><br><span class="line">                <span class="comment">//通过HttpClientUtils模拟浏览器发送请求获取扫描人信息</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">userInfo</span> <span class="operator">=</span> HttpClientUtils.get(userInfoUrl);</span><br><span class="line">                log.info(<span class="string">&quot;userInfo:&quot;</span> + userInfo);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//将扫码人信息字符串转为map对象，便于取数据</span></span><br><span class="line">                <span class="type">Gson</span> <span class="variable">userGson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">                HashMap&lt;String,String&gt; userMap = userGson.fromJson(userInfo, HashMap.class);</span><br><span class="line">                <span class="type">String</span> <span class="variable">nickname</span> <span class="operator">=</span> userMap.get(<span class="string">&quot;nickname&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">headimgurl</span> <span class="operator">=</span> userMap.get(<span class="string">&quot;headimgurl&quot;</span>);</span><br><span class="line">                <span class="comment">//填充数据并插入数据库</span></span><br><span class="line">                queryUser = <span class="keyword">new</span> <span class="title class_">UserCenter</span>();</span><br><span class="line">                queryUser.setOpenid(openid);</span><br><span class="line">                queryUser.setNickname(nickname);</span><br><span class="line">                queryUser.setAvatar(headimgurl);</span><br><span class="line">                userCenterService.save(queryUser);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//使用jwt框架生成token</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtils.getJwtToken(queryUser.getId(), queryUser.getNickname());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//注册成功后，跳转至首页显示信息</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:http://localhost:3000?token=&quot;</span> + token;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>⑦在首页中回显登录后的用户信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//获取路径中的token值</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">token</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">token</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">token</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setTokenInCookie</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUserInfo</span>()</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">//从cookie中获取信息</span></span><br><span class="line">        <span class="title function_">getUserInfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">//在cookie中只能存储字符串，因此必须把取出的字符串转化为json对象</span></span><br><span class="line">            <span class="keyword">let</span> user = cookie.<span class="title function_">get</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span>(user)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">userInfo</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(user)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">            <span class="comment">//将token值放入cookie中</span></span><br><span class="line">            <span class="title function_">setTokenInCookie</span>(<span class="params"></span>)&#123;</span><br><span class="line">                cookie.<span class="title function_">set</span>(<span class="string">&quot;onlineedu_token&quot;</span>,<span class="variable language_">this</span>.<span class="property">token</span>,&#123;<span class="attr">domain</span>:<span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">                cookie.<span class="title function_">set</span>(<span class="string">&quot;userInfo&quot;</span>,<span class="string">&#x27;&#x27;</span>,&#123;<span class="attr">domain</span>:<span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">                <span class="comment">//根据token查询用户信息</span></span><br><span class="line">                login.<span class="title function_">getInfoByToken</span>()</span><br><span class="line">                    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(response.<span class="property">data</span>.<span class="property">code</span> === <span class="number">20000</span>)&#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">userInfo</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response.<span class="property">data</span>.<span class="property">data</span>)</span><br><span class="line">                        cookie.<span class="title function_">set</span>(<span class="string">&#x27;userInfo&#x27;</span>,<span class="variable language_">this</span>.<span class="property">userInfo</span>,&#123;<span class="attr">domian</span>:<span class="string">&#x27;localhost&#x27;</span>&#125;)</span><br><span class="line">                        <span class="comment">//由于在created方法中函数的加载顺序不一定按顺序，为了防止缓存问题，在这里进行一次页面判断</span></span><br><span class="line">                        <span class="variable language_">this</span>.<span class="title function_">getUserInfo</span>()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)   </span><br><span class="line">            &#125;,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="后端接口-9"><a href="#后端接口-9" class="headerlink" title="后端接口"></a>后端接口</h3><p>①在service模块下创建service_usercenter子模块</p>
<p>②创建数据表，根据数据表快速生成相关的实体类等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `usercenter_member` (</span><br><span class="line">  `id` CHAR(19) NOT NULL COMMENT &#x27;会员id&#x27;,</span><br><span class="line">  `openid` VARCHAR(128) DEFAULT NULL COMMENT &#x27;微信openid&#x27;,</span><br><span class="line">  `mobile` VARCHAR(11) DEFAULT &#x27;&#x27; COMMENT &#x27;手机号&#x27;,</span><br><span class="line">  `password` VARCHAR(255) DEFAULT NULL COMMENT &#x27;密码&#x27;,</span><br><span class="line">  `nickname` VARCHAR(50) DEFAULT NULL COMMENT &#x27;昵称&#x27;,</span><br><span class="line">  `sex` TINYINT(2) UNSIGNED DEFAULT NULL COMMENT &#x27;性别 1 女，2 男&#x27;,</span><br><span class="line">  `age` TINYINT(3) UNSIGNED DEFAULT NULL COMMENT &#x27;年龄&#x27;,</span><br><span class="line">  `avatar` VARCHAR(255) DEFAULT NULL COMMENT &#x27;用户头像&#x27;,</span><br><span class="line">  `sign` VARCHAR(100) DEFAULT NULL COMMENT &#x27;用户签名&#x27;,</span><br><span class="line">  `is_disabled` TINYINT(1) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;是否禁用 1（true）已禁用，  0（false）未禁用&#x27;,</span><br><span class="line">  `is_deleted` TINYINT(1) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,</span><br><span class="line">  `gmt_create` DATETIME NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `gmt_modified` DATETIME NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=INNODB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;会员表&#x27;;</span><br></pre></td></tr></table></figure>

<p>③修改子模块的pom文件</p>
<p>④编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-center</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_edu?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="comment">#设置时间格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="comment">#将edu_service注册到nacos服务注册中心</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.231</span><span class="number">.134</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment">#最大阻塞等待时间(负数表示无限制)</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#一旦使用xml映射文件就必须设置这个路径,建议每次在创建时就加上</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<p>⑤主启动类</p>
<p>⑥业务类</p>
<ul>
<li>控制层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//登录</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">userLogin</span><span class="params">(<span class="meta">@RequestBody</span> UserCenter user)</span>&#123;</span><br><span class="line">    <span class="comment">//调用service方法实现登录并在登录成功后返回根据指定规则生成的token</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userToken</span> <span class="operator">=</span> userCenterService.userLogin(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;登录成功&quot;</span>,userToken);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>业务层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserCenterServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserCenterMapper, UserCenter&gt; <span class="keyword">implements</span> <span class="title class_">IUserCenterService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">userLogin</span><span class="params">(UserCenter user)</span> &#123;</span><br><span class="line">        <span class="comment">//获取账户和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getMobile();</span><br><span class="line">        <span class="type">String</span> <span class="variable">inputPassword</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(phone) || StringUtils.isEmpty(inputPassword))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;账户名或密码为空，登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据账户名查询信息</span></span><br><span class="line">        QueryWrapper&lt;UserCenter&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;mobile&quot;</span>,phone);</span><br><span class="line">        <span class="type">UserCenter</span> <span class="variable">queryUser</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.selectOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断账户是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (queryUser == <span class="literal">null</span> || queryUser.getIsDisabled())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;账户名不存在，登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据查询的账户取得盐值和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> queryUser.getSalt();</span><br><span class="line">        <span class="type">String</span> <span class="variable">dbPassword</span> <span class="operator">=</span> queryUser.getPassword();</span><br><span class="line">        <span class="comment">//将输入的密码加密后与数据库密码对比</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">md5Pwd</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(inputPassword, salt);</span><br><span class="line">        <span class="keyword">if</span> (!dbPassword.equals(md5Pwd))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;密码错误，登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果不为空则代表登录成功</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> queryUser.getId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">nickname</span> <span class="operator">=</span> queryUser.getNickname();</span><br><span class="line">        <span class="comment">//生成token并返回</span></span><br><span class="line">        <span class="keyword">return</span> JwtUtils.getJwtToken(id, nickname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据token获取用户信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据token查询用户信息</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/queryInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;UserCenter&gt; <span class="title function_">queryInfoByToken</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="comment">//通过request对象获取用户id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">    <span class="comment">//根据用户id查询数据并返回</span></span><br><span class="line">    <span class="type">UserCenter</span> <span class="variable">loginUser</span> <span class="operator">=</span> userCenterService.getById(userId);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,loginUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="用户中心"><a href="#用户中心" class="headerlink" title="用户中心"></a>用户中心</h2><h3 id="前端页面-12"><a href="#前端页面-12" class="headerlink" title="前端页面"></a>前端页面</h3><p>①在api文件下的login.js添加被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">updateUserInfo</span>(<span class="params">user</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceusercenter/update`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: user</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">updatePhotoById</span>(<span class="params">uid,path</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceusercenter/updatePhoto/<span class="subst">$&#123;uid&#125;</span>/<span class="subst">$&#123;path&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">updatePwdById</span>(<span class="params">uid,oldPwd,newPwd</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceusercenter/updatepwd/<span class="subst">$&#123;uid&#125;</span>/<span class="subst">$&#123;oldPwd&#125;</span>/<span class="subst">$&#123;newPwd&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应页面进行调用</p>
<ul>
<li><p>由于为了时间问题，将本该是多个页面全部凑在一个页面，因此页面多多少少存在点bug，</p>
<p>可到usercenter文件夹的index.vue查看</p>
</li>
</ul>
<h3 id="后端接口-10"><a href="#后端接口-10" class="headerlink" title="后端接口"></a>后端接口</h3><p>①在usercenter模块下编写接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过userId修改用户信息</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateUserInfoById</span><span class="params">(<span class="meta">@RequestBody</span> UserCenter user)</span>&#123;</span><br><span class="line">    <span class="comment">//根据id查询用户信息</span></span><br><span class="line">    UpdateWrapper&lt;UserCenter&gt; wrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;id&quot;</span>,user.getId());</span><br><span class="line">    <span class="keyword">if</span> (!userCenterService.update(user,wrapper))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;更新用户信息失败!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据userId修改用户头像</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/updatePhoto/&#123;userId&#125;/&#123;path&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updatePhotoById</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> String userId,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@PathVariable(&quot;path&quot;)</span> String path)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">dbPath</span> <span class="operator">=</span> decode(path);</span><br><span class="line">    userCenterService.updatePhotoById(userId,dbPath);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 对base64码进行解码</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> code 需要解码的base64字符串</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 解码之后的字符串</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decode</span><span class="params">(String code)</span>&#123;</span><br><span class="line">    String str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        str=<span class="keyword">new</span> <span class="title class_">String</span>(Base64.decodeBase64(code),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/updatepwd/&#123;userId&#125;/&#123;oldPwd&#125;/&#123;newPwd&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updatePwd</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> String userId,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@PathVariable(&quot;oldPwd&quot;)</span> String oldPwd,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@PathVariable(&quot;newPwd&quot;)</span> String newPwd)</span>&#123;</span><br><span class="line">    <span class="comment">//先根据userId查找用户信息</span></span><br><span class="line">    <span class="type">UserCenter</span> <span class="variable">user</span> <span class="operator">=</span> userCenterService.getById(userId);</span><br><span class="line">    <span class="comment">//取出密码和盐值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> user.getSalt();</span><br><span class="line">    <span class="type">String</span> <span class="variable">dbPassword</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先判断密码是否正确</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">md5Password</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(oldPwd, salt);</span><br><span class="line">    <span class="keyword">if</span> (!md5Password.equals(dbPassword))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;原密码错误！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加密新密码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">newPassword</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(newPwd, salt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新密码</span></span><br><span class="line">    user.setPassword(newPassword);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> userCenterService.updateById(user);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!result)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;密码更新失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="讲师及详情展示"><a href="#讲师及详情展示" class="headerlink" title="讲师及详情展示"></a>讲师及详情展示</h2><h3 id="前端页面-13"><a href="#前端页面-13" class="headerlink" title="前端页面"></a>前端页面</h3><p>①在对应的页面进行调用并回填数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//讲师列表页面</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> teacher <span class="keyword">from</span> <span class="string">&#x27;@/api/teacher&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//异步请求asyncData,这个请求只会发送一次</span></span><br><span class="line">  <span class="comment">//params相当于 this.$route.params 通过params.id 可以取到当前id值</span></span><br><span class="line">  <span class="title function_">asyncData</span>(<span class="params">&#123; params, error &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> teacher.<span class="title function_">getFrontTeacher</span>(<span class="number">1</span>, <span class="number">8</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">data</span>: response.<span class="property">data</span>.<span class="property">data</span> &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">pageQuery</span>(<span class="params">pageNum</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(pageNum &gt; <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">pages</span> || pageNum &lt; <span class="number">1</span> || pageNum === <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">current</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      teacher.<span class="title function_">getFrontTeacher</span>(pageNum,<span class="number">8</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">data</span> = response.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"><span class="comment">//讲师详情页面</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> teacher <span class="keyword">from</span> <span class="string">&#x27;@/api/teacher&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">name</span>:<span class="string">&quot;teacherInfo&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">teacherId</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">teacherInfo</span>:&#123;&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">courses</span>: [],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">teacherId</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="title function_">getTeacherByid</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">getTeacherByid</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        teacher.<span class="title function_">getTeacherByid</span>(<span class="variable language_">this</span>.<span class="property">teacherId</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="variable language_">this</span>.<span class="property">teacherInfo</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">teacher</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="variable language_">this</span>.<span class="property">courses</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">courses</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="后端接口-11"><a href="#后端接口-11" class="headerlink" title="后端接口"></a>后端接口</h3><ul>
<li>在后端接口中查询讲师列表和对应讲师的信息</li>
</ul>
<p>①控制层返回map类型对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询讲师</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/query/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">queryTeacherOnIndex</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span>Integer pageNum,</span></span><br><span class="line"><span class="params">                                                          <span class="meta">@PathVariable(&quot;pageSize&quot;)</span>Integer pageSize)</span>&#123;</span><br><span class="line">    HashMap&lt;String,Object&gt; teacherList = eduTeacherService.getFrontTeacherList(pageNum,pageSize);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,teacherList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/query/&#123;teacherId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;HashMap&lt;String,Object&gt;&gt; <span class="title function_">queryTeacherById</span><span class="params">(<span class="meta">@PathVariable(&quot;teacherId&quot;)</span> String teacherId)</span>&#123;</span><br><span class="line">        <span class="comment">//先查询讲师信息</span></span><br><span class="line">        <span class="type">EduTeacher</span> <span class="variable">teacher</span> <span class="operator">=</span> eduTeacherService.getById(teacherId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//再查询相关讲师的课程</span></span><br><span class="line">        QueryWrapper&lt;EduCourse&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;teacher_id&quot;</span>,teacher.getId());</span><br><span class="line">        List&lt;EduCourse&gt; courses = eduCourseService.list(wrapper);</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;teacher&quot;</span>,teacher);</span><br><span class="line">        map.put(<span class="string">&quot;courses&quot;</span>,courses);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,map);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>②业务层执行查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> HashMap&lt;String, Object&gt; <span class="title function_">getFrontTeacherList</span><span class="params">(Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">       <span class="comment">//添加查询条件</span></span><br><span class="line">       QueryWrapper&lt;EduTeacher&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">       wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">       Page&lt;EduTeacher&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">       <span class="built_in">this</span>.baseMapper.selectPage(page,wrapper);</span><br><span class="line">       <span class="comment">//从page中取出数据，</span></span><br><span class="line">       HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       List&lt;EduTeacher&gt; lists = page.getRecords();</span><br><span class="line">       <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> page.getCurrent();</span><br><span class="line">       <span class="type">long</span> <span class="variable">pages</span> <span class="operator">=</span> page.getPages();</span><br><span class="line">       <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> page.getSize();</span><br><span class="line">       <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">       <span class="type">boolean</span> <span class="variable">hasNext</span> <span class="operator">=</span> page.hasNext();</span><br><span class="line">       <span class="type">boolean</span> <span class="variable">hasPrevious</span> <span class="operator">=</span> page.hasPrevious();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//保存到map中并返回</span></span><br><span class="line">       map.put(<span class="string">&quot;lists&quot;</span>,lists);</span><br><span class="line">       map.put(<span class="string">&quot;current&quot;</span>,current);</span><br><span class="line">       map.put(<span class="string">&quot;pages&quot;</span>,pages);</span><br><span class="line">       map.put(<span class="string">&quot;size&quot;</span>,size);</span><br><span class="line">       map.put(<span class="string">&quot;total&quot;</span>,total);</span><br><span class="line">       map.put(<span class="string">&quot;hasNext&quot;</span>,hasNext);</span><br><span class="line">       map.put(<span class="string">&quot;hasPrevious&quot;</span>,hasPrevious);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> map;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="课程及详情展示"><a href="#课程及详情展示" class="headerlink" title="课程及详情展示"></a>课程及详情展示</h2><h3 id="前端页面-14"><a href="#前端页面-14" class="headerlink" title="前端页面"></a>前端页面</h3><p>①在api文件夹下的course.js文件添加被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getHtmlCourse</span>(<span class="params">pageNum,pageSize,VOFrontCourse</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceedu/frontCourse/courseList/<span class="subst">$&#123;pageNum&#125;</span>/<span class="subst">$&#123;pageSize&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="title class_">VOFrontCourse</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">getOneSubject</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/serviceedu/frontCourse/querySubject&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">getTwoSubject</span>(<span class="params">subjectId</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceedu/frontCourse/querySubject`</span>,</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>: subjectId</span><br><span class="line">    &#125;)  </span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getCourseDetailsById</span>(<span class="params">courseId</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/serviceedu/frontCourse/details/<span class="subst">$&#123;courseId&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应的页面进行调用</p>
<h3 id="后端接口-12"><a href="#后端接口-12" class="headerlink" title="后端接口"></a>后端接口</h3><ul>
<li>查询课程类别信息和课程信息</li>
</ul>
<p>①创建两个vo类封装查询数据和封装课程详情信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VOFrontCourse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String courseId;</span><br><span class="line">    <span class="keyword">private</span> String subjectParentId;</span><br><span class="line">    <span class="keyword">private</span> String subjectId;</span><br><span class="line">    <span class="keyword">private</span> String viewCountSort;</span><br><span class="line">    <span class="keyword">private</span> String gmtCreateSort;</span><br><span class="line">    <span class="keyword">private</span> String priceSort;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VOFrontCourseDetails</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line">    <span class="keyword">private</span> String buyCount;</span><br><span class="line">    <span class="keyword">private</span> String lessonNum;</span><br><span class="line">    <span class="keyword">private</span> String viewCount;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String career;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②控制层接收参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/serviceedu/frontCourse&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FrontCourseController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IEduCourseService courseService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IEduSubjectService subjectService;</span><br><span class="line">    <span class="comment">//条件查询课程</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/courseList/&#123;pageNum&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">showCourseListByCondition</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                                    <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                                    <span class="meta">@RequestBody(required = false)</span> VOFrontCourse course)</span>&#123;</span><br><span class="line">        HashMap&lt;String,Object&gt; courseList = courseService.showCourseListByCondition(pageNum,pageSize,course);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,courseList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//subjectId通过判断一二级分类</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/querySubject&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;List&lt;EduSubject&gt;&gt; <span class="title function_">queryOneSubjectList</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> String subjectParentId)</span>&#123;</span><br><span class="line">        QueryWrapper&lt;EduSubject&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(subjectParentId))&#123; <span class="comment">//不为空表示查询二级分类</span></span><br><span class="line">            wrapper.eq(<span class="string">&quot;parent_id&quot;</span>,subjectParentId);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123; <span class="comment">//为空表示查询一级分类</span></span><br><span class="line">            wrapper.eq(<span class="string">&quot;parent_id&quot;</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;EduSubject&gt; subjectList = subjectService.list(wrapper);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,subjectList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③业务层执行业务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HashMap&lt;String, Object&gt; <span class="title function_">showCourseListByCondition</span><span class="params">(Integer pageNum, Integer pageSize, VOFrontCourse course)</span> &#123;</span><br><span class="line">    <span class="comment">//创建wrapper对象</span></span><br><span class="line">    QueryWrapper&lt;EduCourse&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取出封装对象的各个数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> course.getTitle();</span><br><span class="line">    <span class="type">String</span> <span class="variable">subjectParentId</span> <span class="operator">=</span> course.getSubjectParentId();<span class="comment">//一级id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">subjectId</span> <span class="operator">=</span> course.getSubjectId(); <span class="comment">//二级id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">viewCountSort</span> <span class="operator">=</span> course.getViewCountSort();<span class="comment">//关注度排序</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">createSort</span> <span class="operator">=</span> course.getGmtCreateSort(); <span class="comment">//时间排序</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">priceSort</span> <span class="operator">=</span> course.getPriceSort(); <span class="comment">//价格排序</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断数据是否为空决定是否需要添加至查询条件中</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(title))&#123;</span><br><span class="line">        wrapper.like(<span class="string">&quot;title&quot;</span>,title);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(subjectParentId))&#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;subject_parent_id&quot;</span>,subjectParentId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(subjectId))&#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;subject_id&quot;</span>,subjectId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(viewCountSort))&#123;</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;view_count&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(createSort))&#123;</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;gmt_create&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(priceSort))&#123;</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建page对象</span></span><br><span class="line">    Page&lt;EduCourse&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行查询，数据封装在page对象中</span></span><br><span class="line">    <span class="built_in">this</span>.baseMapper.selectPage(page,wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为了分页效果，将数据从page中取出</span></span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    List&lt;EduCourse&gt; lists = page.getRecords();</span><br><span class="line">    <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> page.getCurrent();</span><br><span class="line">    <span class="type">long</span> <span class="variable">pages</span> <span class="operator">=</span> page.getPages();</span><br><span class="line">    <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> page.getSize();</span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">hasNext</span> <span class="operator">=</span> page.hasNext();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">hasPrevious</span> <span class="operator">=</span> page.hasPrevious();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//保存到map中并返回</span></span><br><span class="line">    map.put(<span class="string">&quot;lists&quot;</span>,lists);</span><br><span class="line">    map.put(<span class="string">&quot;current&quot;</span>,current);</span><br><span class="line">    map.put(<span class="string">&quot;pages&quot;</span>,pages);</span><br><span class="line">    map.put(<span class="string">&quot;size&quot;</span>,size);</span><br><span class="line">    map.put(<span class="string">&quot;total&quot;</span>,total);</span><br><span class="line">    map.put(<span class="string">&quot;hasNext&quot;</span>,hasNext);</span><br><span class="line">    map.put(<span class="string">&quot;hasPrevious&quot;</span>,hasPrevious);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过课程id查询课程详情</li>
</ul>
<p>①持久层</p>
<p>编写sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM edu_course WHERE id = 1189389726308478977;</span><br><span class="line"></span><br><span class="line">SELECT c.`id`,c.title,c.`cover`,c.`price`,c.`teacher_id`,c.`buy_count`,</span><br><span class="line">       c.`lesson_num`,c.`view_count`,t.`name`,t.`career`,</span><br><span class="line">       t.`avatar`,d.`description`,v.`is_free`</span><br><span class="line">        FROM edu_course c</span><br><span class="line">        LEFT JOIN edu_teacher t</span><br><span class="line">        ON c.`teacher_id` = t.`id`</span><br><span class="line">        LEFT JOIN edu_course_description d</span><br><span class="line">        ON c.`id` = d.`id`</span><br><span class="line">        LEFT JOIN edu_video v</span><br><span class="line">        ON c.`id` = v.`id`</span><br><span class="line">        WHERE c.id = #&#123;id&#125;;</span><br></pre></td></tr></table></figure>

<p>定义映射文件内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  自定义映射规则  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;queryVOFrontCourseDetails&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.year21.onlineedu.serviceedu.vo.VOFrontCourseDetails&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cover&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cover&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;teacher_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;teacherId&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;buy_count&quot;</span> <span class="attr">property</span>=<span class="string">&quot;buyCount&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;lesson_num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lessonNum&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;view_count&quot;</span> <span class="attr">property</span>=<span class="string">&quot;viewCount&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;career&quot;</span> <span class="attr">property</span>=<span class="string">&quot;career&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;avatar&quot;</span> <span class="attr">property</span>=<span class="string">&quot;avatar&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--    VOFrontCourseDetails queryCourseDetails(@Param(&quot;courseId&quot;) String courseId);--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryCourseDetails&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;queryVOFrontCourseDetails&quot;</span>&gt;</span></span><br><span class="line">       SELECT  c.`id`,c.title,c.`cover`,c.`price`,c.`teacher_id`,c.`buy_count`,</span><br><span class="line">               c.`lesson_num`,c.`view_count`,t.`name`,t.`career`,</span><br><span class="line">               t.`avatar`,d.`description`</span><br><span class="line">       FROM edu_course c</span><br><span class="line">       LEFT JOIN edu_teacher t</span><br><span class="line">       ON c.`teacher_id` = t.`id`</span><br><span class="line">       LEFT JOIN edu_course_description d</span><br><span class="line">       ON c.`id` = d.`id`</span><br><span class="line">       WHERE c.id = #&#123;courseId&#125;;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②持久层、业务层、控制层分别调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据课程id查询课程详情信息 持久层方法</span></span><br><span class="line">VOFrontCourseDetails <span class="title function_">queryCourseDetails</span><span class="params">(<span class="meta">@Param(&quot;courseId&quot;)</span> String courseId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据课程id查询课程详情信息 业务层方法</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> VOFrontCourseDetails <span class="title function_">queryCourseDetailsById</span><span class="params">(String courseId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.baseMapper.queryCourseDetails(courseId);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//根据课程id查询课程详情信息 控制层方法</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/details/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">queryCourseDetailsById</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span>&#123;</span><br><span class="line">    <span class="comment">//1.先根据课程id查询课程信息</span></span><br><span class="line">    <span class="type">VOFrontCourseDetails</span> <span class="variable">courseDetails</span> <span class="operator">=</span> courseService.queryCourseDetailsById(courseId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.根据课程id查询课程的所有章节和小节</span></span><br><span class="line">    List&lt;CourseChapter&gt; courseChapterList = chapterService.getChapterListByCid(courseId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将数据封装进map中返回</span></span><br><span class="line">    HashMap&lt;String, Object&gt; details = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    details.put(<span class="string">&quot;courseDetails&quot;</span>,courseDetails);</span><br><span class="line">    details.put(<span class="string">&quot;courseChapterList&quot;</span>,courseChapterList);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,details);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="课程视频播放"><a href="#课程视频播放" class="headerlink" title="课程视频播放"></a>课程视频播放</h2><ul>
<li>利用阿里云的视频点播功能实现</li>
</ul>
<h3 id="前端页面-15"><a href="#前端页面-15" class="headerlink" title="前端页面"></a>前端页面</h3><ul>
<li>使用动态路由的方式进行跳转视频播放</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- target=&quot;_blank&quot;表示跳转到一个新页面打开 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;&#x27;/video/&#x27; + video.videoSourceId&quot;</span> <span class="attr">title</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fr&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;free-icon vam mr10&quot;</span>&gt;</span>免费试听<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>①在api下的文件夹创建vod.js，编写被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">getVideoAuth</span>(<span class="params">videoId</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/servicevod/videovoucher/<span class="subst">$&#123;videoId&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应的页面调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> vod <span class="keyword">from</span> <span class="string">&#x27;@/api/vod&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;videoId&#x27;</span>,</span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">videoId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">videoAuth</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">videoId</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getVideoAuth</span>()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getVideoAuth</span>(<span class="params"></span>)&#123;</span><br><span class="line">        vod.<span class="title function_">getVideoAuth</span>(<span class="variable language_">this</span>.<span class="property">videoId</span>)</span><br><span class="line">         .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//填充返回的视频凭证</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">videoAuth</span> = response.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">            <span class="comment">//创建播放器</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">createVideoPlay</span>()</span><br><span class="line">         &#125;)    </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//创建播放器</span></span><br><span class="line">    <span class="title function_">createVideoPlay</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Aliplayer</span>(&#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="string">&#x27;J_prismPlayer&#x27;</span>,</span><br><span class="line">            <span class="attr">vid</span>: <span class="variable language_">this</span>.<span class="property">videoId</span>, <span class="comment">// 视频id</span></span><br><span class="line">            <span class="attr">playauth</span>: <span class="variable language_">this</span>.<span class="property">videoAuth</span>, <span class="comment">// 播放凭证</span></span><br><span class="line">            <span class="attr">encryptType</span>: <span class="string">&#x27;1&#x27;</span>, <span class="comment">// 如果播放加密视频，则需设置encryptType=1，非加密视频无需设置此项</span></span><br><span class="line">            <span class="attr">width</span>: <span class="string">&#x27;100%&#x27;</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="string">&#x27;500px&#x27;</span>,</span><br><span class="line">            <span class="attr">autoplay</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;, <span class="keyword">function</span>(<span class="params">player</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;播放器创建成功&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="后端接口-13"><a href="#后端接口-13" class="headerlink" title="后端接口"></a>后端接口</h3><ul>
<li>根据视频id获取视频访问凭证</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/videovoucher/&#123;videoSourceId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">getVideoVoucherById</span><span class="params">(<span class="meta">@PathVariable(&quot;videoSourceId&quot;)</span> String videoSourceId)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1.创建初始化对象</span></span><br><span class="line">        <span class="type">DefaultAcsClient</span> <span class="variable">defaultAcsClient</span> <span class="operator">=</span> VodInitClass.initVodClient(UploadConfigClass.ACCESS_KEY_ID, UploadConfigClass.ACCESS_KEY_SECRET);</span><br><span class="line">        <span class="comment">//2.创建response对象和request对象</span></span><br><span class="line">        <span class="type">GetVideoPlayAuthResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetVideoPlayAuthResponse</span>();</span><br><span class="line">        <span class="type">GetVideoPlayAuthRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetVideoPlayAuthRequest</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.向request对象中设置视频id</span></span><br><span class="line">        request.setVideoId(videoSourceId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.调用初始化对象中的方法，将request对象传入获取视频信息并赋值给response对象</span></span><br><span class="line">        response = defaultAcsClient.getAcsResponse(request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//返回播放凭证</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">videoAuth</span> <span class="operator">=</span> response.getPlayAuth();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,videoAuth);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">false</span>,<span class="string">&quot;获取视频凭证失败，错误信息是：&quot;</span>,e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="课程评论"><a href="#课程评论" class="headerlink" title="课程评论"></a>课程评论</h2><h3 id="前台页面"><a href="#前台页面" class="headerlink" title="前台页面"></a>前台页面</h3><p>①在api文件下创建comment.js文件创建被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="title function_">createComment</span>(<span class="params">content,courseId,rate</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicecomment/create/<span class="subst">$&#123;courseId&#125;</span>/<span class="subst">$&#123;content&#125;</span>/<span class="subst">$&#123;rate&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">showCommnet</span>(<span class="params">pageNum,pageSize,courseId,teacherId</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicecommnet/show/<span class="subst">$&#123;pageNum&#125;</span>/<span class="subst">$&#123;pageSize&#125;</span>/<span class="subst">$&#123;courseId&#125;</span>/<span class="subst">$&#123;teacherId&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">reportComment</span>(<span class="params">commentId</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/servicecommnet/report/<span class="subst">$&#123;commentId&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应的页面进行调用</p>
<h3 id="后端接口-14"><a href="#后端接口-14" class="headerlink" title="后端接口"></a>后端接口</h3><p>①创建edu_comment数据表</p>
<p>②在service模块下创建子模块service_comment</p>
<p>③修改pom文件</p>
<p>④编写yml配置文件</p>
<p>⑤主启动类</p>
<p>⑥业务类</p>
<ul>
<li>通过代码生成器快速生成实体类、控制层等</li>
<li>需要远程调用edu和userCenter模块(直接cv订单order模块的接口即可)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建课程评论 控制层</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/create/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">createComment</span><span class="params">(<span class="meta">@RequestBody</span> String content,</span></span><br><span class="line"><span class="params">                                      <span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId,</span></span><br><span class="line"><span class="params">                                      HttpServletRequest request)</span>&#123;</span><br><span class="line">    commentService.createCommnet(content,courseId,request);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看课程评论 控制层</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/show/&#123;pageNum&#125;/&#123;pageSize&#125;/&#123;courseId&#125;/&#123;teacherId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">showComment</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId,</span></span><br><span class="line"><span class="params">                                                   <span class="meta">@PathVariable(&quot;teacherId&quot;)</span> String teacherId)</span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; comments = commentService.showComment(pageNum,pageSize,courseId,teacherId);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,comments);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//业务层</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CommentMapper, Comment&gt; <span class="keyword">implements</span> <span class="title class_">ICommentService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OpenFeignTransferEdu transferEdu;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OpenFeignTransferUserCenter transferUserCenter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createCommnet</span><span class="params">(String content,String courseId,Integer rate,HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">//获取课程详细信息</span></span><br><span class="line">        <span class="type">VOCourseDetails</span> <span class="variable">courseDetails</span> <span class="operator">=</span> transferEdu.orderCourseDetailsById(courseId);</span><br><span class="line">        <span class="comment">//获取用户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">        <span class="type">VOUserCenter</span> <span class="variable">userInfo</span> <span class="operator">=</span> transferUserCenter.getUserInfoById(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拼凑插入数据库的对象</span></span><br><span class="line">        <span class="type">Comment</span> <span class="variable">comment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Comment</span>();</span><br><span class="line">        comment.setCourseId(courseId);</span><br><span class="line">        comment.setTeacherId(courseDetails.getTeacherId());</span><br><span class="line">        comment.setMemberId(userId);</span><br><span class="line">        comment.setNickname(userInfo.getNickname());</span><br><span class="line">        comment.setAvatar(userInfo.getAvatar());</span><br><span class="line">        comment.setContent(content);</span><br><span class="line">        comment.setRate(rate);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行插入操作</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.insert(comment);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30001</span>,<span class="string">&quot;创建评论数据失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//查看课程评论</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">showComment</span><span class="params">(Integer pageNum, Integer pageSize, String courseId, String teacherId)</span> &#123;</span><br><span class="line">        Page&lt;Comment&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, pageSize);</span><br><span class="line">        QueryWrapper&lt;Comment&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId).eq(<span class="string">&quot;teacher_id&quot;</span>,teacherId);</span><br><span class="line">        <span class="built_in">this</span>.baseMapper.selectPage(page,wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//为了分页效果，将数据从page中取出</span></span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        List&lt;Comment&gt; lists = page.getRecords();</span><br><span class="line">        <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> page.getCurrent();</span><br><span class="line">        <span class="type">long</span> <span class="variable">pages</span> <span class="operator">=</span> page.getPages();</span><br><span class="line">        <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> page.getSize();</span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> page.getTotal();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasNext</span> <span class="operator">=</span> page.hasNext();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasPrevious</span> <span class="operator">=</span> page.hasPrevious();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//保存到map中并返回</span></span><br><span class="line">        map.put(<span class="string">&quot;lists&quot;</span>,lists);</span><br><span class="line">        map.put(<span class="string">&quot;current&quot;</span>,current);</span><br><span class="line">        map.put(<span class="string">&quot;pages&quot;</span>,pages);</span><br><span class="line">        map.put(<span class="string">&quot;size&quot;</span>,size);</span><br><span class="line">        map.put(<span class="string">&quot;total&quot;</span>,total);</span><br><span class="line">        map.put(<span class="string">&quot;hasNext&quot;</span>,hasNext);</span><br><span class="line">        map.put(<span class="string">&quot;hasPrevious&quot;</span>,hasPrevious);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="课程支付"><a href="#课程支付" class="headerlink" title="课程支付"></a>课程支付</h2><ul>
<li>课程支付通过微信模拟支付实现</li>
</ul>
<p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220901211446434.png"></p>
<h3 id="前端页面-16"><a href="#前端页面-16" class="headerlink" title="前端页面"></a>前端页面</h3><p>①在api文件夹下创建order.js文件定义被调用的方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123; </span><br><span class="line">    <span class="comment">//生成订单</span></span><br><span class="line">    <span class="title function_">createOrder</span>(<span class="params">courseId</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/serviceorder/order/createOrder/<span class="subst">$&#123;courseId&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//查询订单信息</span></span><br><span class="line">    <span class="title function_">queryOrder</span>(<span class="params">orderNo</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/serviceorder/order/query/<span class="subst">$&#123;orderNo&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//创建支付二维码</span></span><br><span class="line">    <span class="title function_">createOrderCode</span>(<span class="params">orderNo</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/serviceorder/paylog/createCode/<span class="subst">$&#123;orderNo&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//查询订单支付状态</span></span><br><span class="line">    <span class="title function_">queryOrderPayStatus</span>(<span class="params">orderNo</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">`/serviceorder/paylog/queryStatus/<span class="subst">$&#123;orderNo&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在对应页面进行调用</p>
<ul>
<li><p><font color='red'><strong>在当前页面使用js定时器每隔3秒查询订单状态，判断是否支持，且需要通过vue的生命周期函数</strong></font></p>
<p><font color='red'><strong>在vue对象销毁之前把定时器清除，不然就会出现订单未支付，页面关闭定时器仍然调用查询接口</strong></font></p>
</li>
</ul>
<p>③需要修改前端课程显示页面一些内容，动态判断立即观看或立即购买</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">isFree</span>: <span class="literal">true</span>, <span class="comment">//表示免费</span></span><br><span class="line">      <span class="attr">isBuy</span>: <span class="literal">false</span>, <span class="comment">//表示收费</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//获取url上的课程id</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">courseId</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getCourseDetailsById</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">//获取课程信息</span></span><br><span class="line">    <span class="title function_">getCourseDetailsById</span>(<span class="params"></span>)&#123;</span><br><span class="line">      course.<span class="title function_">getCourseDetailsById</span>(<span class="variable language_">this</span>.<span class="property">courseId</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//将查询的数据填充至列表</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">courseDetails</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">courseDetails</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">courseChapterList</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">courseChapterList</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//调用判断课程显示收费还是免费</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">judgeCourseIfNeedBuy</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//判断课程是否需要收费</span></span><br><span class="line">    <span class="title function_">judgeCourseIfNeedBuy</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="comment">//先判断是否能从cookie中取到信息</span></span><br><span class="line">      <span class="keyword">let</span> user = cookie.<span class="title function_">get</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line">      <span class="keyword">if</span>(user)&#123; <span class="comment">//非空或者非0数字代表已经登录</span></span><br><span class="line">          <span class="comment">//查询是否已经购买此课程</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">judgeCourseIsBuyOrNot</span>()</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123; <span class="comment">//代表未登录</span></span><br><span class="line">        <span class="comment">//仅需判断课程价格是否为0即可</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">courseDetails</span>.<span class="property">price</span> !== <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//设置为付费</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isFree</span> = <span class="literal">false</span> </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isBuy</span> = <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;   </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//查询用户是否已购买当前课程</span></span><br><span class="line">    <span class="title function_">judgeCourseIsBuyOrNot</span>(<span class="params"></span>)&#123;</span><br><span class="line">      course.<span class="title function_">judgeCourseIsBuyOrNot</span>(<span class="variable language_">this</span>.<span class="property">courseId</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span>(!response.<span class="property">data</span>.<span class="property">data</span>)&#123; <span class="comment">//表示未购买</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isFree</span> = <span class="literal">false</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isBuy</span> = <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>



<h3 id="后端接口-15"><a href="#后端接口-15" class="headerlink" title="后端接口"></a>后端接口</h3><h4 id="生成订单"><a href="#生成订单" class="headerlink" title="生成订单"></a>生成订单</h4><p>①创建数据表</p>
<p>②在service模块下创建子模块service_order</p>
<p>③改pom文件</p>
<p>④编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8007</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">server-order</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_edu?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="comment">#设置时间格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="comment">#将edu_service注册到nacos服务注册中心</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露所有的监控端点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">  <span class="comment">#设置不检查redis的健康状态，因为引入了actuator依赖会自带检查一些东西的健康状态</span></span><br><span class="line">  <span class="comment">#因为还没用到redis，若不设置会报一个无法连接redis的错误</span></span><br><span class="line">  <span class="attr">health:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置feign客户端超时时间(OpenFeign默认支持ribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment">#指的是建立连接所用的时间，适用于网络状况正常的情况下,两端连接所用的时间</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="comment">#指的是建立连接后从服务器读取到可用资源所用的时间</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#一旦使用xml映射文件就必须设置这个路径,建议每次在创建时就加上</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.slf4j.Slf4jImpl</span></span><br></pre></td></tr></table></figure>

<p>⑤主启动类</p>
<p>⑥业务类</p>
<ul>
<li><p>此接口需要远程调用edu和userCenter模块中的接口，考虑到实体类依赖问题</p>
<p><font color='red'><strong>远程调用需要在两者调用关系之间存在的公共模块中定义封装返回结果的实体类</strong></font></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//order接口和edu接口两者需要使用的返回结果实体</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VOCourseDetails</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line">    <span class="keyword">private</span> String buyCount;</span><br><span class="line">    <span class="keyword">private</span> String lessonNum;</span><br><span class="line">    <span class="keyword">private</span> String viewCount;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String career;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//order接口和userCenter接口两者需要使用的返回结果实体</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VOUserCenter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String openid;</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="keyword">private</span> String sign;</span><br><span class="line">    <span class="keyword">private</span> Boolean isDisabled;</span><br><span class="line">    <span class="keyword">private</span> Boolean isDeleted;</span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在edu和userCenter模块中重新编写两个接口用于消费者调用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据课程id查询课程详情信息 edu模块</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/orderDetails/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> VOCourseDetails <span class="title function_">orderCourseDetailsById</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span> &#123;</span><br><span class="line">    <span class="comment">//根据课程id查询课程信息</span></span><br><span class="line">    <span class="type">VOFrontCourseDetails</span> <span class="variable">queryDetails</span> <span class="operator">=</span> courseService.queryCourseDetailsById(courseId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将查询得出的信息封装到订单所需的课程vo类中并返回</span></span><br><span class="line">    <span class="type">VOCourseDetails</span> <span class="variable">courseDetails</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VOCourseDetails</span>();</span><br><span class="line">    BeanUtils.copyProperties(queryDetails,courseDetails);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> courseDetails;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过userId查询用户信息 userCenter模块</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/userInfo/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> VOUserCenter <span class="title function_">getUserInfoById</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> String userId)</span>&#123;</span><br><span class="line">    <span class="comment">//根据id查询用户信息</span></span><br><span class="line">    <span class="type">UserCenter</span> <span class="variable">queryUser</span> <span class="operator">=</span> userCenterService.getById(userId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将查询出的用户信息封装到vo类中并返回</span></span><br><span class="line">    <span class="type">VOUserCenter</span> <span class="variable">voUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VOUserCenter</span>();</span><br><span class="line">    BeanUtils.copyProperties(queryUser,voUser);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> voUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>order模块控制层接收参数、业务层定义两个接口远程调用其他模块以及实现具体业务逻辑</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/serviceorder/order&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = &quot;*&quot;,maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IOrderService orderService;</span><br><span class="line">    <span class="comment">//通过课程id创建订单</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/createOrder/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;String&gt; <span class="title function_">createOrderByCourseId</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span>String courseId,</span></span><br><span class="line"><span class="params">                                                    HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">        <span class="type">String</span> <span class="variable">orderId</span> <span class="operator">=</span> orderService.createOrder(courseId,userId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;订单创建成功&quot;</span>,orderId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过id查询订单详情</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query/&#123;orderNo&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Order&gt; <span class="title function_">queryOrderDetailsById</span><span class="params">(<span class="meta">@PathVariable(&quot;orderNo&quot;)</span> String orderNo)</span>&#123;</span><br><span class="line">        QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;order_no&quot;</span>,orderNo);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getOne(wrapper);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;service-edu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenFeignTransferEdu</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/serviceedu/frontCourse/orderDetails/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> VOCourseDetails <span class="title function_">orderCourseDetailsById</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;user-center&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenFeignTransferUserCenter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过userId查询用户信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/serviceusercenter/userInfo/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> VOUserCenter <span class="title function_">getUserInfoById</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> String userId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;OrderMapper, Order&gt; <span class="keyword">implements</span> <span class="title class_">IOrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OpenFeignTransferEdu transferEdu;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OpenFeignTransferUserCenter transferUserCenter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据课程id创建订单</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createOrder</span><span class="params">(String courseId, String userId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据课程id远程调用查询课程信息</span></span><br><span class="line">        <span class="type">VOCourseDetails</span> <span class="variable">courseDetails</span> <span class="operator">=</span> transferEdu.orderCourseDetailsById(courseId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据课程id远程调用查询用户信息</span></span><br><span class="line">        <span class="type">VOUserCenter</span> <span class="variable">userInfo</span> <span class="operator">=</span> transferUserCenter.getUserInfoById(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//分别取出创建订单所需的信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">orderNo</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">courseTitle</span> <span class="operator">=</span> courseDetails.getTitle();</span><br><span class="line">        <span class="type">String</span> <span class="variable">courseCover</span> <span class="operator">=</span> courseDetails.getCover();</span><br><span class="line">        <span class="type">String</span> <span class="variable">teacherName</span> <span class="operator">=</span> courseDetails.getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">nickname</span> <span class="operator">=</span> userInfo.getNickname();</span><br><span class="line">        <span class="type">String</span> <span class="variable">mobile</span> <span class="operator">=</span> userInfo.getMobile();</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">totalFee</span> <span class="operator">=</span> courseDetails.getPrice();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建订单对象并填充数据</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setOrderNo(orderNo);</span><br><span class="line">        order.setCourseId(courseId);</span><br><span class="line">        order.setCourseTitle(courseTitle);</span><br><span class="line">        order.setCourseCover(courseCover);</span><br><span class="line">        order.setTeacherName(teacherName);</span><br><span class="line">        order.setMemberId(userId);</span><br><span class="line">        order.setNickname(nickname);</span><br><span class="line">        order.setMobile(mobile);</span><br><span class="line">        order.setTotalFee(totalFee);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//插入数据库</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.insert(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="number">30001</span>,<span class="string">&quot;订单创建失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> order.getOrderNo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="微信二维码"><a href="#微信二维码" class="headerlink" title="微信二维码"></a>微信二维码</h4><ul>
<li>order模块的pom文件中引入下列依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.wxpay<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wxpay-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>控制层、业务层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制层</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/createCode/&#123;orderNo&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">createCode</span><span class="params">(<span class="meta">@PathVariable(&quot;orderNo&quot;)</span> String orderNo)</span>&#123;</span><br><span class="line">    <span class="comment">//返回的map集合中包含了二维码地址，还要其他需要的信息</span></span><br><span class="line">    Map&lt;String,Object&gt; info = payLogService.createCode(orderNo);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;创建成功&quot;</span>,info);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//业务层</span></span><br><span class="line"><span class="comment">//创建微信支付二维码</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">createCode</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1.根据订单查询订单信息</span></span><br><span class="line">        QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;order_no&quot;</span>,orderNo);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getOne(wrapper);</span><br><span class="line">        <span class="comment">//2.使用map设置生成二维码需要的参数</span></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;appid&quot;</span>, <span class="string">&quot;wx74862e0dfcf69954&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;mch_id&quot;</span>, <span class="string">&quot;1558950191&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;nonce_str&quot;</span>, WXPayUtil.generateNonceStr());</span><br><span class="line">        map.put(<span class="string">&quot;body&quot;</span>, order.getCourseTitle()); <span class="comment">//课程标题</span></span><br><span class="line">        map.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo); <span class="comment">//订单号</span></span><br><span class="line">        map.put(<span class="string">&quot;total_fee&quot;</span>, order.getTotalFee().multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;100&quot;</span>)).longValue()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;spbill_create_ip&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;notify_url&quot;</span>, <span class="string">&quot;http://guli.shop/api/order/weixinPay/weixinNotify&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;trade_type&quot;</span>, <span class="string">&quot;NATIVE&quot;</span>);</span><br><span class="line">        <span class="comment">//3.使用httpClient工具类发送请求到微信支付提供的地址，传递的参数必须是xml格式，</span></span><br><span class="line">        <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">HttpClient</span>(<span class="string">&quot;https://api.mch.weixin.qq.com/pay/unifiedorder&quot;</span>);</span><br><span class="line">        <span class="comment">//设置xml格式的参数</span></span><br><span class="line">        client.setXmlParam(WXPayUtil.generateSignedXml(map,<span class="string">&quot;T6m9iK73b0kn9g5v426MKfHQH7X8rKwb&quot;</span>));</span><br><span class="line">        client.setHttps(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//发送请求</span></span><br><span class="line">        client.post();</span><br><span class="line">        <span class="comment">//4.得到发送请求返回结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">contentXml</span> <span class="operator">=</span> client.getContent(); <span class="comment">//返回的内容也是xml格式</span></span><br><span class="line">        <span class="comment">//将xml转为map返回</span></span><br><span class="line">        Map&lt;String,String&gt; resultMap = WXPayUtil.xmlToMap(contentXml);</span><br><span class="line">        <span class="comment">//由于支付还需要其他在resultMap中不存在的信息，因此额外使用一个map封装最终返回结果</span></span><br><span class="line">        Map&lt;String,Object&gt; endMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        endMap.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo);</span><br><span class="line">        endMap.put(<span class="string">&quot;course_id&quot;</span>, order.getCourseId());</span><br><span class="line">        endMap.put(<span class="string">&quot;total_fee&quot;</span>, order.getTotalFee());</span><br><span class="line">        endMap.put(<span class="string">&quot;result_code&quot;</span>, resultMap.get(<span class="string">&quot;result_code&quot;</span>));</span><br><span class="line">        endMap.put(<span class="string">&quot;code_url&quot;</span>, resultMap.get(<span class="string">&quot;code_url&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//微信支付二维码2小时过期，可采取2小时未支付取消订单</span></span><br><span class="line">        <span class="comment">//            redisTemplate.opsForValue().set(orderNo, map, 120, TimeUnit.MINUTES);</span></span><br><span class="line">        <span class="keyword">return</span> endMap;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>,<span class="string">&quot;生成二维码失败，错误信息是：&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="支付状态"><a href="#支付状态" class="headerlink" title="支付状态"></a>支付状态</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过订单号查询订单状态 控制层</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/queryStatus/&#123;orderNo&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">queryOrderStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;orderNo&quot;)</span> String orderNo)</span>&#123;</span><br><span class="line">    <span class="comment">//查询指定的订单</span></span><br><span class="line">    Map&lt;String,String&gt; map = payLogService.queryOrderStatus(orderNo);</span><br><span class="line">    log.info(<span class="string">&quot;*****查询订单状态map：&quot;</span> + map);</span><br><span class="line">    <span class="keyword">if</span> (map == <span class="literal">null</span>) &#123;<span class="comment">//map为空表示支付失败</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="number">30001</span>, <span class="string">&quot;支付失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//map不为空表示支付成功</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;SUCCESS&quot;</span>.equals(map.get(<span class="string">&quot;trade_state&quot;</span>)))&#123;</span><br><span class="line">        <span class="comment">//向支付表中添加数据并更新此订单状态</span></span><br><span class="line">        payLogService.insertDateAndUpdateStatus(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//业务层实现类</span></span><br><span class="line"><span class="comment">//查询订单状态</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">queryOrderStatus</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1、封装参数</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        m.put(<span class="string">&quot;appid&quot;</span>, <span class="string">&quot;wx74862e0dfcf69954&quot;</span>);</span><br><span class="line">        m.put(<span class="string">&quot;mch_id&quot;</span>, <span class="string">&quot;1558950191&quot;</span>);</span><br><span class="line">        m.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo);</span><br><span class="line">        m.put(<span class="string">&quot;nonce_str&quot;</span>, WXPayUtil.generateNonceStr());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、设置请求</span></span><br><span class="line">        <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpClient</span>(<span class="string">&quot;https://api.mch.weixin.qq.com/pay/orderquery&quot;</span>);</span><br><span class="line">        client.setXmlParam(WXPayUtil.generateSignedXml(m, <span class="string">&quot;T6m9iK73b0kn9g5v426MKfHQH7X8rKwb&quot;</span>));</span><br><span class="line">        client.setHttps(<span class="literal">true</span>);</span><br><span class="line">        client.post();</span><br><span class="line">        <span class="comment">//3、返回第三方的数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">xml</span> <span class="operator">=</span> client.getContent();</span><br><span class="line">        Map&lt;String, String&gt; resultMap = WXPayUtil.xmlToMap(xml);</span><br><span class="line">        <span class="comment">//6、转成Map</span></span><br><span class="line">        <span class="comment">//7、返回</span></span><br><span class="line">        <span class="keyword">return</span> resultMap;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//向payLog表中添加数据并修改order订单状态</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertDateAndUpdateStatus</span><span class="params">(Map&lt;String, String&gt; map)</span> &#123;</span><br><span class="line">    <span class="comment">//获取订单id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderNo</span> <span class="operator">=</span> map.get(<span class="string">&quot;out_trade_no&quot;</span>);</span><br><span class="line">    <span class="comment">//根据订单id查询订单信息</span></span><br><span class="line">    QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;order_no&quot;</span>,orderNo);</span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.getOne(wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(order.getStatus() == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    order.setStatus(<span class="number">1</span>);</span><br><span class="line">    orderService.updateById(order);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//记录支付日志</span></span><br><span class="line">    PayLog payLog=<span class="keyword">new</span> <span class="title class_">PayLog</span>();</span><br><span class="line">    payLog.setOrderNo(order.getOrderNo());<span class="comment">//支付订单号</span></span><br><span class="line">    payLog.setPayTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    payLog.setPayType(<span class="number">1</span>);<span class="comment">//支付类型</span></span><br><span class="line">    payLog.setTotalFee(order.getTotalFee());<span class="comment">//总金额(分)</span></span><br><span class="line">    payLog.setTradeState(map.get(<span class="string">&quot;trade_state&quot;</span>));<span class="comment">//支付状态</span></span><br><span class="line">    payLog.setTransactionId(map.get(<span class="string">&quot;transaction_id&quot;</span>));</span><br><span class="line">    payLog.setAttr(JSONObject.toJSONString(map)); <span class="comment">//map中的其他信息</span></span><br><span class="line">    baseMapper.insert(payLog);<span class="comment">//插入到支付日志表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="动态显示观看-x2F-购买"><a href="#动态显示观看-x2F-购买" class="headerlink" title="动态显示观看&#x2F;购买"></a>动态显示观看&#x2F;购买</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过课程id和用户id查询是否购买此课程</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/judgeIsBuyOrNot/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Boolean&gt; <span class="title function_">judgeIsBuyCourseOrNot</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span>String courseId,</span></span><br><span class="line"><span class="params">                                                 HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="comment">//通过token获取用户id</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> orderService.judgeIsBuyCourseOrNot(courseId,userId);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">true</span>,<span class="string">&quot;查询成功&quot;</span>,result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通过课程id和用户id查询是否购买此课程</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">judgeIsBuyCourseOrNot</span><span class="params">(String courseId, String userId)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId)</span><br><span class="line">        .eq(<span class="string">&quot;member_id&quot;</span>,userId)</span><br><span class="line">        .eq(<span class="string">&quot;status&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.baseMapper.selectCount(wrapper);</span><br><span class="line">    <span class="comment">//返回查询结果</span></span><br><span class="line">    <span class="keyword">return</span> result != <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="整合Spring-Cloud"><a href="#整合Spring-Cloud" class="headerlink" title="整合Spring Cloud"></a>整合Spring Cloud</h1><ul>
<li>微服务是一种架构风格，把一个项目拆分成独立的多个服务，多个服务是单独运行，每个服务占用独立的进程</li>
</ul>
<h2 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h2><ul>
<li>其他需要注册进到nacos注册中心都是一样的步骤</li>
</ul>
<p>①将依赖导入到服务消费者或服务提供者的父类pom中，以便复用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud alibaba nacos--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- SpringBoot整合Web组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②在yml配置文件加入这些配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-edu</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露所有的监控端点</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">  <span class="comment">#设置不检查redis的健康状态，因为引入了actuator依赖会自带检查一些东西的健康状态</span></span><br><span class="line">  <span class="comment">#因为还没用到redis，若不设置会报一个无法连接redis的错误</span></span><br><span class="line">  <span class="attr">health:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>③在启动类上添加@EnableDiscoveryClient注解</p>
<h2 id="openFeign"><a href="#openFeign" class="headerlink" title="openFeign"></a>openFeign</h2><p>①将依赖导入到服务消费者8001的pom中，以便复用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--服务调用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②在yml配置文件加入这些配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置feign客户端超时时间(OpenFeign默认支持ribbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment">#指的是建立连接所用的时间，适用于网络状况正常的情况下,两端连接所用的时间</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="comment">#指的是建立连接后从服务器读取到可用资源所用的时间</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<p>③在服务消费者的启动类上添加@EnableFeignClients注解表示开启feign</p>
<p>④在业务层中创建一个接口并添加@FeignClient和@Component注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;aliyun-video-upload&quot;)</span> <span class="comment">//表示到nacos服务注册中心上查找这个名称的服务提供者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenFeignDelVideo</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过这个rest地址去调用服务提供者中相应的方法执行业务</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/servicevod/videoDel/&#123;videoSourceId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delVideoInAliyun</span><span class="params">(<span class="meta">@PathVariable(&quot;videoSourceId&quot;)</span> String videoSourceId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="hystrix"><a href="#hystrix" class="headerlink" title="hystrix"></a>hystrix</h2><p>①将依赖导入到服务消费者8001的pom中，以便复用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--hystrix依赖，主要是用  @HystrixCommand --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②在yml配置文件加入这些配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开启feign对Hystrix的支持,默认是false,</span></span><br><span class="line"><span class="comment">#开启之后可以直接在@FeignClent注解中的fallback属性指定回调的类</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#Hystrix的单独配置,即设置默认超时时间：</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">execution:</span></span><br><span class="line">        <span class="attr">isolation:</span></span><br><span class="line">          <span class="attr">thread:</span></span><br><span class="line">            <span class="attr">timeoutInMilliseconds:</span> <span class="number">6000</span></span><br></pre></td></tr></table></figure>

<p>③在服务消费者的启动类上添加@EnableHystrix注解注解表示开启熔断机制</p>
<p>④在业务层中创建一个类并实现feign定义的远程调用接口编写fallback方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenFeignDelVideoFallback</span> <span class="keyword">implements</span> <span class="title class_">OpenFeignDelVideo</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">delVideoInAliyun</span><span class="params">(String videoSourceId)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;删除阿里云的视频失败，删除失败的视频id是：&quot;</span> + videoSourceId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>⑤在feign定义的远程调用接口上指明降级处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//表示到nacos服务注册中心上查找这个名称的服务提供者，负责此接口服务降级的类是OpenFeignDelVideoFallback</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;aliyun-video-upload&quot;,fallback = OpenFeignDelVideoFallback.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OpenFeignDelVideo</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h2><p><img src="https://myblogimgurl.oss-cn-shenzhen.aliyuncs.com/image-20220826232048125.png" alt="服务调用过程"></p>
<p>（1）接口化请求调用</p>
<p>当调用标注@FeignClient注解接口时，框架将请求转换成Feign请求实例<code>feign.Request</code>，交由Feign框架处理</p>
<p>（2）Feign</p>
<p>转化请求Feign是一个http请求调用的轻量级框架，以Java接口注解的方式调用Http请求，封装了Http调用流程。</p>
<p>（3）Hystrix</p>
<p>熔断处理机制 Feign的调用关系，会被Hystrix代理拦截，对每一个Feign调用请求，Hystrix都会将其包装</p>
<p>成<code>HystrixCommand</code>,参与Hystrix的流控和熔断规则。如果请求判断需要熔断，则Hystrix直接熔断，抛出</p>
<p>异常或者使用<code>FallbackFactory</code>返回熔断<code>Fallback</code>结果；如果通过，则将调用请求传递给<code>Ribbon</code>组件。</p>
<p>（4）Ribbon</p>
<p>服务地址选择 当请求传递到<code>Ribbon</code>之后,<code>Ribbon</code>会根据自身维护的服务列表，根据服务的服务质量，</p>
<p>如平均响应时间，Load等，结合特定的规则，从列表中挑选合适的服务实例，选择好机器之后，</p>
<p>然后将机器实例的信息请求传递给<code>Http Client</code>客户端，<code>HttpClient</code>客户端来执行真正的Http接口调用；</p>
<p>（5）HttpClient (Http客户端)</p>
<p>真正执行Http调用根据上层<code>Ribbon</code>传递过来的请求，已经指定了服务地址，HttpClient开始执行真正的Http请求</p>
<h2 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h2><p>①在online_edu模块下创建子模块online_edu_gateway</p>
<p>②引入所需依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.year21.onlineedu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_utils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--gson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--服务调用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③编写yml配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8010</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">online-edu-gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#网关gateway也是个微服务，必须在nacos中注册</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#开启从注册中心动态创建路由的功能，利用微服务名进行路由，默认为false</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-edu</span> <span class="comment"># 路由的ID，没有固定规则但要求必须唯一，建议配置服务名</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://service-edu</span>  <span class="comment">#匹配后提供服务的动态路由地址</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/serviceedu/**</span> <span class="comment">#断言，路径相匹配的进行路由</span></span><br></pre></td></tr></table></figure>

<p>④编写主启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Gateway8010</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        SpringApplication.run(Gateway8010.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>这里补充一个全局跨域配置类</p>
<p><font color='red'><strong>注意：当使用此全局跨域配置类后，不能够再在控制器上添加@CrossOrigin注解</strong></font></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrossOriginConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>(<span class="keyword">new</span> <span class="title class_">PathPatternParser</span>());</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="bug总结"><a href="#bug总结" class="headerlink" title="bug总结"></a>bug总结</h1><p>1.前端返回的时间数据带T，按照格林威治时间显示，需要修改为按照东八区时间显示</p>
<p>①在实体类中的时间属性上添加注解，这种方法缺点就是需要手动，数据量大就很不方便</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(timezone = &quot;GMT+8&quot;,pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;创建时间&quot;)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime gmtCreate;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置返回前端的数据按照东八区时间显示</span></span><br><span class="line"><span class="meta">@JsonFormat(timezone = &quot;GMT+8&quot;,pattern=&quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;更新时间&quot;)</span></span><br></pre></td></tr></table></figure>

<p>②在yml配置文件中设置jackson时间格式</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置时间格式</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"> <span class="attr">jackson:</span></span><br><span class="line">   <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">   <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br></pre></td></tr></table></figure>

<p>2.有可能因为npm或者node的版本过高导致大量error出现，无法根据package.json安装依赖</p>
<p>参考网友的方法即可解决：</p>
<p>方案一：降低npm或者node的版本</p>
<p>方案二：(npm或者node的高版本)</p>
<p>①安装cnpm ：<code>npm install cnpm -g</code></p>
<p>②安装 node-sass： <code>cnpm install node-sass</code></p>
<p>③继续安装 : <code>cnpm i node-sass -D</code></p>
<p>④根据package.json安装依赖：<code>cnpm install</code></p>
<p>⑤启动项目：<code>npm run dev</code></p>
<p>⑥当控制台出现  Your application is running here: <a target="_blank" rel="noopener" href="http://localhost:9528/">http://localhost:9528</a> 表示启动成功</p>
<p>3.前端页面访问后端容易产生跨域问题，这里记录一下解决方法</p>
<p>①在后端接口上田间@CrossOrigin注解即可</p>
<p>②使用GateWay解决</p>
<p>3.在讲师管理界面点击修改后，当数据成功回显到页面中，再点击添加讲师，发现表单数据没有清空</p>
<ul>
<li>尝试在created()方法判断当id值为空时，清空表单数据，但没有发挥作用，为什么？</li>
</ul>
<p><font color='red'><strong>因为在多次路由跳转到同一个页面，在页面中created()方法只会执行第一次，之后的跳转不再执行</strong></font></p>
<ul>
<li>解决方法，使用vue的watch侦听属性，如下：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">watch</span>:&#123; <span class="comment">//vue的监听功能</span></span><br><span class="line">    $route(to,<span class="keyword">from</span>)&#123; <span class="comment">//路由变化方式，当路由发生变化，init方法就会执行</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>4.在课程信息回显页面，二级课程显示出了id值，而非这个课程的名字。</p>
<ul>
<li><p>造成的原因是：在页面执行完成时，负责二级课程的数组属性值中是为null的，而在数据渲染的底层</p>
<p>是通过遍历二级课程中的数组内的id来匹配显示在页面上的标题，如果此时数组属性值为空，那么就会</p>
<p>直接显示传回的数据id值</p>
</li>
</ul>
<p>解决方法：在一级课程数组赋值后，将对应的id一级分类课程下的二级课程分类赋值给二级数组属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取所有课程名单</span></span><br><span class="line"><span class="title function_">getAllSubjects</span>(<span class="params"></span>)&#123;</span><br><span class="line">    subject.<span class="title function_">getSubjectList</span>()</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">resopnse</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">oneSubjects</span> = resopnse.<span class="property">data</span></span><br><span class="line">        <span class="comment">//必须保证this.oneSubjects不为空的情况才能进行课程信息的回显</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span> )&#123;</span><br><span class="line">            <span class="comment">//获取url中的参数</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">courseId</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">            <span class="comment">//根据id查询信息</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">queryCourseInfoById</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>5.在查询显示最终课程信息的sql语句中需要多次对edu_subject表进行查询title</p>
<ul>
<li><font color='red'><strong>可以对同张表进行两次左外连接查询，只需要将表的别名设置不同即可</strong></font></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LEFT JOIN edu_subject s1 ON c.`subject_id` = s1.`id` </span><br><span class="line">LEFT JOIN edu_subject s2 ON c.`subject_id` = s2.`id` </span><br></pre></td></tr></table></figure>

<p>6.使用阿里云进行视频上传时，明明端口和接口都正确的情况下依旧报跨域问题，</p>
<p>响应状态码为413，这个状态代表着请求实体太大 (Request entity too large)</p>
<ul>
<li><p>经过短暂排查和搜索发现是因为使用nginx进行代理转发，而nginx默认允许上传</p>
<p>的文件大小是1M，上传文件超过了这个阈值</p>
</li>
<li><p>解决方法如下</p>
</li>
</ul>
<p>①打开nginx配置文件 nginx.conf, 路径一般是：&#x2F;etc&#x2F;nginx&#x2F;nginx.conf。</p>
<p>②在http{}段中加入 client_max_body_size 20m; 	20m为允许最大上传的大小。</p>
<p>③保存后重启nginx，问题解决。</p>
<p>7.前端注册页面验证码点击后倒计时效果</p>
<p>使用js的定时器方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这段代码表示每间隔1秒执行setInterval()的方法</span></span><br><span class="line"><span class="title function_">timeDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">let</span> result = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">         --<span class="variable language_">this</span>.<span class="property">second</span>; <span class="comment">//当前秒数-1</span></span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">codeTest</span> = <span class="variable language_">this</span>.<span class="property">second</span> <span class="comment">//并将秒数值填充至获取验证码的文本钟</span></span><br><span class="line">         <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">second</span> &lt; <span class="number">1</span>) &#123; <span class="comment">//如果秒数小于1，即倒计时结束</span></span><br><span class="line">             <span class="built_in">clearInterval</span>(result);<span class="comment">//清除定时器</span></span><br><span class="line">             <span class="variable language_">this</span>.<span class="property">sending</span> = <span class="literal">true</span>;<span class="comment">//让获取验证码按钮可点击</span></span><br><span class="line">             <span class="comment">//this.disabled = false;</span></span><br><span class="line">             <span class="variable language_">this</span>.<span class="property">second</span> = <span class="number">60</span>;<span class="comment">//将倒计时再次置为60</span></span><br><span class="line">             <span class="variable language_">this</span>.<span class="property">codeTest</span> = <span class="string">&quot;获取验证码&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;, <span class="number">1000</span>);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>8.在vue框架中可以通过下列指令获取url地址上指定名称的参数值</p>
<p><font color='red'><strong>this.$route.query.参数名</strong></font></p>
<p>9.<font color='red'><strong>created函数内方法执行顺序并不是从上到下的，而是随机的，哪个请求快就先执行哪个</strong></font></p>
<ul>
<li><p>如果在created函数中有多个方法进行对数据库操作，建议使用.then()函数确保执行顺序</p>
<p>或者在别的方法中使用.then()设置好请求顺序，不然页面有时候有bug存在，明明取到数据</p>
<p>却不生效。</p>
</li>
</ul>
<p>10.在layout中添加了自定义的布局vue，想要生效需要在对应的页面中引入使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">layout</span>: <span class="string">&#x27;video&#x27;</span>, <span class="comment">//引入需要使用的布局</span></span><br></pre></td></tr></table></figure>

<p>11.在进行远程调用时，发现返回的实体类在服务消费者中不存在，返回的实体类只在服务提供者中存在，</p>
<p>不能在这个模块中生成此实体，以避免造成依赖。</p>
<p><font color='red'><strong>解决方法是：在双方公用的模块中生成和返回实体一致的vo类，也可理解为将服务提供者中的实体类</strong></font></p>
<p><font color='red'><strong>copy到公共模块中，让服务消费者和服务提供者都使用这个vo类作为返回实体，因为在远程调用中无论</strong></font></p>
<p><font color='red'><strong>是服务消费者还是服务提供者都必须使用同一个对象作为返回实体才能保证数据的一致性</strong></font></p>
<p>12.树形结构一般是通过拼凑一个对象封装查询数据得到</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//树形结构json形式</span></span><br><span class="line">&#123;</span><br><span class="line">    id:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    name:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            id:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            name:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            children:[]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//树形结构 java实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Treenode[] children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>13.权限管理整合后登录成功，侧边栏菜单不显示内容，但可以在地址栏上输入对应的路由路径</p>
<p>并能正确访问页面和显示数据。</p>
<p>原因：addRoutes()添加路由之后，this.$router.options.routes()（初始路由列表） 未更新</p>
<p>解决方法：在src下文件夹下的permission.js文件中的 和下方代码示例中的第二行代码后面 </p>
<p>添加后两行代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步操作，根据登录用户名字返回动态路由列表</span></span><br><span class="line"><span class="keyword">const</span> accessRoutes = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;permission/generateRoutes&#x27;</span>, roles)</span><br><span class="line"><span class="comment">//进行动态路由+静态路由的合并</span></span><br><span class="line"><span class="keyword">let</span> allRoute = constantRoutes.<span class="title function_">concat</span>(accessRoutes)</span><br><span class="line"><span class="comment">//更新配置的初始路由列表</span></span><br><span class="line">router.<span class="property">options</span>.<span class="property">routes</span> = allRoute;</span><br></pre></td></tr></table></figure>

<p>14.经过权限管理的bug调试，终于知道为什么要在用户登录的时候去查看用户对应的权限值</p>
<p>并将其携带返回到前端保存在了store对象当中？</p>
<p>因为在前端工程中使用了v-if 调用注册的全局方法hasPerm,再将需要判断的权限值传入</p>
<p>hasPerim(”权限值“)，而hasPerm又在main.js文件中被定义成了另外一个判断权限的方法 </p>
<p>Vue.prototype.hasPerm &#x3D; hasBtnPermission ，在这个hasBtnPermission会从store对象</p>
<p>中取出代表button访问权限的数组，经过遍历此数组和当前传入权限值的匹配程度决定了</p>
<p>某个页面上的按钮是否能被此用户所看到</p>
<p>15.前端请求参数有斜杠或反斜杠接口访问不到，前端将此参数base64编码后传递</p>
<ul>
<li>前端base64编码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求参数有斜杠或反斜杠接口访问不到，因此需要前端将其base64编码后传递</span></span><br><span class="line"><span class="keyword">let</span> dbPath = <span class="variable language_">window</span>.<span class="title function_">btoa</span>(path)</span><br></pre></td></tr></table></figure>

<ul>
<li>后端base64解码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 对base64码进行解码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 需要解码的base64字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 解码之后的字符串</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decode</span><span class="params">(String code)</span>&#123;</span><br><span class="line">    String str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        str=<span class="keyword">new</span> <span class="title class_">String</span>(Base64.decodeBase64(code),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Year21</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://year21.top/2022/09/14/OnlineEducation">http://year21.top/2022/09/14/OnlineEducation</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xxxccc1986.github.io" target="_blank">Year 21's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringCloud/">SpringCloud</a><a class="post-meta__tags" href="/tags/Vue/">Vue</a><a class="post-meta__tags" href="/tags/Nuxt/">Nuxt</a><a class="post-meta__tags" href="/tags/ElementUi/">ElementUi</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg" data-sites="facebook,twitter,wechat,qq"></div><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/09/14/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/"><img class="prev-cover" src="https://w.wallhaven.cc/full/v9/wallhaven-v9wzlm.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">其他技术</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/14/DeploySpringCloudOnLinux/"><img class="next-cover" src="https://w.wallhaven.cc/full/9m/wallhaven-9m5y98.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">如何在Linux上部署SpringCloud项目？</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/09/14/DeploySpringCloudOnLinux/" title="如何在Linux上部署SpringCloud项目？"><img class="cover" src="https://w.wallhaven.cc/full/9m/wallhaven-9m5y98.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-14</div><div class="title">如何在Linux上部署SpringCloud项目？</div></div></a></div><div><a href="/2022/08/17/SpringCloud/" title="SpringCloud"><img class="cover" src="https://w.wallhaven.cc/full/kw/wallhaven-kwov61.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-17</div><div class="title">SpringCloud</div></div></a></div><div><a href="/2022/04/08/JavaWebNew/" title="ThymeLeaf、VUE、Axios"><img class="cover" src="https://w.wallhaven.cc/full/m9/wallhaven-m9y9j1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-08</div><div class="title">ThymeLeaf、VUE、Axios</div></div></a></div><div><a href="/2022/07/07/ManagementSystem/" title="SpringBoot+Vue的前后端分离项目"><img class="cover" src="https://w.wallhaven.cc/full/k7/wallhaven-k7q797.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-07</div><div class="title">SpringBoot+Vue的前后端分离项目</div></div></a></div><div><a href="/2022/09/14/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" title="前端技术"><img class="cover" src="https://w.wallhaven.cc/full/rd/wallhaven-rdv95q.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-14</div><div class="title">前端技术</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Year 21</div><div class="author-info__description">昨天   今天   明天</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">34</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxccc1986"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1483501858&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://t.me/year_21_xx" target="_blank" title="Telegram"><i class="fab fa-telegram"></i></a><a class="social-icon" href="mailto:masicjokersic@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一个不知名的初学者，欢迎指教。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">项目简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%8A%9F%E8%83%BD%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text">项目功能点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">项目技术点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">公共模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88Swagger"><span class="toc-number">3.1.</span> <span class="toc-text">整合Swagger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E"><span class="toc-number">3.2.</span> <span class="toc-text">统一结果返回</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">3.3.</span> <span class="toc-text">统一异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">统一日志处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.</span> <span class="toc-text">后台系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%B7%A5%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">前端页面工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">4.2.</span> <span class="toc-text">新功能开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">4.3.</span> <span class="toc-text">nginx反向代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E7%AE%A1%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">首页管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%98%BE%E7%A4%BA"><span class="toc-number">4.4.1.</span> <span class="toc-text">登录显示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E7%AE%A1%E7%90%86"><span class="toc-number">4.5.</span> <span class="toc-text">讲师管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.5.1.</span> <span class="toc-text">前端页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%88%97%E8%A1%A8"><span class="toc-number">4.5.1.1.</span> <span class="toc-text">讲师列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9D%A1"><span class="toc-number">4.5.1.2.</span> <span class="toc-text">分页条</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.5.1.3.</span> <span class="toc-text">条件查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AE%B2%E5%B8%88"><span class="toc-number">4.5.1.4.</span> <span class="toc-text">删除讲师</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AE%B2%E5%B8%88"><span class="toc-number">4.5.1.5.</span> <span class="toc-text">添加讲师</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AE%B2%E5%B8%88"><span class="toc-number">4.5.1.6.</span> <span class="toc-text">修改讲师</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%A4%B4%E5%83%8F"><span class="toc-number">4.5.1.7.</span> <span class="toc-text">讲师头像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.5.2.</span> <span class="toc-text">后端接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AE%B2%E5%B8%88-1"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">删除讲师</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AE%B2%E5%B8%88"><span class="toc-number">4.5.2.2.</span> <span class="toc-text">查询讲师</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E8%AE%B2%E5%B8%88"><span class="toc-number">4.5.2.3.</span> <span class="toc-text">新增讲师</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AE%B2%E5%B8%88-1"><span class="toc-number">4.5.2.4.</span> <span class="toc-text">修改讲师</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%A4%B4%E5%83%8F-1"><span class="toc-number">4.5.2.5.</span> <span class="toc-text">讲师头像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="toc-number">4.6.</span> <span class="toc-text">课程分类管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-1"><span class="toc-number">4.6.1.</span> <span class="toc-text">前端页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B"><span class="toc-number">4.6.1.1.</span> <span class="toc-text">添加课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%98%BE%E7%A4%BA"><span class="toc-number">4.6.1.2.</span> <span class="toc-text">课程显示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">4.6.2.</span> <span class="toc-text">后端接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B-1"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">添加课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%98%BE%E7%A4%BA-1"><span class="toc-number">4.6.2.2.</span> <span class="toc-text">课程显示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E7%AE%A1%E7%90%86"><span class="toc-number">4.7.</span> <span class="toc-text">课程管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-2"><span class="toc-number">4.7.1.</span> <span class="toc-text">前端页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B-2"><span class="toc-number">4.7.1.1.</span> <span class="toc-text">添加课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%A4%A7%E7%BA%B2"><span class="toc-number">4.7.1.2.</span> <span class="toc-text">课程大纲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E8%AF%BE%E7%A8%8B"><span class="toc-number">4.7.1.3.</span> <span class="toc-text">确认课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%8F%91%E5%B8%83"><span class="toc-number">4.7.1.4.</span> <span class="toc-text">最终发布</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8"><span class="toc-number">4.7.1.5.</span> <span class="toc-text">课程列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">4.7.1.6.</span> <span class="toc-text">查询课程信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">4.7.1.7.</span> <span class="toc-text">更新课程信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%BE%E7%A8%8B"><span class="toc-number">4.7.1.8.</span> <span class="toc-text">删除课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-x2F-%E4%BF%AE%E6%94%B9-x2F-%E5%88%A0%E9%99%A4%E7%AB%A0%E8%8A%82"><span class="toc-number">4.7.1.9.</span> <span class="toc-text">添加&#x2F;修改&#x2F;删除章节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4-%E5%B0%8F%E8%8A%82%E8%A7%86%E9%A2%91"><span class="toc-number">4.7.1.10.</span> <span class="toc-text">添加(删除)小节视频</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-2"><span class="toc-number">4.7.2.</span> <span class="toc-text">后端接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AF%BE%E7%A8%8B-3"><span class="toc-number">4.7.2.1.</span> <span class="toc-text">添加课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%A4%A7%E7%BA%B2-1"><span class="toc-number">4.7.2.2.</span> <span class="toc-text">课程大纲</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E8%AF%BE%E7%A8%8B-1"><span class="toc-number">4.7.2.3.</span> <span class="toc-text">确认课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E5%8F%91%E5%B8%83-1"><span class="toc-number">4.7.2.4.</span> <span class="toc-text">最终发布</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8-1"><span class="toc-number">4.7.2.5.</span> <span class="toc-text">课程列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF-1"><span class="toc-number">4.7.2.6.</span> <span class="toc-text">查询课程信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%AF%BE%E7%A8%8B%E4%BF%A1%E6%81%AF-1"><span class="toc-number">4.7.2.7.</span> <span class="toc-text">更新课程信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%BE%E7%A8%8B-1"><span class="toc-number">4.7.2.8.</span> <span class="toc-text">删除课程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%A0%E8%8A%82%E7%AE%A1%E7%90%86"><span class="toc-number">4.7.2.9.</span> <span class="toc-text">章节管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%B0%8F%E8%8A%82%E8%A7%86%E9%A2%91"><span class="toc-number">4.7.2.10.</span> <span class="toc-text">添加小节视频</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%B0%8F%E8%8A%82%E8%A7%86%E9%A2%91"><span class="toc-number">4.7.2.11.</span> <span class="toc-text">删除小节视频</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90"><span class="toc-number">4.8.</span> <span class="toc-text">统计分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-3"><span class="toc-number">4.8.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-3"><span class="toc-number">4.8.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CMS%E7%AE%A1%E7%90%86"><span class="toc-number">4.9.</span> <span class="toc-text">CMS管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-4"><span class="toc-number">4.9.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-4"><span class="toc-number">4.9.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E8%AE%BA%E7%AE%A1%E7%90%86"><span class="toc-number">4.10.</span> <span class="toc-text">评论管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-5"><span class="toc-number">4.10.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-5"><span class="toc-number">4.10.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86"><span class="toc-number">4.11.</span> <span class="toc-text">订单管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-6"><span class="toc-number">4.11.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-6"><span class="toc-number">4.11.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">4.12.</span> <span class="toc-text">权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88Spring-Security"><span class="toc-number">4.12.1.</span> <span class="toc-text">整合Spring Security</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-7"><span class="toc-number">4.12.2.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.12.3.</span> <span class="toc-text">后台接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">4.12.4.</span> <span class="toc-text">登录过程分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E5%8F%B0%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.</span> <span class="toc-text">前台系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NUXT%E8%B7%AF%E7%94%B1"><span class="toc-number">5.1.</span> <span class="toc-text">NUXT路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5axios"><span class="toc-number">5.2.</span> <span class="toc-text">引入axios</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88redis"><span class="toc-number">5.3.</span> <span class="toc-text">整合redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E6%AD%A5%E9%AA%A4"><span class="toc-number">5.3.1.</span> <span class="toc-text">整合步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot%E7%BC%93%E5%AD%98%E6%B3%A8%E8%A7%A3"><span class="toc-number">5.3.2.</span> <span class="toc-text">SpringBoot缓存注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#banner%E8%BD%AE%E6%92%AD%E5%9B%BE"><span class="toc-number">5.4.</span> <span class="toc-text">banner轮播图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-number">5.4.1.</span> <span class="toc-text">数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-8"><span class="toc-number">5.4.2.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-7"><span class="toc-number">5.4.3.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E5%B1%95%E7%A4%BA"><span class="toc-number">5.5.</span> <span class="toc-text">首页展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-9"><span class="toc-number">5.5.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-8"><span class="toc-number">5.5.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">5.6.</span> <span class="toc-text">注册功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-10"><span class="toc-number">5.6.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E4%BF%A1%E6%B3%A8%E5%86%8C"><span class="toc-number">5.6.2.</span> <span class="toc-text">短信注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">5.6.3.</span> <span class="toc-text">后台接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">5.7.</span> <span class="toc-text">登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-11"><span class="toc-number">5.7.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95"><span class="toc-number">5.7.2.</span> <span class="toc-text">整合微信登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-9"><span class="toc-number">5.7.3.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83"><span class="toc-number">5.8.</span> <span class="toc-text">用户中心</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-12"><span class="toc-number">5.8.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-10"><span class="toc-number">5.8.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%B2%E5%B8%88%E5%8F%8A%E8%AF%A6%E6%83%85%E5%B1%95%E7%A4%BA"><span class="toc-number">5.9.</span> <span class="toc-text">讲师及详情展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-13"><span class="toc-number">5.9.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-11"><span class="toc-number">5.9.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%8F%8A%E8%AF%A6%E6%83%85%E5%B1%95%E7%A4%BA"><span class="toc-number">5.10.</span> <span class="toc-text">课程及详情展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-14"><span class="toc-number">5.10.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-12"><span class="toc-number">5.10.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE"><span class="toc-number">5.11.</span> <span class="toc-text">课程视频播放</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-15"><span class="toc-number">5.11.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-13"><span class="toc-number">5.11.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%AF%84%E8%AE%BA"><span class="toc-number">5.12.</span> <span class="toc-text">课程评论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%8F%B0%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.12.1.</span> <span class="toc-text">前台页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-14"><span class="toc-number">5.12.2.</span> <span class="toc-text">后端接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%94%AF%E4%BB%98"><span class="toc-number">5.13.</span> <span class="toc-text">课程支付</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-16"><span class="toc-number">5.13.1.</span> <span class="toc-text">前端页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3-15"><span class="toc-number">5.13.2.</span> <span class="toc-text">后端接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%AE%A2%E5%8D%95"><span class="toc-number">5.13.2.1.</span> <span class="toc-text">生成订单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81"><span class="toc-number">5.13.2.2.</span> <span class="toc-text">微信二维码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E7%8A%B6%E6%80%81"><span class="toc-number">5.13.2.3.</span> <span class="toc-text">支付状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA%E8%A7%82%E7%9C%8B-x2F-%E8%B4%AD%E4%B9%B0"><span class="toc-number">5.13.2.4.</span> <span class="toc-text">动态显示观看&#x2F;购买</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B4%E5%90%88Spring-Cloud"><span class="toc-number">6.</span> <span class="toc-text">整合Spring Cloud</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nacos"><span class="toc-number">6.1.</span> <span class="toc-text">nacos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#openFeign"><span class="toc-number">6.2.</span> <span class="toc-text">openFeign</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hystrix"><span class="toc-number">6.3.</span> <span class="toc-text">hystrix</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">6.4.</span> <span class="toc-text">执行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gateway"><span class="toc-number">6.5.</span> <span class="toc-text">Gateway</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bug%E6%80%BB%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">bug总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/27/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" title="数据结构与算法"><img src="https://w.wallhaven.cc/full/dp/wallhaven-dp1v8g.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法"/></a><div class="content"><a class="title" href="/2022/11/27/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" title="数据结构与算法">数据结构与算法</a><time datetime="2022-11-27T15:24:02.000Z" title="发表于 2022-11-27 23:24:02">2022-11-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"><img src="https://w.wallhaven.cc/full/57/wallhaven-57o9v3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式"/></a><div class="content"><a class="title" href="/2022/10/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式">设计模式</a><time datetime="2022-10-10T04:12:02.000Z" title="发表于 2022-10-10 12:12:02">2022-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/DeploySpringCloudOnLinux/" title="如何在Linux上部署SpringCloud项目？"><img src="https://w.wallhaven.cc/full/9m/wallhaven-9m5y98.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何在Linux上部署SpringCloud项目？"/></a><div class="content"><a class="title" href="/2022/09/14/DeploySpringCloudOnLinux/" title="如何在Linux上部署SpringCloud项目？">如何在Linux上部署SpringCloud项目？</a><time datetime="2022-09-14T13:50:02.000Z" title="发表于 2022-09-14 21:50:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/OnlineEducation/" title="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目"><img src="https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目"/></a><div class="content"><a class="title" href="/2022/09/14/OnlineEducation/" title="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目">SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目</a><time datetime="2022-09-14T13:45:02.000Z" title="发表于 2022-09-14 21:45:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/" title="其他技术"><img src="https://w.wallhaven.cc/full/v9/wallhaven-v9wzlm.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="其他技术"/></a><div class="content"><a class="title" href="/2022/09/14/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/" title="其他技术">其他技术</a><time datetime="2022-09-14T13:33:02.000Z" title="发表于 2022-09-14 21:33:02">2022-09-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 By Year 21</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">心之所向，皆可抵达</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://jsdelivr.pai233.top/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://jsdelivr.pai233.top/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'FdeA2Fr167tRipdBpVUi0fvz-gzGzoHsz',
      appKey: 'roCcb1ljCCFK13sNVcwK4VJi',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://jsdelivr.pai233.top/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="6712227171" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(d, w, c) {
    w.ChatraID = 'Z2tPHYia3jhnSPJ3K';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.js"></script><script src="https://jsdelivr.pai233.top/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://jsdelivr.pai233.top/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>