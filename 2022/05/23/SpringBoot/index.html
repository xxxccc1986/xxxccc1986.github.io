<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SpringBoot | Year 21's Blog</title><meta name="keywords" content="SpringBoot"><meta name="author" content="Year 21"><meta name="copyright" content="Year 21"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringBoot概述SpringBoot程序创建①对Maven进行设定 12345678910111213141516171819&lt;mirror&gt;	&lt;id&gt;nexus-aliyun&lt;&#x2F;id&gt;	&lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;	&lt;name&gt;Nexus aliyun&lt;&#x2F;name&gt;	&lt;u">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot">
<meta property="og:url" content="http://xxxccc1986.github.io/2022/05/23/SpringBoot/index.html">
<meta property="og:site_name" content="Year 21&#39;s Blog">
<meta property="og:description" content="SpringBoot概述SpringBoot程序创建①对Maven进行设定 12345678910111213141516171819&lt;mirror&gt;	&lt;id&gt;nexus-aliyun&lt;&#x2F;id&gt;	&lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;	&lt;name&gt;Nexus aliyun&lt;&#x2F;name&gt;	&lt;u">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2022/05/23/X9ra5D.png">
<meta property="article:published_time" content="2022-05-23T14:52:02.000Z">
<meta property="article:modified_time" content="2022-05-23T14:52:02.000Z">
<meta property="article:author" content="Year 21">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/05/23/X9ra5D.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xxxccc1986.github.io/2022/05/23/SpringBoot/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Year 21","link":"链接: ","source":"来源: Year 21's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-05-23 22:52:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2022/05/23/X9ra5D.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Year 21's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-23T14:52:02.000Z" title="发表于 2022-05-23 22:52:02">2022-05-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-23T14:52:02.000Z" title="更新于 2022-05-23 22:52:02">2022-05-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>74分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="SpringBoot概述"><a href="#SpringBoot概述" class="headerlink" title="SpringBoot概述"></a>SpringBoot概述</h2><h3 id="SpringBoot程序创建"><a href="#SpringBoot程序创建" class="headerlink" title="SpringBoot程序创建"></a>SpringBoot程序创建</h3><p>①对Maven进行设定</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②创建Maven工程，在pom文件中设置工程的父工程以及导入Springboot的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>③创建主程序类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@SpringBootApplication注解标识这是一个SpringBoot应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>④简化配置</p>
<ul>
<li><font color='red'><strong>所有的配置信息只需要写在resource文件夹下</strong></font></li>
</ul>
<p>⑤测试程序的运行是否成功：<font color='red'><strong>只需要启动主程序类的main方法即可</strong></font></p>
<p>⑥简化部署步骤</p>
<p>插件在没有设置打包方式的情况下，自动打包为jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="SpringBoot特点"><a href="#SpringBoot特点" class="headerlink" title="SpringBoot特点"></a>SpringBoot特点</h3><p>1.依赖管理</p>
<p>①父项目作为依赖管理，声明了所有开发中常用的依赖的版本号,自动版本仲裁机制，子项目继承父项目不需要填写依赖的版本号</p>
<p>②开发导入starter场景启动器，spring-boot-starter-* ： *是某种场景</p>
<p>③可以修改默认的父项目的版本控制</p>
<p>2.自动配置</p>
<p>①自动配置tomcat(引入Tomcat依赖、配置Tomcat)</p>
<p>②自动配置SpringMVC</p>
<p>③自动配置Web常见功能</p>
<p>④默认的包结构</p>
<ul>
<li>主程序所在包及其下面的所有子包里面的组件都会被默认扫描进来</li>
<li>无需配置之前的包扫描</li>
<li>改变扫描路径，@SpringBootApplication(scanBasePackages&#x3D;”xxx.xxx”)或者@ComponentScan 指定扫描路径</li>
</ul>
<p>⑤各种配置拥有默认值</p>
<p>⑥按需加载所有自动配置</p>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p>1.@Configuration</p>
<ul>
<li><strong>proxyBeanMethods：代理bean的方法</strong></li>
</ul>
<p>Full(proxyBeanMethods &#x3D; true)、【保证每个@Bean方法被调用多少次返回的组件都是单实例的】</p>
<p>Lite(proxyBeanMethods &#x3D; false)【每个@Bean方法被调用多少次返回的组件都是新创建的】</p>
<p>有组件依赖的情况必须使用Full模式默认。其他默认是否Lite模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//验证组件依赖是否解决，是否保证了bean实例的唯一性</span></span><br><span class="line"><span class="comment">//@Configuration(proxyBeanMethods = false)的情况下</span></span><br><span class="line"><span class="type">Pet</span> <span class="variable">tom</span> <span class="operator">=</span> config.getBean(<span class="string">&quot;pet&quot;</span>,Pet.class);</span><br><span class="line">System.out.println(config.getBean(<span class="string">&quot;person&quot;</span>,Person.class).getPet() == tom);<span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>2.@Import导入容器中的组件默认名字就是全类名</p>
<p>3.@Conditonal 条件装配，满足Condition指定的条件才会进行组件注入</p>
<p>@ConditionalOnBean表示当容器中存在某个bean对象才会执行什么操作</p>
<ul>
<li>标注在类上则表示要满足才会导入类中的所有组件</li>
<li>标注在方法上则表示要满足才会导入方法内的所有组件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此注解表示容器中有id为pet的组件才会往容器中注册下面@Bean标注的</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(name= &#123;&quot;pet&quot;&#125;)</span>    </span><br><span class="line"><span class="comment">//方法名作为容器中组件的id，返回值类型为容器中组件的类型</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;test&quot;</span>, <span class="number">20</span>);</span><br><span class="line">      person.setPet(pet());</span><br><span class="line">      <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>4.@ImportResource 导入Spring原生的配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:bean.xml&quot;)</span></span><br></pre></td></tr></table></figure>

<p>5.配置绑定 (使用Java读取到properties文件中的内容，并且把它封装到JavaBean中)</p>
<p>方式一：@ConfigurationProperties</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//也就是必须使用@ConfigurationProperties的类必须将其加入容器中</span></span><br><span class="line"><span class="comment">//只有在容器中的组件才能使用SpringBoot提供的功能</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//value的值car表示将与配置文件application.properties中属性以car为前缀的变量值进行绑定</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(value = &quot;car&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarProperties</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>方式二：@EnableConfigurationProperties + @ConfigurationProperties(这个方式适用于导入第三方jar包)</p>
<p>@EnableConfigurationProperties 必须标注在配置类上</p>
<p>@ConfigurationProperties标注在进行配置绑定的类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.开启CarProperties属性配置功能</span></span><br><span class="line"><span class="comment">//2.将这个组件自动导入到容器中</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(CarProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfig</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(value = &quot;car&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarProperties</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h3><p>@SpringBootConfiguration 代表这是一个配置类</p>
<p>@ComponentScan 扫描指定包路径下的组件</p>
<p>@EnableAutoConfiguration(<font color='red'><strong>重点</strong></font>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//等同于下面三个</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">	@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br></pre></td></tr></table></figure>

<p>关于@EnableAutoConfiguration注解的详解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>@AutoConfigurationPackage注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用Registrar给容器中导入多个组件</span></span><br><span class="line"><span class="comment">//在这个内部类的方法中将MainApplication所在包下的所有组件进行批量注册</span></span><br><span class="line"><span class="meta">@Import(AutoConfigurationPackages.Registrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>@Import(AutoConfigurationImportSelector.class)注解</p>
<p><font color='red'><strong>虽然在Spring-boot启动时会加载所有默认场景的自动配置类，但最终还是按照条件装配原则@Conditional注解(有些加载了但不生效)</strong></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给容器中批量导入一些组件</span></span><br><span class="line">getAutoConfigurationEntry()&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取所有需要导入到容器中的组件</span></span><br><span class="line">List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//利用工厂加载得到所有的组件 </span></span><br><span class="line">Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">loadSpringFactories</span><span class="params">(ClassLoader classLoader)</span> &#123;</span><br><span class="line">   </span><br><span class="line"><span class="comment">/*默认扫描当前系统中所有META-INF/spring.factories位置的文件中的内容  </span></span><br><span class="line"><span class="comment">以内容中org.springframework.boot.autoconfigure.EnableAutoConfiguration=为key，</span></span><br><span class="line"><span class="comment">需要注册的组件名为value，最后会逐个注册到ioc容器中</span></span><br><span class="line"><span class="comment">例如：    </span></span><br><span class="line"><span class="comment">spring-boot-autoconfigure-2.6.7.jar这个jar中也有META-INF/spring.factories文件     </span></span><br><span class="line"><span class="comment">这个文件中写死了需要总共加载的所有组件，在spring-boot一启动就会就会加载所有组件*/</span></span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\....   </span><br><span class="line">&#125; </span><br><span class="line">    </span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<p>按照条件装配的例子之一：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给容器中加入了文件上传解析器；</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(MultipartResolver.class)</span>  <span class="comment">//容器中有这个类型组件</span></span><br><span class="line"><span class="comment">//容器中没有这个名字 multipartResolver 的组件</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span> </span><br><span class="line"><span class="keyword">public</span> MultipartResolver <span class="title function_">multipartResolver</span><span class="params">(MultipartResolver resolver)</span> &#123;</span><br><span class="line">          <span class="comment">//给@Bean标注的方法传入了对象参数，这个参数的值就会从容器中找。</span></span><br><span class="line">          <span class="comment">//SpringMVC multipartResolver。防止有些用户配置的文件上传解析器不符合规范</span></span><br><span class="line">	<span class="comment">// Detect if the user has created a MultipartResolver but named it incorrectly</span></span><br><span class="line">	<span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color='red'><strong>SpringBoot自动配置总结：</strong></font></p>
<p>①SpringBoot先加载所有的自动配置类(xxxAutoConfiguration)</p>
<p>②每个自动配置类按照条件装配原则来决定是否生效，默认都会绑定配置文件指定的值 xxxxProperties 和 配置文件进行了绑定</p>
<p>③生效的配置类就会给容器中注册很多的组件(只要容器中存在这些组件代表这些功能就能使用)</p>
<p>④SpringBoot底层会装配好所有的组件，但只要用户有将对应的组件重新配置，则优先使用用户配置的</p>
<ul>
<li><ul>
<li>@Bean替换底层的组件</li>
<li>看这个组件是获取的配置文件什么值就去修改。</li>
</ul>
</li>
</ul>
<p>总的流程就是：<font color='red'><strong>场景starter —&gt; xxxxxAutoConfiguration —&gt; 组件  —&gt;</strong> <strong>xxxxProperties里面拿值  —-&gt; application.properties</strong></font></p>
<hr>
<p>部分使用技巧：</p>
<p>①引入场景依赖,<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter">官方文档地址</a></p>
<p>②快速判断哪个组件是否生效：在application.properties配置文件中设置debug&#x3D;true 生效的(Positive)\不生效的(Negative)</p>
<p>③修改某一项配置</p>
<ul>
<li><p>参照<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties">官方文档地址</a>修改配置项</p>
</li>
<li><p>自己分析。xxxxProperties绑定了配置文件的哪些。</p>
</li>
<li><p>自定义加入或者替换组件@Bean、@Component</p>
</li>
<li><p>自定义器  XXXXXCustomizer</p>
</li>
</ul>
<h3 id="开发小技巧"><a href="#开发小技巧" class="headerlink" title="开发小技巧"></a>开发小技巧</h3><p>1.lombok(简化JavaBean开发)</p>
<p>①在pom文件中引入依赖</p>
<p>②在IDEA中安装lombok插件并重启</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> <span class="comment">//设置属性的get、set方法</span></span><br><span class="line"><span class="meta">@ToString</span> <span class="comment">//设置toString方法</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span>  <span class="comment">//设置有参构造器</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span>	<span class="comment">//设置无参构造器</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(value = &quot;car&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String carName;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> carAge;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span>	<span class="comment">//可以替代sout打印输出信息</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">TestHello</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;请求已进入&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.dev-tools</p>
<p>Ctrl + F9项目重新编译达到自动重启的目的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 设置自动重启 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.Spring Initailizr（项目初始化向导）</p>
<p>1.选择我们需要的开发场景</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9dho4.png"></p>
<p>2.自动依赖引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.year21<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot02<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>SpringBoot02<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.自动创建项目结构</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9dIY9.png"></p>
<p>4.自动编写好主配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBoot02Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBoot02Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h2><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>YAML 是 “YAML Ain’t Markup Language”（YAML 不是一种标记语言）的递归缩写。</p>
<p>在开发的这种语言时，YAML 的意思其实是：”Yet Another Markup Language”（仍是一种标记语言）。 </p>
<p>YAML更加关注的是数据本身，</p>
<p>基本语法：</p>
<ul>
<li>key: value；kv之间有空格</li>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进不允许使用tab，只允许空格</li>
<li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li>
<li>‘#’表示注释</li>
<li>字符串无需加引号，如果要加，’’与””表示字符串内容 会被 转义&#x2F;不转义</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用yaml表示javaBean</span></span><br><span class="line"><span class="attr">people:</span></span><br><span class="line">  <span class="attr">userName:</span> <span class="string">&quot;测试\n人物 &quot;</span></span><br><span class="line"><span class="comment"># 单引号会将 \n作为字符串输出，双引号会将\n作为换行符输出</span></span><br><span class="line"><span class="comment"># 单引号会出现转义，双引号不会出现转义</span></span><br><span class="line">  <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">birth:</span> <span class="number">2020</span><span class="string">/10/9</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">20</span></span><br><span class="line"><span class="comment"># 行内写法 interests: [画画,看书]</span></span><br><span class="line">  <span class="attr">interests:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">画画</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">看书</span></span><br><span class="line">  <span class="attr">animal:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">熊猫</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">猫</span></span><br><span class="line"><span class="comment">#  score:</span></span><br><span class="line"><span class="comment">#    technical: 85</span></span><br><span class="line"><span class="comment">#    english: 90</span></span><br><span class="line">  <span class="attr">score:</span> &#123;<span class="attr">technical:</span> <span class="number">85</span>,<span class="attr">english:</span> <span class="number">90</span>&#125;</span><br><span class="line">  <span class="attr">salary:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2000</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">3500</span></span><br><span class="line">  <span class="attr">pet:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">xiaoxiao</span></span><br><span class="line">    <span class="attr">weight:</span> <span class="number">20.1</span></span><br><span class="line">  <span class="attr">allPets:</span></span><br><span class="line">     <span class="attr">sick:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">xiaoxiao</span>,<span class="attr">weight:</span> <span class="number">20.5</span>&#125;</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xiao1</span></span><br><span class="line">        <span class="attr">weight:</span> <span class="number">25.5</span></span><br><span class="line">     <span class="attr">health:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">xiaoe</span>,<span class="attr">weight:</span> <span class="number">25.5</span>&#125;</span><br></pre></td></tr></table></figure>

<p>可以引入此依赖可以在application.yaml中定义属性显示提示</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Web开发"><a href="#Web开发" class="headerlink" title="Web开发"></a>Web开发</h3><h4 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h4><h5 id="静态资源的目录"><a href="#静态资源的目录" class="headerlink" title="静态资源的目录"></a>静态资源的目录</h5><p>Ⅰ.静态资源放在类路径下的这些文件夹中： &#x2F;static (或者 &#x2F;public 或 &#x2F;resources 或 &#x2F;META-INF&#x2F;resources)</p>
<p>都能通过当前项目根路径&#x2F; + 静态资源名 访问 </p>
<p>原理： 静态映射&#x2F;**</p>
<ul>
<li><p>与SpringMVC的处理机制一样，当有非jsp后缀的请求进入时，由前端控制器先进行处理，</p>
<p>前端控制器不能处理再交给默认的静态资源处理器，如果静态资源处理器不能处理则报404</p>
</li>
</ul>
<p>Ⅱ.设置静态资源访问前缀</p>
<p>默认无前缀设置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/res/**</span></span><br></pre></td></tr></table></figure>

<p>设置之后则静态资源的访问路径为：当前项目 + res + 静态资源名字</p>
<h5 id="欢迎页支持"><a href="#欢迎页支持" class="headerlink" title="欢迎页支持"></a>欢迎页支持</h5><p>方式一：静态资源路径下  index.html</p>
<ul>
<li><p>可以配置静态资源路径</p>
</li>
<li><p>但是不可以配置静态资源的访问前缀。否则导致 index.html不能被默认访问</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="comment"># 修改静态资源默认访问前缀</span></span><br><span class="line"><span class="comment">#  mvc:</span></span><br><span class="line"><span class="comment">#    static-path-pattern: /res/**</span></span><br><span class="line"><span class="comment"># 修改静态资源默认路径</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">   <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">static-locations:</span> [<span class="string">classpath:/test/</span>]</span><br><span class="line">   <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">add-mappings:</span> <span class="literal">false</span>   <span class="comment">#禁用所有静态资源规则</span></span><br></pre></td></tr></table></figure>

<h5 id="自定义-Favicon网页头像"><a href="#自定义-Favicon网页头像" class="headerlink" title="自定义 Favicon网页头像"></a>自定义 Favicon网页头像</h5><p>将favicon.ico 放在静态资源目录下即可。</p>
<h5 id="静态资源配置绑定原理"><a href="#静态资源配置绑定原理" class="headerlink" title="静态资源配置绑定原理"></a>静态资源配置绑定原理</h5><ul>
<li>SpringBoot启动默认加载  xxxAutoConfiguration 类（自动配置类）</li>
<li>SpringMVC功能的自动配置类 WebMvcAutoConfiguration，生效</li>
</ul>
<p>给Servlet容器中注册了那些组件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, WebProperties.class &#125;)</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件的相关属性和xxx进行了绑定。WebMvcProperties与spring.mvc、ResourceProperties与spring.web进行绑定</li>
</ul>
<p>配置类只有一个有参构造器(实际上是在参数位置使用了@Autowired注解，但配置类中只有一个构造器，所有被省略了)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个方法的参数都会从容器中获取</span></span><br><span class="line"><span class="comment">//WebProperties webProperties：获取了spring.mvc绑定的所有的值的对象</span></span><br><span class="line"><span class="comment">//WebMvcProperties mvcProperties：获取了spring.web绑定的所有的值的对象</span></span><br><span class="line"><span class="comment">//ListableBeanFactory beanFactory Spring的beanFactory</span></span><br><span class="line"><span class="comment">//messageConvertersProvider 找到所有的HttpMessageConverters</span></span><br><span class="line"><span class="comment">//resourceHandlerRegistrationCustomizerProvider 找到资源处理器的自定义器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//servletRegistrations  给应用注册Servlet、Filter</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WebMvcAutoConfigurationAdapter</span><span class="params">(WebProperties webProperties, WebMvcProperties mvcProperties,</span></span><br><span class="line"><span class="params">ListableBeanFactory beanFactory, ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span><br><span class="line"><span class="params">ObjectProvider&lt;ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span></span><br><span class="line"><span class="params">ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span><br><span class="line"><span class="params">ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.resourceProperties = webProperties.getResources();</span><br><span class="line">			<span class="built_in">this</span>.mvcProperties = mvcProperties;</span><br><span class="line">			<span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">			<span class="built_in">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line">			<span class="built_in">this</span>.resourceHandlerRegistrationCustomizer = 		     resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line">			<span class="built_in">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line">			<span class="built_in">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line">			<span class="built_in">this</span>.mvcProperties.checkConfiguration();</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h5 id="资源处理的默认规则"><a href="#资源处理的默认规则" class="headerlink" title="资源处理的默认规则"></a>资源处理的默认规则</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">		logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//处理webjars的规则</span></span><br><span class="line">    <span class="comment">//所有/webjars/**的请求，都去 classpath:/META-INF/resources/webjars/找资源；    </span></span><br><span class="line">	addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">	<span class="comment">//处理静态资源的规则</span></span><br><span class="line"> <span class="comment">//在没有更改静态资源路径的情况下所有/**的请求，都会去以下默认路径找资源，统称为静态资源文件夹（其中&quot;/&quot;表示项目根目录）：   </span></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">	registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">	<span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">	registration.addResourceLocations(resource);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="欢迎页的处理规则"><a href="#欢迎页的处理规则" class="headerlink" title="欢迎页的处理规则"></a>欢迎页的处理规则</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext,</span></span><br><span class="line"><span class="params">ormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> &#123;</span><br><span class="line"><span class="comment">//处理规则设置的方法    </span></span><br><span class="line"><span class="type">WelcomePageHandlerMapping</span> <span class="variable">welcomePageHandlerMapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">TemplateAvailabilityProviders</span>(applicationContext), applicationContext, getWelcomePage(),</span><br><span class="line">					<span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">			welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">			welcomePageHandlerMapping.setCorsConfigurations(getCorsConfigurations());</span><br><span class="line">			<span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders,</span><br><span class="line">ApplicationContext applicationContext, Optional&lt;Resource&gt; welcomePage, String staticPathPattern) &#123;</span><br><span class="line">	<span class="keyword">if</span> (welcomePage.isPresent() &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">        <span class="comment">//要用欢迎页功能，必须是/**</span></span><br><span class="line">		logger.info(<span class="string">&quot;Adding welcome page: &quot;</span> + welcomePage.get());</span><br><span class="line">		setRootViewName(<span class="string">&quot;forward:index.html&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;</span><br><span class="line">      	<span class="comment">//调用Controller  /index</span></span><br><span class="line">		logger.info(<span class="string">&quot;Adding welcome page template: index&quot;</span>);</span><br><span class="line">		setRootViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h4><p><strong>请求映射@xxxMapping：指将请求与控制器方法进行绑定</strong></p>
<p><font color='red'><strong>需要一个核心过滤器：HiddenHttpMethodFilter</strong></font>(在SpringBoot中自动装配了，在SpringMVC中需要在web.xml文件手动进行配置)</p>
<ul>
<li>即使在SpringBoot自动装配了，但需要使用HiddenHttpMethodFilter还需要<font color='red'><strong>在application.yaml文件中进行开启</strong></font></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#开启页面表单的rest风格(可选择性开启)</span></span><br></pre></td></tr></table></figure>

<p>在SpringBoot中的用法和之前一致：</p>
<p>1.表单提交方式必须是<font color='red'><strong>post 方式</strong></font></p>
<p>2.表单须携带一个 <font color='red'>**name&#x3D;”_method“，value&#x3D;”当前想要提交的请求方式“ **</font>的隐藏域</p>
<p>表单使用Rest风格的原理(与SpringMVC底层的执行是一致的)：</p>
<p>①<font color='red'><strong>所有请求都会被这个HiddenHttpMethodFilter所拦截</strong></font></p>
<p>②获取原生的request请求，判断是否为POST提交方法</p>
<p>③获取表单中的_method隐藏域属性的值，将其转换为大写</p>
<p>④判断转换后的请求方式是否在过滤器的放行名单中</p>
<p>⑤存在于名单中，使用包装模式将原生的request进行包装返回，在这个过程中重写了getMethod方法</p>
<p>⑥在过滤器链的放行方法中放行的是被包装后的request</p>
<ul>
<li>表单中携带的name&#x3D;”_method“可以通过手动@Bean导入HiddenHttpMethodFilter调用方法修改</li>
</ul>
<h5 id="请求映射原理"><a href="#请求映射原理" class="headerlink" title="请求映射原理"></a>请求映射原理</h5><p><img src="https://s1.ax1x.com/2022/05/23/X9dHQx.png" alt="原理图示"></p>
<ul>
<li><p>mappedHandler &#x3D; getHandler(processedRequest);</p>
<p>在这个方法中会获取所有的HandlerMapping，逐个寻找每个HandlerMapping的映射规则，</p>
<p>哪个能处理就将对应的HandlerMapping返回</p>
</li>
<li><p>RequestMappingHandlerMapping：保存了所有@RequestMapping和handler的映射规则</p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/23/X9djTe.png"></p>
<ul>
<li><p>所有的请求映射规则都保存在了HandlerMapping中</p>
<ul>
<li>SpringBoot自动配置欢迎页的WelcomePageHandlerMapping，因此访问&#x2F;就能访问到首页index.html</li>
</ul>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wClt.png"></p>
<h5 id="SpringBoot获取请求参数"><a href="#SpringBoot获取请求参数" class="headerlink" title="SpringBoot获取请求参数"></a>SpringBoot获取请求参数</h5><p>注解获取：@PathVariable、@RequestHeader、@RequestParam、@CookieValue、@RequestBody</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/car/&#123;id&#125;/owner/&#123;userName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">map</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@PathVariable(&quot;userName&quot;)</span> String userName,</span></span><br><span class="line"><span class="params">                         <span class="meta">@PathVariable</span> Map&lt;String, String&gt; pv,//自动将请求地址中的路径变量封装到这个Map中</span></span><br><span class="line"><span class="params">                                  <span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestHeader</span> Map&lt;String, String&gt; header,//自动将请求行信息封装到这个Map中</span></span><br><span class="line"><span class="params">                                  <span class="meta">@RequestParam(&quot;age&quot;)</span> Integer age,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@RequestParam(&quot;inters&quot;)</span> List&lt;String&gt; inters,</span></span><br><span class="line"><span class="params">                       <span class="meta">@RequestParam</span> Map&lt;String,String&gt; params,//自动将请求地址中的请求参数封装到这个Map中</span></span><br><span class="line"><span class="params">                                  <span class="meta">@CookieValue(&quot;Idea-43f7d2cf&quot;)</span> String cookie)</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>,userName);</span><br><span class="line">        map.put(<span class="string">&quot;pv&quot;</span>,pv);</span><br><span class="line">        map.put(<span class="string">&quot;userAgent&quot;</span>,userAgent);</span><br><span class="line">        map.put(<span class="string">&quot;header&quot;</span>,header);</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,age);</span><br><span class="line">        map.put(<span class="string">&quot;inters&quot;</span>,inters);</span><br><span class="line">        map.put(<span class="string">&quot;params&quot;</span>,params);</span><br><span class="line">        map.put(<span class="string">&quot;cookie&quot;</span>,cookie);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequestBody将请求体内容赋给requestBody</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">map</span><span class="params">(<span class="meta">@RequestBody</span> String requestBody)</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;requestBody&quot;</span>,requestBody);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color='red'><strong>@RequestAttribute：从request请求域中获取数据</strong></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在gotoOtherPage控制器方法中保存的请求域属性通过请求转发的方式在sout控制器方法中获取</span></span><br><span class="line"><span class="comment">//此处只是演示</span></span><br><span class="line"><span class="comment">//大部分都是返回到前端页面，通过EL表达式等方式直接获取使用</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/goto&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">gotoOtherPage</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/success&quot;)</span></span><br><span class="line">    <span class="comment">//@RequestAttribute将请求域中test属性的值赋予形参success</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sout</span><span class="params">(<span class="meta">@RequestAttribute(&quot;test&quot;)</span> String success)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@MatrixVariable：矩阵变量(可以用于解决cookie被禁用的问题)</p>
<ul>
<li>矩阵变量使用要求<ul>
<li>矩阵变量需要在SpringBoot中手动开启</li>
<li>根据RFC3986的规范，矩阵变量应当绑定在路径变量中</li>
<li>若是有多个矩阵变量，应当使用英文符号;进行分隔。</li>
<li>若是一个矩阵变量有多个值，应当使用英文符号,进行分隔，或者命名多个重复的key</li>
<li>&#x2F;test&#x2F;customer;age&#x3D;20;gender&#x3D;boy”  矩阵变量示例</li>
</ul>
</li>
</ul>
<p><font color='red'><strong>url重写就是指把cookie的值使用矩阵变量的方式进行传递 ：&#x2F;test;jsesssionid&#x3D;xxxx</strong></font></p>
<p>对于请求路径的处理都是使用UrlPathHelper这个类进行解析，</p>
<p>removeSemicolonContent(移除请求路径;后的内容)用于支持矩阵变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> * <span class="meta">@description</span>: 修改springboot的自动配置机制，实现对矩阵变量的支持</span><br><span class="line"> * <span class="meta">@date</span> <span class="number">2022</span>/<span class="number">5</span>/<span class="number">13</span> <span class="number">0</span>:<span class="number">00</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方式一：</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">                <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">                <span class="comment">//设置为不移除分号后面的内容；因此矩阵变量才可以生效</span></span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方式二：</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public void configurePathMatch(PathMatchConfigurer configurer) &#123;</span></span><br><span class="line"><span class="comment">//        UrlPathHelper urlPathHelper = new UrlPathHelper();</span></span><br><span class="line"><span class="comment">//        //设置为不移除分号后面的内容；因此矩阵变量才可以生效</span></span><br><span class="line"><span class="comment">//        urlPathHelper.setRemoveSemicolonContent(false);</span></span><br><span class="line"><span class="comment">//        configurer.setUrlPathHelper(urlPathHelper);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  /test/customer;age=20;inters=book;inters=play</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/&#123;customer&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">testMatrixVariable</span><span class="params">(<span class="meta">@MatrixVariable(&quot;age&quot;)</span> Integer age,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@MatrixVariable(&quot;inters&quot;)</span> List&lt;String&gt; inters,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@PathVariable(&quot;customer&quot;)</span> String path)</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,age);</span><br><span class="line">        map.put(<span class="string">&quot;inters&quot;</span>,inters);</span><br><span class="line">        map.put(<span class="string">&quot;path&quot;</span>,path);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// /boss/1;age=20/2;age=10&quot;</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">test</span><span class="params">(<span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;bossId&quot;)</span>Integer boosAge,</span></span><br><span class="line"><span class="params">                    <span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;empId&quot;)</span>Integer empAge)</span>&#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;boss&quot;</span>,boosAge);</span><br><span class="line">        map.put(<span class="string">&quot;emp&quot;</span>,empAge);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="请求参数处理原理"><a href="#请求参数处理原理" class="headerlink" title="请求参数处理原理"></a>请求参数处理原理</h5><p>①获取对应的处理器适配器以执行控制器方法HandlerAdapter ha &#x3D; getHandlerAdapter(mappedHandler.getHandler())</p>
<ul>
<li>获取所有的处理器适配器，循环判断哪个处理器适配器能支持当前的方法并返回 此处是(RequestMapping)</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wiOf.png" alt="执行不同方法的适配器"></p>
<p>0 - 支持方法上标注@RequestMapping的处理器适配器</p>
<p>1 - 支持函数式编程的处理器适配器</p>
<p>…</p>
<p>②根据获得的处理器适配器对象调用目标方法并为目标方法设置参数解析器和返回值解析器</p>
<p><font color='red'><strong>参数解析器和返回值解析器的信息都封装在同一个对象ServletInvocableHandlerMethod invocableMethod中</strong> </font></p>
<ul>
<li>参数解析器(确定每一个参数的值是什么)：判断当前解析器是否支持解析这种参数，支持则调用解析方法</li>
<li>返回值处理器(确定能返回什么类型的结果)：判断当前处理器是否支持返回这种类型参数并调用返回处理方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标方法对参数的各种处理</span></span><br><span class="line">mav = invokeHandlerMethod(request, response, handlerMethod)&#123;</span><br><span class="line"> </span><br><span class="line"><span class="type">ServletInvocableHandlerMethod</span> <span class="variable">invocableMethod</span> <span class="operator">=</span> createInvocableHandlerMethod(handlerMethod);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">//为当前正在执行的目标方法设置参数解析器</span></span><br><span class="line">	invocableMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">//为当前正在执行的目标方法设置返回值处理器</span></span><br><span class="line">	invocableMethod.setHandlerMethodReturnValueHandlers(<span class="built_in">this</span>.returnValueHandlers);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//进一步调用</span></span><br><span class="line">invocableMethod.invokeAndHandle(webRequest, mavContainer)&#123;</span><br><span class="line">    <span class="comment">//真正执行目标方法</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs)&#123;</span><br><span class="line">        <span class="comment">//获取方法的参数值</span></span><br><span class="line">        Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs);</span><br><span class="line">            </span><br><span class="line"><span class="comment">//getMethodArgumentValues方法内部的执行过程</span></span><br><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,Object... providedArgs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">		MethodParameter[] parameters = getMethodParameters();</span><br><span class="line">		<span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123;</span><br><span class="line">			<span class="keyword">return</span> EMPTY_ARGS;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">			<span class="type">MethodParameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">			parameter.initParameterNameDiscovery(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">			args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">		<span class="keyword">if</span> (args[i] != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">		<span class="comment">// Leave stack trace for later, exception may actually be resolved and handled...</span></span><br><span class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">			<span class="type">String</span> <span class="variable">exMsg</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">			<span class="keyword">if</span> (exMsg != <span class="literal">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">				logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">throw</span> ex;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> args;</span><br><span class="line">	&#125;            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③确定目标方法的解析器(挨个判断所有参数解析器哪个支持解析当前这个参数)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HandlerMethodArgumentResolver <span class="title function_">getArgumentResolver</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">		<span class="type">HandlerMethodArgumentResolver</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.argumentResolverCache.get(parameter);</span><br><span class="line">		<span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (HandlerMethodArgumentResolver resolver : <span class="built_in">this</span>.argumentResolvers) &#123;</span><br><span class="line">				<span class="keyword">if</span> (resolver.supportsParameter(parameter)) &#123;</span><br><span class="line">					result = resolver;</span><br><span class="line">					<span class="built_in">this</span>.argumentResolverCache.put(parameter, result);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>④解析这个参数的值</p>
<p>调用各自 HandlerMethodArgumentResolver 的 resolveArgument 方法</p>
<p>⑤当目标方法执行完成后会将数据放在ModelAndViewContainer容器中(包含要显示的页面地址view和Model数据)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest)&#123;</span><br><span class="line">    <span class="comment">//遍历循环拿到model里面每一个值</span></span><br><span class="line">    modelFactory.updateModel(webRequest, mavContainer);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//从mavContainer中获取model并进行封装</span></span><br><span class="line">    <span class="type">ModelMap</span> <span class="variable">model</span> <span class="operator">=</span> mavContainer.getModel();</span><br><span class="line">	<span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(mavContainer.getViewName(), model, mavContainer.getStatus());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//封装后经过一些处理并返回封装后的mav对象</span></span><br><span class="line">    <span class="keyword">return</span> mav</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>⑥处理目标方法执行后返回的结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理方法执行后返回的结果</span></span><br><span class="line">processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line"></span><br><span class="line"><span class="comment">//在渲染的这个方法中将model和map的数据放在请求域中</span></span><br><span class="line">renderMergedOutputModel(mergedModel, getRequestToExpose(request), response)&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//暴露模型作为请求域的属性</span></span><br><span class="line">exposeModelAsRequestAttributes(model, request)&#123;</span><br><span class="line">    <span class="comment">//通过增强for循环将已封装后的mergedModel中的数据逐个添加到请求域中</span></span><br><span class="line">    model.forEach((name, value) -&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">				request.setAttribute(name, value);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				request.removeAttribute(name);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Servlet-API"><a href="#Servlet-API" class="headerlink" title="Servlet API"></a>Servlet API</h5><p>ServletRequestMethodArgumentResolver参数解析器可以解析的的方法参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">		Class&lt;?&gt; paramType = parameter.getParameterType();</span><br><span class="line">		<span class="keyword">return</span> (WebRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">				ServletRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">				MultipartRequest.class.isAssignableFrom(paramType) ||</span><br><span class="line">				HttpSession.class.isAssignableFrom(paramType) ||</span><br><span class="line">				(pushBuilder != <span class="literal">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType)) ||</span><br><span class="line">				Principal.class.isAssignableFrom(paramType) ||</span><br><span class="line">				InputStream.class.isAssignableFrom(paramType) ||</span><br><span class="line">				Reader.class.isAssignableFrom(paramType) ||</span><br><span class="line">				HttpMethod.class == paramType ||</span><br><span class="line">				Locale.class == paramType ||</span><br><span class="line">				TimeZone.class == paramType ||</span><br><span class="line">				ZoneId.class == paramType);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h5 id="复杂参数"><a href="#复杂参数" class="headerlink" title="复杂参数"></a>复杂参数</h5><p>Map<strong>、</strong>Model（<font color='red'><strong>map、model里面的数据会被共享到域对象中 相当于request.setAttribute</strong></font>）</p>
<p><font color='red'><strong>在一个方法中同时使用Map、Model返回的BingdingAwareModelMap对象是同一个</strong></font></p>
<ul>
<li><p>这两个类型的参数在各自底层的解析器中都会调用mavContainer.getModel()方法返回一个BingdingAwareModelMap对象</p>
<p>而Model、ModelMap、Map类型的参数本质上都是 BindingAwareModelMap 类的对象实例，具体查看SpringMVC相关信息继承树</p>
</li>
</ul>
<p><strong>RedirectAttributes（ 重定向携带数据）</strong>、<strong>ServletResponse（response）</strong></p>
<h5 id="自定义类型参数-封装Bean"><a href="#自定义类型参数-封装Bean" class="headerlink" title="自定义类型参数 封装Bean"></a>自定义类型参数 封装Bean</h5><p>WebDataBinder binder &#x3D; binderFactory.createBinder(webRequest, attribute, name);</p>
<p>WebDataBinder :web数据绑定器，将请求参数的值绑定到指定的JavaBean里面</p>
<p>WebDataBinder 利用它里面的 Converters 将请求数据转成指定的数据类型。再次封装到JavaBean中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在SpringMVC的配置中加入自定义类型转换	</span></span><br><span class="line">	   <span class="meta">@Override</span></span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">          registry.addConverter(<span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String,Pet&gt;() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Pet <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">             <span class="keyword">if</span> (StringUtils.hasText(source))&#123;</span><br><span class="line">                  <span class="type">Pet</span> <span class="variable">pet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Pet</span>();</span><br><span class="line">                  String[] split = source.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                  pet.setName(split[<span class="number">0</span>]);</span><br><span class="line">                  pet.setAge(Integer.parseInt(split[<span class="number">1</span>]));</span><br><span class="line">                  <span class="keyword">return</span> pet;</span><br><span class="line">             &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">           </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">if</span> (bindingResult == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="comment">// Bean property binding and validation;</span></span><br><span class="line">			<span class="comment">// skipped in case of binding failure on construction.</span></span><br><span class="line">			<span class="type">WebDataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> binderFactory.createBinder(webRequest, attribute, name);</span><br><span class="line">			<span class="keyword">if</span> (binder.getTarget() != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (!mavContainer.isBindingDisabled(name)) &#123;</span><br><span class="line">                    <span class="comment">//重点部分 转换过程在这个方法内</span></span><br><span class="line">					bindRequestParameters(binder, webRequest);</span><br><span class="line">				&#125;</span><br><span class="line">				validateIfApplicable(binder, parameter);</span><br><span class="line">				<span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BindException</span>(binder.getBindingResult());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// Value type adaptation, also covering java.util.Optional</span></span><br><span class="line">			<span class="keyword">if</span> (!parameter.getParameterType().isInstance(attribute)) &#123;</span><br><span class="line">				attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);</span><br><span class="line">			&#125;</span><br><span class="line">			bindingResult = binder.getBindingResult();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;           </span><br></pre></td></tr></table></figure>

<h4 id="响应数据"><a href="#响应数据" class="headerlink" title="响应数据"></a>响应数据</h4><p>1.jackson.jar(已由SpringBoot的web场景自动引入spring-boot-starter-json场景)+@ResponseBody(在方法上标注此注解)</p>
<p>2.利用返回值处理器(处理流程与参数解析器一致)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理流程</span></span><br><span class="line"><span class="comment">//获取所有的返回值处理器，挨个遍历每个返回值处理器，并找到能够处理当前参数的返回值处理器并返回此处理器</span></span><br><span class="line"><span class="comment">//获取当前的返回值的返回值处理器，不为空则调用对应的处理返回值的方法</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.returnValueHandlers.handleReturnValue(returnValue, getReturnValueType(returnValue), mavContainer, webRequest)&#123;</span><br><span class="line"><span class="comment">//handleReturnValue方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">	ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//获取当前返回值的返回值处理器    </span></span><br><span class="line">	<span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> selectHandler(returnValue, returnType);</span><br><span class="line">	<span class="comment">//不为空则调用返回值处理器的处理返回值方法</span></span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unknown return value type: &quot;</span> +returnType.getParameterType().getName());&#125;</span><br><span class="line"><span class="comment">//else</span></span><br><span class="line">handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest)&#123;</span><br><span class="line"><span class="comment">//使用消息转换器进行写出操作，即将返回值显示到前端页面上</span></span><br><span class="line">writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);   </span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>①返回值处理器判断是否支持这种类型返回值 supportReturnType</p>
<p>②返回值处理器调用handleReturnValue()方法进行处理</p>
<ul>
<li>RequestResponseBodyMethodProcessor可以处理方法标注了@ResponseBody 注解的</li>
</ul>
<p>③使用MessageConverters进行写出处理，即将返回值显示到前端页面上，将数据转为json</p>
<p><font color='red'><strong>Ⅰ.内容协商(指浏览器通过请求头告知服务器，浏览器可以接受的内容类型)</strong></font></p>
<p><font color='red'><strong>Ⅱ.服务器最终根据自身的能力，决定产生什么的内容类型</strong></font></p>
<p><font color='red'><strong>Ⅲ.SpringMVC会逐个遍历容器中所有的HttpMessageConverter，找到能够处理的消息转换器</strong></font></p>
<ul>
<li>MappingJackson2HttpMessageConverter可以将对象转为json写出</li>
</ul>
<p>返回值处理器支持处理的返回值类型</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ModelAndView</span><br><span class="line">Model</span><br><span class="line">View</span><br><span class="line">ResponseEntity </span><br><span class="line">ResponseBodyEmitter</span><br><span class="line">StreamingResponseBody</span><br><span class="line">HttpEntity</span><br><span class="line">HttpHeaders</span><br><span class="line">Callable</span><br><span class="line">DeferredResult</span><br><span class="line">ListenableFuture</span><br><span class="line">CompletionStage</span><br><span class="line">WebAsyncTask</span><br><span class="line">有 @ModelAttribute 且为对象类型的</span><br><span class="line">@ResponseBody 注解 ---&gt; RequestResponseBodyMethodProcessor；</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2022/05/23/X9wZkQ.png" alt="返回值处理器"></p>
<h5 id="HTTPMessageConverter原理"><a href="#HTTPMessageConverter原理" class="headerlink" title="HTTPMessageConverter原理"></a>HTTPMessageConverter原理</h5><p>①HttpMessageConverter规范：看是否支持将此Class类型的对象转换为MediaType类型的数据</p>
<p>e.g. 将Person对象转为Json字符串(此过程可逆)</p>
<ul>
<li>当判断某个canWrite为true，则调用write方法将其写出(canRead同理)</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/23/X9weYj.png" alt="报文信息转唤器"></p>
<p>②系统默认的MessageConverter</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wupn.png"></p>
<p>0 - 只支持返回值是byte类型的</p>
<p>1 - 只支持返回值是String类型的</p>
<p>…</p>
<p>7 - 直接返回true</p>
<p>8 - 直接返回true</p>
<p>下面的2-9以此类推…</p>
<p>最终：使用MappingJackson2HttpMessageConverter将对象转为json，利用底层的jackson的objectMapper</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wQXV.png" alt="转为json格式写出"></p>
<h4 id="内容协商"><a href="#内容协商" class="headerlink" title="内容协商"></a>内容协商</h4><p>根据客户端的接受能力的不同，返回不同媒体类型的数据</p>
<p>1.引入xml依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.根据情况修改请求头的accept字段，此字段可以告知服务器，浏览器可以接受的内容类型是什么</p>
<h5 id="内容协商原理"><a href="#内容协商原理" class="headerlink" title="内容协商原理"></a>内容协商原理</h5><p>①判断当前响应头中是否已有确定的响应类型</p>
<p>②获取客户端(postman、浏览器)支持接收的内容类型，可以理解为获取客户端请求头accept字段</p>
<p>contentNegotiationManager：内容协商管理器(默认使用基于请求头的策略)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取每一个内容协商策略</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;MediaType&gt; <span class="title function_">resolveMediaTypes</span><span class="params">(NativeWebRequest request)</span> <span class="keyword">throws</span> HttpMediaTypeNotAcceptableException &#123;</span><br><span class="line">		<span class="keyword">for</span> (ContentNegotiationStrategy strategy : <span class="built_in">this</span>.strategies) &#123;</span><br><span class="line">			List&lt;MediaType&gt; mediaTypes = strategy.resolveMediaTypes(request);</span><br><span class="line">            <span class="comment">//获取到的媒体类型是*/* 跳过此次循环</span></span><br><span class="line">			<span class="keyword">if</span> (mediaTypes.equals(MEDIA_TYPE_ALL_LIST)) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="comment">//当从某一个内容协商策略中获得媒体类型后就直接返回，除非获取到的媒体类型是*/*</span></span><br><span class="line">			<span class="keyword">return</span> mediaTypes;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> MEDIA_TYPE_ALL_LIST;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>HeaderContentNegotiationStrategy 负责解析Http Request Header中的Accept</li>
</ul>
<p>③获取服务器能够产生的内容类型，遍历循环当前容器中的所有HttpMessageConverter，找到支持操作当前</p>
<p>​	转换对象的报文信息转唤器(converter) ，把这些converter支持的媒体类型进行统计,放进集合中</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wYtJ.png"></p>
<p>④得知客户端需要application&#x2F;xml 的内容类型，服务端可以产生10种(json、xml)内容类型</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wth9.png" alt="服务器能产生的内容类型"></p>
<p>⑤找到内容协商的最佳匹配的内容类型</p>
<p>⑥用 支持 将对象 转换为最佳匹配的内容类型converter，调用它进行转换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内容协商的核心方法</span></span><br><span class="line">writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage)&#123;</span><br><span class="line">    <span class="comment">//首先会获取返回值，再根据返回值进行判断，此处省略</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//内容协商的关键环节</span></span><br><span class="line">    <span class="comment">//1.判断当前响应头中是否已有确定的响应类型</span></span><br><span class="line">    <span class="type">MediaType</span> <span class="variable">contentType</span> <span class="operator">=</span> outputMessage.getHeaders().getContentType();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2.获取客户端(postman、浏览器)支持接收的内容类型，可以理解为获取客户端请求头actept字段</span></span><br><span class="line">    acceptableTypes = getAcceptableMediaTypes(request);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3.获取服务器能够产生的内容类型</span></span><br><span class="line">List&lt;MediaType&gt; producibleTypes = getProducibleMediaTypes(request, valueType, targetType)&#123;</span><br><span class="line">        List&lt;MediaType&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	<span class="keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="built_in">this</span>.messageConverters) &#123;</span><br><span class="line">		<span class="keyword">if</span> (converter <span class="keyword">instanceof</span> GenericHttpMessageConverter &amp;&amp; targetType != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (((GenericHttpMessageConverter&lt;?&gt;) converter).canWrite(targetType, valueClass, <span class="literal">null</span>)) &#123;</span><br><span class="line">            	<span class="comment">//把所有支持操作当前bean的转换器支持的媒体类型进行逐个统计并放到result集合中</span></span><br><span class="line">				result.addAll(converter.getSupportedMediaTypes(valueClass));</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line">      <span class="comment">//通过两层for循环逐个匹配客户端能够接受的内容类型与服务器产生的内容类型进行匹配</span></span><br><span class="line">      <span class="comment">//mediaTypesToUse集合中的值是最终需要使用的内容类型</span></span><br><span class="line">      List&lt;MediaType&gt; mediaTypesToUse = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">			<span class="keyword">for</span> (MediaType requestedType : acceptableTypes) &#123;</span><br><span class="line">				<span class="keyword">for</span> (MediaType producibleType : producibleTypes) &#123;</span><br><span class="line">					<span class="keyword">if</span> (requestedType.isCompatibleWith(producibleType)) &#123;</span><br><span class="line">						mediaTypesToUse.add(getMostSpecificMediaType(requestedType, producibleType));</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; </span><br><span class="line">      </span><br><span class="line">     <span class="comment">//对mediaTypesToUse集合进行排序</span></span><br><span class="line">     MediaType.sortBySpecificityAndQuality(mediaTypesToUse);  </span><br><span class="line">     </span><br><span class="line">     <span class="comment">//对要使用的内容类型按照请求头的accept权重的优先匹配原则，进行最终选择，且内容类型只能有一个   </span></span><br><span class="line">     <span class="keyword">for</span> (MediaType mediaType : mediaTypesToUse) &#123;</span><br><span class="line">				<span class="keyword">if</span> (mediaType.isConcrete()) &#123;</span><br><span class="line">					selectedMediaType = mediaType;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断选择的内容类型不为空    </span></span><br><span class="line">    <span class="keyword">if</span> (selectedMediaType != <span class="literal">null</span>) &#123;</span><br><span class="line">	selectedMediaType = selectedMediaType.removeQualityValue();</span><br><span class="line"><span class="comment">//再次对所有的HttpMessageConverter进行遍历，找到能够将当前的bean对象转换为要返回的类型内容HttpMessageConverter   </span></span><br><span class="line">	<span class="keyword">for</span> (HttpMessageConverter&lt;?&gt; converter : <span class="built_in">this</span>.messageConverters) &#123;</span><br><span class="line">	<span class="type">GenericHttpMessageConverter</span> <span class="variable">genericConverter</span> <span class="operator">=</span> (converter <span class="keyword">instanceof</span> GenericHttpMessageConverter ?</span><br><span class="line">		GenericHttpMessageConverter&lt;?&gt;) converter : <span class="literal">null</span>);</span><br><span class="line">	<span class="keyword">if</span> (genericConverter != <span class="literal">null</span> ?</span><br><span class="line">	((GenericHttpMessageConverter) converter).canWrite(targetType, valueType, selectedMediaType) :</span><br><span class="line">						converter.canWrite(valueType, selectedMediaType)) &#123;</span><br><span class="line">        <span class="comment">//body的值是要转换的对象的内容</span></span><br><span class="line">			body = getAdvice().beforeBodyWrite(body, returnType, selectedMediaType,</span><br><span class="line">						(Class&lt;? <span class="keyword">extends</span> <span class="title class_">HttpMessageConverter</span>&lt;?&gt;&gt;) converter.getClass(),</span><br><span class="line">						inputMessage, outputMessage);</span><br><span class="line">				<span class="keyword">if</span> (body != <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="type">Object</span> <span class="variable">theBody</span> <span class="operator">=</span> body;</span><br><span class="line">					LogFormatUtils.traceDebug(logger, traceOn -&gt;</span><br><span class="line">						<span class="string">&quot;Writing [&quot;</span> + LogFormatUtils.formatValue(theBody, !traceOn) + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">					addContentDispositionHeader(inputMessage, outputMessage);</span><br><span class="line">					<span class="keyword">if</span> (genericConverter != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//最终调用write方法将转换后的bean对象写出到页面 </span></span><br><span class="line">				genericConverter.write(body, targetType, selectedMediaType, outputMessage);</span><br><span class="line">						&#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="开启浏览器参数内容协商功能"><a href="#开启浏览器参数内容协商功能" class="headerlink" title="开启浏览器参数内容协商功能"></a>开启浏览器参数内容协商功能</h5><p>只需要在application.yml文件中设置为true开启即可,默认设置为false</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">contentnegotiation:</span></span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span> <span class="comment">#开启请求参数内容协商模式 </span></span><br></pre></td></tr></table></figure>

<p>开启之后会在内容协商管理器中添加一个ParameterContentNegotiationStrategy 的内容解析策略，</p>
<p>这个策略支持解析xml和json的内容类型</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wa11.png"></p>
<p>导入了jackson处理xml的包，xml的converter就会自动加载进来</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">WebMvcConfigurationSupport</span></span><br><span class="line"><span class="variable">jackson2XmlPresent</span> <span class="operator">=</span> ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.xml.XmlMapper&quot;</span>, classLoader);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (jackson2XmlPresent) &#123;</span><br><span class="line">			<span class="type">Jackson2ObjectMapperBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> Jackson2ObjectMapperBuilder.xml();</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">this</span>.applicationContext != <span class="literal">null</span>) &#123;</span><br><span class="line">				builder.applicationContext(<span class="built_in">this</span>.applicationContext);</span><br><span class="line">			&#125;</span><br><span class="line">			messageConverters.add(<span class="keyword">new</span> <span class="title class_">MappingJackson2XmlHttpMessageConverter</span>(builder.build()));</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h5 id="自定义MessageConverter"><a href="#自定义MessageConverter" class="headerlink" title="自定义MessageConverter"></a>自定义MessageConverter</h5><p>1.处理流程：</p>
<p>①@ResponseBody 响应数据出去 调用 <strong>RequestResponseBodyMethodProcessor</strong> 处理</p>
<p>②Processor 处理方法返回值。通过 <strong>MessageConverter</strong> 处理</p>
<p>③所有 <strong>MessageConverter</strong> 合起来可以支持各种媒体类型数据的操作（读、写）</p>
<p>④内容协商找到最终的 <strong>messageConverter</strong>；</p>
<p>2.自定义配置内容协商管理器的内容协商策略以满足浏览器请求参数携带format访问回显指定的内容类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加自定义的消息转换器</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    converters.add(<span class="keyword">new</span> <span class="title class_">TestMessageConverter</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义配置内容协商管理器的内容协商策略</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> &#123;</span><br><span class="line"><span class="comment">//基于请求参数的内容协商策略</span></span><br><span class="line">  HashMap&lt;String, MediaType&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//指定支持解析哪些参数对应的哪些媒体类型</span></span><br><span class="line">   map.put(<span class="string">&quot;json&quot;</span>,MediaType.APPLICATION_JSON);</span><br><span class="line">   map.put(<span class="string">&quot;xml&quot;</span>,MediaType.APPLICATION_ATOM_XML);</span><br><span class="line">   map.put(<span class="string">&quot;test&quot;</span>,MediaType.parseMediaType(<span class="string">&quot;application/tt&quot;</span>));</span><br><span class="line"><span class="type">ParameterContentNegotiationStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParameterContentNegotiationStrategy</span>(map);</span><br><span class="line"></span><br><span class="line"><span class="comment">//基于请求头的内容协商策略</span></span><br><span class="line"><span class="type">HeaderContentNegotiationStrategy</span> <span class="variable">headerStrategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeaderContentNegotiationStrategy</span>();</span><br><span class="line"><span class="comment">//将这两个全部加入到内容协商管理器中</span></span><br><span class="line">configurer.strategies(Arrays.asList(strategy,headerStrategy));</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://s1.ax1x.com/2022/05/23/X9wwX6.png" alt="自定义配置内容协商管理器的内容协商策略"></p>
<h4 id="视图解析"><a href="#视图解析" class="headerlink" title="视图解析"></a>视图解析</h4><p>1.视图解析原理</p>
<p>①目标方法处理的过程，所有的数据都会被放在ModelAndViewContainer中，包括数据和视图地址</p>
<p>②方法的参数是一个自定义类型对象(从请求参数中确定的)，都会把它放在ModelAndViewContainer中</p>
<p>③任何目标方法在执行完成之后都会返回一个ModelAndView对象</p>
<p>④processDispatchResult(); 处理方法返回的结果</p>
<p>​	Ⅰ.render(mv, request, response); 进行页面渲染</p>
<ul>
<li><p>根据方法返回值得到视图View对象(定义了页面的渲染的逻辑)</p>
<ul>
<li><p>所有的视图解析器尝试是否能根据当前返回值得到View对象</p>
</li>
<li><p>根据redirect:&#x2F;index.html返回值得到了一个由Thymeleaf创建的 RedirectView对象</p>
<p>注意：ContentNegotiationViewResolver 里面包含了下面1-4的视图解析器，其内部还是通过遍历1-4解析器，</p>
<p>判断哪个能解析从而得到视图对象</p>
</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wBnK.png"></p>
<p>⑤通过得到的视图对象View调用其对应的渲染方法 view.render(mv.getModelInternal(), request, response);</p>
<ul>
<li><p>视图对象RedirectView的渲染过程</p>
<p>①获取目标的url了</p>
<p>②使用原生的重定向方法 response.sendRedirect(encodedURL)</p>
</li>
</ul>
</li>
</ul>
<p>2.视图解析的不同情况：</p>
<ul>
<li>返回值以forward开始：会 new InternalResourceView(forwardUrl) –&gt; 底层就是原生的转发</li>
<li>返回值以redirect开始：会 new RedirectView() –&gt; 底层就是原生的重定向</li>
<li>返回值以普通字符串开始：会 new ThymeleafView()</li>
</ul>
<p>视图解析：视图解析器根据返回的不同规则得到不同的视图，通过视图调用对应的渲染方法得到对应的视图页面</p>
<h4 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h4><p>Thymeleaf：<strong>现代化、服务端Java模板引擎</strong>，有网络时动态获取标签元素内的文本，没有网络时显示预先设置的静态值</p>
<table>
<thead>
<tr>
<th align="left">表达式名字</th>
<th align="left">语法</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">变量取值</td>
<td align="left">${…}</td>
<td align="left">获取请求域、session域、对象等值</td>
</tr>
<tr>
<td align="left">选择变量</td>
<td align="left">*{…}</td>
<td align="left">获取上下文对象值</td>
</tr>
<tr>
<td align="left">消息</td>
<td align="left">#{…}</td>
<td align="left">获取国际化等值</td>
</tr>
<tr>
<td align="left">链接</td>
<td align="left">@{…}</td>
<td align="left">生成链接</td>
</tr>
<tr>
<td align="left">片段表达式</td>
<td align="left">~{…}</td>
<td align="left">jsp:include 作用，引入公共页面片段</td>
</tr>
</tbody></table>
<ul>
<li><font color='red'><strong>变量取值行内写法(不需要写在标签内)：[[${session.loginUser.username}]]</strong></font></li>
</ul>
<p>thymeleaf引入公共部分的区别</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">&quot;copy&quot;</span>&gt;</span></span><br><span class="line">  <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;footer :: copy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这三者的不同 th:insert(将公共部分及标签插入到原标签)	th:replace(将原标签全部替代)	th:include(将公共部分插入原标签中)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">      <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><p>1.添加拦截器</p>
<p>①自定义类 实现 HandlerInterceptor 接口，重写拦截器的三个方法</p>
<p>②通过定制WebMVC，即自定义配置类 实现WebMvcConfigurer接口，将拦截器添加到容器中</p>
<p>③指定拦截规则【如果是拦截所有，静态资源也会被拦截】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/fonts/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.拦截器原理</p>
<p>①根据当前的请求，找到处理器执行链对象(其中包括了处理器方法、拦截器链、拦截器索引)</p>
<p>②执行顺序：</p>
<ul>
<li>情况一：a&gt;若每个拦截器的preHandle()都返回true</li>
</ul>
<p>​		此时多个拦截器的执行顺序和拦截器在SpringMVC的配置文件的配置顺序有关：</p>
<p>​		<strong>preHandle()会按照拦截器在配置中的正序执行，</strong></p>
<p>​		<strong>而postHandle()和afterComplation()会按照拦截器在配置中的反序执行</strong></p>
<ul>
<li>情况二：<font color='red'><strong>b&gt;若某个拦截器的preHandle()返回了false</strong></font>6</li>
</ul>
<p>​		<strong>preHandle()返回false和它之前的拦截器的preHandle()都会执行，</strong></p>
<p>​		<strong>postHandle()都不执行，<font color='red'>当前这个返回false的拦截器 之前的所有拦截器的afterComplation()都会倒序执行</font></strong></p>
<p>③如果任何一个拦截器返回false，直接结束，不执行目标方法</p>
<p>④在这之前的任何步骤出现异常都会触发afterComplation()方法</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wyAe.png" alt="执行流程"></p>
<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><ul>
<li><p>上传文件必须表单必须是post的提交方式，enctype&#x3D;multipart&#x2F;from-data</p>
<p>在 form 标签中使用 input type&#x3D;file 添加上传的文件</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">uploadPhoto</span><span class="params">(<span class="meta">@RequestParam(&quot;email&quot;)</span> String email,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestPart(&quot;userImg&quot;)</span>MultipartFile file,</span></span><br><span class="line"><span class="params">                             <span class="meta">@RequestPart(&quot;photos&quot;)</span> MultipartFile[] photos)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       log.info(<span class="string">&quot;邮箱：&quot;</span> + email + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;用户名：&quot;</span> + username + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;头像：&quot;</span> + file.getSize() + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;文件封面：&quot;</span> + photos.length + <span class="string">&quot;\n&quot;</span> );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!file.isEmpty())&#123;</span><br><span class="line">           <span class="comment">//获取原始的文件名</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">           <span class="comment">//获取文件的后缀</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">suffixName</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">           <span class="comment">//随机生成文件名</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">           <span class="comment">//组合文件的前缀和名字</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">photoName</span> <span class="operator">=</span> name + suffixName;</span><br><span class="line">           <span class="comment">//保存文件,可以通过这个方法直接将图片保存到硬盘上</span></span><br><span class="line">           file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\baidu\\&quot;</span> + photoName));</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (photos.length &gt; <span class="number">0</span> )&#123;</span><br><span class="line">           <span class="keyword">for</span> (MultipartFile photo : photos)&#123;</span><br><span class="line">               <span class="keyword">if</span> (!photo.isEmpty())&#123;</span><br><span class="line">                   <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> photo.getOriginalFilename();</span><br><span class="line">                   photo.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\baidu\\&quot;</span> + originalFilename) );</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>文件上传的原理：</p>
<p>文件上传自动配置类：MultipartAutoConfiguration - MultipartProperties</p>
<ul>
<li>在配置类中自动配置了文件上传解析器(StandardServletMultipartResolver)</li>
</ul>
<p>原理步骤：</p>
<p>①当请求进入使用文件解析器判断(isMultipart) 并用(resolveMultipart方法)封装文件上传请求，</p>
<p>​	返回一个 MultipartHttpServletRequest请求对象</p>
<p>②参数解析器来解析请求中文件内容封装成MultipartFile</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wR1I.png"></p>
<p>③底层将request中的文件信息封装到一个Map(MultiValueMap《String,MultipararFile》)</p>
<p>④最后通过FileCopyUtils工具类实现文件流的拷贝</p>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>1.默认规则</p>
<p>默认情况下，Spring Boot提供	&#x2F;error处理所有错误的映射</p>
<p>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。</p>
<p>对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据</p>
<p>2.自定义错误视图</p>
<p>①要对其进行自定义，添加 View 解析为 error</p>
<p>②要完全替换默认行为，可以实现 ErrorController 并注册该类型的Bean定义，</p>
<p>​	或添加<code>ErrorAttributes类型的组件</code>以使用现有机制但替换其内容。</p>
<p>③error&#x2F;下的4xx，5xx页面会被自动解析</p>
<p>3.定制错误处理逻辑</p>
<p>①自定义错误页</p>
<ul>
<li>error&#x2F;404.html   error&#x2F;5xx.html；有精确的错误状态码页面就匹配精确，没有就找 4xx.html；如果都没有就触发白页</li>
</ul>
<p>②@ControllerAdvice+@ExceptionHandler处理全局异常；底层是 ExceptionHandlerExceptionResolver 支持的</p>
<p>③@ResponseStatus+自定义异常 ；底层是 ResponseStatusExceptionResolver ，把responsestatus注解的信息</p>
<p>​	底层调用 response.sendError(statusCode, resolvedReason)；向tomcat发送的&#x2F;error</p>
<p>④Spring底层的异常，如 参数类型转换异常；DefaultHandlerExceptionResolver 处理框架底层的异常。</p>
<p><font color='red'><strong>response.sendError()：这个方法只有一个作用，即立即结束此次请求的处理，让tomcat发送&#x2F;error请求</strong></font></p>
<p>response.sendError(HttpServletResponse.SC_BAD_REQUEST, ex.getMessage()); </p>
<p>⑤<font color='red'><strong>自定义实现 HandlerExceptionResolver 处理异常；在设置order优先级之后，可以作为默认的全局异常处理规则</strong></font></p>
<ul>
<li>ErrorViewResolver 最底层的异常处理解析器， 实现自定义处理异常(一般不自定义覆盖这个)；</li>
</ul>
<p>​		response.sendError 。&#x2F;error请求就会转给BasicErrorcontroller</p>
<p>​		异常没有进行任何处理。tomcat底层 response.sendError。error请求就会转给BasicErrorcontroller</p>
<p>​		basicErrorController 要去的页面地址是 ErrorViewResolver 解析器进行解析的 ；</p>
<p>4.异常处理的自动配置原理</p>
<ul>
<li><p>ErrorMvcAutoConfiguration 自动配置异常处理规则</p>
<ul>
<li>在容器中注册的组件：类型：DefaultErrorAttributes –&gt; id：errorAttributes (定义错误页面中可以包含的数据)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DefaultErrorAttributes也是个处理器异常解析器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultErrorAttributes</span> <span class="keyword">implements</span> <span class="title class_">ErrorAttributes</span>, HandlerExceptionResolver, Ordered &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在容器中注册的组件：类型：BasicErrorController –&gt; id：basicErrorController(响应json 或 html的空白页)</p>
<p>这是一个控制器，默认处理：&#x2F;error 路径的请求 如果是页面，则 new  ModelAndView(<strong>“error”</strong>, model)；	</p>
</li>
<li><p>给容器中组注册一个id为error的View对象(作用是响应error页面)</p>
</li>
<li><p>在容器中注册的组件 BeanNameViewResolver (这是歌视图解析器)  根据返回的是视图名作为组件的id在容器中寻找组件，</p>
<ul>
<li>这个组件是个View，用于调用对应的视图渲染方法进行页面渲染</li>
</ul>
<p>	</p>
<p><font color='red'><strong>这里可以这么理解错误视图的产生过程：</strong></font>请求一个不存在的地址，会被BasicErrorController所处理，返回值是error，</p>
<p>这个返回值被BeanNameViewResolver视图解析器所解析，根据这个视图解析器的工作原理到ioc容器中找到了</p>
<p>这个已经注册在ioc容器中，id为error的组件(View对象，默认是个空白页面)，</p>
<p>获得这个View对象后，调用其对应的渲染技术，渲染页面。</p>
</li>
<li><p>在容器中注册的组件：DefaultErrorViewResolver –&gt; id:conventionErrorViewResolver	</p>
<ul>
<li><p>这个视图解析器的作用是在发生错误的时候将Http的状态码作为视图页地址(viewName)，访问地址是&#x2F;error&#x2F;4xx.html</p>
<p>找到真正的页面，<font color='red'><strong>这就是为什么把5xx.html页面放在error文件夹下被自动解析的原因</strong></font></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>5.异常处理的流程</p>
<p>①执行目标方法，在目标方法允许期间，出现任何异常都会被catch且标注当前请求结束，并被dispatchException封装</p>
<p>②进入视图解析流程(页面渲染)</p>
<p>③处理handler执行方法的异常，处理完成之后返回mv对象</p>
<p>Ⅰ.遍历所有的handlerExceptionResolvers，找到能处理当前异常的解析器</p>
<p>Ⅱ.DefaultErrorAttributes先来处理异常，将异常的信息保存到request域中并返回null</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wIHS.png" alt="处理器异常解析器接口的方法"></p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wHhj.png" alt="系统中保存的异常处理器"></p>
<p>Ⅲ.在系统默认设置的处理器异常解析器中没有解析器能处理，所有异常会被抛出</p>
<p>Ⅳ.由于异常没有处理则会由Servlet在底层再次请求转发(保存在request域中的数据会被携带过去)，发起一个&#x2F;error的请求</p>
<p>Ⅴ.这个&#x2F;error则被自动配置的BasicErrorController控制器进行处理</p>
<p>Ⅵ.在BasicErrorController的请求处理方法根据请求行的accpet进行内容协商调用对应方法</p>
<p>Ⅶ.在对应的处理方法中resolveErrorView()中遍历所有的ErrorViewResolver，找到能够处理的解析器</p>
<p>Ⅷ.则会调用系统自动装配的DefaultErrorResolver进行解析(原理同异常处理自动装配的解释)，</p>
<p>​	DefaultErrorResolver的作用是把响应状态码作为错误页的地址，error&#x2F;500.html</p>
<p>Ⅸ.最终由模板引擎Thymeleaf响应这个页面 error&#x2F;500.html </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//出现异常，标注当前请求结束</span></span><br><span class="line">webRequest.requestCompleted();</span><br><span class="line"></span><br><span class="line"><span class="comment">//视图解析流程</span></span><br><span class="line">processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException)&#123;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//处理handler执行方法的异常，处理完成之后返回ModelAndView对象，包含要去的视图地址和要显示的数据</span></span><br><span class="line">mv = processHandlerException(request, response, handler, exception)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Check registered HandlerExceptionResolvers...</span></span><br><span class="line">    <span class="comment">//在这些解析器中没有能处理除0异常的解析器</span></span><br><span class="line">		<span class="type">ModelAndView</span> <span class="variable">exMv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.handlerExceptionResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (HandlerExceptionResolver resolver : <span class="built_in">this</span>.handlerExceptionResolvers) &#123;</span><br><span class="line">				exMv = resolver.resolveException(request, response, handler, ex);</span><br><span class="line">				<span class="keyword">if</span> (exMv != <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//BasicErrorController的请求处理方法</span></span><br><span class="line"><span class="comment">//MediaType.TEXT_HTML_VALUE指定返回text/html页面</span></span><br><span class="line"><span class="meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span></span><br><span class="line">	<span class="keyword">public</span> ModelAndView <span class="title function_">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">		<span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line">		Map&lt;String, Object&gt; model = Collections</span><br><span class="line">				.unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));</span><br><span class="line">		response.setStatus(status.value());</span><br><span class="line">		<span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolveErrorView(request, response, status, model);</span><br><span class="line">		<span class="keyword">return</span> (modelAndView != <span class="literal">null</span>) ? modelAndView : <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;error&quot;</span>, model);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定将方法返回值作为响应报文</span></span><br><span class="line">	<span class="meta">@RequestMapping</span></span><br><span class="line">	<span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">error</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">		<span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line">		<span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(status);</span><br><span class="line">		&#125;</span><br><span class="line">		Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(body, status);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Web原生组件注入"><a href="#Web原生组件注入" class="headerlink" title="Web原生组件注入"></a>Web原生组件注入</h4><ul>
<li><p>(Servlet、Filter、Listener的注入)</p>
<p>@WebListener、</p>
<p>@WebServlet(urlPatterns &#x3D; “&#x2F;myServlet”)</p>
<p>@WebFilter(urlPatterns &#x3D; {“&#x2F;css&#x2F;<em>“, “&#x2F;images&#x2F;</em>“})</p>
<p>加上在主程序类上标注扫描这三大组件所在包注册进ioc容器中</p>
</li>
</ul>
<p>1.使用原生的Servlet API</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在Spingboot的应用程序类上标注原生的servlet组件放在哪个包下</span></span><br><span class="line"><span class="meta">@ServletComponentScan(basePackages = &quot;top.year21.springboot.servlet&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootAdminApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringbootAdminApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在自定义的原生Servlet上使用注解进行注册servlet    </span></span><br><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/myServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//注册Filter</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &#123;&quot;/css/*&quot;, &quot;/images/*&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizeFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;&#125;   </span><br><span class="line">    </span><br><span class="line"><span class="comment">//注册Filter</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizeListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>2.使用RegistrationBean</p>
<p>通过xxxRegistrationBean组件 + @Bean注解将原生的三大组件注册进ioc容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//proxyBeanMethods = true 保证依赖的组件始终都是单实例的</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegistrationBeanConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MyServlet</span> <span class="variable">myServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServlet</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(myServlet,<span class="string">&quot;/myServlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CustomizeFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomizeFilter</span>();</span><br><span class="line">        <span class="comment">//第一种方法</span></span><br><span class="line"><span class="comment">//        return new FilterRegistrationBean(filter,myServlet());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//第二种方法</span></span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">theFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>(filter);</span><br><span class="line">        theFilter.addUrlPatterns(<span class="string">&quot;/myServlet&quot;</span>,<span class="string">&quot;/css/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> theFilter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletListenerRegistrationBean <span class="title function_">myListener</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">CustomizeListener</span> <span class="variable">listener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomizeListener</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>(listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 扩展：DispatchServlet注册进ioc容器的过程</p>
<p>①容器中自动配置了DispatcherServlet，将这个组件的属性和WebMvcProperties.class进行绑定；</p>
<p>​	对应的配置文件配置项是spring.mvc。</p>
<p>②通过使用@Bean + ServletRegistrationBean&lt; DispatcherServlet.&gt; 把DisparcherServlet 进行配置</p>
<p>访问其他Servlet的请求不被DispatcherServlet拦截的原因：</p>
<ul>
<li>精确优先原则：当多个Servlet都能处理同一层路径，用最匹配的进行处理；比如下方访问&#x2F;my会原先匹配MyServlet</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wOcq.png"></p>
<h4 id="嵌入式Servlet容器"><a href="#嵌入式Servlet容器" class="headerlink" title="嵌入式Servlet容器"></a>嵌入式Servlet容器</h4><p>SpringBoot底层默认有很多的WebServer工厂：TomcatServletWebServerFactory 、 </p>
<p>​																				  JettyServletWebServerFactory 、 </p>
<p>​																				  UndertowServletWebServerFactory</p>
<ul>
<li>因此需要切换web服务器只需要在pom文件中引入相关的start场景</li>
</ul>
<p>1.原理：</p>
<p>每个ioc容器在启动时都会先调用父类所有的refresh方法()进行刷新，再执行当前容器的refresh()方法，</p>
<p>在执行到onrefresh()方法中，通过createWebServer()创建默认的内嵌Servlet容器</p>
<p>①SpringBoot应用启动是发现当前的是web应用，web应用会创建一个web版本的ioc容器 ServletwebServletApplicationContext</p>
<p>②在 ServletwebServletApplicationContext 启动时会寻找 ServletWebServletFactory (Servlet的web服务器工厂)</p>
<p>​	底层直接会有一个自动配置类(ServletWebServerFactoryAutoConfiguration)</p>
<p>③ServletWebServerFactoryAutoConfiguration导入了ServletWebServerFactoryConfiguration（配置类）&#96;</p>
<p>④ServletWebServerFactoryConfiguration 配置类 根据动态判断系统中到底导入了那个Web服务器的包。</p>
<p>（默认是web-starter导入tomcat包），容器中就有 TomcatServletWebServerFactory&#96;</p>
<p>⑤TomcatServletWebServerFactory 创建出Tomcat服务器并启动；</p>
<p>TomcatWebServer 的构造器拥有初始化方法initialize—this.tomcat.start();&#96;</p>
<p>总结：<font color='red'><strong>内嵌服务器，就是手动把启动服务器的代码调用（tomcat核心jar包存在）&#96;</strong></font></p>
<p>2、定制Servlet容器</p>
<ul>
<li><p>实现  WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory.&gt;</p>
<p>把配置文件的值和 ServletWebServerFactory 进行绑定</p>
</li>
<li><p>修改配置文件 server.xxx</p>
</li>
<li><p>直接自定义 ConfigurableServletWebServerFactory</p>
</li>
</ul>
<p>xxxxxCustomizer：定制化器，可以改变xxxx的默认规则</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizationBean</span> <span class="keyword">implements</span> <span class="title class_">WebServerFactoryCustomizer</span>&lt;ConfigurableServletWebServerFactory&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConfigurableServletWebServerFactory server)</span> &#123;</span><br><span class="line">        server.setPort(<span class="number">9000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="定制化原理"><a href="#定制化原理" class="headerlink" title="定制化原理"></a>定制化原理</h4><p>定制化的常见方式</p>
<p>①编写自定义配置类 + @Bean替换、增加容器中默认组件(视图解析器、异常解析器)等</p>
<p>②修改配置文件</p>
<p>③xxxxxCustomizer：定制化器</p>
<p>④<font color='red'><strong>web应用开发，自定义一个配置类 实现 WebMvcConfigurer 接口可定制化web功能</strong></font> <strong>+ @Bean给容器中再扩展一些组件</strong></p>
<p>⑤@EnableWebMvc + WebMvcConfigurer —— @Bean  可以全面接管SpringMVC，但存在个别问题</p>
<p>​	虽然实现定制和扩展功能但会导致WebMvcAutoConfiguration自动配置类配置的底层组件全部失效</p>
<hr>
<h3 id="数据访问"><a href="#数据访问" class="headerlink" title="数据访问"></a>数据访问</h3><h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><p>1.根据开发场景导入对应的starter场景</p>
<p>在导入的starter场景中自动导入了数据源，数据库事务管理，以及封装了原生的jdbc操作的jdbcTemplate模板</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wXj0.png"></p>
<ul>
<li>至于jdbc驱动(数据库驱动)没有导入是因为数据库众多，springboot没法判断使用的是哪个，需手动导入pom文件</li>
</ul>
<p>2.导入的自动配置类的分析</p>
<ul>
<li><p>DataSourceAutoConfiguration ： 数据源的自动配置</p>
<ul>
<li><p>修改数据源相关的配置：<strong>spring.datasource</strong></p>
</li>
<li><p><strong>数据库连接池的配置，是自己容器中没有DataSource才自动配置的</strong></p>
</li>
<li><p>底层配置好的连接池是：<strong>HikariDataSource</strong></p>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Conditional(PooledDataSourceCondition.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span></span><br><span class="line"><span class="meta">		DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,</span></span><br><span class="line"><span class="meta">		DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PooledDataSourceConfiguration</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>DataSourceTransactionManagerAutoConfiguration： 事务管理器的自动配置</p>
</li>
<li><p>JdbcTemplateAutoConfiguration： <strong>JdbcTemplate的自动配置，可以来对数据库进行crud</strong></p>
<ul>
<li><p>可以修改这个配置项@ConfigurationProperties(prefix &#x3D; <strong>“spring.jdbc”</strong>) 来修改JdbcTemplate</p>
</li>
<li><p>@Bean@Primary    JdbcTemplate；容器中有这个组件</p>
</li>
</ul>
</li>
<li><p>JndiDataSourceAutoConfiguration： jndi的自动配置</p>
</li>
<li><p>XADataSourceAutoConfiguration： 分布式事务相关的</p>
</li>
</ul>
<p>3.修改配置类以使用</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/fruit_db?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">jdbc:</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">query-timeout:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>4.测试配置是否正常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   JdbcTemplate jdbcTemplate;</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from t_fruit&quot;</span>, Long.class);</span><br><span class="line">       log.info(<span class="string">&quot;查询的数据是：&quot;</span> + count);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Druid数据源"><a href="#Druid数据源" class="headerlink" title="Druid数据源"></a>Druid数据源</h4><p>可以采用两种方式：1.自定义方式(在springboot-admin包下查看)	2.引入官方starter场景的依赖包</p>
<p>1.自动配置的分析</p>
<p>扩展配置项 spring.datasource.druid</p>
<p>DruidSpringAopConfiguration.class,   监控SpringBean的；配置项：spring.datasource.druid.aop-patterns</p>
<p>DruidStatViewServletConfiguration.class, 监控页的配置：spring.datasource.druid.stat-view-servlet；默认开启</p>
<p>DruidWebStatFilterConfiguration.class, web监控配置；spring.datasource.druid.web-stat-filter；默认开启</p>
<p>DruidFilterConfiguration.class}) 所有Druid自己filter的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_STAT_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.stat&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_CONFIG_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.config&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_ENCODING_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.encoding&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_SLF4J_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.slf4j&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_LOG4J_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.log4j&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_LOG4J2_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.log4j2&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_COMMONS_LOG_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.commons-log&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILTER_WALL_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.datasource.druid.filter.wall&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>2.采用配置文件进行配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/fruit_db?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">aop-patterns:</span> <span class="string">top.year21.springboot</span> <span class="comment">#监控SpringBean</span></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat,wall</span> <span class="comment"># 底层开启功能，stat（sql监控），wall（防火墙）</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span> <span class="comment"># 配置监控页功能</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">reset-enable:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">web-stat-filter:</span>  <span class="comment"># 监控web</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/*</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">&#x27;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#x27;</span></span><br><span class="line">      <span class="attr">filter:</span> </span><br><span class="line">        <span class="attr">stat:</span> <span class="comment"># 对上面filters里面的stat的详细配置</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">update-allow:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h4 id="整合MyBatis"><a href="#整合MyBatis" class="headerlink" title="整合MyBatis"></a>整合MyBatis</h4><p>1.引入mybats的starter场景依赖</p>
<p>补充一下：spring官方的启动场景为 spring-boot-starter-*</p>
<p>​					第三方的启动场景为 *-spring-boot-starter</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.配置模式</p>
<ul>
<li><p>全局配置文件中导入的组件</p>
<p>SqlSessionFactory: 负责创建sqlsession</p>
<p>SqlSession：提供java程序与数据库交互的连接</p>
<p>@Import(<strong>AutoConfiguredMapperScannerRegistrar</strong>.<strong>class</strong>）；</p>
<p>Mapper： 负责操作数据库的mapper接口只要标注 @Mapper 注解就会被自动扫描进来</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(MybatisProperties.class)</span> ： <span class="comment">//MyBatis配置项绑定类。</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisAutoConfiguration</span>&#123;&#125;</span><br><span class="line"><span class="comment">//绑定配置文件的mybatis前缀内容</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mybatis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisProperties</span></span><br></pre></td></tr></table></figure>

<p>配置模式下，整合mybats场景进行crud的前置操作：</p>
<p>①导入mybatis官方starter场景依赖</p>
<p>②编写mapper接口。<font color='red'><strong>mapper接口一定要标准@Mapper注解</strong></font></p>
<p>③编写mapper接口的映射文件并绑定mapper接口</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;?xml</span> <span class="string">version=&quot;1.0&quot;</span> <span class="string">encoding=&quot;UTF-8&quot;</span> <span class="string">?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE</span> <span class="string">mapper</span></span><br><span class="line">        <span class="string">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="string">&gt;</span></span><br><span class="line"><span class="string">&lt;mapper</span> <span class="string">namespace=&quot;top.year21.springboot.dao.FruitMapper&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;!--</span>    <span class="string">Fruit</span> <span class="string">queryOneById(Integer</span> <span class="string">id);--&gt;</span></span><br><span class="line">    <span class="string">&lt;select</span> <span class="string">id=&quot;queryOneById&quot;</span> <span class="string">resultType=&quot;top.year21.springboot.bean.Fruit&quot;&gt;</span></span><br><span class="line">        <span class="string">select</span> <span class="string">*</span> <span class="string">from</span> <span class="string">t_fruit</span> <span class="string">where</span> <span class="string">fid</span> <span class="string">=</span> <span class="comment">#&#123;id&#125;;</span></span><br><span class="line">    <span class="string">&lt;/select&gt;</span></span><br><span class="line"><span class="string">&lt;/mapper&gt;</span></span><br></pre></td></tr></table></figure>

<p>④在application.yaml中指定Mapper配置文件的位置，以及指定全局配置文件的信息 </p>
<p>​	<font color='red'> <strong>建议不要写全局配置文件，所有全局配置文件的配置都放在configuration配置项中即可</strong></font></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置mybatis的核心配置文件和映射配置文件位置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="comment">#  config-location: classpath:mybatis/mybatis-config.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span> <span class="comment">#指定mapper接口映射文件位置</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#使用这个修改则不能指定config-location处的mybatis-config.xml文件位置，不然报错</span></span><br><span class="line">  <span class="attr">configuration:</span>  <span class="comment">#指定mybatis全局配置文件中的相关配置</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>3.注解模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//采用注解+配置模式的混合写法</span></span><br><span class="line">   <span class="comment">// public void saveCity(City city) &#123;</span></span><br><span class="line"><span class="comment">//        cityMapper.insertCity(city);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//&lt;!--  void insertCity(City city);  --&gt;</span></span><br><span class="line"><span class="comment">//    &lt;insert id=&quot;insertCity&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;&gt;</span></span><br><span class="line"><span class="comment">//        insert into city(name,state,country) values(#&#123;name&#125;,#&#123;state&#125;,#&#123;country&#125;)</span></span><br><span class="line"><span class="comment">//    &lt;/insert&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//纯注解写法</span></span><br><span class="line">    <span class="meta">@Insert(&quot; insert into city(name,state,country) values(#&#123;name&#125;,#&#123;state&#125;,#&#123;country&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true,keyColumn = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveCity</span><span class="params">(City city)</span> &#123;</span><br><span class="line">        cityMapper.insertCity(city);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="整合MyBatis-plus"><a href="#整合MyBatis-plus" class="headerlink" title="整合MyBatis-plus"></a>整合MyBatis-plus</h4><p>1.引入MyBatis-plus的starter场景依赖</p>
<ul>
<li><font color='red'><strong>注：在这个stater中也自动引入了jdbc和mybatis的场景，因此上面两个的整合依赖就不需要再引入，但jdbc驱动依赖必须引入</strong></font></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;<span class="number">3.5</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.自动配置分析</p>
<ul>
<li><p>MybatisPlusAutoConfiguration 配置类，MybatisPlusProperties 配置项绑定。mybatis-plus：xxx 就是对mybatis-plus的定制</p>
</li>
<li><p>SqlSessionFactory 自动配置好。底层是容器中默认的数据源</p>
</li>
<li><p>mapperLocations 自动配置好且有默认值(<em>classpath*:&#x2F;mapper&#x2F;*</em>&#x2F;*.xml)。</p>
<p>即任意包的类路径下的所有mapper文件夹下任意路径下的所有xml都是sql映射文件。 </p>
</li>
<li><p>容器中也自动配置好了 SqlSessionTemplate</p>
</li>
<li><p>@Mapper 标注的接口也会被自动扫描；可以@MapperScan(“xxx.xxx”)批量扫描就行</p>
</li>
</ul>
<p><font color='red'><strong>最大特点：自定义mapper继承BaseMapper就直接拥有了crud能力</strong></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BaseMapper&lt;T&gt; 这个接口提供了大量基础的有关对数据库crud操作的方法</span></span><br><span class="line"><span class="comment">//泛型参数T 则是说明这个自定义的mapper是对数据库中哪个能映射成泛型参数T类型的表进行的具体操作</span></span><br><span class="line"><span class="comment">//自定义的mapper接口继承了BaseMapper就能使用它定义的方法，也就直接拥有了crud能力</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IService接口是所有service的父类，其内封装了大量基础的业务处理所需要调用的与数据交互的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ServiceImpl&lt;M extends BaseMapper&lt;T&gt;, T&gt;是IService&lt;T&gt;的实现类，里面有IService定义的方法</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper,User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>3.测试整合效果</p>
<ul>
<li><font color='red'><strong>开启分页功能需要先引入分页插件</strong></font></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;top.year21.springboot.dao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageHelperConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新的分页插件,一缓和二缓遵循mybatis的规则,*/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> 			  		<span class="title class_">PaginationInnerInterceptor</span>(DbType.H2);</span><br><span class="line">        paginationInnerInterceptor.setOverflow(<span class="literal">true</span>);</span><br><span class="line">        paginationInnerInterceptor.setMaxLimit(<span class="number">500L</span>);</span><br><span class="line">        interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>进行测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/dynamic&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">dynamicTable</span><span class="params">(<span class="meta">@RequestParam(value = &quot;pageNum&quot;,defaultValue = &quot;1&quot;,required = false)</span> Integer pageNum, Model model)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在使用分页功能后查询的数据都封装在了pageInfo中，其中数据库的查询数据在records中</span></span><br><span class="line"><span class="comment">//        List&lt;User&gt; users = userService.list();</span></span><br><span class="line">        <span class="comment">//分页查询的数据</span></span><br><span class="line">        Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//分页查询后的结果</span></span><br><span class="line">        Page&lt;User&gt; pageInfo = userService.page(page,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        model.addAttribute(&quot;users&quot;,users);</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;pageInfo&quot;</span>,pageInfo);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;table/dynamic_table&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/deleteUser/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestParam(&quot;pageNum&quot;)</span> Integer pageNum,//被携带的参数</span></span><br><span class="line"><span class="params">                         RedirectAttributes redirectAttributes )</span>&#123; <span class="comment">//用个重定向携带参数，跳转到指定页面</span></span><br><span class="line">        userService.removeById(id);</span><br><span class="line">        <span class="comment">//携带需要重定向使用的参数</span></span><br><span class="line">        redirectAttributes.addAttribute(<span class="string">&quot;pageNum&quot;</span>,pageNum);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/dynamic&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><font color='red'><strong>thymeleaf使用注意点：</strong></font></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--非restful风格的写法：使用thymeleaf生成跳转连接，且在连接中读取参数的写法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/dynamic(pageNum=$&#123;num&#125;)&#125;&quot;</span>&gt;</span>[[$&#123;num&#125;]]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--restful风格的写法：使用thymeleaf生成跳转连接，且在连接中读取参数的写法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-danger btn-sm&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/deleteUser/&#123;id&#125;(id=$&#123;user.id&#125;)&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--thtmeleaf遍历分页数据内容--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;user,state:$&#123;pageInfo.records&#125;&quot;</span>&gt;</span> </span><br><span class="line">             <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;state.count&#125;&quot;</span>&gt;</span>Trident<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.id&#125;&quot;</span>&gt;</span>Trident<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span>Internet Explorer 4.0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.age&#125;&quot;</span>&gt;</span>Win 95+<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.email&#125;&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">           </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="整合Redis"><a href="#整合Redis" class="headerlink" title="整合Redis"></a>整合Redis</h4><p>1.stater场景引入的依赖</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X9wzHU.png"></p>
<p>2.自动配置的分析</p>
<ul>
<li><p>RedisAutoConfiguration 自动配置类。RedisProperties 属性类 –&gt; spring.redis.xxx是对redis的配置</p>
</li>
<li><p>连接工厂是准备好的。LettuceConnectionConfiguration、JedisConnectionConfiguration</p>
</li>
<li><p>自动注入了RedisTemplate&lt;Object, Object&gt; ： xxxTemplate；</p>
</li>
<li><p>自动注入了StringRedisTemplate；k：v都是String</p>
<p>底层使用 StringRedisTemplate、RedisTemplate两者其中之一就可以操作redis</p>
</li>
</ul>
<p>3.切换为Jedis</p>
<p>默认导入的是LettuceConnectionConfiguration，切换导入为JedisConnectionConfiguration</p>
<p><font color='red'><strong>需要引入jedis依赖和配置文件修改客户端类型</strong></font></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 版本不需要写，springboot进行了版本仲裁--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.231</span><span class="number">.133</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">client-type:</span> <span class="string">jedis</span></span><br><span class="line">  <span class="attr">jedis:</span></span><br><span class="line">    <span class="attr">pool:</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>4.测试</p>
<ul>
<li>注意：<font color='red'><strong>使用了spring容器中的组件的对象不能自己手动new，必须自动装配，从容器中获取</strong></font></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用redis统计指定访问页面的访问次数</span></span><br><span class="line">	<span class="meta">@GetMapping(&quot;/index.html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getIndex</span><span class="params">(HttpSession session, Model model)</span>&#123; </span><br><span class="line">        ValueOperations&lt;String, String&gt; opsForValue = redisTemplate.opsForValue();</span><br><span class="line">        <span class="type">String</span> <span class="variable">index</span> <span class="operator">=</span> opsForValue.get(<span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> opsForValue.get(<span class="string">&quot;/sql&quot;</span>);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;index&quot;</span>,index);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;sql&quot;</span>,sql);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加拦截器以拦截指定页面</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        redisTemplate.opsForValue().increment(uri);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisInterceptor redisInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//添加拦截规则</span></span><br><span class="line">        <span class="comment">//此处redisInterceptor必须从容器中自动装配</span></span><br><span class="line">        <span class="comment">//因为这个对象使用到了redis自动装配的stringRedisTemplate</span></span><br><span class="line">        <span class="comment">//手动new的RedisInterceptor对象不能使用stringRedisTemplate这个组件</span></span><br><span class="line">        registry.addInterceptor(redisInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/fonts/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Junit单元测试"><a href="#Junit单元测试" class="headerlink" title="Junit单元测试"></a>Junit单元测试</h3><p>1.引入junit5的starter场景依赖</p>
<p>2.SpringBoot整合Junit以后。</p>
<p>①编写测试方法：@Test标注（注意需要使用junit5版本的注解）</p>
<p>②Junit类具有Spring的功能，@Autowired、比如 @Transactional 标注测试方法，测试完成后自动回滚</p>
<ul>
<li><p>常用Junit5注解测试</p>
<p>**@Test :**表示方法是测试方法。</p>
<p>**@ParameterizedTest :**表示方法是参数化测试</p>
<p>**@RepeatedTest :**表示方法可重复执行</p>
<p>**@DisplayName :**为测试类或者测试方法设置展示名称</p>
<p>**@BeforeEach :**表示在每个单元测试之前执行</p>
<p>**@AfterEach :**表示在每个单元测试之后执行</p>
<p>**@BeforeAll :**表示在所有单元测试之前执行</p>
<p>**@AfterAll :**表示在所有单元测试之后执行</p>
<p>**@Tag :**表示单元测试类别，类似于JUnit4中的@Categories</p>
<p>**@Disabled :**表示测试类或测试方法不执行，类似于JUnit4中的@Ignore</p>
<p>**@Timeout :**表示测试方法运行如果超过了指定时间将会返回错误</p>
<p>**@ExtendWith :**为测试类或测试方法提供扩展类引用</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span>  <span class="comment">//此注解代表整合了SpringBoot，可以使用springboot的组件</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;junit5功能测试&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Junit5Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于标识每个测试方法</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试DisplayName注解&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDisplayName</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Disabled</span> <span class="comment">//禁用对这个方法的测试</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试方法2&quot;)</span> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testMethod2</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以模拟对一个功能的多次运行</span></span><br><span class="line">    <span class="meta">@RepeatedTest(5)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testRepeatedTest</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">     <span class="comment">//规定方法的超时时间</span></span><br><span class="line">    <span class="meta">@Timeout(value = 500,unit = TimeUnit.MILLISECONDS)</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试方法的超时&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testTimeOut</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;测试已经超时&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//BeforeEach、AfterEach分别在每一个测试方法执行前后都执行一次</span></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testBeforeEach</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test will started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAfterEach</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test will stoped&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//BeforeAll、AfterAll在所有测试方法开始之前分别执行一次，且只执行一次</span></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testBeforeAll</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;all test will started &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testAfterAll</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;all test will stoped &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="断言机制"><a href="#断言机制" class="headerlink" title="断言机制"></a><font color='red'><strong>断言机制</strong></font></h4><p>断言（assertions）机制是测试方法中的核心部分，用来对测试需要满足的条件进行验证。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">assertEquals</td>
<td align="left">判断两个对象或两个原始类型是否相等</td>
</tr>
<tr>
<td align="left">assertNotEquals</td>
<td align="left">判断两个对象或两个原始类型是否不相等</td>
</tr>
<tr>
<td align="left">assertSame</td>
<td align="left">判断两个对象引用是否指向同一个对象</td>
</tr>
<tr>
<td align="left">assertNotSame</td>
<td align="left">判断两个对象引用是否指向不同的对象</td>
</tr>
<tr>
<td align="left">assertTrue</td>
<td align="left">判断给定的布尔值是否为 true</td>
</tr>
<tr>
<td align="left">assertFalse</td>
<td align="left">判断给定的布尔值是否为 false</td>
</tr>
<tr>
<td align="left">assertNull</td>
<td align="left">判断给定的对象引用是否为 null</td>
</tr>
<tr>
<td align="left">assertNotNull</td>
<td align="left">判断给定的对象引用是否不为 null</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssertionsTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//任何一个断言抛出异常，下方所有的断言都不会执行</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试简单断言&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSimpleAssertions</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> count(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">//判断是否值是否相等</span></span><br><span class="line">        assertEquals(<span class="number">6</span>,num,<span class="string">&quot;逻辑出现问题&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断地址引用是否相同</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">a2</span> <span class="operator">=</span> <span class="string">&quot;test1&quot;</span>;</span><br><span class="line">        assertSame(a1,a2,<span class="string">&quot;地址引用不一致&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">count</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> a + b;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试数组断言&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testArrayAssertions</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span>[] a1 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">        <span class="type">int</span>[] a2 = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>,<span class="number">1</span>&#125;;</span><br><span class="line">        assertArrayEquals(a1,a2,<span class="string">&quot;两个数组不一样&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组合断言即所有的断言都成功才算成功</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试组合断言&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">TestAllAssertions</span><span class="params">()</span> &#123;</span><br><span class="line">        assertAll(<span class="string">&quot;Math&quot;</span>,</span><br><span class="line">                () -&gt; assertEquals(<span class="number">2</span>, <span class="number">1</span> + <span class="number">1</span>),</span><br><span class="line">                () -&gt; assertTrue(-<span class="number">1</span> &gt; <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试异常断言&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">TestExceptionAssertions</span><span class="params">()</span> &#123;</span><br><span class="line">        assertThrows(</span><br><span class="line">                <span class="comment">//抛出的异常，执行的方法</span></span><br><span class="line">                ArithmeticException.class, () -&gt; &#123;<span class="type">int</span> i= <span class="number">10</span> / <span class="number">2</span>;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试快速失败&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">TestshouldFailAssertions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == <span class="number">2</span>)&#123;</span><br><span class="line">            fail(<span class="string">&quot;应该抛出快速失败的异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h4><p>前置条件（assumptions与断言不同之处在于<strong>不满足的断言会使得测试方法失败</strong>，而<strong>不满足的前置条件只会使得测试方法的执行终止。</strong></p>
<p><font color='red'><strong>前置条件可以看成是测试方法执行的前提，当该前提不满足时，就没有继续执行的必要。</strong></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="meta">@DisplayName(&quot;测试前置条件&quot;)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">testAssumptions</span><span class="params">()</span>&#123;</span><br><span class="line">       Assumptions.assumeTrue(<span class="literal">false</span>,<span class="string">&quot;结果不是true&quot;</span>);<span class="comment">//前置条件不成立，下方sout不会输出</span></span><br><span class="line">       System.out.println(<span class="string">&quot;**********&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="嵌套测试"><a href="#嵌套测试" class="headerlink" title="嵌套测试"></a>嵌套测试</h4><p>JUnit 5 可以通过 Java 中的内部类和@Nested 注解实现嵌套测试，从而可以更好的把相关的测试方法组织在一起。</p>
<p>在内部类中可以使用@BeforeEach 和@AfterEach 注解，而且嵌套的层次没有限制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 嵌套测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestingAStackDemo</span> &#123;</span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;new Stack()&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">isInstantiatedWithNew</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//在嵌套测试的情况下，外出的test不能驱动内层的Before(After)Each/All之类的方法提前运行和置后运行</span></span><br><span class="line">        <span class="comment">//换句话来说就是内层的before等方法不会在下方这个方法执行之前运行</span></span><br><span class="line">        assertNull(stack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;when new&quot;)</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WhenNew</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">createNewStack</span><span class="params">()</span> &#123;</span><br><span class="line">            stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;is empty&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when peeked&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::peek);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 内层的Test可以驱动外层的Before(After)Each/All之类的方法提前运行和置后运行</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;after pushing an element&quot;)</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">AfterPushing</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">anElement</span> <span class="operator">=</span> <span class="string">&quot;an element&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@BeforeEach</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">pushAnElement</span><span class="params">()</span> &#123;</span><br><span class="line">                stack.push(anElement);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;it is no longer empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">isNotEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when popped and is empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.pop());</span><br><span class="line">                assertTrue(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when peeked but remains not empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.peek());</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="参数化测试"><a href="#参数化测试" class="headerlink" title="参数化测试"></a><font color='red'><strong>参数化测试</strong></font></h4><p>@ValueSource: 为参数化测试指定入参来源，支持八大基础类以及String类型,Class类型</p>
<p>@NullSource: 表示为参数化测试提供一个null的入参</p>
<p>@EnumSource: 表示为参数化测试提供一个枚举入参</p>
<p>@CsvFileSource：表示读取指定CSV文件内容作为参数化测试入参</p>
<p>@MethodSource：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line">   <span class="meta">@DisplayName(&quot;参数化测试&quot;)</span></span><br><span class="line">   <span class="meta">@ValueSource(ints = &#123;1,5,6,7&#125;)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">testParameterized</span><span class="params">(<span class="type">int</span> num)</span>&#123;</span><br><span class="line">       System.out.println(num);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ParameterizedTest</span></span><br><span class="line">   <span class="meta">@DisplayName(&quot;参数化测试2&quot;)</span></span><br><span class="line">   <span class="meta">@MethodSource(&quot;stringProvider&quot;)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">testParameterized</span><span class="params">(String string)</span>&#123;</span><br><span class="line">       System.out.println(string);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">stringProvider</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> Stream.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="指标监控"><a href="#指标监控" class="headerlink" title="指标监控"></a>指标监控</h3><h4 id="SpringBoot-Actuator"><a href="#SpringBoot-Actuator" class="headerlink" title="SpringBoot Actuator"></a>SpringBoot Actuator</h4><ul>
<li>对每个微服务快速引用即可获得生产级别的应用监控、审计等功能。</li>
</ul>
<p>1.使用步骤</p>
<p>①引入场景</p>
<p>②访问 <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/">http://localhost:8080/actuator/</a>**</p>
<p>③暴露所有监控信息为HTTP</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--      引入监控功能  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># management 是所有actuator的配置</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">true</span> <span class="comment">#默认开启所有监控端点</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span>  <span class="comment">#默认以web方式暴露所有监控端点</span></span><br></pre></td></tr></table></figure>

<p>2.常用<a target="_blank" rel="noopener" href="https://www.yuque.com/atguigu/springboot/sgpvgn">端点</a></p>
<p>最常用的Endpoint：</p>
<p>Health：监控状况</p>
<p>Metrics：运行时指标</p>
<p>Loggers：日志记录</p>
<h4 id="Health-Endpoint"><a href="#Health-Endpoint" class="headerlink" title="Health Endpoint"></a>Health Endpoint</h4><p>健康检查端点一般用于在云平台，平台会定时的检查应用的健康状况，</p>
<p>重要的几点：</p>
<ul>
<li><p>health endpoint返回的结果，应该是一系列健康检查后的一个汇总报告</p>
</li>
<li><p>很多的健康检查默认已经自动配置好了，比如：数据库、redis等</p>
</li>
<li><p>可以很容易的添加自定义的健康检查机制</p>
</li>
</ul>
<h4 id="Metrics-Endpoint"><a href="#Metrics-Endpoint" class="headerlink" title="Metrics Endpoint"></a>Metrics Endpoint</h4><p>提供详细的、层级的、空间指标信息，这些信息可以被pull（主动推送）或者push（被动获取）方式得到；</p>
<ul>
<li><p>通过Metrics对接多种监控系统</p>
</li>
<li><p>简化核心Metrics开发</p>
</li>
<li><p>添加自定义Metrics或者扩展已有Metrics</p>
</li>
</ul>
<p>由于目前水平过低，接触较少，留个印象吧，即使不知道以后是否能够有机会从事计算机行业</p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/atguigu/springboot/sgpvgn">剩下的内容</a>  &lt;—  点击这里</p>
<h3 id="Profile功能"><a href="#Profile功能" class="headerlink" title="Profile功能"></a>Profile功能</h3><ul>
<li><p>默认配置文件与指定的环境配置都会同时生效</p>
<ul>
<li><p>默认配置文件  application.yaml；任何时候都会加载</p>
</li>
<li><p>指定环境配置文件  application-{env}.yaml</p>
<ul>
<li><p>激活指定环境</p>
<p>①配置文件激活</p>
<p>②命令行激活：java -jar xxx.jar –spring.profiles.active&#x3D;prod  –person.name&#x3D;haha</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>1.条件装配@@Profile</p>
<p>@@Profile可以使用在类或者方法上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据生产环境对配置类的内容进行操作</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Profile(&quot;pro&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductionConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfig</span> &#123;</span><br><span class="line"><span class="comment">//根据生产环境对下方的bean进行注册</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&quot;pro&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Man <span class="title function_">getMan</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Man</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.profile分组</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#application.properties是默认环境，默认加载</span></span><br><span class="line"><span class="comment">#在application.properties使用：</span></span><br><span class="line"><span class="comment">#--spring.profiles.active=xxx	激活指定激活的环境</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">pro</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.profiles.group.pro[0]</span>=<span class="string">grp</span></span><br><span class="line"><span class="attr">spring.profiles.group.pro[1]</span>=<span class="string">pro</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.profiles.group.test[0]</span>=<span class="string">test</span></span><br></pre></td></tr></table></figure>

<h3 id="外部化配置"><a href="#外部化配置" class="headerlink" title="外部化配置"></a>外部化配置</h3><p>1.配置来源：常用来源(Java属性文件、YAML文件、环境变量、命令行参数)</p>
<p>2.配置文件查找位置</p>
<ul>
<li>后面查找的位置会覆盖前面的配置文件内容</li>
</ul>
<p>①classpath 根路径</p>
<p>②classpath 根路径下config目录</p>
<p>③jar包当前目录</p>
<p>④jar包当前目录的config目录</p>
<p>⑤&#x2F;config子目录的直接子目录(这一个只会在linux中生效)</p>
<p>3.配置文件的加载顺序</p>
<ul>
<li>后面加载的文件会覆盖前面的配置文件内容</li>
</ul>
<p>①当前jar包内部的application.properties和application.yml</p>
<p>②当前jar包内部的application-{profile}.properties 和 application-{profile}.yml</p>
<p>③引用的外部jar包的application.properties和application.yml</p>
<p>④引用的外部jar包的application-{profile}.properties 和 application-{profile}.yml</p>
<h3 id="自定义starter"><a href="#自定义starter" class="headerlink" title="自定义starter"></a>自定义starter</h3><ul>
<li><p>customize-spring-boot-starter</p>
</li>
<li><p>customize-spring-boot-starter-autoconfigurer</p>
<p>编写自动配置类 xxxAutoConfiguration -&gt; xxxxProperties</p>
<p>@Configuration</p>
<p>@Conditional</p>
<p>@EnableConfigurationProperties</p>
<p>@Bean</p>
</li>
</ul>
<h4 id="starter启动原理"><a href="#starter启动原理" class="headerlink" title="starter启动原理"></a>starter启动原理</h4><p>①starter场景引入了starter-autoconfigure依赖</p>
<p>①在每一次启动都会找到autoconfigure依赖中的META-INF&#x2F;spring.factories 文件中 </p>
<p>②根据这个文件的EnableAutoConfiguration的值，使得项目启动加载指定的自动配置类</p>
<p>③根据配置类的生效规则完成注入</p>
<p><font color='red'><strong>引入starter — xxxAutoConfiguration — 容器中放入组件 —- 绑定xxxProperties —- 配置项</strong></font></p>
<hr>
<h2 id="SpringBoot原理"><a href="#SpringBoot原理" class="headerlink" title="SpringBoot原理"></a>SpringBoot原理</h2><h3 id="启动过程"><a href="#启动过程" class="headerlink" title="启动过程"></a>启动过程</h3><p>①创建SpringApplication</p>
<ul>
<li><p>在启动过程会到spring.factories文件中查找这三个类</p>
<p>BootstrapRegistryInitializer(由于没有任何配置类注册这个组件，所有这里为0)</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X90C4J.png"></p>
<p>ApplicationContextInitializer</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X90Ajx.png"></p>
<p>ApplicationListener</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X90ZDK.png"></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.保存了主配置类的信息</span></span><br><span class="line"><span class="built_in">this</span>.primarySources = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(Arrays.asList(primarySources));</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.判断当前应用的类型，Servlet</span></span><br><span class="line"><span class="built_in">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.bootstrapRegistryInitializers：bootstrap注册表初始化引导器 (List&lt;BootstrapRegistryInitializer.&gt; )</span></span><br><span class="line"><span class="built_in">this</span>.bootstrapRegistryInitializers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(</span><br><span class="line">   <span class="comment">//实际就是在找每一个spring.factories中的org.springframework.boot.Bootstraper</span></span><br><span class="line">		getSpringFactoriesInstances(BootstrapRegistryInitializer.class));</span><br><span class="line"></span><br><span class="line"><span class="comment">//找ApplicationContextInitializer；找每一个spring.factories中的ApplicationContextInitializer</span></span><br><span class="line">		setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));</span><br><span class="line"></span><br><span class="line"><span class="comment">//找ApplicationListener;应用监听器；找每一个spring.factories中的ApplicationListener</span></span><br><span class="line">		setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br></pre></td></tr></table></figure>

<p>②运行SpringApplication</p>
<ul>
<li><p>在运行过程会到spring.factories文件中查找这个类</p>
<p>SpringApplicationRunListener</p>
<p><img src="https://s1.ax1x.com/2022/05/23/X90uUe.png"></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.记录应用启动的时间</span></span><br><span class="line"><span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.创建引导上下文</span></span><br><span class="line">createBootstrapContext()&#123;</span><br><span class="line">    <span class="comment">//创建一个默认的引导上下文环境</span></span><br><span class="line">    <span class="type">DefaultBootstrapContext</span> <span class="variable">bootstrapContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultBootstrapContext</span>();</span><br><span class="line"><span class="comment">//获取之前所有的bootstrappers逐个调用其内对应的方法</span></span><br><span class="line"><span class="built_in">this</span>.bootstrapRegistryInitializers.forEach((initializer) -&gt; initializer.initialize(bootstrapContext));</span><br><span class="line">		<span class="keyword">return</span> bootstrapContext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//让当前应用进入headless模式 java.awt.headless</span></span><br><span class="line"><span class="comment">//用于在缺失显示屏、鼠标或者键盘时的系统配置。</span></span><br><span class="line">configureHeadlessProperty();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取所有的运行监听器SpringApplicationRunListener</span></span><br><span class="line">getRunListeners(args)&#123;</span><br><span class="line">    <span class="comment">//每一个spring.factories中的SpringApplicationRunListener</span></span><br><span class="line">    <span class="comment">//这个方法的逻辑都是一样的，都是到spring.factories中找某个类型的组件</span></span><br><span class="line">   getSpringFactoriesInstances()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历获取的SpringApplicationRunListener调用其stating方法</span></span><br><span class="line"><span class="comment">//这个starting方法内部做了一个广播，遍历筛选合适的springApplicationListener</span></span><br><span class="line"><span class="comment">//循环调用springApplicationListener监听器的onApplicationEvent 方法</span></span><br><span class="line"><span class="comment">//相当于通知所有感兴趣系统正在启动过程的，项目正在 starting</span></span><br><span class="line">listeners.starting(bootstrapContext, <span class="built_in">this</span>.mainApplicationClass);</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存命令行参数</span></span><br><span class="line"><span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(args);</span><br><span class="line"></span><br><span class="line"><span class="comment">//准备应用的环境信息</span></span><br><span class="line">prepareEnvironment(listeners...)&#123;</span><br><span class="line">    <span class="comment">//返回或创建一个基础环境信息对象</span></span><br><span class="line">   <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> getOrCreateEnvironment();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//根据返回的环境信息对象对环境进行配置</span></span><br><span class="line">    <span class="comment">//在这个方法里读取所有的配置源的配置属性值(内部配置文件、外部配置文件)</span></span><br><span class="line">    configureEnvironment(environment, applicationArguments.getSourceArgs();</span><br><span class="line">                         </span><br><span class="line">    <span class="comment">//绑定环境信息</span></span><br><span class="line">	ConfigurationPropertySources.attach(environment);</span><br><span class="line">                         </span><br><span class="line">	<span class="comment">//遍历之前获取的监听器SpringApplicationRunListener挨个调用其environmentPrepared方法</span></span><br><span class="line">    <span class="comment">//这个environmentPrepared方法内部做了一个广播，遍历筛选合适的springApplicationListener                     </span></span><br><span class="line">    <span class="comment">//循环调用springApplicationListener监听器的onApplicationEvent 方法  </span></span><br><span class="line">    <span class="comment">//通知所有的SpringApplicationListener监听器当前环境准备已完成                        </span></span><br><span class="line">    listeners.environmentPrepared(bootstrapContext, environment);        </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//核心一步 创建ioc容器</span></span><br><span class="line"><span class="comment">//根据应用类型(Servlet)创建对应的容器类型</span></span><br><span class="line"><span class="comment">//应用类型(Servlet)会创建AnnotationConfigServletWebServerApplicationContext 的ioc容器                       </span></span><br><span class="line">context = createApplicationContext(); </span><br><span class="line">  </span><br><span class="line"><span class="comment">//准备ioc容器的基本信息                         </span></span><br><span class="line">prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner)&#123;</span><br><span class="line">    <span class="comment">//保存环境信息</span></span><br><span class="line">    context.setEnvironment(environment);</span><br><span class="line">    <span class="comment">//ioc容器的后置处理流程</span></span><br><span class="line">    postProcessApplicationContext(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//应用初始化applyInitializers</span></span><br><span class="line">    <span class="comment">//在这个方法里面遍历前面获取到的所有ApplicationContextInitializer</span></span><br><span class="line">    <span class="comment">//并执行每一个相应的initializer方法对ioc容器进行初始化扩展功能</span></span><br><span class="line">    applyInitializers(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//遍历之前获取的监听器SpringApplicationRunListener挨个调用其contextPrepared方法</span></span><br><span class="line">    <span class="comment">//这个environmentPrepared方法内部做了一个广播，遍历筛选合适的springApplicationListener                     </span></span><br><span class="line">    <span class="comment">//循环调用springApplicationListener监听器的onApplicationEvent 方法  </span></span><br><span class="line">    <span class="comment">//通知所有的SpringApplicationListener监听器当前contextPrepared已完成  </span></span><br><span class="line">    listeners.contextPrepared(context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//(同上操作)遍历之前获取的SpringApplicationRunListener挨个调用其contextLoaded方法</span></span><br><span class="line">    <span class="comment">//通知所有合适的监听器contextLoaded已完成</span></span><br><span class="line">    listeners.contextLoaded(context);    </span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//刷新ioc容器</span></span><br><span class="line">    <span class="comment">//里面执行的过程在spring注解驱动的源码中                     </span></span><br><span class="line">    refreshContext(context); </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//容器刷新完成后进行的一些后置工作                   </span></span><br><span class="line">   afterRefresh(context, applicationArguments);</span><br><span class="line">                         </span><br><span class="line">    <span class="comment">//所有监听器调用 listeners.started(context); 通知所有合适的监听器started已完成</span></span><br><span class="line">    listeners.started(context, timeTakenToStartup);</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//调用所有runners；callRunners()</span></span><br><span class="line">     callRunners(context, applicationArguments)&#123;</span><br><span class="line">        <span class="comment">//获取容器中的 ApplicationRunner  </span></span><br><span class="line">        runners.addAll(context.getBeansOfType(ApplicationRunner.class).values());</span><br><span class="line">        <span class="comment">//获取容器中的  CommandLineRunner</span></span><br><span class="line">		runners.addAll(context.getBeansOfType(CommandLineRunner.class).values());</span><br><span class="line">        <span class="comment">//合并所有runner并且按照@Order进行排序 </span></span><br><span class="line">         AnnotationAwareOrderComparator.sort(runners);</span><br><span class="line">         <span class="comment">//遍历所有的runner。调用 run 方法</span></span><br><span class="line">		<span class="keyword">for</span> (Object runner : <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(runners)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (runner <span class="keyword">instanceof</span> ApplicationRunner) &#123;</span><br><span class="line">				callRunner((ApplicationRunner) runner, args);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (runner <span class="keyword">instanceof</span> CommandLineRunner) &#123;</span><br><span class="line">				callRunner((CommandLineRunner) runner, args);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">     &#125;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">catch</span>&#123;                    </span><br><span class="line">    <span class="comment">//如果上述方法出现异常在try</span></span><br><span class="line">	<span class="comment">//调用合适的Listener的 failed</span></span><br><span class="line">	listeners.failed(context, exception);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果正常执行没出现任何异常</span></span><br><span class="line">	<span class="comment">//调用所有监听器的 ready方法</span></span><br><span class="line">	<span class="comment">//这一步的作用是通知所有合适的监听器ready已完成</span></span><br><span class="line">    listeners.ready(context, timeTakenToReady); </span><br><span class="line">	</span><br><span class="line">     <span class="keyword">try</span>&#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">catch</span>&#123;                     </span><br><span class="line">	<span class="comment">//ready方法如果出现异常。则继续调用所有合适的Listener的failed；</span></span><br><span class="line">	<span class="comment">//通知所有的监听器当前出现了异常failed失败了</span></span><br><span class="line">    &#125;</span><br><span class="line">                      </span><br></pre></td></tr></table></figure>

<h3 id="读取spring-factories的三个组件"><a href="#读取spring-factories的三个组件" class="headerlink" title="读取spring.factories的三个组件"></a>读取spring.factories的三个组件</h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-application-events-and-listeners">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-application-events-and-listeners</a></p>
<p>ApplicationContextInitializer</p>
<p>ApplicationListener</p>
<p>SpringApplicationRunListener</p>
<h3 id="容器中的两个runner"><a href="#容器中的两个runner" class="headerlink" title="容器中的两个runner"></a>容器中的两个runner</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 应用启动做一个一次性事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义CommandLineRunner... run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;自定义ApplicationRunner ... run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Year21</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://year21.top/2022/05/23/SpringBoot">http://year21.top/2022/05/23/SpringBoot</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xxxccc1986.github.io" target="_blank">Year 21's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2022/05/23/X9ra5D.png" data-sites="facebook,twitter,wechat,qq"></div><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/09/SpringByAnnotation/"><img class="prev-cover" src="https://w.wallhaven.cc/full/72/wallhaven-7278dy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Spring注解驱动</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/23/Volatile/"><img class="next-cover" src="https://w.wallhaven.cc/full/z8/wallhaven-z8751j.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Volatile关键字</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/07/25/ComputerStore/" title="SpringBoot+MyBatis+BootStrap3.0前后端不分离项目"><img class="cover" src="https://w.wallhaven.cc/full/x8/wallhaven-x8rgz3.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-25</div><div class="title">SpringBoot+MyBatis+BootStrap3.0前后端不分离项目</div></div></a></div><div><a href="/2022/07/07/ManagementSystem/" title="SpringBoot+Vue的前后端分离项目"><img class="cover" src="https://w.wallhaven.cc/full/k7/wallhaven-k7q797.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-07</div><div class="title">SpringBoot+Vue的前后端分离项目</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Year 21</div><div class="author-info__description">昨天   今天   明天</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxccc1986"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1483501858&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://t.me/year_21_xx" target="_blank" title="Telegram"><i class="fab fa-telegram"></i></a><a class="social-icon" href="mailto:masicjokersic@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一个不知名的初学者，欢迎指教。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot%E7%A8%8B%E5%BA%8F%E5%88%9B%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text">SpringBoot程序创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">SpringBoot特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">自动配置原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">1.5.</span> <span class="toc-text">开发小技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">2.</span> <span class="toc-text">核心功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web%E5%BC%80%E5%8F%91"><span class="toc-number">2.2.</span> <span class="toc-text">Web开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">2.2.1.</span> <span class="toc-text">静态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E7%9B%AE%E5%BD%95"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">静态资源的目录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5%E6%94%AF%E6%8C%81"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">欢迎页支持</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Favicon%E7%BD%91%E9%A1%B5%E5%A4%B4%E5%83%8F"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">自定义 Favicon网页头像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E7%BB%91%E5%AE%9A%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">静态资源配置绑定原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E7%9A%84%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">资源处理的默认规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5%E7%9A%84%E5%A4%84%E7%90%86%E8%A7%84%E5%88%99"><span class="toc-number">2.2.1.6.</span> <span class="toc-text">欢迎页的处理规则</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text">请求参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">请求映射原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SpringBoot%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">SpringBoot获取请求参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">请求参数处理原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Servlet-API"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">Servlet API</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">复杂参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0-%E5%B0%81%E8%A3%85Bean"><span class="toc-number">2.2.2.6.</span> <span class="toc-text">自定义类型参数 封装Bean</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.3.</span> <span class="toc-text">响应数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTPMessageConverter%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">HTTPMessageConverter原理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">2.2.4.</span> <span class="toc-text">内容协商</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">内容协商原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%82%E6%95%B0%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">开启浏览器参数内容协商功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89MessageConverter"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">自定义MessageConverter</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="toc-number">2.2.5.</span> <span class="toc-text">视图解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.2.6.</span> <span class="toc-text">模板引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">2.2.7.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">2.2.8.</span> <span class="toc-text">文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.2.9.</span> <span class="toc-text">异常处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Web%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%85%A5"><span class="toc-number">2.2.10.</span> <span class="toc-text">Web原生组件注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8"><span class="toc-number">2.2.11.</span> <span class="toc-text">嵌入式Servlet容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E5%8C%96%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.12.</span> <span class="toc-text">定制化原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-number">2.3.</span> <span class="toc-text">数据访问</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL"><span class="toc-number">2.3.1.</span> <span class="toc-text">SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Druid%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">2.3.2.</span> <span class="toc-text">Druid数据源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88MyBatis"><span class="toc-number">2.3.3.</span> <span class="toc-text">整合MyBatis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88MyBatis-plus"><span class="toc-number">2.3.4.</span> <span class="toc-text">整合MyBatis-plus</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88Redis"><span class="toc-number">2.3.5.</span> <span class="toc-text">整合Redis</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Junit%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.</span> <span class="toc-text">Junit单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E6%9C%BA%E5%88%B6"><span class="toc-number">2.4.1.</span> <span class="toc-text">断言机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.4.2.</span> <span class="toc-text">前置条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.3.</span> <span class="toc-text">嵌套测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.4.</span> <span class="toc-text">参数化测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="toc-number">2.5.</span> <span class="toc-text">指标监控</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBoot-Actuator"><span class="toc-number">2.5.1.</span> <span class="toc-text">SpringBoot Actuator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Health-Endpoint"><span class="toc-number">2.5.2.</span> <span class="toc-text">Health Endpoint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Metrics-Endpoint"><span class="toc-number">2.5.3.</span> <span class="toc-text">Metrics Endpoint</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Profile%E5%8A%9F%E8%83%BD"><span class="toc-number">2.6.</span> <span class="toc-text">Profile功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">2.7.</span> <span class="toc-text">外部化配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89starter"><span class="toc-number">2.8.</span> <span class="toc-text">自定义starter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#starter%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86"><span class="toc-number">2.8.1.</span> <span class="toc-text">starter启动原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">SpringBoot原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">启动过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96spring-factories%E7%9A%84%E4%B8%89%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">读取spring.factories的三个组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84%E4%B8%A4%E4%B8%AArunner"><span class="toc-number">3.3.</span> <span class="toc-text">容器中的两个runner</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/08/03/nginx/" title="Nginx"><img src="https://s1.ax1x.com/2022/08/03/vZbRFe.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx"/></a><div class="content"><a class="title" href="/2022/08/03/nginx/" title="Nginx">Nginx</a><time datetime="2022-08-03T13:45:02.000Z" title="发表于 2022-08-03 21:45:02">2022-08-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/30/RabbitMQ/" title="RabbitMQ"><img src="https://s1.ax1x.com/2022/07/30/vF9x2j.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RabbitMQ"/></a><div class="content"><a class="title" href="/2022/07/30/RabbitMQ/" title="RabbitMQ">RabbitMQ</a><time datetime="2022-07-30T13:30:02.000Z" title="发表于 2022-07-30 21:30:02">2022-07-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/25/ComputerStore/" title="SpringBoot+MyBatis+BootStrap3.0前后端不分离项目"><img src="https://w.wallhaven.cc/full/x8/wallhaven-x8rgz3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot+MyBatis+BootStrap3.0前后端不分离项目"/></a><div class="content"><a class="title" href="/2022/07/25/ComputerStore/" title="SpringBoot+MyBatis+BootStrap3.0前后端不分离项目">SpringBoot+MyBatis+BootStrap3.0前后端不分离项目</a><time datetime="2022-07-25T14:53:30.000Z" title="发表于 2022-07-25 22:53:30">2022-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/07/DeployPersonalProjectsOnLinux/" title="如何在Linux上部署个人项目？"><img src="https://w.wallhaven.cc/full/d5/wallhaven-d59deo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何在Linux上部署个人项目？"/></a><div class="content"><a class="title" href="/2022/07/07/DeployPersonalProjectsOnLinux/" title="如何在Linux上部署个人项目？">如何在Linux上部署个人项目？</a><time datetime="2022-07-07T15:56:30.000Z" title="发表于 2022-07-07 23:56:30">2022-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/07/ManagementSystem/" title="SpringBoot+Vue的前后端分离项目"><img src="https://w.wallhaven.cc/full/k7/wallhaven-k7q797.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot+Vue的前后端分离项目"/></a><div class="content"><a class="title" href="/2022/07/07/ManagementSystem/" title="SpringBoot+Vue的前后端分离项目">SpringBoot+Vue的前后端分离项目</a><time datetime="2022-07-07T15:20:16.000Z" title="发表于 2022-07-07 23:20:16">2022-07-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s1.ax1x.com/2022/05/23/X9ra5D.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 By Year 21</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">心之所向，皆可抵达</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://jsdelivr.pai233.top/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://jsdelivr.pai233.top/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'FdeA2Fr167tRipdBpVUi0fvz-gzGzoHsz',
      appKey: 'roCcb1ljCCFK13sNVcwK4VJi',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://jsdelivr.pai233.top/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="6712227171" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(d, w, c) {
    w.ChatraID = 'Z2tPHYia3jhnSPJ3K';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.js"></script><script src="https://jsdelivr.pai233.top/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://jsdelivr.pai233.top/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>