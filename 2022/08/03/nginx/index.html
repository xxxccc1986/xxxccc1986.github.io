<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Nginx | Year 21's Blog</title><meta name="keywords" content="Nginx"><meta name="author" content="Year 21"><meta name="copyright" content="Year 21"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="nginx介绍1.nginx的概念 nginx专为性能优化而开发，它也是高性能的 HTTP 和反向代理的服务器，处理高并发的能力非常好 2.正向&#x2F;反向代理 正向代理代理的对象是客户端，反向代理代理的对象是服务端 3.负载均衡 将从客户端发来的请求分发到多个服务器上，将原先请求集中到单个服务器上的情况 改为将请求分发到多个服务器上，将负载分发到不同的服务器  负载均衡的体现  4.动静分离">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx">
<meta property="og:url" content="http://xxxccc1986.github.io/2022/08/03/nginx/index.html">
<meta property="og:site_name" content="Year 21&#39;s Blog">
<meta property="og:description" content="nginx介绍1.nginx的概念 nginx专为性能优化而开发，它也是高性能的 HTTP 和反向代理的服务器，处理高并发的能力非常好 2.正向&#x2F;反向代理 正向代理代理的对象是客户端，反向代理代理的对象是服务端 3.负载均衡 将从客户端发来的请求分发到多个服务器上，将原先请求集中到单个服务器上的情况 改为将请求分发到多个服务器上，将负载分发到不同的服务器  负载均衡的体现  4.动静分离">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2022/08/03/vZbRFe.png">
<meta property="article:published_time" content="2022-08-03T13:45:02.000Z">
<meta property="article:modified_time" content="2022-08-03T13:45:02.000Z">
<meta property="article:author" content="Year 21">
<meta property="article:tag" content="Nginx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/08/03/vZbRFe.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xxxccc1986.github.io/2022/08/03/nginx/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Year 21","link":"链接: ","source":"来源: Year 21's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nginx',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-08-03 21:45:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">38</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2022/08/03/vZbRFe.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Year 21's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-03T13:45:02.000Z" title="发表于 2022-08-03 21:45:02">2022-08-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-03T13:45:02.000Z" title="更新于 2022-08-03 21:45:02">2022-08-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Nginx"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="nginx介绍"><a href="#nginx介绍" class="headerlink" title="nginx介绍"></a>nginx介绍</h1><p>1.nginx的概念</p>
<p>nginx专为性能优化而开发，它也是高性能的 HTTP 和反向代理的服务器，处理高并发的能力非常好</p>
<p>2.正向&#x2F;反向代理</p>
<p><font color='red'><strong>正向代理</strong></font>代理的对象是客户端，<font color='red'><strong>反向代理</strong></font>代理的对象是服务端</p>
<p>3.负载均衡</p>
<p><font color='red'><strong>将从客户端发来的请求分发到多个服务器上</strong></font>，将原先请求集中到单个服务器上的情况</p>
<p>改为将请求分发到多个服务器上，将负载分发到不同的服务器</p>
<ul>
<li>负载均衡的体现<img src="https://s1.ax1x.com/2022/08/03/vZHjr6.png"></li>
</ul>
<p>4.动静分离</p>
<p>动静分离简单来说就是将动态请求和静态请求进行分开，把动态页面和静态页面的请求由不同的</p>
<p>服务器来解析，加快解析速度，以降低原来单个服务器的压力</p>
<p><img src="https://s1.ax1x.com/2022/08/03/vZHvqK.png"></p>
<hr>
<h1 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h1><p>1.进入nginx官网  –&gt;  <a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">官方下载网址</a></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//安装nginx之前需要先安装相关的依赖和库</span><br><span class="line">yum -y install gcc-c++ zlib-devel openssl-devel libtool</span><br><span class="line"></span><br><span class="line">//进入usr/local目录</span><br><span class="line">cd /usr/local</span><br><span class="line"></span><br><span class="line">//通过命令下载nginx安装包</span><br><span class="line">wget http://nginx.org/download/nginx-1.22.0.tar.gz</span><br><span class="line"></span><br><span class="line">//解压nginx安装包</span><br><span class="line">//z是解压的工具，v是显示解压的信息，x是解压操作，f指定解压缩文件</span><br><span class="line">tar -zxvf nginx-1.22.0.tar.gz</span><br><span class="line"></span><br><span class="line">//删除nginx安装包 可选择的</span><br><span class="line">rm -rf nginx-1.22.0.tar.gz</span><br><span class="line"></span><br><span class="line">//进入nginx目录</span><br><span class="line">cd /usr/local/nginx-1.22.0</span><br><span class="line"></span><br><span class="line">//配置nginx</span><br><span class="line">./configure --prefix=/usr/local/nginx</span><br><span class="line"></span><br><span class="line">//安装nginx</span><br><span class="line">make <span class="built_in">&amp;</span><span class="built_in">&amp;</span> make install</span><br><span class="line"></span><br><span class="line">//返回上级目录就能看到一个nginx文件夹所有东西都安装在这个文件夹中</span><br><span class="line">//此时可以将之前解压出来的文件夹删除掉</span><br><span class="line">rm -rf nginx-1.22.0</span><br><span class="line"></span><br><span class="line">//进入/usr/local/nginx/sbin目录，输入./nginx即可启动nginx</span><br><span class="line">./nginx</span><br><span class="line"></span><br><span class="line">//通过命令查看是否启动</span><br><span class="line">ps -ef |grep nginx</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="使用nginx"><a href="#使用nginx" class="headerlink" title="使用nginx"></a>使用nginx</h1><h2 id="nginx常用命令"><a href="#nginx常用命令" class="headerlink" title="nginx常用命令"></a>nginx常用命令</h2><ul>
<li><font color='red'><strong>使用nginx的命令前提是必须进入nginx的&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin目录</strong></font></li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.查看nginx的版本</span><br><span class="line">./nginx -v</span><br><span class="line">2.启动nginx </span><br><span class="line">./nginx </span><br><span class="line">3.关闭nginx</span><br><span class="line">./nginx -s stop</span><br><span class="line">4.重启nginx</span><br><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>

<h2 id="nginx配置文件"><a href="#nginx配置文件" class="headerlink" title="nginx配置文件"></a>nginx配置文件</h2><ul>
<li><font color='red'><strong>nginx配置文件的位置个人习惯安装在此位置&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</strong></font></li>
</ul>
<p>1.nginx的配置文件由三部分组成</p>
<p>①全局块</p>
<p>从配置文件开始到 events 块之间的内容，主要会设置一些<font color='red'><strong>影响 nginx 服务器整体运行的配置指令</strong></font>，</p>
<p>主要包括配置运行Nginx服务器的用户（组）、允许生成的 worker process 数，进程PID存放路径、</p>
<p>日志存放路径和类型以及配置文件的引入等。</p>
<p>worker_processes  1; Nginx并发处理服务的关键配置，值越大，其并发处理能力越强</p>
<p>②event块</p>
<p>events 块涉及的指令主要影响 Nginx 服务器与用户的网络连接</p>
<p>worker_connections  1024; 表示每个 work process 支持的最大连接数为 1024.</p>
<p>③http块</p>
<ul>
<li>代理、缓存和日志定义等大部分功能都在这里配置。且http块又包括http 全局块、server 块。</li>
</ul>
<p>Ⅰ.http全局块内容包括文件引入、MIME-TYPE 定义、日志自定义、连接超时时间、单链接请求数上限等。</p>
<p>Ⅱ.server 块</p>
<ul>
<li><p>每个 http 块可以包括多个 server 块，而每个 server 块就相当于一个虚拟主机。</p>
</li>
<li><p>而每个 server 块也分为全局 server 块，以及可以同时包含多个 locaton 块。</p>
</li>
</ul>
<p>全局 server 块</p>
<p> 最常见的配置是本虚拟机主机的监听配置和本虚拟主机的名称或 IP 配置。</p>
<p>location 块</p>
<p> 一个 server 块可以配置多个 location 块。</p>
<p> 这块的主要作用是基于 Nginx 服务器接收到的请求字符串（例如 server_name&#x2F;uri-string），</p>
<p>对虚拟主机名称（也可以是 IP 别名）之外的字符串（例如 前面的 &#x2F;uri-string）进行匹配，</p>
<p>对特定的请求进行处理。地址定向、数据缓存和应答控制等功能，还有许多第三方模块的配置。</p>
<h2 id="nginx配置实例"><a href="#nginx配置实例" class="headerlink" title="nginx配置实例"></a>nginx配置实例</h2><p>准备工作：下载tomcat与jdk(暂时使用默认内置的jdk)</p>
<ul>
<li>tomcat的安装与使用</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.安装tomcat(两种方式)</span><br><span class="line">方式一：通过官网下载 https://tomcat.apache.org/ 下载对应的tar.gz版本</span><br><span class="line">方式二：wget  https://mirror.bit.edu.cn/apache/tomcat/tomcat-9/v9.0.39/bin/apache-tomcat-9.0.39.tar.gz</span><br><span class="line">2.解压下载的tar压缩包</span><br><span class="line">tar -zxvf apache-tomcat-9.0.65.tar.gz </span><br><span class="line">3.删除tar压缩包</span><br><span class="line">rm -rf apache-tomcat-9.0.65.tar.gz </span><br><span class="line">4.移动指指定文件夹并重命名</span><br><span class="line">mv apache-tomcat-9.0.65/ /opt/tomcat</span><br><span class="line">5.启动tomcat，先进入bin目录</span><br><span class="line">cd /opt/tomcat/bin</span><br><span class="line">./startup.sh</span><br><span class="line">6.返回上一级目录进入logs目录，可以查看启动日志</span><br><span class="line">tail -f catalina.out </span><br></pre></td></tr></table></figure>

<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>1.示例一 使用 nginx 反向代理，访问 test.dzsc.tk 直接跳转到 127.0.0.1:8080</p>
<p><img src="https://s1.ax1x.com/2022/08/03/vZbSaD.png" alt="请求过程"></p>
<p>在nginx.conf设置反向代理配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    root   html;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">    proxy_pass http:<span class="comment">//localhost:8080;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.示例二 使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中</p>
<p>nginx 监听端口为 9001，</p>
<p>访问 <a target="_blank" rel="noopener" href="http://localhost:9001/edu/">http://localhost:9001/edu/</a> 直接跳转到 localhost:8080</p>
<p>访问 <a target="_blank" rel="noopener" href="http://localhost:9001/vod/">http://localhost:9001/vod/</a> 直接跳转到 localhost:8081</p>
<ul>
<li>需要准备两个tomcat(与前面tomcat安装一样)以及两个页面</li>
</ul>
<p>在nginx.conf设置反向代理配置</p>
<p><font color='red'><strong>需要注意的是所有端口都需要在防火墙进行开放</strong></font></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       9001;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location /edu/ &#123;</span><br><span class="line">            proxy_pass http://localhost:8080;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /vod/ &#123;</span><br><span class="line">            proxy_pass http://localhost:8081;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>location 指令说明</strong> </p>
<p> 该指令用于匹配 URL。</p>
<p> 语法如下：location [&#x3D; | ~ | <del>* | ^</del> ] uri {}</p>
<p>1、&#x3D; ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配</p>
<p>成功，就停止继续向下搜索并立即处理该请求。</p>
<p> 2、~：用于表示 uri 包含正则表达式，并且区分大小写。</p>
<p> 3、~*：用于表示 uri 包含正则表达式，并且不区分大小写。</p>
<p> 4、^~：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字</p>
<p>符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location </p>
<p>块中的正则 uri 和请求字符串做匹配。</p>
<p> 注意：如果 uri 包含正则表达式，则必须要有 ~ 或者 ~* 标识。</p>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>1.示例一</p>
<p>浏览器地址栏输入地址 <a target="_blank" rel="noopener" href="http://localhost/edu/a.html">http://localhost/edu/a.html</a> ，负载均衡效果，平均8080和8081端口中</p>
<p>在 nginx 的配置文件中进行负载均衡的配置</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//myserver就是自定义的一个服务名，对外暴露服务，而服务下有两台机器，自动实现轮询访问</span><br><span class="line">upstream myserver&#123;</span><br><span class="line">		ip_hash;</span><br><span class="line">        server localhost:8080 weight=2;</span><br><span class="line">        server localhost:8081 weghit=1;</span><br><span class="line">        fair;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://myserver;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>nginx分配服务器策略</li>
</ul>
<p>第一种 轮询（默认）</p>
<p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</p>
<p>第二种weight</p>
<p>weight代表权重默认为1,权重越高被分配的客户端越多</p>
<p>第三种ip_hash</p>
<p>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器</p>
<p>第四种fair（第三方）</p>
<p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
<h3 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h3><ul>
<li>动静分离示意</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/08/03/vZbpIe.png"></p>
<p>通过 location 指定不同的后缀名实现不同的请求转发。通过 expires 参数设置，可以使浏</p>
<p>览器缓存过期时间，减少与服务器之前的请求和流量。具体 Expires 定义：是给一个资源</p>
<p>设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，</p>
<p>所以不会产生额外的流量。此种方法非常适合不经常变动的资源。（如果经常更新的文件，</p>
<p>不建议使用 Expires 来缓存），我这里设置 3d，表示在这 3 天之内访问这个 URL，发送一个</p>
<p>请求，比对服务器该文件最后更新时间没有变化，则不会从服务器抓取，返回状态码 304，</p>
<p>如果有修改，则直接从服务器重新下载，返回状态码 200。</p>
<ul>
<li><p>在nginx.conf设置动静分离配置</p>
<p> autoindex on;这个设置会在访问&#x2F;image&#x2F;页面时列出文件夹中的所有资源内容</p>
</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location /www/ &#123;</span><br><span class="line">           root   /data/;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"> location /image/ &#123;</span><br><span class="line">           root   /data/;</span><br><span class="line">           autoindex on;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<h3 id="高可用集群"><a href="#高可用集群" class="headerlink" title="高可用集群"></a>高可用集群</h3><p><strong>高可用集群解决的问题是什么？当只有一台nginx服务器时，宕机后会导致所有请求失败</strong></p>
<p><img src="https://s1.ax1x.com/2022/08/03/vZbCPH.png"></p>
<ul>
<li>配置高可用集群步骤</li>
</ul>
<p>①使用两台服务器安装两台nginx</p>
<p>②安装keepalived 	yum install keepalived –y</p>
<p>​	查看keepalived版本	rpm -q -a keepalived</p>
<p>安装之后，在etc里面生成目录keepalived，有文件 keepalived.conf</p>
<p>③完成高可用的文件配置(主从配置)</p>
<p>修改&#x2F;etc&#x2F;keepalived&#x2F;keepalivec.conf配置文件</p>
<p>并在当前目录下执行 chmod 644 keepalived.conf 给予权限</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 全局定义</span><br><span class="line">global_defs &#123;</span><br><span class="line">  notification_email &#123;</span><br><span class="line">    acassen@firewall.loc</span><br><span class="line">    failover@firewall.loc</span><br><span class="line">    sysadmin@firewall.loc</span><br><span class="line">  &#125;</span><br><span class="line">  notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">  smtp_server 192.168.231.134</span><br><span class="line">  smtp_connect_timeout 30</span><br><span class="line">  # 路由id</span><br><span class="line">  router_id LVS_DEVEL</span><br><span class="line">  # 设置运行脚本默认用户和组。如果没有指定，则默认用户为keepalived_script(需要该用户存在)，否则为root用户。默认groupname同username</span><br><span class="line">  script_user root</span><br><span class="line">  # 如果脚本路径的任一部分对于非root用户来说，都具有可写权限，则不会以root身份运行脚本</span><br><span class="line">  enable_script_security</span><br><span class="line">&#125;</span><br><span class="line"># 检测Nginx是否还存活的脚本</span><br><span class="line">vrrp_script check_nginx &#123;</span><br><span class="line">  # 脚本文件的位置</span><br><span class="line">  script &quot;/usr/local/src/nginx_check.sh&quot;</span><br><span class="line">  interval 2 # 检测脚本执行的间隔</span><br><span class="line">  weight 2 # 设置当服务器的权重</span><br><span class="line">&#125;</span><br><span class="line"># 虚拟IP的配置</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">  state MASTER # 表示当前服务器是MASTER还是BACKUP</span><br><span class="line">  interface ens33 # 绑定的网卡名称</span><br><span class="line">  virtual_router_id 51 # 主、备机的virtual_router_id必须相同</span><br><span class="line">  priority 100 # 主、备机取不同的优先级，主机值较大，备份机值较小</span><br><span class="line">  advert_int 1 # 每隔多久发送一次心跳，默认是1秒</span><br><span class="line">  # 权限校验</span><br><span class="line">  authentication &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass 1111</span><br><span class="line">  &#125;</span><br><span class="line">  # 虚拟IP地址</span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">    192.168.231.150</span><br><span class="line">  &#125;</span><br><span class="line">  # 指定监控脚本</span><br><span class="line">  track_script &#123;</span><br><span class="line">    # 这里的check_nginx对应上面的vrrp_script的名字</span><br><span class="line">    check_nginx</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在&#x2F;usr&#x2F;local&#x2F;src 添加检测脚本</p>
<p>并在当前目录下执行 chmod 744 &#x2F;usr&#x2F;local&#x2F;src&#x2F;nginx_check.sh 给予权限</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then</span><br><span class="line">  /usr/local/nginx/sbin/nginx</span><br><span class="line">  sleep 2</span><br><span class="line">  if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then</span><br><span class="line">    systemctl stop keepalived</span><br><span class="line">  fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>④把两台服务器上nginx和keepalived启动</p>
<p>启动nginx：.&#x2F;nginx</p>
<p>启动keepalived：systemctl start keepalived.service</p>
<hr>
<h1 id="nginx原理"><a href="#nginx原理" class="headerlink" title="nginx原理"></a>nginx原理</h1><ul>
<li>master的工作流程</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/08/03/vZbPGd.png"></p>
<ul>
<li>worker的工作流程</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/08/03/vZbiRA.png"></p>
<ul>
<li>一个master和多个woker的好处</li>
</ul>
<p>①可以使用nginx –s reload热部署，利用nginx进行热部署操作</p>
<p>②每个woker是独立的进程，如果有其中的一个woker出现问题，其他woker独立的，</p>
<p>​	继续进行争抢，实现请求过程，不会造成服务中断</p>
<ul>
<li><p>worker数和服务器的cpu数相等是最合适的</p>
</li>
<li><p>发送请求，占用了 woker 的2 或者 4 个连接数(worker_connection)</p>
</li>
</ul>
<p>①请求的是静态资源的话nginx会直接请求静态资源服务器，一来一回只需要2个连接数</p>
<p>②而如果请求的是非静态以及涉及数据库查询，因为work是不支持java的，就需要</p>
<p>再发送请求到tomcat，一来一回又多占用2个请求，所以是4个连接数</p>
<ul>
<li>nginx有一个master，有多个woker，每个woker支持最大连接数为1024，则最大并发数是？</li>
</ul>
<p>普通的静态访问最大并发数是： worker_connections * worker_processes &#x2F;2</p>
<p>如果是HTTP作 为反向代理那最大并发数量是 worker_connections * worker_processes&#x2F;4</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Year21</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://year21.top/2022/08/03/nginx">http://year21.top/2022/08/03/nginx</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xxxccc1986.github.io" target="_blank">Year 21's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Nginx/">Nginx</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2022/08/03/vZbRFe.png" data-sites="facebook,twitter,wechat,qq"></div><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/07/30/RabbitMQ/"><img class="prev-cover" src="https://s1.ax1x.com/2022/07/30/vF9x2j.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">RabbitMQ</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/17/centos/"><img class="next-cover" src="https://w.wallhaven.cc/full/rd/wallhaven-rdkjx1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Centos7安装工具</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Year 21</div><div class="author-info__description">昨天   今天   明天</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">38</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxccc1986"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1483501858&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://t.me/year_21_xx" target="_blank" title="Telegram"><i class="fab fa-telegram"></i></a><a class="social-icon" href="mailto:masicjokersic@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一个不知名的初学者，欢迎指教。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#nginx%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">nginx介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nginx"><span class="toc-number">2.</span> <span class="toc-text">安装nginx</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8nginx"><span class="toc-number">3.</span> <span class="toc-text">使用nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">nginx常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">nginx配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.3.</span> <span class="toc-text">nginx配置实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">3.3.1.</span> <span class="toc-text">反向代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">3.3.2.</span> <span class="toc-text">负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB"><span class="toc-number">3.3.3.</span> <span class="toc-text">动静分离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4"><span class="toc-number">3.3.4.</span> <span class="toc-text">高可用集群</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nginx%E5%8E%9F%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">nginx原理</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/10/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"><img src="https://w.wallhaven.cc/full/57/wallhaven-57o9v3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式"/></a><div class="content"><a class="title" href="/2022/10/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式">设计模式</a><time datetime="2022-10-10T04:12:02.000Z" title="发表于 2022-10-10 12:12:02">2022-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/DeploySpringCloudOnLinux/" title="如何在Linux上部署SpringCloud项目？"><img src="https://w.wallhaven.cc/full/9m/wallhaven-9m5y98.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何在Linux上部署SpringCloud项目？"/></a><div class="content"><a class="title" href="/2022/09/14/DeploySpringCloudOnLinux/" title="如何在Linux上部署SpringCloud项目？">如何在Linux上部署SpringCloud项目？</a><time datetime="2022-09-14T13:50:02.000Z" title="发表于 2022-09-14 21:50:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/OnlineEducation/" title="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目"><img src="https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目"/></a><div class="content"><a class="title" href="/2022/09/14/OnlineEducation/" title="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目">SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目</a><time datetime="2022-09-14T13:45:02.000Z" title="发表于 2022-09-14 21:45:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/" title="其他技术"><img src="https://w.wallhaven.cc/full/9m/wallhaven-9m3v7d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="其他技术"/></a><div class="content"><a class="title" href="/2022/09/14/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/" title="其他技术">其他技术</a><time datetime="2022-09-14T13:33:02.000Z" title="发表于 2022-09-14 21:33:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" title="前端技术"><img src="https://w.wallhaven.cc/full/rd/wallhaven-rdv95q.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端技术"/></a><div class="content"><a class="title" href="/2022/09/14/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" title="前端技术">前端技术</a><time datetime="2022-09-14T13:13:02.000Z" title="发表于 2022-09-14 21:13:02">2022-09-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s1.ax1x.com/2022/08/03/vZbRFe.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 By Year 21</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">心之所向，皆可抵达</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://jsdelivr.pai233.top/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://jsdelivr.pai233.top/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'FdeA2Fr167tRipdBpVUi0fvz-gzGzoHsz',
      appKey: 'roCcb1ljCCFK13sNVcwK4VJi',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://jsdelivr.pai233.top/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="6712227171" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(d, w, c) {
    w.ChatraID = 'Z2tPHYia3jhnSPJ3K';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.js"></script><script src="https://jsdelivr.pai233.top/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://jsdelivr.pai233.top/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>