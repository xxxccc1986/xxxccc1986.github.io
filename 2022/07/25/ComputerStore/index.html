<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SpringBoot+MyBatis+BootStrap3.0前后端不分离项目 | Year 21's Blog</title><meta name="keywords" content="SpringBoot BootStrap"><meta name="author" content="Year 21"><meta name="copyright" content="Year 21"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前置介绍 项目介绍：基于SpringBoot+Mybatis+BootStrap3.0前后端不分离的项目  项目功能 ： ①登录、注册、集成kaptcha验证码防止机器人，以及用户管理(用户信息的修改)   ②分页处理展示商品信息、支持通过模糊搜索查找相关商品 ③购物车相关功能管理(如购物车商品的展示和结算)  ④订单管理页面可以查看不同状态订单以及集成了支付宝沙箱模拟商品支付全过程 ⑤收藏界面同">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot+MyBatis+BootStrap3.0前后端不分离项目">
<meta property="og:url" content="http://xxxccc1986.github.io/2022/07/25/ComputerStore/index.html">
<meta property="og:site_name" content="Year 21&#39;s Blog">
<meta property="og:description" content="前置介绍 项目介绍：基于SpringBoot+Mybatis+BootStrap3.0前后端不分离的项目  项目功能 ： ①登录、注册、集成kaptcha验证码防止机器人，以及用户管理(用户信息的修改)   ②分页处理展示商品信息、支持通过模糊搜索查找相关商品 ③购物车相关功能管理(如购物车商品的展示和结算)  ④订单管理页面可以查看不同状态订单以及集成了支付宝沙箱模拟商品支付全过程 ⑤收藏界面同">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://w.wallhaven.cc/full/x8/wallhaven-x8rgz3.png">
<meta property="article:published_time" content="2022-07-25T14:53:30.000Z">
<meta property="article:modified_time" content="2022-07-25T14:53:30.000Z">
<meta property="article:author" content="Year 21">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="BootStrap">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/x8/wallhaven-x8rgz3.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xxxccc1986.github.io/2022/07/25/ComputerStore/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Year 21","link":"链接: ","source":"来源: Year 21's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://jsdelivr.pai233.top/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot+MyBatis+BootStrap3.0前后端不分离项目',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-07-25 22:53:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://w.wallhaven.cc/full/x8/wallhaven-x8rgz3.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Year 21's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot+MyBatis+BootStrap3.0前后端不分离项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-25T14:53:30.000Z" title="发表于 2022-07-25 22:53:30">2022-07-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-25T14:53:30.000Z" title="更新于 2022-07-25 22:53:30">2022-07-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE/">个人项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">29.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>129分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot+MyBatis+BootStrap3.0前后端不分离项目"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="前置介绍"><a href="#前置介绍" class="headerlink" title="前置介绍"></a>前置介绍</h2><ul>
<li><p>项目介绍：基于SpringBoot+Mybatis+BootStrap3.0前后端不分离的项目</p>
</li>
<li><p>项目功能 ：</p>
<p>①登录、注册、集成kaptcha验证码防止机器人，以及用户管理(用户信息的修改)  </p>
<p>②分页处理展示商品信息、支持通过模糊搜索查找相关商品</p>
<p>③购物车相关功能管理(如购物车商品的展示和结算) </p>
<p>④订单管理页面可以查看不同状态订单以及集成了支付宝沙箱模拟商品支付全过程</p>
<p>⑤收藏界面同样实现分页展示用户收藏商品信息，以及加入收藏、取消收藏和加入购物车</p>
<p>⑥对全部业务方法使用aop拦截计算业务执行时间，为后续优化提供支持</p>
</li>
</ul>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>基本环境：</p>
<p>1.jdk 1.8</p>
<p>2.maven 3.6.2</p>
<p>3.数据库 mysql 8.0.26</p>
<p>4.集成开发环境 IDEA2020</p>
<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS `computer_store` CHARACTER SET &#x27;utf8&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_user (</span><br><span class="line">	uid INT AUTO_INCREMENT COMMENT &#x27;用户id&#x27;,</span><br><span class="line">	username VARCHAR(20) NOT NULL UNIQUE COMMENT &#x27;用户名&#x27;,</span><br><span class="line">	password CHAR(32) NOT NULL COMMENT &#x27;密码&#x27;,</span><br><span class="line">	salt CHAR(36) COMMENT &#x27;盐值&#x27;,</span><br><span class="line">	phone VARCHAR(20) COMMENT &#x27;电话号码&#x27;,</span><br><span class="line">	email VARCHAR(30) COMMENT &#x27;电子邮箱&#x27;,</span><br><span class="line">	gender INT COMMENT &#x27;性别:0-女，1-男&#x27;,</span><br><span class="line">	avatar VARCHAR(50) COMMENT &#x27;头像&#x27;,</span><br><span class="line">	is_delete INT COMMENT &#x27;是否删除：0-未删除，1-已删除&#x27;,</span><br><span class="line">	created_user VARCHAR(20) COMMENT &#x27;日志-创建人&#x27;,</span><br><span class="line">	created_time DATETIME COMMENT &#x27;日志-创建时间&#x27;,</span><br><span class="line">	modified_user VARCHAR(20) COMMENT &#x27;日志-最后修改执行人&#x27;,</span><br><span class="line">	modified_time DATETIME COMMENT &#x27;日志-最后修改时间&#x27;,</span><br><span class="line">	PRIMARY KEY (uid)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>考虑到每个表中都有固定的四个字段，重复写过于麻烦，因此可以使用一个Java基类来对应这四个字段</strong></li>
</ul>
<h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用于与数据表四个字段形成映射关系的基类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;<span class="comment">//为了便于数据传输，实现序列化接口</span></span><br><span class="line">    <span class="keyword">private</span> String createdUser;</span><br><span class="line">    <span class="keyword">private</span> Date createdTime;</span><br><span class="line">    <span class="keyword">private</span> String modifiedUser;</span><br><span class="line">    <span class="keyword">private</span> Date modifiedTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对应数据表的User实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String salt; <span class="comment">//用于加密密码</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;<span class="comment">//&#x27;性别:0-女，1-男&#x27;,</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="keyword">private</span> Integer isDelete;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><h4 id="后端-持久层"><a href="#后端-持久层" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><ul>
<li><strong>通过MyBatis框架与数据库进行交互</strong></li>
</ul>
<p>1.编写sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#增加用户的sql语句</span><br><span class="line">insert into t_user(username,password) vaules(?,?);</span><br><span class="line"></span><br><span class="line">#判断用户名是否已存在的语句</span><br><span class="line">select * from t_user where username = ?;</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口和抽象方法</p>
<p>由于项目可能有多个mapper接口，因此在项目的目录结构下创建一个mapper的包，用于管理所有的mapper接口，</p>
<p>并在springboot启动类上使用@MapperScan注解扫描此包下的所有mapper接口或直接在接口上使用@Mapper注解。</p>
<p>以便在项目启动的时间把mapper扫描进容器中，交由spring容器管理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//User实体类对应的mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">//用户注册</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据用户名查询用户信息</span></span><br><span class="line">    User <span class="title function_">queryUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.编写映射文件</p>
<p>项目可能有多个mapper映射文件，必须在项目目录结构resource文件下创建一个mapper的包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.year21.computerstore.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- int addUser(@Param(&quot;user&quot;) User user); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> &gt;</span></span><br><span class="line">        insert into t_user(</span><br><span class="line">                        username,password,salt,phone,email,gender,avatar,is_delete,</span><br><span class="line">                        created_user,created_time,modified_user,modified_time</span><br><span class="line">                        )</span><br><span class="line">                        values (</span><br><span class="line">                        #&#123;username&#125;,#&#123;password&#125;,#&#123;salt&#125;,#&#123;phone&#125;,#&#123;email&#125;,</span><br><span class="line">                        #&#123;gender&#125;,#&#123;avatar&#125;,#&#123;isDelete&#125;,</span><br><span class="line">                        #&#123;createdUser&#125;,#&#123;createdTime&#125;,#&#123;modifiedUser&#125;,#&#123;modifiedTime&#125;</span><br><span class="line">                                )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 询的结果集字段和实体类的user属性名不一致，自定义查询结果集的映射规则   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;queryUser&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;salt&quot;</span> <span class="attr">column</span>=<span class="string">&quot;salt&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;avatar&quot;</span> <span class="attr">column</span>=<span class="string">&quot;avatar&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;isDelete&quot;</span> <span class="attr">column</span>=<span class="string">&quot;is_delete&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;createdUser&quot;</span> <span class="attr">column</span>=<span class="string">&quot;created_user&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;createdTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;created_time&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;modifiedUser&quot;</span> <span class="attr">column</span>=<span class="string">&quot;modified_user&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;modifiedTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;modified_time&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--   User queryUserByUsername(@Param(&quot;username&quot;) String username); --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  用于查询的结果集字段和实体类的user属性名不一致，所以不能使用resultType，必须使用resultMap  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserByUsername&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;queryUser&quot;</span>&gt;</span></span><br><span class="line">            select * from t_user  where username = #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.将mapper映射文件的位置在yml配置文件中进行对应的设置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<p>5.进行单元测试（每个 的完成建议都进行单元测试）</p>
<h4 id="后端-业务层"><a href="#后端-业务层" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>业务层的包下主要有exception、impl、接口，其中exception放置各种异常处理类，impl中放置接口的实现类</p>
<p>1.规划异常处理机制</p>
<p>考虑到在后端处理业务的过程中，会出现各种异常情况，如执行过程中数据库宕机、用户名重复等。</p>
<p>虽然java在异常处理机制已经很完善，以上的情况都是抛出RuntimeException异常，对定位异常不够明确。</p>
<p>因此在业务层的制定中，需要考虑对异常的定义处理。</p>
<p>在业务层制定一个继承RuntimeException异常的异常类，再让具体的异常继承这个异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//专用于处理业务层的异常基类</span></span><br><span class="line"><span class="comment">//e.g. throws new ServiceException(&quot;业务层出现异常&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServiceException</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">ServiceException</span><span class="params">(String message, Throwable cause, <span class="type">boolean</span> enableSuppression, <span class="type">boolean</span> writableStackTrace)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause, enableSuppression, writableStackTrace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>根据业务层不同的 来详细定义具体异常的类型，统一的继承ServiceException异常基类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表示用户名重复的异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsernameDuplicateException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UsernameDuplicateException</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UsernameDuplicateException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UsernameDuplicateException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UsernameDuplicateException</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UsernameDuplicateException</span><span class="params">(String message, Throwable cause, <span class="type">boolean</span> enableSuppression, <span class="type">boolean</span> writableStackTrace)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause, enableSuppression, writableStackTrace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//专用于处理业务层其他未知异常，如数据插入过程中服务器、数据库宕机的情况</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//表示验证码错误的异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidCodeNotMatchException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义业务层接口和抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理用户注册的业务层接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line">    <span class="comment">//处理用户注册</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">UserRegister</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.定义接口的实现类，处理请求</p>
<ul>
<li><p>为什么要补全这五个字段？因为注册界面只让填写了用户名和密码，在经过查询数据库用户不重复后，</p>
<p>如果直接执行插入操作，那么这五个字段在数据库中就是空值，因此必须在注册时补全</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理用户注册的业务层接口的实现类</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IUserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//处理用户注册</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">UserRegister</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//需要先判断用户名是否在数据库中重复</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">queryUser</span> <span class="operator">=</span> userMapper.queryUserByUsername(user.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重复的情况下，抛出用户名重复异常</span></span><br><span class="line">        <span class="keyword">if</span> (queryUser != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameDuplicateException</span>(<span class="string">&quot;用户名已被注册&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//密码不能以明文方式存入数据库，需要进行加密操作</span></span><br><span class="line">        <span class="comment">//密码加密的实现： 盐值 + password + 盐值 ---&gt; md5算法进行加密，连续加载三次 ---&gt; 得到最终存入数据库的结果</span></span><br><span class="line">        <span class="comment">//盐值就是一个随机的字符串</span></span><br><span class="line">        <span class="comment">//记录旧密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">oldPassword</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line">        <span class="comment">//使用UUID获取时间戳创建盐值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> UUID.randomUUID().toString().toUpperCase();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//记录此刻的盐值，用于以后做用户登录判断</span></span><br><span class="line">        user.setSalt(salt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行加密操作</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">md5Password</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(oldPassword, salt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将加密后的密码设置为用户设置的密码</span></span><br><span class="line">        user.setPassword(md5Password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在执行插入操作之前对一些表字段进行补全</span></span><br><span class="line">        <span class="comment">//is_delete字段设置为0，表示未删除用户</span></span><br><span class="line">        user.setIsDelete(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//补全其余四个日志信息的字段</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">currentTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        user.setCreatedUser(user.getUsername());</span><br><span class="line">        user.setCreatedTime(currentTime);</span><br><span class="line">        user.setModifiedUser(user.getUsername());</span><br><span class="line">        user.setModifiedTime(currentTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//不重复，调用插入方法,处理业务</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.addUser(user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123; <span class="comment">//判断服务器或数据库执行是否出现异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;处理用户注册过程中，服务器或数据库执行出现异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.业务层进行单元测试</p>
<h4 id="后端-控制层"><a href="#后端-控制层" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.设置返回响应信息给前端的基类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//响应数据给前端</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JsonResult</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="comment">//响应状态码 200-成功 4000-用户名重复 5000-数据库或服务器异常</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="comment">//响应信息</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="comment">//响应数据</span></span><br><span class="line">    <span class="keyword">private</span> E data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JsonResult</span><span class="params">(<span class="type">int</span> code, E data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.设计请求</p>
<p>请求路径：&#x2F;user</p>
<p>请求参数：User user,HttpSession session,String code</p>
<p>请求类型：post</p>
<p>响应结果：JsonResult&lt; Void&gt;</p>
<p>3.controller的设计</p>
<p>①创建一个BaseController全局处理自定义的异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局处理异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line">    <span class="comment">//操作成功的状态码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">OK</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.当出现了value内的异常之一，就会将下方的方法作为新的控制器方法进行执行</span></span><br><span class="line"><span class="comment">     *   因此该方法的返回值也同时是返回给前端的页面</span></span><br><span class="line"><span class="comment">     * 2.此外还自动将异常对象传递到此方法的参数列表中，这里使用Throwable e来接收</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ServiceException.class)</span> <span class="comment">//统一处理抛出的异常</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">handleException</span><span class="params">(Throwable e)</span>&#123;</span><br><span class="line">        JsonResult&lt;Void&gt; result = <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(e);</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> UsernameDuplicateException)&#123;</span><br><span class="line">            result.setStatus(<span class="number">4000</span>); <span class="comment">//表示用户名重复</span></span><br><span class="line">            result.setMessage(e.getMessage());</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> InsertException)&#123;</span><br><span class="line">            result.setStatus(<span class="number">5000</span>); <span class="comment">//数据库或服务器有问题</span></span><br><span class="line">            result.setMessage(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回异常处理结果</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②创建一个UserController处理请求</p>
<p>UserController继承了BaseControlle也就间接用于了BaseControlle的属性和方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理用户请求的控制器</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户注册</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">userRegister</span><span class="params">(User user,HttpSession session,String code)</span> &#123;</span><br><span class="line">        <span class="comment">//从session取出验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">validCode</span> <span class="operator">=</span> (String) session.getAttribute(Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">		<span class="comment">//判断验证码是否正确</span></span><br><span class="line">        <span class="keyword">if</span> (!validCode.equals(code))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidCodeNotMatchException</span>(<span class="string">&quot;验证码错误,请重试！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行插入操作</span></span><br><span class="line">        userService.userRegister(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.使用postman进行接口的测试</p>
<h4 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li>前端页面只需要将表单信息通过ajax异步向后端服务器发起请求即可</li>
</ul>
<p>给用户注册按钮绑定点击事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="comment">//在网页加载完成后执行</span></span><br><span class="line">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//引入页脚的公共页面</span></span><br><span class="line">    $(<span class="string">&quot;.footer&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;components/footer.html&quot;</span>)</span><br><span class="line">    <span class="comment">//检测信息</span></span><br><span class="line">    <span class="title function_">checkInfoAndSendAjax</span>();</span><br><span class="line">    <span class="comment">//给返回主页绑定点击事件</span></span><br><span class="line">    $(<span class="string">&quot;#btn-toIndex&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        location.<span class="property">href</span> = <span class="string">&quot;index.html&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//验证信息和发送ajax注册用户请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkInfoAndSendAjax</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//给用户注册绑定点击事件</span></span><br><span class="line">    $(<span class="string">&quot;#btn-reg&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        <span class="keyword">let</span> pwd = $(<span class="string">&quot;#password&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        <span class="keyword">let</span> rePwd = $(<span class="string">&quot;#rePwd&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        <span class="keyword">let</span> codeStr = $(<span class="string">&quot;#code&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        <span class="comment">//去掉验证码前后空格</span></span><br><span class="line">        codeStr = $.<span class="title function_">trim</span>(codeStr);</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="string">&quot;&quot;</span> || pwd == <span class="string">&quot;&quot;</span> || rePwd == <span class="string">&quot;&quot;</span> ||codeStr == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;请先填写需要注册的信息！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//验证用户名是否符合规则</span></span><br><span class="line">        <span class="keyword">let</span> nameCheck = <span class="regexp">/^\w&#123;5,12&#125;$/</span>;</span><br><span class="line">        <span class="keyword">let</span> username = $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(nameCheck.<span class="title function_">test</span>(username)))&#123;</span><br><span class="line">            $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;用户名必须是5-12位的字母和数字&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">empty</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//验证密码是否符合规则</span></span><br><span class="line">        <span class="keyword">let</span> passCheck = <span class="regexp">/^\w&#123;5,12&#125;$/</span>;</span><br><span class="line">        <span class="keyword">let</span> password = $(<span class="string">&quot;#password&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        <span class="keyword">if</span> (!passCheck.<span class="title function_">test</span>(password))&#123;</span><br><span class="line">            $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;密码必须是5-12位的字母和数字&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">empty</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//验证确认密码和密码是否相同</span></span><br><span class="line">        <span class="keyword">let</span> rePass = $(<span class="string">&quot;#rePwd&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">        <span class="keyword">if</span> (rePass !== password)&#123;</span><br><span class="line">            $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">text</span>(<span class="string">&quot;密码不一致&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">empty</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            url : <span class="string">&quot;http://localhost:8080/user&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: $(<span class="string">&quot;#form-reg&quot;</span>).<span class="title function_">serialize</span>(), <span class="comment">//获取表单的所有内容</span></span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;注册成功！&quot;</span>)</span><br><span class="line">                    location.<span class="property">href</span> = <span class="string">&quot;login.html&quot;</span></span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    $(<span class="string">&quot;#error-msg&quot;</span>).<span class="title function_">html</span>(res.<span class="property">message</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(error.<span class="property">status</span> + <span class="string">&quot;错误,服务器出现故障，请等待攻城狮修复！！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><h4 id="后端-持久层-1"><a href="#后端-持久层-1" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><ul>
<li>持久层可以利用上面写好的sql语句判断用户是否存在即可，密码的校验 交由业务层进行处理</li>
</ul>
<p>1.sql语句用上面的</p>
<p>2.mapper接口用上面的</p>
<p>3.mapper接口的映射文件用上面的</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-1"><a href="#后端-业务层-1" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，创建两个自定义的异常处理类继承ServiceException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 表示用户名不存在的异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserNotExistException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;&#125;</span><br><span class="line"><span class="comment">//表示密码错误的异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WrongPasswordException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>2.编写接口和抽象方法以及实现类内具体的业务处理流程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//IUserService</span></span><br><span class="line"><span class="comment">//处理用户登录</span></span><br><span class="line">User <span class="title function_">userLogin</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IUserServiceImpl 具体的业务处理用户登录</span></span><br><span class="line">   <span class="keyword">public</span> User <span class="title function_">userLogin</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//用户名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> user.getUsername();</span><br><span class="line">        <span class="comment">//用户输入的密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询登录用户是否在数据库中存在</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userMapper.queryUserByUsername(username);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (loginUser == <span class="literal">null</span>)&#123; <span class="comment">//为空代表用户名不存在</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotExistException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取得数据库查询返回用户的盐值和密码以及删除状态</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> loginUser.getSalt();</span><br><span class="line">        <span class="type">String</span> <span class="variable">databasePwd</span> <span class="operator">=</span> loginUser.getPassword();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">deleteStatus</span> <span class="operator">=</span> loginUser.getIsDelete();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对用户输入的密码进行加密</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">md5PasswordBy</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(userPassword, salt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将加密后的字符和数据库查询的MD5进行校验</span></span><br><span class="line">        <span class="keyword">if</span> (!databasePwd.equals(md5PasswordBy))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WrongPasswordException</span>(<span class="string">&quot;密码不正确&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断登录的用户账户是否已注销</span></span><br><span class="line">        <span class="keyword">if</span> (deleteStatus == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotExistException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//密码正确返回查询的用户信息</span></span><br><span class="line">        <span class="keyword">return</span> loginUser;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3.进行单元测试</p>
<h4 id="后端-控制层-1"><a href="#后端-控制层-1" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.在全局异常处理机制中添加对业务层异常的处理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;user</p>
<p>请求参数：User user, HttpSession session,String code</p>
<p>请求类型：get</p>
<p>响应结果：JsonResult&lt; User&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制层调用业务层接口的方法</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;User&gt; <span class="title function_">userLogin</span><span class="params">(User user, HttpSession session)</span>&#123;</span><br><span class="line">   <span class="comment">//将存储在session的kaptcha所生成的验证码取出</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">validCode</span> <span class="operator">=</span> (String) session.getAttribute(Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">        <span class="comment">//判断验证码是否一致</span></span><br><span class="line">        <span class="keyword">if</span> (!validCode.equals(code))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ValidCodeNotMatchException</span>(<span class="string">&quot;验证码错误,请重试！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行登录操作</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userService.userLogin(user);</span><br><span class="line">        <span class="comment">//分别将用户的session保存到服务端</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;uid&quot;</span>,loginUser.getUid());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>,loginUser.getUsername());</span><br><span class="line">        <span class="comment">//优化一下传回前端的user数据，有些字段是不需要的。</span></span><br><span class="line">        <span class="comment">//只将用户名和uid进行回传</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        newUser.setUsername(loginUser.getUsername());</span><br><span class="line">        newUser.setUid(loginUser.getUid());</span><br><span class="line">        newUser.setGender(loginUser.getGender());</span><br><span class="line">        newUser.setPhone(loginUser.getPhone());</span><br><span class="line">        newUser.setEmail(loginUser.getEmail());</span><br><span class="line">        newUser.setAvatar(loginUser.getAvatar());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,newUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.控制层单元测试</p>
<h4 id="前端页面-1"><a href="#前端页面-1" class="headerlink" title="前端页面"></a>前端页面</h4><p>登录成功以及登录成功后需要做的事情：</p>
<ul>
<li><p>与上面注册登录一样的逻辑，这里不浪费空间了</p>
<p>唯一一个不同的地方是需要在登录成功后跳转至首页</p>
<p><font color='red'><strong>window.location.href &#x3D; “xxx.html” 这个直接跳转到指定页面</strong></font></p>
</li>
<li><p>保存用户信息到session域中</p>
<ul>
<li>①保存在前端的会话窗口中，供前端页面使用</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将用户信息存入session域中</span></span><br><span class="line">sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;user&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li><p>②保存在工程项目的session中，供整个工程使用</p>
<p><strong>session对象主要存在服务器端，可以用于保存服务器的临时数据的对象，也可用于拦截器的拦截请求</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Description : 从session中获取用户uid</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> session springboot启动时生成的session对象</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Integer <span class="title function_">getUserIdFromSession</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">uidStr</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;uid&quot;</span>).toString();</span><br><span class="line">        <span class="keyword">return</span> Integer.valueOf(uidStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//从session中获取用户username</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getUsernameFromSession</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> session.getAttribute(<span class="string">&quot;username&quot;</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color='red'><strong>拦截器</strong></font>，对每个访问的页面进行拦截判断，没有登录则重定向至登录页面</p>
<p>①在interceptor包下自定义拦截器类，实现HandleInterceptor接口，实现此接口的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义的拦截器类，拦截所有请求进行判断</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">           * Description : 检测全局session对象中是否由uid数据，有则放行，没有则拦截</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@param</span> request 请求对象</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@param</span> response 响应对象</span></span><br><span class="line"><span class="comment">           * <span class="doctag">@param</span> handler 处理器（url+Controller：映射）</span></span><br><span class="line"><span class="comment">           **/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//获取项目工程的session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (session.getAttribute(<span class="string">&quot;uid&quot;</span>) != <span class="literal">null</span>)&#123; <span class="comment">//说明此时已登录</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123; <span class="comment">//说明未登录</span></span><br><span class="line">            <span class="comment">//重定向至登录页面</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/web/login.html&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②在config包下创建自定义配置类，实现WebMvcConfigurer接口，将拦截器添加到容器中</p>
<p>​    指定拦截规则【如果是拦截所有，静态资源也会被拦截，所以要指定白名单和黑名单】</p>
<p><font color='red'>   <strong>拦截器也要放行接口的请求，不然就报错</strong></font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 网页拦截器，判读用户是否已经登录</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//注册拦截器并添加拦截规则</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">            <span class="comment">//也可以用一个List&lt;String&gt; 来设置排除拦截的资源</span></span><br><span class="line">            <span class="comment">//拦截器也要放行接口的请求，不然就报错</span></span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/web/login.html&quot;</span>,<span class="string">&quot;/web/index.html&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;/web/register.html&quot;</span>,<span class="string">&quot;/web/product.html&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;/web/components/**&quot;</span>,<span class="string">&quot;/web/search.html&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;/user/**&quot;</span>,<span class="string">&quot;/address/**&quot;</span>,<span class="string">&quot;/file/**&quot;</span>,<span class="string">&quot;/district/**&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;/product/**&quot;</span>,<span class="string">&quot;/cart/**&quot;</span>,<span class="string">&quot;/order/**&quot;</span>,<span class="string">&quot;/kaptcha/**&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/bootstrap3/**&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;/images/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><h4 id="后端-持久层-2"><a href="#后端-持久层-2" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_user <span class="keyword">set</span> password <span class="operator">=</span> #&#123;password&#125; <span class="keyword">where</span> uid <span class="operator">=</span> #&#123;uid&#125;;</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updatePassword</span><span class="params">(String password,String uid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper接口的映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    int updatePassword(@Param(&quot;password&quot;) String password,@Param(&quot;uid&quot;) String uid);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updatePassword&quot;</span>&gt;</span></span><br><span class="line">    update t_user set password = #&#123;password&#125; where uid = #&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-业务层-2"><a href="#后端-业务层-2" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常处理，创建一个表示密码不匹配的异常，比如原密码不对</p>
<p>2.定义Userservice的抽象方法</p>
<p>3.编写实现类实现接口方法的业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.表示原密码不正确的异常</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OriginalPasswordNotMatchException</span> <span class="keyword">extends</span> <span class="title class_">ServiceException</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.Userservice的抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line">    <span class="comment">//处理用户修改密码</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">userResetPwd</span><span class="params">(String oldPwd,String newPwd, HttpSession session)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.编写实现类实现接口方法的业务处理逻辑</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description : 处理用户修改密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/7/11</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> originalPassword 用户的原密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newPassword 用户要修改的新密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 项目启动springboot提供的session对象，用于获取用户的uid</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userResetPwd</span><span class="params">(String originalPassword,String newPassword, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从session中获取用户名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从数据库查询对应的信息</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.queryUserByUsername(username);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取得数据库查询返回用户的盐值和密码以及删除状态</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> user.getSalt();</span><br><span class="line">    <span class="type">String</span> <span class="variable">databasePwd</span> <span class="operator">=</span> user.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对用户输入的密码进行加密</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">md5Password</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(originalPassword, salt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先判断原密码是否正确，将加密后的密码和数据库查询的MD5进行校验</span></span><br><span class="line">    <span class="keyword">if</span> (!databasePwd.equals(md5Password))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OriginalPasswordNotMatchException</span>(<span class="string">&quot;原密码不正确&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将新密码进行加密</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">newMD5Pwd</span> <span class="operator">=</span> PasswordEncryptedUtils.getPasswordByMD5(newPassword, salt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先获取现在的时间</span></span><br><span class="line">    <span class="type">Date</span> <span class="variable">currentTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新密码</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.updatePassword(newMD5Pwd,user.getUsername(),currentTime,username);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;数据库或服务器故障，密码修改失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-2"><a href="#后端-控制层-2" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.在全局异常处理机制中添加对业务层异常的处理</p>
<p>2.设计请求</p>
<p>请求路径 &#x2F;user</p>
<p>请求参数 String oldPwd，String newPwd，Httpsession session</p>
<p>请求类型 post</p>
<p>响应类型 JsonResult&lt; Void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">userResetPwd</span><span class="params">(<span class="meta">@RequestParam(&quot;oldPassword&quot;)</span> String oldPwd,</span></span><br><span class="line"><span class="params">                                     <span class="meta">@RequestParam(&quot;newPassword&quot;)</span> String newPwd,</span></span><br><span class="line"><span class="params">                                     HttpSession session)</span>&#123;</span><br><span class="line">    userService.userResetPwd(oldPwd, newPwd, session);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-2"><a href="#前端页面-2" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li><p>与上面用户登录大致的逻辑，这里不浪费空间了，代码放在web&#x2F;password.html页面下</p>
</li>
<li><p>补充一点：在用户修改密码后，利用location.href &#x3D; “login.html”</p>
<p>以及在后端删除session中存储的uid值实现让用户重新登录</p>
</li>
</ul>
<hr>
<h3 id="个人资料"><a href="#个人资料" class="headerlink" title="个人资料"></a>个人资料</h3><h4 id="后端-持久层-3"><a href="#后端-持久层-3" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<ul>
<li>需要更新phone、email、gender、modified_user ,modified_time这五个字段</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>根据uid主键查询用户信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> uid <span class="operator">=</span> #&#123;uid&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>更新的<span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">update</span> t_user <span class="keyword">set</span> phone <span class="operator">=</span> #&#123;phone&#125;,</span><br><span class="line">                  email <span class="operator">=</span> #&#123;email&#125;,</span><br><span class="line">                  gender <span class="operator">=</span> #&#123;gender&#125;,</span><br><span class="line">				  modified_user <span class="operator">=</span> #&#123;modifiedUser&#125;,</span><br><span class="line">				  modified_time <span class="operator">=</span> #&#123;modifiedTime&#125;</span><br><span class="line">			  <span class="keyword">where</span> uid <span class="operator">=</span> #&#123;uid&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User <span class="title function_">queryUserByUid</span><span class="params">(<span class="meta">@Param(&quot;uid&quot;)</span> Integer uid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">UpdateUserInfo</span><span class="params">(String phone,</span></span><br><span class="line"><span class="params">                   String email,</span></span><br><span class="line"><span class="params">                   Integer gender,</span></span><br><span class="line"><span class="params">                   String modifiedUser,</span></span><br><span class="line"><span class="params">                   Date modifiedTime,</span></span><br><span class="line"><span class="params">                   Integer uid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    User queryUserByUid(@Param(&quot;uid&quot;) Integer uid);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryUserByUid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;queryUser&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where uid = #&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    int UpdateUserInfo(****)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;UpdateUserInfo&quot;</span>&gt;</span></span><br><span class="line">    update t_user set</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null and phone != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        phone = #&#123;phone&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        email = #&#123;email&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null and gender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        gender = #&#123;gender&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    modified_user = #&#123;modifiedUser&#125;,</span><br><span class="line">    modified_time = #&#123;modifiedTime&#125;</span><br><span class="line">    where uid = #&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-业务层-3"><a href="#后端-业务层-3" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常控制，好像没什么新异常</p>
<p>2.定义service层接口的抽象方法</p>
<p>3.实现抽象方法，编写业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象方法</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">userUpdateInfo</span><span class="params">(String phone,String email,</span></span><br><span class="line"><span class="params">                    Integer gender,String username,</span></span><br><span class="line"><span class="params">                    Integer uid)</span>;</span><br><span class="line"><span class="comment">//根据id查询用户信息</span></span><br><span class="line">User <span class="title function_">queryUserByUid</span><span class="params">(Integer uid)</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">//实现抽象方法，编写业务处理逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">userUpdateInfo</span><span class="params">(String phone, String email, Integer gender,String username,Integer uid)</span> &#123;</span><br><span class="line">    <span class="comment">//获取用户id并判断用户是否存在</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.queryUserByUid(uid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span> | user.getIsDelete() == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotExistException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改用户信息</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userMapper.UpdateUserInfo(phone, email, gender, username, <span class="keyword">new</span> <span class="title class_">Date</span>(), uid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;数据库或服务器异常，个人资料修改失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-3"><a href="#后端-控制层-3" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.无异常，不需要处理</p>
<p>2.设计请求</p>
<p>请求路径 &#x2F;user&#x2F;updateInfo</p>
<p>请求参数 String phone,String email,Integer gender,HttpSession session</p>
<p>请求类型 post</p>
<p>响应类型 JsonResult&lt; User&gt;</p>
<p>3.处理请求</p>
<ul>
<li>考虑到前端信息及时更新的问题，因此这里选择将更新后的User进行回传</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/queryUser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;User&gt; <span class="title function_">queryUserByUid</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.queryUserByUid(uid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将用户名、id、电话、邮箱、性别进行回传</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    newUser.setUsername(user.getUsername());</span><br><span class="line">    newUser.setUid(user.getUid());</span><br><span class="line">    newUser.setGender(user.getGender());</span><br><span class="line">    newUser.setPhone(user.getPhone());</span><br><span class="line">    newUser.setEmail(user.getEmail());</span><br><span class="line">    newUser.setAvatar(user.getAvatar());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,newUser);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PutMapping(&quot;/updateInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;User&gt; <span class="title function_">userInfoUpdate</span><span class="params">(String phone,String email,Integer gender,HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//从session中取出用户名和uid</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新数据</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.userUpdateInfo(phone, email, gender, username, id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将用户名、id、电话、邮箱、性别进行回传</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    newUser.setUsername(user.getUsername());</span><br><span class="line">    newUser.setUid(user.getUid());</span><br><span class="line">    newUser.setGender(user.getGender());</span><br><span class="line">    newUser.setPhone(user.getPhone());</span><br><span class="line">    newUser.setEmail(user.getEmail());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,newUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-3"><a href="#前端页面-3" class="headerlink" title="前端页面"></a>前端页面</h4><p>①第一个ajax请求在用户信息页面加载完成后自动发送，并根据返回值通过js的id选择器</p>
<p>​	找到对应的元素并修改其属性值</p>
<p>②第二个ajax请求在用户点击修改按钮之后先提示是否修改，再根据其选择进行处理，</p>
<p>​	同理根据结果利用js的id选择器找到对应的元素并修改其属性值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--	js代码	--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//在网页加载完成后执行</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//在页面完成之后自动发送ajax请求</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $.<span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        url : <span class="string">&quot;http://localhost:8080/user/queryUser&quot;</span> ,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>(res.<span class="property">data</span>.<span class="property">username</span>) <span class="comment">//修改用户名</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                $(<span class="string">&quot;#phone&quot;</span>).<span class="title function_">val</span>(res.<span class="property">data</span>.<span class="property">phone</span>) <span class="comment">//修改电话</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                $(<span class="string">&quot;#email&quot;</span>).<span class="title function_">val</span>(res.<span class="property">data</span>.<span class="property">email</span>) <span class="comment">//修改邮箱</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//修改性别</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">gender</span> === <span class="number">0</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="comment">//prop()表示给某个元素添加属性和属性值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    $(<span class="string">&quot;#gender-female&quot;</span>).<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>,<span class="string">&quot;checked&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;<span class="keyword">else</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    $(<span class="string">&quot;#gender-male&quot;</span>).<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>,<span class="string">&quot;checked&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">alert</span>(<span class="string">&quot;服务器出现故障，请等待攻城狮修复！！&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//给用户注册绑定点击事件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="string">&quot;#btn-change-info&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//根据用户选择状态决定是否发生ajax请求</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&quot;确定要修改吗？&quot;</span>))&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            $.<span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                url : <span class="string">&quot;http://localhost:8080/user/updateInfo&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">type</span>: <span class="string">&quot;put&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">data</span>: $(<span class="string">&quot;#form-change-info&quot;</span>).<span class="title function_">serialize</span>(),<span class="comment">//获取表单的所有内容</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        <span class="title function_">alert</span>(<span class="string">&quot;修改成功！&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        <span class="comment">//将回传的用户信息进行更新</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;user&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res.<span class="property">data</span>))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        <span class="comment">//网页刷新</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        location.<span class="title function_">reload</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    &#125;<span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                        <span class="title function_">alert</span>(res.<span class="property">message</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="title function_">alert</span>(<span class="string">&quot;服务器出现故障，请等待攻城狮修复！！&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//阻止表单的默认提交行为</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="头像上传"><a href="#头像上传" class="headerlink" title="头像上传"></a>头像上传</h3><h4 id="后端-持久层-4"><a href="#后端-持久层-4" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<p>对应的avatar字段存其保存地址</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update t_user set avatar = #&#123;avatar&#125;,modified_user = #&#123;modifiedUser&#125;,</span><br><span class="line">                          modified_time = #&#123;modifiedTime&#125; where uid = #&#123;uid&#125;;</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateUserAvatar</span><span class="params">(<span class="meta">@Param(&quot;file&quot;)</span> String ImgAddress,</span></span><br><span class="line"><span class="params">                     String modifiedUser,</span></span><br><span class="line"><span class="params">                     Date modifiedTime,</span></span><br><span class="line"><span class="params">                     Integer uid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper接口的映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    int updateUserAvatar(@Param(&quot;file&quot;) String ImgAddress);--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserAvatar&quot;</span>&gt;</span></span><br><span class="line">    update t_user set avatar = #&#123;avatar&#125; where uid = #&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-业务层-4"><a href="#后端-业务层-4" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常规划 例如用户数据不存在，服务器宕机等</p>
<p>2.定义service层接口抽象方法</p>
<p>3.实现类重写抽象方法，编写业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.处理用户上传图片的抽象方法</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">userUploadImg</span><span class="params">(String imgAddress,Integer uid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.具体业务处理逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userUploadImg</span><span class="params">(String imgAddress, Integer uid)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.queryUserByUid(uid);</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotExistException</span>(<span class="string">&quot;用户数据不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//插入图片</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span>  <span class="operator">=</span> userMapper.updateUserAvatar(imgAddress, user.getUsername(),<span class="keyword">new</span> <span class="title class_">Date</span>(),uid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;图片在服务器或数据库更新过程中出现错误，上传失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-4"><a href="#后端-控制层-4" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.处理控制层和业务层异常，<strong>将控制层异常加入全局异常处理@ExceptionHandler的值中</strong></p>
<ul>
<li><p>考虑到控制层接口前端数据也有可能出现异常，因此控制层也要进行异常控制</p>
<p>创建一个FileUploadException继承RunTimeException，其余异常继承此异常</p>
<p>①文件为空异常</p>
<p>②文件大小超出限制异常</p>
<p>③文件状态异常</p>
<p>④文件类型不符异常</p>
<p>⑤文件读取IO异常</p>
</li>
</ul>
<p>2.设计请求</p>
<p>请求路径：&#x2F;file</p>
<p>请求参数：MultipartFile file，Httpsession session</p>
<p>请求类型：post</p>
<p>响应类型：JsonResult&lt; Void&gt;</p>
<p>3.处理请求</p>
<p>①创建一个Controller专门处理文件的上传和下载</p>
<p>②将文件的下载地址保存到数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理文件上传和下载的Controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置文件的上传限制</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.servlet.multipart.max-file-size&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileMaxSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置上传文件的类型</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FILE_TYPE = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        FILE_TYPE.add(<span class="string">&quot;images/jpg&quot;</span>);</span><br><span class="line">        FILE_TYPE.add(<span class="string">&quot;images/jpeg&quot;</span>);</span><br><span class="line">        FILE_TYPE.add(<span class="string">&quot;images/png&quot;</span>);</span><br><span class="line">        FILE_TYPE.add(<span class="string">&quot;images/bmp&quot;</span>);</span><br><span class="line">        FILE_TYPE.add(<span class="string">&quot;images/gif&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">userAvatarUpload</span><span class="params">(MultipartFile file,</span></span><br><span class="line"><span class="params">                                             HttpSession session)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在保存文件之前对文件做检查</span></span><br><span class="line">        <span class="comment">//判断文件是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (file.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileEmptyException</span>(<span class="string">&quot;上传文件为空，上传失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断文件是否超过限制</span></span><br><span class="line">        <span class="keyword">if</span> (file.getSize() &gt; fileMaxSize)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileSizeException</span>(<span class="string">&quot;文件过大，上传失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断上传的文件是否为图片类型 file.getContentType()获取的是这种形式 --&gt; text/html</span></span><br><span class="line">        <span class="keyword">if</span> (!FILE_TYPE.contains(file.getContentType()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileTypeNotMatchException</span>(<span class="string">&quot;文件类型不符，上传失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取上传文件的原始名字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取文件的后缀名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用时间戳为文件定义新的名字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuidName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义文件最终的名字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> uuidName + suffix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取项目在服务器上的真实位置并拼凑文件最终的保存位置</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/src/main/resources/static/images/img/&quot;</span> + fileName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 这里其实有两个选择：①直接将文件写入硬盘 这里选择这种</span></span><br><span class="line"><span class="comment">         * ②先获取存储文件的文件夹的路径，判断存储文件的文件夹是否存在，不存在则创建</span></span><br><span class="line"><span class="comment">         * 最后再将文件名和文件夹路径进行拼凑出最终文件的保存路径</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        <span class="comment">//虚拟创建目标文件</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">destFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(realPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取目标文件的上级目录</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">parentFile</span> <span class="operator">=</span> destFile.getParentFile();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!parentFile.exists())&#123;</span><br><span class="line">            <span class="comment">//代表文件的上级目录不存在，进行创建</span></span><br><span class="line">            parentFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//选择第一种方法，直接写入目标位置</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(destFile);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (FileStatusException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileStatusException</span>(<span class="string">&quot;文件状态异常，写入失败&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileUploadIOException</span>(<span class="string">&quot;服务器或数据库写入文件失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取uid值</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将文件的下载路径写入数据库</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileAccessPath</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:&quot;</span> + port + <span class="string">&quot;/file/down/&quot;</span> + fileName;</span><br><span class="line"></span><br><span class="line">        userService.userUploadImg(fileAccessPath,uid);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/down/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; fileUpload(<span class="meta">@PathVariable(&quot;name&quot;)</span> String fileName) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//读取文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">downFilePath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/src/main/resources/static/images/img/&quot;</span> + fileName;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (downFilePath != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//创建一个输入流读入需要下载的文件</span></span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(downFilePath));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建一个和文件所需字节大小一致的byte字节数组</span></span><br><span class="line">            <span class="type">byte</span>[] fileBytes = <span class="keyword">new</span> <span class="title class_">byte</span>[inputStream.available()];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将读入的流写入字节数据</span></span><br><span class="line">            inputStream.read(fileBytes);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建HttpHeaders对象设置响应头信息</span></span><br><span class="line">            <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//设置要下载方式以及下载文件的名字</span></span><br><span class="line">            <span class="comment">//Content-Disposition 通知客户端以下载的方式接受数据</span></span><br><span class="line">            <span class="comment">//attachment;filename= 设置下载的文件的名字</span></span><br><span class="line">            headers.add(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + URLEncoder.encode(fileName,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//设置响应状态码</span></span><br><span class="line">            <span class="type">HttpStatus</span> <span class="variable">statusCode</span> <span class="operator">=</span> HttpStatus.OK;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建ResponseEntity对象</span></span><br><span class="line">            ResponseEntity&lt;<span class="type">byte</span>[]&gt; responseEntity = <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(fileBytes, headers, statusCode);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//关闭输入流</span></span><br><span class="line">            inputStream.close();</span><br><span class="line">            <span class="comment">//将需要下载的文件以字节数组的方式响应出去</span></span><br><span class="line">            <span class="keyword">return</span> responseEntity;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-4"><a href="#前端页面-4" class="headerlink" title="前端页面"></a>前端页面</h4><p>①在页面加载完成之前自动发送第一个ajax请求。</p>
<p>②这里使用form表单提交图像，但form表单提交会自动跳转，因此需要阻止submit的跳转行为</p>
<p>​	引入js文件,在form表单添加onsubmit属性以及利用js插件解决</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--	引入阻止表单上传跳转的js--&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/jquery-1.8.0.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/jquery.form.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">    &lt;!--js代码	--&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">afterFromSubmit</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//阻止表单的默认跳转行为，并在ajax请求后进行重定向</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="string">&quot;#avatar&quot;</span>).<span class="title function_">ajaxSubmit</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">alert</span>(<span class="string">&quot;上传成功&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//页面重定向，防止表单重复提交</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            location.<span class="property">href</span> = <span class="string">&quot;upload.html&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//这一步很关键，防止submit默认的提交跳转行为</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//网页加载完成之前自动发送ajax请求</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $.<span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/user/queryUser&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//判断用户是首次注册还是老用户</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">avatar</span> !== <span class="literal">null</span> &amp;&amp;res.<span class="property">data</span>.<span class="property">avatar</span> !== <span class="string">&quot;&quot;</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//设置用户头像</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                $(<span class="string">&quot;#img-avatar&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>,res.<span class="property">data</span>.<span class="property">avatar</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;<span class="keyword">else</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//设置为默认头像</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                $(<span class="string">&quot;#img-avatar&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;../images/index/user.jpg&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="地址管理"><a href="#地址管理" class="headerlink" title="地址管理"></a>地址管理</h2><ul>
<li><p>鉴于地址管理  有点多，开发顺序参考：</p>
<p>新增收货地址管理、显示用户地址信息、设为默认地址、修改、删除</p>
</li>
</ul>
<h3 id="创建数据表-1"><a href="#创建数据表-1" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_address (</span><br><span class="line">    aid <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;收货地址id&#x27;</span>,</span><br><span class="line">    uid <span class="type">INT</span> COMMENT <span class="string">&#x27;归属的用户id&#x27;</span>,</span><br><span class="line">    NAME <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">    province_name <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;省-名称&#x27;</span>,</span><br><span class="line">    province_code <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;省-行政代号&#x27;</span>,</span><br><span class="line">    city_name <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;市-名称&#x27;</span>,</span><br><span class="line">    city_code <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;市-行政代号&#x27;</span>,</span><br><span class="line">    area_name <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;区-名称&#x27;</span>,</span><br><span class="line">    area_code <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;区-行政代号&#x27;</span>,</span><br><span class="line">    zip <span class="type">CHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;邮政编码&#x27;</span>,</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">50</span>) COMMENT <span class="string">&#x27;详细地址&#x27;</span>,</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;手机&#x27;</span>,</span><br><span class="line">    tel <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;固话&#x27;</span>,</span><br><span class="line">    tag <span class="type">VARCHAR</span>(<span class="number">6</span>) COMMENT <span class="string">&#x27;标签&#x27;</span>,</span><br><span class="line">    is_default <span class="type">INT</span> COMMENT <span class="string">&#x27;是否默认：0-不默认，1-默认&#x27;</span>,</span><br><span class="line">    created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">    created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">    modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (aid)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<h3 id="创建实体类-1"><a href="#创建实体类-1" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对应数据表t_address的实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer aid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String provinceName;</span><br><span class="line">    <span class="keyword">private</span> String provinceCode;</span><br><span class="line">    <span class="keyword">private</span> String cityName;</span><br><span class="line">    <span class="keyword">private</span> String cityCode;</span><br><span class="line">    <span class="keyword">private</span> String areaName;</span><br><span class="line">    <span class="keyword">private</span> String areaCode;</span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String phone ;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="keyword">private</span> String tag;</span><br><span class="line">    <span class="keyword">private</span> Integer isDefault;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="新增地址"><a href="#新增地址" class="headerlink" title="新增地址"></a>新增地址</h3><h4 id="后端-持久层-5"><a href="#后端-持久层-5" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>插入数据 除了此表的主键不需要数据，其他都要</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_address(uid,name,province_name,province_code,city_name,city_code,area_name,</span><br><span class="line">					area_code,zip,address,phone,tel,tag,is_default,created_user,created_time,</span><br><span class="line">                    modified_user,modified_time)</span><br><span class="line">                    <span class="keyword">values</span>(#&#123;uid&#125;,#&#123;name&#125;,#&#123;proviceName&#125;,#&#123;provinceCode&#125;,#&#123;cityName&#125;,</span><br><span class="line">                    		#&#123;cityCode&#125;,#&#123;areaName&#125;,#&#123;areaCode&#125;,#&#123;zip&#125;,#&#123;address&#125;,#&#123;phone&#125;,</span><br><span class="line">                        	#&#123;tel&#125;,#&#123;tag&#125;,#&#123;isDefault&#125;,#&#123;createdUser&#125;,#&#123;createdTime&#125;,</span><br><span class="line">                        	#&#123;modifiedUser&#125;,#&#123;modifiedTime&#125;</span><br><span class="line">                    		)</span><br><span class="line">	</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>判断用户数据条目是否超过限制</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t_address <span class="keyword">where</span> uid <span class="operator">=</span> #&#123;uid&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象接口和抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Address实体类对应的mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressMapper</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addAddress</span><span class="params">(Address address)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">userAddressCount</span><span class="params">(Integer aid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper接口对应的映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-5"><a href="#后端-业务层-5" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常规划 用户地址条目数超出限制的异常</p>
<p>2.定义service接口和抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAddressService</span> &#123;</span><br><span class="line">    <span class="comment">//添加地址业务抽象方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addAddress</span><span class="params">(Address address)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.编写具体的业务处理逻辑</p>
<ul>
<li><strong>需要注意，如果用户此时添加的地址是第一条，需要将其设置为其账户的默认地址</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAddressService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressMapper addressMapper;</span><br><span class="line">    <span class="comment">//添加地址业务具体逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAddress</span><span class="params">(Address address)</span> &#123;</span><br><span class="line">        <span class="comment">//先判断用户在数据库中的地址记录数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> addressMapper.userAddressCount(address.getUid());</span><br><span class="line">        <span class="comment">//查询是否超过记录限制</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt;= <span class="number">20</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressCountLimitException</span>(<span class="string">&quot;地址数量已达上限，请先删除部分地址！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当查询记录为0，则将此地址设置为用户默认的地址</span></span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>)&#123;</span><br><span class="line">            address.setIsDefault(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//插入数据</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> addressMapper.addAddress(address);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;新增地址失败，服务器或数据库异常！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-5"><a href="#后端-控制层-5" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.处理异常，将异常添加到全局统一管理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;address</p>
<p>请求参数：Address address,HttpSession session</p>
<p>请求类型：post</p>
<p>响应类型：JsonResult&lt; Void&gt;</p>
<p>3.处理请求，创建对应的controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/address&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAddressService addressService;</span><br><span class="line">    <span class="comment">//处理用户新增地址</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addAddress</span><span class="params">(Address address, HttpSession session)</span>&#123;</span><br><span class="line">        <span class="comment">//从session中取出uid</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">        <span class="comment">//将取出的uid设为当前地址对象的的uid</span></span><br><span class="line">        address.setUid(uid);</span><br><span class="line">        <span class="comment">//调用业务层方法，新增地址</span></span><br><span class="line">        addressService.addAddress(address);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-5"><a href="#前端页面-5" class="headerlink" title="前端页面"></a>前端页面</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&quot;#btn-add-new-address&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            url : <span class="string">&quot;http://localhost:8080/address&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: $(<span class="string">&quot;#form-add-new-address&quot;</span>).<span class="title function_">serialize</span>(), <span class="comment">//获取表单的所有内容</span></span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;新增成功！&quot;</span>)</span><br><span class="line">                    location.<span class="property">href</span> = <span class="string">&quot;address.html&quot;</span></span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(res.<span class="property">message</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;服务器出现故障，请等待攻城狮修复！！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="获取省市区列表"><a href="#获取省市区列表" class="headerlink" title="获取省市区列表"></a>获取省市区列表</h3><h4 id="创建数据表-2"><a href="#创建数据表-2" class="headerlink" title="创建数据表"></a>创建数据表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>parent属性代表的是父区域的代码号，省的父代码号是<span class="operator">+</span><span class="number">86</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_dict_district (</span><br><span class="line">    id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    parent <span class="type">varchar</span>(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    code <span class="type">varchar</span>(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<h4 id="创建实体类-2"><a href="#创建实体类-2" class="headerlink" title="创建实体类"></a>创建实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">District</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String parent;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="后端-持久层-6"><a href="#后端-持久层-6" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>根据父代号查询相关信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_dict_district <span class="keyword">where</span> parent <span class="operator">=</span> #&#123;parent&#125; <span class="keyword">order</span> <span class="keyword">by</span> code <span class="keyword">ASC</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>根据code查询对应的省市区名字</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> t_dict_district <span class="keyword">where</span> code <span class="operator">=</span> #&#123;code&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口和抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据父代号查询区域信息</span></span><br><span class="line">List&lt;District&gt; <span class="title function_">queryDistrictByParent</span><span class="params">(String parent)</span>;</span><br><span class="line"><span class="comment">//根据code查询当前省市区的名称</span></span><br><span class="line">String <span class="title function_">queryDistrictByCode</span><span class="params">(String code)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-6"><a href="#后端-业务层-6" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常 ,暂无异常</p>
<p>2.定义service接口和抽象方法</p>
<p>3.编写具体的业务处理逻辑</p>
<ul>
<li><p>此外，还需要在address业务层需要调用District业务层为它的address对象填充空白字段</p>
<p>因为provinceName、cityName、areaName的值需要通过前端传过来的option标签的</p>
<p>value值(这些option标签是通过这个业务层查询后append到select标签中的)进行查询</p>
<p>才能得到，因此还需要在address业务层调用这个业务层接口</p>
<p><font color='red'><strong>select标签中的option标签的value的值是前端往后端传的参数</strong></font></p>
</li>
<li><p>而在这之前添加关于地址的字段全空，code为名字就是因为select中没有选项</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IDistrictServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IDistrictService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DistrictMapper districtMapper;</span><br><span class="line">    <span class="comment">//根据父代号查询省市区信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;District&gt; <span class="title function_">getSpecifyDistrictByParent</span><span class="params">(String parent)</span> &#123;</span><br><span class="line">        List&lt;District&gt; districts = districtMapper.queryDistrictByParent(parent);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过滤无效字段数据，提高传输效率</span></span><br><span class="line">        <span class="keyword">for</span> (District ad: districts) &#123;</span><br><span class="line">            ad.setId(<span class="literal">null</span>);</span><br><span class="line">            ad.setParent(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回数据</span></span><br><span class="line">        <span class="keyword">return</span> districts;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据code查询省市区名字</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNameByCode</span><span class="params">(String code)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> districtMapper.queryDistrictByCode(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-6"><a href="#后端-控制层-6" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.无异常，不用处理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;district</p>
<p>请求参数：String parent</p>
<p>请求类型：get</p>
<p>响应类型：JsonResult&lt;List&lt; District&gt;&gt;</p>
<p>3.处理请求,创建一个新的控制类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理父代号查询省市区的请求</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;District&gt;&gt; <span class="title function_">queryDistrictByParent</span><span class="params">(String parent)</span>&#123;</span><br><span class="line">    <span class="comment">//查询数据</span></span><br><span class="line">    List&lt;District&gt; list = districtService.getSpecifyDistrictByParent(parent);</span><br><span class="line">    <span class="comment">//返回数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-6"><a href="#前端页面-6" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li>前端页面js代码过长，需要到&#x2F;web&#x2F;addAddress.html的script标签下看</li>
</ul>
<hr>
<h3 id="获取用户地址"><a href="#获取用户地址" class="headerlink" title="获取用户地址"></a>获取用户地址</h3><h4 id="后端-持久层-7"><a href="#后端-持久层-7" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_address <span class="keyword">where</span> uid <span class="operator">=</span> #&#123;uid&#125; <span class="keyword">order</span> <span class="keyword">by</span> is_default <span class="keyword">desc</span>,created_time <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询用户所有地址记录</span></span><br><span class="line">List&lt;Address&gt; <span class="title function_">queryUserAddress</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写映射文件</p>
<ul>
<li>定义结果结映射规则，将通过select查询出来的结果放入List当中</li>
</ul>
<p>4.单元测试</p>
<h4 id="后端-业务层-7"><a href="#后端-业务层-7" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常控制，貌似没新异常</p>
<p>2.定义业务层抽象方法</p>
<p>3.编写具体的业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加地址查询的抽象方法</span></span><br><span class="line">List&lt;Address&gt; <span class="title function_">queryUser</span><span class="params">(Integer uid)</span>;</span><br><span class="line"><span class="comment">//地址查询的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Address&gt; <span class="title function_">queryUser</span><span class="params">(Integer uid)</span> &#123;</span><br><span class="line">    <span class="comment">//先判断用户信息是否存在</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.queryUserByUid(uid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span> | user.getIsDelete() == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserNotExistException</span>(<span class="string">&quot;用户信息不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回查询的用户地址信息</span></span><br><span class="line">    <span class="keyword">return</span> addressMapper.queryUserAddress(uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-7"><a href="#后端-控制层-7" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.异常处理</p>
<p>2.设计请求</p>
<p>请求地址：&#x2F;address</p>
<p>请求参数：HttpSession session</p>
<p>请求类型：get</p>
<p>响应类型：JsonResult&lt;List&lt; Address&gt;&gt;</p>
<p>3.处理请求</p>
<ul>
<li><strong>控制层需要把前端发送过来的Address其余空字段补全</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理用户查询收货地址</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&gt; <span class="title function_">queryAllAddress</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//获取uid</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">    <span class="comment">//查询数据</span></span><br><span class="line">    List&lt;Address&gt; list = addressService.queryUser(uid);</span><br><span class="line">    <span class="comment">//返回数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-7"><a href="#前端页面-7" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li><p>在页面加载完成时，自动发送ajax请求查询用户收货地址，拿到返回数据之后</p>
<p>判断返回数据的j集合中是否有信息，没有信息将表格内容设置为提示信息，</p>
<p>有内容则通过js选择器找到显示表格的标签，通过append()将数据逐个插入到表格的标签内</p>
<p>并将修改、删除、设为默认的三个 绑定单击事件</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//页面加载完成自动发送ajax请求查询用户地址</span></span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/address&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">length</span> !== <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>;i &lt; res.<span class="property">data</span>.<span class="property">length</span>;i++)&#123;</span><br><span class="line">                    <span class="comment">//挨个获取返回的集合中的元素</span></span><br><span class="line">                    <span class="keyword">var</span> address = res.<span class="property">data</span>[i];</span><br><span class="line">                    <span class="comment">//拼凑标签和信息</span></span><br><span class="line">                    str = <span class="string">&quot;&lt;tr&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;td&gt;&quot;</span>+ address.<span class="property">tag</span> + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;td&gt;&quot;</span>+ address.<span class="property">name</span> + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;td&gt;&quot;</span></span><br><span class="line">                        + address.<span class="property">provinceCode</span> + address.<span class="property">cityCode</span> + address.<span class="property">areaCode</span> + address.<span class="property">address</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;td&gt;&quot;</span> + address.<span class="property">phone</span> + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;a href=&#x27;javascript:void(0);&#x27; onclick=&#x27;updateAddress()&#x27; class=&#x27;btn btn-xs btn-info&#x27;&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;span class=&#x27;fa fa-edit&#x27;&gt;&lt;/span&gt;修改&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/a&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;a href=&#x27;javascript:void(0);&#x27; onclick=&#x27;deleteAddress()&#x27; class=&#x27;btn btn-xs add-del btn-info&#x27;&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;span class=&#x27;fa fa-trash-o&#x27;&gt;&lt;/span&gt;删除&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/a&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;a href=&#x27;javascript:void(0);&#x27; onclick=&#x27;setDefault()&#x27; class=&#x27;btn btn-xs add-def btn-default&#x27;&gt;设为默认&lt;/a&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                        + <span class="string">&quot;&lt;/tr&gt;&quot;</span></span><br><span class="line">                    <span class="comment">//将数据逐个插入到表格的标签内</span></span><br><span class="line">                    $(<span class="string">&quot;#address-list&quot;</span>).<span class="title function_">append</span>(str)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> text = <span class="string">&quot;暂无收货地址，请先添加收货地址&quot;</span></span><br><span class="line">                $(<span class="string">&quot;#address-list&quot;</span>).<span class="title function_">text</span>(text)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="设置默认地址"><a href="#设置默认地址" class="headerlink" title="设置默认地址"></a>设置默认地址</h3><h4 id="后端-持久层-8"><a href="#后端-持久层-8" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>判断需要设置为默认地址的数据是否存在</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_address <span class="keyword">where</span> aid <span class="operator">=</span> #&#123;aid&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>将所有地址设置为非默认值</span><br><span class="line"><span class="keyword">update</span> t_address <span class="keyword">set</span> is_default <span class="operator">=</span> <span class="number">0</span> <span class="keyword">where</span> uid <span class="operator">=</span> #&#123;uid&#125; <span class="keyword">and</span> is_delete <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>更新地址的默认值</span><br><span class="line"><span class="keyword">update</span> t_address <span class="keyword">set</span> is_default <span class="operator">=</span> <span class="number">1</span>,</span><br><span class="line">                     modified_user <span class="operator">=</span> #&#123;modifiedUser&#125;,</span><br><span class="line">					 modified_time <span class="operator">=</span> #&#123;modifiedTime&#125;</span><br><span class="line">                     <span class="keyword">where</span> aid <span class="operator">=</span> #&#123;aid&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据地址aid查询某条地址</span></span><br><span class="line">Address <span class="title function_">queryUserAddressByAid</span><span class="params">(Integer aid)</span>;</span><br><span class="line"><span class="comment">// 根据用户uid将其关联的地址设置为非默认值</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">setAllAddressNotDefault</span><span class="params">(Integer uid)</span>;</span><br><span class="line"><span class="comment">//根据地址aid将某条地址设为默认值</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">setOneAddressDefault</span><span class="params">(Integer aid,String modifiedUser, Date modifiedTime)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper映射文件</p>
<h4 id="后端-业务层-8"><a href="#后端-业务层-8" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常规划，数据不存在</p>
<p>2.定义service层抽象方法</p>
<p>3.编写具体的业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询某条地址的抽象方法</span></span><br><span class="line">Address <span class="title function_">queryAddressByAid</span><span class="params">(Integer aid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置用户所有地址为非默认地址的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">setNotDefaultAddress</span><span class="params">(Integer uid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置某个地址为默认地址的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">setOneAddressDefault</span><span class="params">(Integer aid,String modifiedUser, Date modifiedTime)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据aid查询地址的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">queryAddressByAid</span><span class="params">(Integer aid)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> addressMapper.queryUserAddressByAid(aid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置用户所有地址为非默认的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">setNotDefaultAddress</span><span class="params">(Integer uid)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> addressMapper.setAllAddressNotDefault(uid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置某个地址为默认地址的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">setOneAddressDefault</span><span class="params">(Integer aid,String modifiedUser, Date modifiedTime)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> addressMapper.setOneAddressDefault(aid,modifiedUser,modifiedTime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="后端-控制层-8"><a href="#后端-控制层-8" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.将异常加入全局处理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;address&#x2F;setAddress</p>
<p>请求参数：Integer aid,HttpSession session</p>
<p>请求类型：post</p>
<p>响应类型：JsonResult&lt; void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/setAddress&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">setUserDefaultAddress</span><span class="params">(Integer aid,HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//查询要修改的地址是否存在</span></span><br><span class="line">    <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.queryAddressByAid(aid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (address == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressNotExistsException</span>(<span class="string">&quot;该地址不存在，设置失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从session中取出用户的uid和名字</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">    <span class="type">String</span> <span class="variable">modifiedUser</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line"></span><br><span class="line">    <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将该用户的所有地址设为非默认值</span></span><br><span class="line">    addressService.setNotDefaultAddress(uid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将需要修改的地址设为默认值</span></span><br><span class="line">    addressService.setOneAddressDefault(aid,modifiedUser,date);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-8"><a href="#前端页面-8" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li><p><font color='red'><strong>由于是直接通过拼接元素实现了数据展示，对于id的获取选择使用正则表达式进行替换</strong></font></p>
<p>使用正则表达式替换获取该地址的aid值，#{aid}只是一个占位符的含义，没其他含义</p>
<p>str &#x3D; str.replace(“#{aid}”,address.aid)</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为设为默认地址绑定点击事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setDefault</span>(<span class="params">aid</span>)&#123;</span><br><span class="line">    <span class="title function_">alert</span>(aid)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&quot;确定要这条收货地址设为默认地址吗？&quot;</span>))&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/address/setAddress&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="string">&quot;aid=&quot;</span> + aid,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;设置成功&quot;</span>)</span><br><span class="line">                location.<span class="title function_">reload</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>:<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(error.<span class="property">message</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="删除地址"><a href="#删除地址" class="headerlink" title="删除地址"></a>删除地址</h3><h4 id="后端-持久层-9"><a href="#后端-持久层-9" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句的编写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_address <span class="keyword">set</span> is_delete <span class="operator">=</span> <span class="number">1</span>，</span><br><span class="line">					modified_user <span class="operator">=</span> #&#123;modifiedUser&#125;,</span><br><span class="line">					 modified_time <span class="operator">=</span> #&#123;modifiedTime&#125;</span><br><span class="line">					 <span class="keyword">where</span> aid <span class="operator">=</span> #&#123;aid&#125;)</span><br></pre></td></tr></table></figure>

<p>2.定义mapper抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteAddressByAid</span><span class="params">(Integer aid,String modifiedUser, Date modifiedTime)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-9"><a href="#后端-业务层-9" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常控制，貌似没有</p>
<p>2.定义抽象方法</p>
<ul>
<li>与上方设置默认地址类上</li>
</ul>
<p>3.编写具体的处理逻辑</p>
<ul>
<li>与上方设置默认地址类上</li>
</ul>
<p>4.单元测试</p>
<h4 id="后端-控制层-9"><a href="#后端-控制层-9" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.异常处理，貌似没有</p>
<p>2.设计请求</p>
<ul>
<li>与上方设置默认地址类上</li>
</ul>
<p>3.处理请求</p>
<ul>
<li>与上方设置默认地址类上</li>
</ul>
<p>4.单元测试</p>
<h4 id="前端页面-9"><a href="#前端页面-9" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li><p>删除地址要考虑这条删除的地址是否为默认地址，</p>
<p>如果是默认地址不允许删除，提示修改其他地址才能删除</p>
</li>
</ul>
<p>js代码与上方的设置默认地址相似，就不浪费空间了</p>
<hr>
<h3 id="修改地址"><a href="#修改地址" class="headerlink" title="修改地址"></a>修改地址</h3><h4 id="后端-持久层-10"><a href="#后端-持久层-10" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句的编写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_address <span class="keyword">set</span>(除了uid、创建者和创建时间的字段) <span class="keyword">where</span> aid <span class="operator">=</span> #&#123;aid&#125; <span class="keyword">and</span> is_delete <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>2.定义mapper抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新用户地址信息</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateUserAddressByAid</span><span class="params">(Address address)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-10"><a href="#后端-业务层-10" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常控制，貌似没有</p>
<p>2.定义抽象方法</p>
<p>3.编写具体的处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改某个指定地址的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateOneAddress</span><span class="params">(Address address,String modifiedUser)</span>;</span><br><span class="line"><span class="comment">//修改指定地址的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateOneAddress</span><span class="params">(Address address,String modifiedUser)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取并设置其他三个地址为null的字段</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">provinceName</span> <span class="operator">=</span> districtService.getNameByCode(address.getProvinceCode());</span><br><span class="line">    <span class="type">String</span> <span class="variable">cityName</span> <span class="operator">=</span> districtService.getNameByCode(address.getCityCode());</span><br><span class="line">    <span class="type">String</span> <span class="variable">areaName</span> <span class="operator">=</span> districtService.getNameByCode(address.getAreaCode());</span><br><span class="line">    address.setProvinceName(provinceName);</span><br><span class="line">    address.setCityName(cityName);</span><br><span class="line">    address.setAreaName(areaName);</span><br><span class="line">    <span class="comment">//补全表单中没有的其他字段</span></span><br><span class="line">    address.setModifiedUser(modifiedUser);</span><br><span class="line">    address.setModifiedTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> addressMapper.updateUserAddressByAid(address);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-10"><a href="#后端-控制层-10" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.异常处理，貌似没有</p>
<p>2.设计请求</p>
<p>请求地址：&#x2F;address&#x2F;updateAddress</p>
<p>请求参数：Address address,HttpSession session</p>
<p>请求类型：post</p>
<p>响应类型：JsonResult&lt; void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/updateAddress&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateOneAddress</span><span class="params">(Address address,HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//取出session中用户名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">modifiedUser</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> addressService.updateOneAddress(address, modifiedUser);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;修改地址时，服务器或数据库异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-10"><a href="#前端页面-10" class="headerlink" title="前端页面"></a>前端页面</h4><p>①在跳转到这个页面时，自动发送一个ajax请求，根据返回数据填充表单</p>
<p>②在用户修改省份时，城市、市县自动变为请选择城市或区县并根据选择发送对应的ajax请求查询</p>
<p>③在页面加载完成时，用户可根据自由选择城市或区县的单个修改</p>
<p>④修改按钮前端将整个表单以ajax请求进行发送，后端以实体类address接收并处理</p>
<p>⑤恢复原地址信息按钮实际上就是再次调用第一个中的ajax请求</p>
<ul>
<li><font color='red'><strong>javaScript代码长达200多行，不予展示，需要到项目于的&#x2F;web&#x2F;editAddress.html页面查看</strong></font></li>
</ul>
<hr>
<h2 id="商品管理"><a href="#商品管理" class="headerlink" title="商品管理"></a>商品管理</h2><h3 id="创建数据表-3"><a href="#创建数据表-3" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_product (</span><br><span class="line">  id <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">  category_id <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分类id&#x27;</span>,</span><br><span class="line">  item_type <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品系列&#x27;</span>,</span><br><span class="line">  title <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品标题&#x27;</span>,</span><br><span class="line">  sell_point <span class="type">varchar</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品卖点&#x27;</span>,</span><br><span class="line">  price <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品单价&#x27;</span>,</span><br><span class="line">  num <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;库存数量&#x27;</span>,</span><br><span class="line">  image <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片路径&#x27;</span>,</span><br><span class="line">  status <span class="type">int</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;商品状态  1：上架   2：下架   3：删除&#x27;</span>,</span><br><span class="line">  priority <span class="type">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;显示优先级&#x27;</span>,</span><br><span class="line">  created_time datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  modified_time datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后修改时间&#x27;</span>,</span><br><span class="line">  created_user <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">  modified_user <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;最后修改人&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<h3 id="创建实体类-3"><a href="#创建实体类-3" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对应数据表t_product的实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer categoryId ;</span><br><span class="line">    <span class="keyword">private</span> String itemType;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String sellPoint;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> String priority;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="热销排行"><a href="#热销排行" class="headerlink" title="热销排行"></a>热销排行</h3><h4 id="后端-持久层-11"><a href="#后端-持久层-11" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句编写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,title,price,image <span class="keyword">FROM</span> t_product  <span class="keyword">where</span> status <span class="operator">=</span> <span class="number">1</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> priority <span class="keyword">DESC</span> LIMIT <span class="number">0</span>,<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口和抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询优先权前五的商品进行展示</span></span><br><span class="line">List&lt;Product&gt; <span class="title function_">queryPriorityProduct</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-11"><a href="#后端-业务层-11" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常</p>
<p>2.定义service接口和抽象方法</p>
<p>3.编写具体的处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询热销商品的前五项的抽象方法</span></span><br><span class="line">List&lt;Product&gt; <span class="title function_">queryPriorityProduct</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">queryPriorityProduct</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productMapper.queryPriorityProduct();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-11"><a href="#后端-控制层-11" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.异常处理，无异常不需要处理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;product</p>
<p>请求参数：无</p>
<p>请求类型：get</p>
<p>响应类型：JsonResult&lt;List&lt; Product&gt;&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理热销商品的请求</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;Product&gt;&gt; <span class="title function_">queryBestProduct</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//查询对应商品</span></span><br><span class="line">    List&lt;Product&gt; products = productService.queryPriorityProduct();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,products);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-11"><a href="#前端页面-11" class="headerlink" title="前端页面"></a>前端页面</h4><p>①在页面加载完成自动发送ajax请求，根据返回信息填充热销排行信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询热销商品的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showHotProducts</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        url : <span class="string">&quot;http://localhost:8080/product&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; res.<span class="property">data</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="keyword">let</span> product = res.<span class="property">data</span>[i]</span><br><span class="line">                <span class="keyword">let</span> image = <span class="string">&quot;http://localhost:8080&quot;</span> + product.<span class="property">image</span> + <span class="string">&quot;collect.png&quot;</span></span><br><span class="line">                str = <span class="string">&quot;&lt;div class=&#x27;col-md-12&#x27;&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;div class=\&quot;col-md-7 text-row-2\&quot;&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;a href=&#x27;#&#x27;&gt;&quot;</span> + product.<span class="property">title</span> + <span class="string">&quot;&lt;/a&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;div class=\&quot;col-md-2\&quot;&gt;¥23&lt;/div&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;div class=\&quot;col-md-3\&quot;&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;img src=&quot;</span> + image  + <span class="string">&quot; class=&#x27;img-responsive&#x27; /&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;/div&gt;&quot;</span></span><br><span class="line">                $(<span class="string">&quot;#hot-list&quot;</span>).<span class="title function_">append</span>(str)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;查询错误，请等待攻城狮修复！！&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="最新产品"><a href="#最新产品" class="headerlink" title="最新产品"></a>最新产品</h3><ul>
<li>所有的逻辑跟热销排行 相似在此不再浪费空间书写，只书写部分</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="keyword">sql</span>语句</span><br><span class="line"><span class="keyword">SELECT</span> id,title,price,image <span class="keyword">FROM</span> t_product </span><br><span class="line">					<span class="keyword">WHERE</span> category_id <span class="operator">=</span> <span class="number">163</span> </span><br><span class="line">					<span class="keyword">and</span> status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">ORDER</span> <span class="keyword">BY</span> created_time <span class="keyword">DESC</span> </span><br><span class="line">					LIMIT <span class="number">0</span>,<span class="number">4</span> ;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="显示商品"><a href="#显示商品" class="headerlink" title="显示商品"></a>显示商品</h3><h4 id="后端-持久层-12"><a href="#后端-持久层-12" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句的编写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> title,sell_point,price,image <span class="keyword">from</span> t_product <span class="keyword">where</span> id <span class="operator">=</span> #&#123;id&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据指定商品id进行商品查询</span></span><br><span class="line">Product <span class="title function_">queryProductById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-12"><a href="#后端-业务层-12" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，商品不存在,商品状态异常</p>
<p>2.定义抽象方法</p>
<p>3.编写具体的逻辑处理方法</p>
<p>4.单元测试</p>
<h4 id="后端-控制层-12"><a href="#后端-控制层-12" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.处理异常，将异常加入全局处理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;product&#x2F;{id}</p>
<p>请求参数：Integet id</p>
<p>请求类型：get</p>
<p>响应类型：JsonResult&lt; Product&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理商品id查询该商品信息的请求</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Product&gt; <span class="title function_">queryProductById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.queryProductById(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-12"><a href="#前端页面-12" class="headerlink" title="前端页面"></a>前端页面</h4><p>①在页面加载完成自动发送ajax请求，把根据id查询的返回信息填充至页面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showInThisProductHtml</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//接收上一个页面传来的连接</span></span><br><span class="line">    <span class="keyword">var</span> hrefUrl = location.<span class="property">href</span>;</span><br><span class="line">    <span class="comment">//以url中的&quot;=&quot;为截断点，形成一个数组</span></span><br><span class="line">    <span class="keyword">var</span> param = hrefUrl.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">    <span class="comment">//decodeURI解码得到想要的参数</span></span><br><span class="line">    <span class="keyword">var</span> id = <span class="built_in">decodeURI</span>(param[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在页面加载完成时自动发送此ajax请求并填充表单</span></span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/product/&quot;</span> + id,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> product = res.<span class="property">data</span>;</span><br><span class="line">            <span class="comment">//将普通的数据填充至页面</span></span><br><span class="line">            $(<span class="string">&quot;#product-title&quot;</span>).<span class="title function_">text</span>(product.<span class="property">title</span>)</span><br><span class="line">            $(<span class="string">&quot;#product-sell-point&quot;</span>).<span class="title function_">append</span>(product.<span class="property">sellPoint</span>)</span><br><span class="line">            $(<span class="string">&quot;#product-price&quot;</span>).<span class="title function_">text</span>(product.<span class="property">price</span>)</span><br><span class="line">            $(<span class="string">&quot;#stock&quot;</span>).<span class="title function_">text</span>(product.<span class="property">num</span>)</span><br><span class="line">            <span class="comment">//将数据库查询的图片进行替换</span></span><br><span class="line">            <span class="keyword">let</span> image = <span class="string">&quot;..&quot;</span> +  product.<span class="property">image</span></span><br><span class="line">            <span class="comment">//遍历填充图片数据</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                $(<span class="string">&quot;#product-image-&quot;</span> + i + <span class="string">&quot;-big&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>,image + i + <span class="string">&quot;_big.png&quot;</span>)</span><br><span class="line">                $(<span class="string">&quot;#product-image-&quot;</span> + i).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>,image + i + <span class="string">&quot;.jpg&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//在页面加载完成时，填充页面数据</span></span><br><span class="line">    <span class="title function_">showInThisProductHtml</span>();</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="立即购买"><a href="#立即购买" class="headerlink" title="立即购买"></a>立即购买</h3><ul>
<li><font color='red'><strong>后端-持久层 、业务层、控制层大部分东西都在前面的 已经实现了</strong></font></li>
</ul>
<p>1.根据uid查询用户地址，在地址管理的获取收货地址 已经实现</p>
<p>2.根据pid查询商品信息，在显示商品 已经实现</p>
<p>业务层有所修改，添加一个新的方法对应从商品详情页进去确定订单界面的请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理根据从商品界面进入创建orderItem订单的具体逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertOrderItemFromProductHtml</span><span class="params">(Integer oid,Integer pid, Integer num, String username)</span> &#123;</span><br><span class="line">    <span class="comment">//根据pid查询商品信息</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.queryProductById(pid);</span><br><span class="line">    <span class="comment">//创建一个用于向持久层传输的OrderItem实体类对象</span></span><br><span class="line">    <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line">    <span class="comment">//补全orderItem对象的空白字段</span></span><br><span class="line">    orderItem.setOid(oid);</span><br><span class="line">    orderItem.setPid(pid);</span><br><span class="line">    orderItem.setTitle(product.getTitle());</span><br><span class="line">    orderItem.setImage(product.getImage());</span><br><span class="line">    orderItem.setPrice(product.getPrice());</span><br><span class="line">    orderItem.setNum(num);</span><br><span class="line">    <span class="type">Date</span> <span class="variable">createdTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    orderItem.setCreatedUser(username);</span><br><span class="line">    orderItem.setCreatedTime(createdTime);</span><br><span class="line">    orderItem.setModifiedUser(username);</span><br><span class="line">    orderItem.setModifiedTime(createdTime);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用持久层进行插入</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> orderMapper.insertOneOrderItem(orderItem);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;服务器出现错误，创建订单失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-13"><a href="#前端页面-13" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li><p>没办法，由于两个页面共用同一个创建订单的方法因此必须在前端页面判断是由哪个界面</p>
<p>进入的确认订单支付界面</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给在线支付按钮绑定单击事件</span></span><br><span class="line">$(<span class="string">&quot;#btn-create-order&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//获取用户选择的是哪一个地址的value值</span></span><br><span class="line">    <span class="keyword">let</span> aid = <span class="title function_">getSelectOption</span>();</span><br><span class="line">    <span class="keyword">let</span> totalPrice = <span class="title class_">JSON</span>.<span class="title function_">parse</span>($(<span class="string">&quot;#all-price&quot;</span>).<span class="title function_">html</span>());</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/order/createOrder&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;<span class="attr">aid</span>:aid,<span class="attr">totalPrice</span>:totalPrice&#125;,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="comment">//获取已经创建的order的订单号</span></span><br><span class="line">            <span class="keyword">let</span> oid = res.<span class="property">data</span>.<span class="property">oid</span></span><br><span class="line">            <span class="comment">//获取地址栏上的参数</span></span><br><span class="line">            <span class="keyword">let</span> urlParam = location.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>)<span class="comment">//截取地址栏url?后的第二个元素</span></span><br><span class="line">            <span class="comment">//判断是否携带了cids，不等于-1代表是从购物车进入这个界面</span></span><br><span class="line">            <span class="keyword">if</span>(urlParam.<span class="title function_">search</span>(<span class="string">&quot;cids&quot;</span>) !== -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//获取每个cid取创建orderItem数据</span></span><br><span class="line">                <span class="title function_">useCidSentAjaxCreateOrderItem</span>(oid);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; <span class="comment">//等于1代表不是从购物车进入这个界面</span></span><br><span class="line">                <span class="comment">//实现商品界面的立即购买创建订单</span></span><br><span class="line">                <span class="title function_">fromProductSentAjaxCreateOrderItem</span>(oid);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>)&#123;</span><br><span class="line">            <span class="title function_">alert</span>(error.<span class="property">message</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//表示这是从商品界面进入的确认订单界面</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fromProductSentAjaxCreateOrderItem</span>(<span class="params">oid</span>)&#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/order/createOrderItem&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;<span class="attr">oid</span>:oid,<span class="attr">pid</span>:pid,<span class="attr">num</span>:num&#125;,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="comment">//跳转到指定页面</span></span><br><span class="line">                location.<span class="property">href</span> = <span class="string">&quot;payment.html?oid=&quot;</span> + oid</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;创建orderItem订单失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>)&#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;服务器内部异常！&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<hr>
<h2 id="购物车管理"><a href="#购物车管理" class="headerlink" title="购物车管理"></a>购物车管理</h2><h3 id="创建数据表-4"><a href="#创建数据表-4" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_cart (</span><br><span class="line">    cid <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;购物车数据id&#x27;</span>,</span><br><span class="line">    uid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">    pid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品id&#x27;</span>,</span><br><span class="line">    price <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;加入时商品单价&#x27;</span>,</span><br><span class="line">    num <span class="type">INT</span> COMMENT <span class="string">&#x27;商品数量&#x27;</span>,</span><br><span class="line">    created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">    created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">    modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (cid)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<h3 id="创建实体类-4"><a href="#创建实体类-4" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cart</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Integer pid  ; </span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="加入购物车"><a href="#加入购物车" class="headerlink" title="加入购物车"></a>加入购物车</h3><h4 id="后端-持久层-13"><a href="#后端-持久层-13" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>根据用户uid和商品pid查询某条购物车cid数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_cart <span class="keyword">where</span> uid <span class="operator">=</span> #&#123;uid&#125; <span class="keyword">and</span> pid <span class="operator">=</span> #&#123;pid&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>更新cid数据</span><br><span class="line"><span class="keyword">update</span> t_cart <span class="keyword">set</span> price <span class="operator">=</span> #&#123;price&#125;,num <span class="operator">=</span> #&#123;num&#125;,</span><br><span class="line">				  modified_user <span class="operator">=</span> #&#123;modifiedUser&#125;,modified_time <span class="operator">=</span> #&#123;modifiedTime&#125;</span><br><span class="line">				  <span class="keyword">where</span> cid <span class="operator">=</span> #&#123;cid&#125;</span><br><span class="line">				  </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>插入新的cart的数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_cart(uid,pid,price,num,created_user,created_time,modified_user,modified_time)</span><br><span class="line">                          <span class="keyword">values</span>(#&#123;uid&#125;,#&#123;pid&#125;,#&#123;price&#125;,#&#123;num&#125;,</span><br><span class="line">                                 #&#123;createdUser&#125;,#&#123;createdTime&#125;,</span><br><span class="line">                                 #&#123;modifiedUser&#125;,#&#123;modifiedTime&#125;</span><br><span class="line">                                )</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口和抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实体类Cart对应的mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CartMapper</span> &#123;</span><br><span class="line"><span class="comment">//根据用户uid和商品pid查询某条购物车cid数据</span></span><br><span class="line">Cart <span class="title function_">queryCartByUidAndPid</span><span class="params">(Integer uid, <span class="meta">@Param(&quot;pid&quot;)</span> Integer pid)</span>;</span><br><span class="line"><span class="comment">//更新cart数据</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateCartInfo</span><span class="params">(Cart cart)</span>;</span><br><span class="line"><span class="comment">//新增cart数据</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addCart</span><span class="params">(Cart cart)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-13"><a href="#后端-业务层-13" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常。没想到异常</p>
<p>2.定义service接口和抽象方法</p>
<p>3.编写具体逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据uid和pid查询Cart信息的抽象方法</span></span><br><span class="line">Cart <span class="title function_">queryCartByUidAndPid</span><span class="params">(Integer uid,Integer pid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新数据的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">UpdateCartInfo</span><span class="params">(Cart cart,String modifiedUser, Date modifiedTime)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增数据的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addCart</span><span class="params">(Cart cart,String createdUser,Date createdTime,String modifiedUser, Date modifiedTime)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理购物车管理接口的实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ICartServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICartService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CartMapper cartMapper;</span><br><span class="line">    <span class="comment">//根据uid和aid查询数据的具体逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Cart <span class="title function_">queryCartByUidAndPid</span><span class="params">(Integer uid, Integer pid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cartMapper.queryCartByUidAndPid(uid,pid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新cart数据的具体逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">UpdateCartInfo</span><span class="params">(Cart cart, String modifiedUser, Date modifiedTime)</span> &#123;</span><br><span class="line">        <span class="comment">//更改修改人和修改时间的字段</span></span><br><span class="line">        cart.setModifiedUser(modifiedUser);</span><br><span class="line">        cart.setModifiedTime(modifiedTime);</span><br><span class="line">        <span class="comment">//执行修改</span></span><br><span class="line">        <span class="keyword">return</span> cartMapper.updateCartInfo(cart);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 新增cart数据的抽象方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addCart</span><span class="params">(Cart cart,String createdUser,Date createdTime,String modifiedUser, Date modifiedTime)</span> &#123;</span><br><span class="line">        <span class="comment">//取得当前商品的pid和用户uid</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pid</span> <span class="operator">=</span> cart.getPid();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> cart.getUid();</span><br><span class="line">        <span class="comment">//查询当前pid在当前用户的购物车中是否存在</span></span><br><span class="line">        <span class="type">Cart</span> <span class="variable">destCart</span> <span class="operator">=</span> cartMapper.queryCartByUidAndPid(uid, pid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据查询的结果做出不同动作</span></span><br><span class="line">        <span class="keyword">if</span> (destCart == <span class="literal">null</span>)&#123; <span class="comment">//表示不存在，则直接添加</span></span><br><span class="line">            <span class="comment">//补全其他四个字段</span></span><br><span class="line">            cart.setCreatedUser(createdUser);</span><br><span class="line">            cart.setCreatedTime(createdTime);</span><br><span class="line">            cart.setModifiedUser(modifiedUser);</span><br><span class="line">            cart.setModifiedTime(modifiedTime);</span><br><span class="line">            <span class="comment">//执行插入操作</span></span><br><span class="line">            <span class="keyword">return</span> cartMapper.addCart(cart);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123; <span class="comment">//表示该用户已存在该产品的数据</span></span><br><span class="line">            <span class="comment">//取出查询的数据数量</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">destNum</span> <span class="operator">=</span> destCart.getNum();</span><br><span class="line">            <span class="comment">//取出新添加产品的数量</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">cartNum</span> <span class="operator">=</span> cart.getNum();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//计算最终的数量</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">endNum</span> <span class="operator">=</span> destNum + cartNum;</span><br><span class="line">            <span class="comment">//并更新需要更新的字段</span></span><br><span class="line">            destCart.setNum(endNum);</span><br><span class="line">            destCart.setModifiedUser(modifiedUser);</span><br><span class="line">            destCart.setModifiedTime(modifiedTime);</span><br><span class="line">            <span class="comment">//执行更新操作</span></span><br><span class="line">            <span class="keyword">return</span> cartMapper.updateCartInfo(destCart);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-13"><a href="#后端-控制层-13" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.无异常，不需要处理</p>
<p>2.设计请求</p>
<p>请求地址：&#x2F;cart&#x2F;addCart</p>
<p>请求参数：Cart cart, HttpSession session</p>
<p>请求类型：post</p>
<p>响应类型：JsonResult&lt; void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/addCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">addCart</span><span class="params">(Cart cart, HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//从session中区域uid和用户名</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">    cart.setUid(uid);</span><br><span class="line">    <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> cartService.addCart(cart, username, date, username, date);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span>  <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;服务器或数据库异常，加入购物车失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-14"><a href="#前端页面-14" class="headerlink" title="前端页面"></a>前端页面</h4><p>①给加入购物车绑定点击事件，点击就发送ajax请求，成功则提示添加成功，在购物车等您结算！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addProductToCart</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> pid = <span class="title function_">getPidFromLastHtml</span>();</span><br><span class="line">    $(<span class="string">&quot;.go-cart&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> price = $(<span class="string">&quot;#product-price&quot;</span>).<span class="title function_">text</span>()</span><br><span class="line">        <span class="keyword">let</span> num = $(<span class="string">&quot;#num&quot;</span>).<span class="title function_">val</span>()</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/cart/addCart&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;<span class="attr">pid</span>:pid,<span class="attr">price</span>:price,<span class="attr">num</span>:num&#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;已成功加入购物车，在购物车等您结算哟！&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            error : <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;服务器出现错误，加入购物车失败！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="展示购物车"><a href="#展示购物车" class="headerlink" title="展示购物车"></a>展示购物车</h3><h4 id="后端-持久层-14"><a href="#后端-持久层-14" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>根据用户uid查询信息</span><br><span class="line"><span class="keyword">SELECT</span> c.cid,c.pid,c.`uid`,c.price,c.num,p.title,p.image,p.`price` <span class="keyword">AS</span> real_price</span><br><span class="line">                    <span class="keyword">FROM</span> t_cart c <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_product p</span><br><span class="line">                    <span class="keyword">ON</span> c.pid <span class="operator">=</span> p.`id`</span><br><span class="line">                    <span class="keyword">WHERE</span> c.`uid` <span class="operator">=</span> #&#123;uid&#125;</span><br><span class="line">                    <span class="keyword">order</span> <span class="keyword">by</span> c.created_time <span class="keyword">desc</span>                   </span><br></pre></td></tr></table></figure>

<p>2.在对应的mapper接口定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据uid查询用户购物车信息</span></span><br><span class="line">List&lt;CartVo&gt; <span class="title function_">queryAllCartsByUid</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper的映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-14"><a href="#后端-业务层-14" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常</p>
<p>2.定义抽象方法</p>
<p>3.编写具体业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据uid查询用户CartVo信息的抽象方法</span></span><br><span class="line">List&lt;CartVo&gt; <span class="title function_">queryCartByUid</span><span class="params">(Integer uid)</span>;</span><br><span class="line"><span class="comment">//根据uid查询用户购物车信息的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CartVo&gt; <span class="title function_">queryCartByUid</span><span class="params">(Integer uid)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cartMapper.queryAllCartsByUid(uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-14"><a href="#后端-控制层-14" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.无异常，不需要处理</p>
<p>2.设计请求</p>
<p>请求地址：&#x2F;cart&#x2F;showCarts</p>
<p>请求参数：HttpSession session</p>
<p>请求类型：get</p>
<p>响应类型：JsonResult&lt; List&lt; Cart&gt;&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理查询用户购物车信息的请求</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/showCarts&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;CartVo&gt;&gt; <span class="title function_">showCarts</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">    List&lt;CartVo&gt; carts = cartService.queryCartByUid(uid);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,carts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-15"><a href="#前端页面-15" class="headerlink" title="前端页面"></a>前端页面</h4><p>①用户点击了购物车，自动发送ajax请求，根据返回的内容填充购物车的内容</p>
<ul>
<li>代码量过大，需要到cart.html的script标签中查看</li>
</ul>
<hr>
<h3 id="删除商品"><a href="#删除商品" class="headerlink" title="删除商品"></a>删除商品</h3><h4 id="后端-持久层-15"><a href="#后端-持久层-15" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句编写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>根据cid删除指定商品</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_cart <span class="keyword">where</span> cid <span class="operator">=</span> #&#123;cid&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据cid删除指定商品</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteCartByCid</span><span class="params">(Integer cid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper映射文件</p>
<h4 id="后端-业务层-15"><a href="#后端-业务层-15" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常规划，删除失败</p>
<p>2.定义抽象方法</p>
<p>3.编写具体的业务逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据cid删除指定的购物车商品</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteCartByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据cids删除cart信息的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteCartByCid</span><span class="params">(Integer cid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> cartMapper.deleteCartByCid(cid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeleteException</span>(<span class="string">&quot;服务器异常，删除失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-15"><a href="#后端-控制层-15" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.已将异常加入过，不需要重复</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;cart&#x2F;deleteCart</p>
<p>请求参数：Integer[ ] cids</p>
<p>请求方式：post</p>
<p>响应类型：JsonResult&lt; Void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理根据cids内的指定cid删除cart的请求</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/deleteCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">deleteCartByCid</span><span class="params">(Integer[] cids)</span>&#123;</span><br><span class="line">    <span class="comment">//遍历执行删除操作</span></span><br><span class="line">    <span class="keyword">for</span> (Integer cid: cids) &#123;</span><br><span class="line">        cartService.deleteCartByCid(cid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-16"><a href="#前端页面-16" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li>考虑到提高代码复用性，决定前端无论单个还是多个cid都以参数传递，后端以数组接受</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给每个删除按钮绑定点击事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delCartItem</span>(<span class="params">cids</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&quot;确定要删除这条商品吗？&quot;</span>))&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/cart/deleteCart&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="string">&quot;cids=&quot;</span> + cids,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;删除成功&quot;</span>)</span><br><span class="line">                <span class="title function_">showUserCarts</span>();</span><br><span class="line">                $(<span class="string">&quot;#selectCount&quot;</span>).<span class="title function_">empty</span>().<span class="title function_">html</span>(<span class="number">0</span>)</span><br><span class="line">                $(<span class="string">&quot;#selectTotal&quot;</span>).<span class="title function_">empty</span>().<span class="title function_">html</span>(<span class="number">0</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>:<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;删除失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//给批量删除按钮绑定点击事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">selDelCart</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//获取页面中购物车的商品数量</span></span><br><span class="line">    <span class="keyword">let</span> trNum = $(<span class="string">&quot;#cart-list tr&quot;</span>).<span class="property">length</span></span><br><span class="line">    <span class="keyword">let</span> chooseNum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> deletedCids = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">let</span> char = <span class="string">&quot;&amp;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; trNum; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($(<span class="string">&quot;#cid&quot;</span>+ i).<span class="title function_">prop</span>(<span class="string">&quot;checked&quot;</span>))&#123;</span><br><span class="line">            chooseNum += <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">let</span> cids = <span class="title class_">JSON</span>.<span class="title function_">parse</span>($(<span class="string">&quot;#cid&quot;</span>+i).<span class="title function_">val</span>());</span><br><span class="line">            <span class="keyword">let</span> str = <span class="string">&quot;cids=&quot;</span> + cids</span><br><span class="line">            <span class="keyword">if</span> (i === trNum -<span class="number">1</span>)&#123;</span><br><span class="line">                deletedCids += str</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                deletedCids += str + char</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (chooseNum === <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;请先选择需要删除的购物车商品！！！&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&quot;确定要删除这些商品吗？&quot;</span>))&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/cart/deleteCart&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: deletedCids,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;批量删除成功&quot;</span>)</span><br><span class="line">                <span class="title function_">showUserCarts</span>();</span><br><span class="line">                $(<span class="string">&quot;#selectCount&quot;</span>).<span class="title function_">html</span>(<span class="number">0</span>)</span><br><span class="line">                $(<span class="string">&quot;#selectTotal&quot;</span>).<span class="title function_">html</span>(<span class="number">0</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>:<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;删除失败&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="数量增减"><a href="#数量增减" class="headerlink" title="数量增减"></a>数量增减</h3><h4 id="后端-持久层-16"><a href="#后端-持久层-16" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.编写sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>根据cid更新用户商品数量</span><br><span class="line"><span class="keyword">update</span> t_cart <span class="keyword">set</span> num <span class="operator">=</span> #&#123;num&#125;,modified_user <span class="operator">=</span> #&#123;modifiedUser&#125;,modified_time <span class="operator">=</span> #&#123;modifiedTime&#125;</span><br><span class="line">                          <span class="keyword">where</span> cid <span class="operator">=</span> #&#123;cid&#125;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>根据cid查询用户cart信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_cart <span class="keyword">where</span> cid <span class="operator">=</span> #&#123;cid&#125;;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<p>3.编写mapper映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-16"><a href="#后端-业务层-16" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，更新失败,数据不存在</p>
<p>2.定义service接口的抽象方法</p>
<p>3.编写具体的处理逻辑(已开发过无需重复)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据cid查询用户cart信息</span></span><br><span class="line">Cart <span class="title function_">queryCartByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateCartNumByCid</span><span class="params">(Integer num, String modifiedUser, Date modifiedTime, Integer cid)</span> &#123;</span><br><span class="line">    <span class="comment">//现根据cid查询此数据是否存在</span></span><br><span class="line">    <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> cartMapper.queryCartByCid(cid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cart == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CartInfoNotExistsException</span>(<span class="string">&quot;购物车内无这条数据，增加失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cartMapper.UpdateCartNumByCid(num,modifiedUser,modifiedTime,cid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-16"><a href="#后端-控制层-16" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.处理异常，将异常加入到异常处理</p>
<p>2.设计请求</p>
<p>请求地址：&#x2F;cart&#x2F;updateCart</p>
<p>请求参数：Integer num,Integer cid,HttpSession session</p>
<p>请求类型：post</p>
<p>响应类型：JsonResult&lt; void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/updateCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateCateByCid</span><span class="params">(Integer num,Integer cid,HttpSession session)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">modifiedUser</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">    <span class="type">Date</span> <span class="variable">modifiedTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    cartService.updateCartNumByCid(num,modifiedUser,modifiedTime,cid);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="前端页面-17"><a href="#前端页面-17" class="headerlink" title="前端页面"></a>前端页面</h4><p>① 给增加和减少按钮绑定点击事件，在发送ajax请求之前先把数据减少或增加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//按加号数量增，减号的逻辑同理</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addNum</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> n = <span class="built_in">parseInt</span>($(<span class="string">&quot;#goodsCount&quot;</span>+num).<span class="title function_">val</span>());</span><br><span class="line">    $(<span class="string">&quot;#goodsCount&quot;</span>+num).<span class="title function_">val</span>(n + <span class="number">1</span>);</span><br><span class="line">    <span class="title function_">calcRow</span>(num);</span><br><span class="line">    <span class="keyword">let</span> cid = $(<span class="string">&quot;#cid&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">let</span> updateNum = $(<span class="string">&quot;#goodsCount&quot;</span>+num).<span class="title function_">val</span>()</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        url : <span class="string">&quot;http://localhost:8080/cart/updateCart&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:&#123;<span class="attr">cid</span>:cid,<span class="attr">num</span>:updateNum&#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;增加失败，请等待攻城狮修复！！&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算单行小计价格的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calcRow</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="comment">//取单价</span></span><br><span class="line">    <span class="keyword">var</span> vprice = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#goodsPrice&quot;</span>+num).<span class="title function_">html</span>());</span><br><span class="line">    <span class="comment">//取数量</span></span><br><span class="line">    <span class="keyword">var</span> vnum = <span class="built_in">parseFloat</span>($(<span class="string">&quot;#goodsCount&quot;</span>+num).<span class="title function_">val</span>());</span><br><span class="line">    <span class="comment">//小计金额</span></span><br><span class="line">    <span class="keyword">var</span> vtotal = vprice * vnum;</span><br><span class="line">    <span class="comment">//赋值</span></span><br><span class="line">    $(<span class="string">&quot;#goodsCast&quot;</span>+num).<span class="title function_">html</span>(<span class="string">&quot;¥&quot;</span> + vtotal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="商品结算"><a href="#商品结算" class="headerlink" title="商品结算"></a>商品结算</h3><h4 id="后端-持久层-17"><a href="#后端-持久层-17" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><ul>
<li>关于展示用户收货地址所需要的在前面写好了因此在这不再重复</li>
</ul>
<p>1.sql语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>根据用户cid查询对应的cartVo信息</span><br><span class="line"><span class="keyword">SELECT</span> c.cid,c.pid,c.`uid`,c.price,c.num,p.title,p.image,p.`price` <span class="keyword">AS</span> real_price</span><br><span class="line">                               <span class="keyword">FROM</span> t_cart c <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_product p</span><br><span class="line">                               <span class="keyword">ON</span> c.pid <span class="operator">=</span> p.`id`</span><br><span class="line">                               <span class="keyword">WHERE</span> c.`cid` <span class="operator">=</span> #&#123;cid&#125;</span><br><span class="line">                               <span class="keyword">order</span> <span class="keyword">by</span> c.created_time <span class="keyword">desc</span>             </span><br></pre></td></tr></table></figure>

<p>2.mapper抽象接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据cid查询返回CartVo对象</span></span><br><span class="line">CartVo <span class="title function_">queryCartVoByCid</span><span class="params">(Integer cid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper的映射文件</p>
<h4 id="后端-业务层-17"><a href="#后端-业务层-17" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常。没有异常</p>
<p>2.定义抽象接口</p>
<p>3.编写具体逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据cid查询返回CartVo对象</span></span><br><span class="line">CartVo <span class="title function_">queryCartVoByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line"><span class="comment">//根据cids数组批量查询对应订单信息</span></span><br><span class="line">List&lt;Cart&gt; <span class="title function_">queryCartByCids</span><span class="params">(Integer[] cids)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据cid返回CartVo对象的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> CartVo <span class="title function_">queryCartVoByCid</span><span class="params">(Integer cid)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cartMapper.queryCartVoByCid(cid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据cids数组的内容查询cart信息的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CartVo&gt; <span class="title function_">queryCartByCids</span><span class="params">(Integer[] cids)</span> &#123;</span><br><span class="line">    List&lt;CartVo&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer cid : cids) &#123;</span><br><span class="line">        <span class="type">CartVo</span> <span class="variable">destCartVo</span> <span class="operator">=</span> cartMapper.queryCartVoByCid(cid);</span><br><span class="line">        list.add(destCartVo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="后端-控制层-17"><a href="#后端-控制层-17" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.没有异常需要处理</p>
<p>2.设计请求</p>
<p>请求地址：&#x2F;cart&#x2F;queryCids</p>
<p>请求参数：Integer[] cids</p>
<p>请求类型：get</p>
<p>响应类型：JsonResult&lt;List&lt; Cart&gt; &gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理cids数组的内容查询cart信息的请求</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/queryCids&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;Cart&gt;&gt; <span class="title function_">queryCids</span><span class="params">(Integer[] cids)</span>&#123;</span><br><span class="line">    List&lt;Cart&gt; list = cartService.queryCartByCids(cids);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-18"><a href="#前端页面-18" class="headerlink" title="前端页面"></a>前端页面</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showOrderItem</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//自动发送ajax请求查询url地址上的cid信息</span></span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        url : <span class="string">&quot;http://localhost:8080/cart/queryCids&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: location.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>),</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">            $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">empty</span>()</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; res.<span class="property">data</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="keyword">let</span> cartVo = res.<span class="property">data</span>[i]</span><br><span class="line">                <span class="keyword">let</span> totalPrice = cartVo.<span class="property">price</span> * cartVo.<span class="property">num</span></span><br><span class="line">                str =   <span class="string">&quot;&lt;tr&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;td&gt;&lt;img src=..&quot;</span> + cartVo.<span class="property">image</span> + <span class="string">&quot;collect.png&quot;</span> + <span class="string">&quot; class=&#x27;img-responsive&#x27; /&gt;&lt;/td&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;td&gt;&quot;</span> + cartVo.<span class="property">title</span> + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;td&gt;¥&lt;span&gt;&quot;</span> + cartVo.<span class="property">price</span> + <span class="string">&quot;&lt;/span&gt;&lt;/td&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;td&gt;&quot;</span> + cartVo.<span class="property">num</span> + <span class="string">&quot;&lt;/td&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;td&gt;&lt;span&gt;&quot;</span> + totalPrice + <span class="string">&quot;&lt;/span&gt;&lt;/td&gt;&quot;</span></span><br><span class="line">                    + <span class="string">&quot;&lt;/tr&gt;&quot;</span></span><br><span class="line">                $(<span class="string">&quot;#cart-list&quot;</span>).<span class="title function_">append</span>(str)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;增加失败，请等待攻城狮修复！！&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//页面加载完成时自动发送</span></span><br><span class="line">    <span class="title function_">showOrderItem</span>();</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="订单管理"><a href="#订单管理" class="headerlink" title="订单管理"></a>订单管理</h2><h3 id="创建数据表-5"><a href="#创建数据表-5" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order (</span><br><span class="line">	oid <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">	uid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">	recv_name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人姓名&#x27;</span>,</span><br><span class="line">	recv_phone <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;收货人电话&#x27;</span>,</span><br><span class="line">	recv_province <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;收货人所在省&#x27;</span>,</span><br><span class="line">	recv_city <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;收货人所在市&#x27;</span>,</span><br><span class="line">	recv_area <span class="type">VARCHAR</span>(<span class="number">15</span>) COMMENT <span class="string">&#x27;收货人所在区&#x27;</span>,</span><br><span class="line">	recv_address <span class="type">VARCHAR</span>(<span class="number">50</span>) COMMENT <span class="string">&#x27;收货详细地址&#x27;</span>,</span><br><span class="line">	total_price <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;总价&#x27;</span>,</span><br><span class="line">	status <span class="type">INT</span> COMMENT <span class="string">&#x27;状态：0-未支付，1-已支付，2-已取消，3-已关闭，4-已完成&#x27;</span>,</span><br><span class="line">	order_time DATETIME COMMENT <span class="string">&#x27;下单时间&#x27;</span>,</span><br><span class="line">	pay_time DATETIME COMMENT <span class="string">&#x27;支付时间&#x27;</span>,</span><br><span class="line">	created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">	created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">	modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (oid)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_order_item (</span><br><span class="line">	id <span class="type">INT</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单中的商品记录的id&#x27;</span>,</span><br><span class="line">	oid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;所归属的订单的id&#x27;</span>,</span><br><span class="line">	pid <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品的id&#x27;</span>,</span><br><span class="line">	title <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品标题&#x27;</span>,</span><br><span class="line">	image <span class="type">VARCHAR</span>(<span class="number">500</span>) COMMENT <span class="string">&#x27;商品图片&#x27;</span>,</span><br><span class="line">	price <span class="type">BIGINT</span> COMMENT <span class="string">&#x27;商品价格&#x27;</span>,</span><br><span class="line">	num <span class="type">INT</span> COMMENT <span class="string">&#x27;购买数量&#x27;</span>,</span><br><span class="line">	created_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">	created_time DATETIME COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	modified_user <span class="type">VARCHAR</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">	modified_time DATETIME COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<h3 id="创建实体类-5"><a href="#创建实体类-5" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对应数据表t_order的实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer oid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> String recvName;</span><br><span class="line">    <span class="keyword">private</span> String recvPhone;</span><br><span class="line">    <span class="keyword">private</span> String recvProvince;</span><br><span class="line">    <span class="keyword">private</span> String recvCity;</span><br><span class="line">    <span class="keyword">private</span> String recvArea;</span><br><span class="line">    <span class="keyword">private</span> String recvAddress;</span><br><span class="line">    <span class="keyword">private</span> Long totalPrice;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> Date orderTime;</span><br><span class="line">    <span class="keyword">private</span> Date payTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应数据表t_order_item的实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderItem</span> <span class="keyword">extends</span> <span class="title class_">BaseEntity</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer oid;</span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> Integer num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建订单"><a href="#创建订单" class="headerlink" title="创建订单"></a>创建订单</h3><h4 id="后端-持久层-18"><a href="#后端-持久层-18" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句编写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>向<span class="keyword">order</span>表中插入一条<span class="keyword">order</span>数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_order(uid,recv_name,recv_phone,recv_province,recv_city,recv_area,recv_address,</span><br><span class="line">                   total_price,status,order_time,pay_time,created_user,created_time,modified_user,modified_time)</span><br><span class="line">                   <span class="keyword">values</span>(</span><br><span class="line">                       #&#123;uid&#125;,#&#123;recvName&#125;,#&#123;recvPhone&#125;,#&#123;recvProvince&#125;,#&#123;recvCity&#125;,#&#123;recvArea&#125;,#&#123;recvAddress&#125;,</span><br><span class="line">                       #&#123;totalPrice&#125;,#&#123;status&#125;,#&#123;orderTime&#125;,#&#123;payTime&#125;,#&#123;createdUser&#125;,#&#123;createdTime&#125;,</span><br><span class="line">                       #&#123;modifiedUser&#125;,#&#123;modifiedTime&#125;)		</span><br><span class="line">                       </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>向order_item表中插入一条orderItem数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_order_item(oid,pid,title,image,price,num,</span><br><span class="line">                        created_user,created_time,modified_user,modified_time)</span><br><span class="line">                        <span class="keyword">values</span>(#&#123;oid&#125;,#&#123;pid&#125;,#&#123;title&#125;,#&#123;image&#125;,#&#123;price&#125;,</span><br><span class="line">                               #&#123;num&#125;,#&#123;createdUser&#125;,#&#123;createdTime&#125;,#&#123;modifiedUser&#125;,#&#123;modifiedTime&#125;</span><br><span class="line">                          )</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口和抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实体类Order对应的mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line">    <span class="comment">//插入一条order订单数据</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertOneOrder</span><span class="params">(Order order)</span>;</span><br><span class="line">    <span class="comment">//向order_item表中插入一条orderItem数据</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertOneOrderItem</span><span class="params">(OrderItem orderItem)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.编写mapper的映射文件</p>
<p>设置自定义的结果集映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-18"><a href="#后端-业务层-18" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，插入失败</p>
<p>2.定义service层接口和抽象方法</p>
<p>3.编写具体的处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理添加order订单数据的抽象方法</span></span><br><span class="line">Order <span class="title function_">insertOrder</span><span class="params">(Integer aid, Long totalPrice, Integer uid, String username)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理添加orderItem数据的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertOrderItem</span><span class="params">(Integer oid, Integer cid, Integer num, String username)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体的处理逻辑</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IOrderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IOrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> IAddressService addressService;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> ICartService cartService;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> IProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">insertOrder</span><span class="params">(Integer aid,Long totalPrice,Integer uid,String username)</span> &#123;</span><br><span class="line">        <span class="comment">//根据控制层传入的aid进行查询</span></span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.queryAddressByAid(aid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个用于向持久层传输的Order实体类对象</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//补全order对象的空白字段</span></span><br><span class="line">        order.setUid(uid);</span><br><span class="line">        order.setRecvName(address.getName());</span><br><span class="line">        order.setRecvPhone(address.getPhone());</span><br><span class="line">        order.setRecvProvince(address.getProvinceName());</span><br><span class="line">        order.setRecvCity(address.getCityName());</span><br><span class="line">        order.setRecvArea(address.getAreaName());</span><br><span class="line">        order.setRecvAddress(address.getAddress());</span><br><span class="line">        order.setTotalPrice(totalPrice);</span><br><span class="line">        order.setStatus(<span class="number">0</span>); <span class="comment">//表示未支付</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">createdTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        order.setOrderTime(createdTime);</span><br><span class="line">        order.setPayTime(<span class="literal">null</span>);</span><br><span class="line">        order.setCreatedUser(username);</span><br><span class="line">        order.setModifiedUser(username);</span><br><span class="line">        order.setCreatedTime(createdTime);</span><br><span class="line">        order.setModifiedTime(createdTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用持久层进行插入</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> orderMapper.insertOneOrder(order);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;服务器出现错误，创建订单失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="comment">//根据oid查询指定的订单，并返回给控制层</span></span><br><span class="line">        <span class="keyword">return</span> orderMapper.queryOrderByOid(order.getOid());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertOrderItem</span><span class="params">(Integer oid, Integer cid, Integer num, String username)</span> &#123;</span><br><span class="line">        <span class="comment">//根据cid查询订单获取pid</span></span><br><span class="line">        <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> cartService.queryCartByCid(cid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取出pid的值</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">pid</span> <span class="operator">=</span> cart.getPid();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据pid查询商品信息</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.queryProductById(pid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个用于向持久层传输的OrderItem实体类对象</span></span><br><span class="line">        <span class="type">OrderItem</span> <span class="variable">orderItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderItem</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//补全orderItem对象的空白字段</span></span><br><span class="line">        orderItem.setOid(oid);</span><br><span class="line">        orderItem.setPid(pid);</span><br><span class="line">        orderItem.setTitle(product.getTitle());</span><br><span class="line">        orderItem.setImage(product.getImage());</span><br><span class="line">        orderItem.setPrice(product.getPrice());</span><br><span class="line">        orderItem.setNum(num);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">createdTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        orderItem.setCreatedUser(username);</span><br><span class="line">        orderItem.setCreatedTime(createdTime);</span><br><span class="line">        orderItem.setModifiedUser(username);</span><br><span class="line">        orderItem.setModifiedTime(createdTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用持久层进行插入</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> orderMapper.insertOneOrderItem(orderItem);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;服务器出现错误，创建订单失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-18"><a href="#后端-控制层-18" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.处理异常，已添加无需再重复</p>
<p>2.设计请求</p>
<p>请求路径： ①&#x2F;order&#x2F;createOrder  ②&#x2F;order&#x2F;createOrderItem</p>
<p>请求参数：①Integer aid,Long totalPrice,HttpSession session</p>
<p>​					②Integer oid,Integer cid,Integer pid,Integer num,HttpSession session</p>
<p>请求类型：post</p>
<p>响应类型：①JsonResult&lt; Order&gt; ②①JsonResult&lt; Void&gt;</p>
<p>3.创建一个新的控制器处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/createOrder&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Order&gt; <span class="title function_">createOrder</span><span class="params">(Integer aid,Long totalPrice,HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//从session中取出用户名和uid</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line">    <span class="comment">//调用业务层方法执行插入操作</span></span><br><span class="line">    orderService.insertOrder(aid,totalPrice,uid,username);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/createOrderItem&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">createOrderItem</span><span class="params">(Integer oid,Integer cid,Integer num,HttpSession session)</span>&#123;</span><br><span class="line">        <span class="comment">//从session中取出用户名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> getUsernameFromSession(session);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用业务层方法执行插入操作</span></span><br><span class="line">        orderService.insertOrderItem(oid,cid,num,username);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-19"><a href="#前端页面-19" class="headerlink" title="前端页面"></a>前端页面</h4><p>①在用户选择了商品来到确认订单页面之后</p>
<p>②确认商品无误之后，点击在线支付按钮，那么在点击之后就要生成order订单，</p>
<p>​	生成order订单项就应该发送一个ajax请求，且这个ajax请求生成的oid订单号需要返回给前端</p>
<p>​	在前端需要时带着这个订单号跳转到下一个指定页面</p>
<p>③且将oid传入另一个方法中，在这个方法内获取客户所勾选的商品的数量，</p>
<p>​	并根据这个数量将获取每一个商品cid，发送与商品个数一致的次数的ajax请求</p>
<p>​	并且每个ajax都需要带着cid和num和oid</p>
<ul>
<li><font color='red'><strong>javaScript代码太长，不予展示，需要到项目于的&#x2F;web&#x2F;orderConfirm.htmll页面查看</strong></font></li>
</ul>
<hr>
<h3 id="集成支付宝沙箱支付"><a href="#集成支付宝沙箱支付" class="headerlink" title="集成支付宝沙箱支付"></a>集成支付宝沙箱支付</h3><p>①引入依赖到pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入支付宝沙箱支付依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.23.26.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②编写alipayConfig用于设置请求属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//支付宝沙箱支付配置类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayConfig</span> &#123;</span><br><span class="line">    <span class="comment">//自己的appId</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">appId</span> <span class="operator">=</span> <span class="string">&quot;2021000121634026&quot;</span>;</span><br><span class="line">    <span class="comment">//应用私有秘钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">appPrivateKey</span> <span class="operator">=</span> <span class="string">&quot;MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDDnIWV/KsE+T3hpSr7+H//GdKsTbVcc/fpsp/RI9Aqfg0z009TrUI+NQ9+6mI4YxQUZnnUM1sRcnAQI4ivnGu2qkZFoot7gv50jwvZD8amIe6b3Joed2DBOKps2IJuyOwjV4Ae+WBJW5bSNiuuYu6UjanX69nK8TU6y6K39p02YnDqC47Z0veKVbAmpbsOnks1gGd+Cgcm5fSsdcx+aGKSt6YEJuYkqri9lUExHSYkZLNfzzAXRujyLCk0lLHdzUNDoatIyukk1HhCyvLosg3oaCtvIzqGC8/XHCEQ5r8JD4nKd/gGoyolWzhJvFcFkKmHjPZA8vT8TP1ZC1z1m1DvAgMBAAECggEBAI0C7JnvByoSsrVTZ+U0grDXYLOtYSxAvVrO1b7iXlIDhGjzz5+2qqZFgeIv/JZBdlwuc2yxiNjO8lHwC7zsugl4Pig8wOhMyjokVJopcT6Z/3SEVuXXkPw5aUIF4iES3oersESj6PF5AQSQ4HRaBTs51FI/R0WxFHpKCgcr1LE6inEn862CvZlbh2Cqh6rqBxB1ESi4eRhAj+FsJlczqWDCLn2dG1Ki7IhkuApdNFs9lurGeXGu/FBphaaprAiTVWuxyBWIdW5TYACjkNZ+oXrzCJK6t0DWsmxAbaZHMiLIVIAypZ6p8/kf/b70zXRYhkXQ6KUKpo983G6dBBPUF0ECgYEA7ta+jK3OZvzwZQeaBXYS4vi28jgpLg/v/DFpdcwaAShKEms/R7XZ8wZ9y4jabQKOuyJX69NS7dhfNv4wdW976BkIevwANM6haFSh5bJsq+EK8fwXEPez2uKPLsIdSgBwwh6En4vClOUTOOprLuyTXM7mQNqSW+AsaLmlaGYDuhcCgYEA0aqkcJMysXnGIc7nbJDiWvsRihe5WMsMCOY6vtjVPMh/qEasT9Hxhv4Gs+Pso15MNxhDuRddp+qgXyuUXGkeii8h+p2MgO5O5tA1T74APaDclmyiuc27Rj27Cc9mbFTWOk5txrXgzqEJjw9HudUHTJmpKoqI2aVEK73X6AdB3ukCgYAqHwk/+i8ajqU+zBZnvCkcikyJb0oj63+hdH1q3vH/HkHh+bQRS4sChzSMPrh23Sqa6jWjS4OmmrBAHJgjPeQWTMPoHKVUqtRgd/yNa+gqb+fkQVc4ENdRVP93eZh8wpMgSQ2OrbFFXRkEwqLghax/g6Wr7mA9f82VMphvTv59RQKBgA3YnxNwJSDjUdpZt57L0qb/faEJAAyFHD5aNfb0iuCAvS13vVloG/M2Q2sN2krPp2jcCVzn1h+Itx6R2jJgHswxYKUUUnsRQdSsW1jwy0NGpEqq0fRDSeLRoNB9Cd6Nm7guBcHhsP70U5VHBQ2Yq+q7GxjcHT2CVIYu+1svX4JBAoGARyBB9IjgM9dH0cH8djojC2qlH7Qar9bbvl55i9EQY51d1J/bC5JBE/CAYu0s1MmIatigcJ6A7FyvJ+nnow+qr4tegi5CG76v+Ue/IrgZXJZyDqMBrHorn/SwRXleOj2gjfxkQ8mh0OkrIntbdD6SDnvtXkxcVkfX9ICY5VIA4DA=&quot;</span>;</span><br><span class="line">    <span class="comment">//支付宝公钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">alipayPublicKey</span> <span class="operator">=</span> <span class="string">&quot;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjtedJ8C1NIO3r4vuMThcvTMZxqO3Jki5VYPfkmnraA/PIKXXgsfOdoSWxCsiqPMIBMRT3Oyk1EsxgAeFBKTFaSM5LC8oinTXFbkv+3XEuOjtfqbp0oIgu9pWfJQDL2gIVSbm3VKmdE4UtJ36nu3hyuTT3U19QQsKVgxMDWHCOIw0eCHcJm1xDPj0zmagL3jC7576sXHcnFxEKARGugMpP9bkBgvFkjKrnkQfMAz3OO8vUSC0lCGo2UrSwhyD6zqXVz39sIduVpKTTg+wpAJQ/RhBhLXNw4JW3UaZpX2BZbmqEx91Hpr+O/95Z90cTqT+rwyu6uW612B5bCPnKa+BCQIDAQAB&quot;</span>;</span><br><span class="line">    <span class="comment">//异步回调地址</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">notifyUrl</span> <span class="operator">=</span> <span class="string">&quot;http://h64hsr.natappfree.cc/alipay/notifyNotice&quot;</span>;</span><br><span class="line">    <span class="comment">//同步回调地址</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">returnUrl</span> <span class="operator">=</span> <span class="string">&quot;http://h64hsr.natappfree.cc/alipay/returnNotice&quot;</span>;</span><br><span class="line">    <span class="comment">//推荐使用这个秘钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">signType</span> <span class="operator">=</span> <span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line">    <span class="comment">//使用的编码格式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">charset</span> <span class="operator">=</span> <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line">    <span class="comment">//支付宝默认网关</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">gatewayUrl</span> <span class="operator">=</span> <span class="string">&quot;https://openapi.alipaydev.com/gateway.do&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③创建alipayController，并编写pay接口、异步回调接口、同步回调接口</p>
<ul>
<li><p>由于<font color='red'><strong>在异步回调会出现session失效</strong></font>的问题，解决方法 —&gt; <a target="_blank" rel="noopener" href="https://blog.csdn.net/woniu__/article/details/105320823?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-2-105320823-null-null.pc_agg_new_rank&utm_term=%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%B2%99%E7%AE%B1%E6%94%AF%E4%BB%98%E5%AE%9D%E5%BC%82%E6%AD%A5%E5%9B%9E%E8%B0%83%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F&spm=1000.2123.3001.4430">如何解决异步回调session失效</a></p>
</li>
<li><p>异步接口方法一般用于在支付后进行数据库的修改操作，</p>
<p>而同步接口方法一般是用于向用户显示已支付完成的作用，</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理支付宝沙箱支付的接口</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/alipay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPayController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IOrderService orderService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description : 处理在线支付的请求</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/7/25</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oid 订单id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> totalPrice 订单总金额</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/pay&quot;,produces = &quot;text/html;charset=UTF-8&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">goAlipay</span><span class="params">(String oid,String totalPrice,HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得初始化的AlipayClient</span></span><br><span class="line">        <span class="type">AlipayClient</span> <span class="variable">alipayClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAlipayClient</span>(AlipayConfig.gatewayUrl, AlipayConfig.appId,</span><br><span class="line">                AlipayConfig.appPrivateKey, <span class="string">&quot;json&quot;</span>, AlipayConfig.charset, AlipayConfig.alipayPublicKey,</span><br><span class="line">                AlipayConfig.signType);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置请求参数</span></span><br><span class="line">        <span class="type">AlipayTradePagePayRequest</span> <span class="variable">alipayRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlipayTradePagePayRequest</span>();</span><br><span class="line">        alipayRequest.setReturnUrl(AlipayConfig.returnUrl);</span><br><span class="line">        alipayRequest.setNotifyUrl(AlipayConfig.notifyUrl);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 商户订单号，商户网站订单系统中唯一订单号，必填</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">out_trade_no</span> <span class="operator">=</span> oid;</span><br><span class="line">        <span class="comment">// 付款金额，必填</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">total_amount</span> <span class="operator">=</span> totalPrice;</span><br><span class="line">        <span class="comment">// 订单名称，必填</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="string">&quot;支付宝沙箱测试商品支付&quot;</span>;</span><br><span class="line">        <span class="comment">// 商品描述，可空</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 该笔订单允许的最晚付款时间，逾期将关闭交易。取值范围：1m～15d。m-分钟，h-小时，d-天，1c-当天（1c-当天的情况下，无论交易何时创建，都在0点关闭）。</span></span><br><span class="line">        <span class="comment">// 该参数数值不接受小数点， 如 1.5h，可转换为 90m。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">timeout_express</span> <span class="operator">=</span> <span class="string">&quot;1c&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从session中取出异步需要用的uid</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">str</span> <span class="operator">=</span> (Integer) request.getSession().getAttribute(<span class="string">&quot;uid&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">passback_params</span> <span class="operator">=</span> String.valueOf(str);</span><br><span class="line">        <span class="comment">//对取得的数据进行URLEncoder编码，这一步不做会报错</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uidStr</span> <span class="operator">=</span> URLEncoder.encode(passback_params,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将编码后的数据封装在alipayRequest对象中，参数名字一定要是passback_params才能在异步通知时返回</span></span><br><span class="line">        <span class="comment">//至于参数的变量值这没有要求，只需要与上方编码后的一样即可</span></span><br><span class="line">        alipayRequest.setBizContent(<span class="string">&quot;&#123;\&quot;out_trade_no\&quot;:\&quot;&quot;</span> + out_trade_no + <span class="string">&quot;\&quot;,&quot;</span> + <span class="string">&quot;\&quot;total_amount\&quot;:\&quot;&quot;</span> + total_amount</span><br><span class="line">                + <span class="string">&quot;\&quot;,&quot;</span> + <span class="string">&quot;\&quot;subject\&quot;:\&quot;&quot;</span> + subject + <span class="string">&quot;\&quot;,&quot;</span> + <span class="string">&quot;\&quot;body\&quot;:\&quot;&quot;</span> + body + <span class="string">&quot;\&quot;,&quot;</span> + <span class="string">&quot;\&quot;timeout_express\&quot;:\&quot;&quot;</span></span><br><span class="line">                + timeout_express + <span class="string">&quot;\&quot;,&quot;</span> + <span class="string">&quot;\&quot;passback_params\&quot;:\&quot;&quot;</span> + uidStr + <span class="string">&quot;\&quot;,&quot;</span></span><br><span class="line">                + <span class="string">&quot;\&quot;product_code\&quot;:\&quot;FAST_INSTANT_TRADE_PAY\&quot;&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这个是请求支付宝后台获取的数据，实际上获取是一个表单，然后他会附带一个自动执行的js方法</span></span><br><span class="line">        <span class="comment">//自动替你执行表单，然后进入表单中支付宝生成的页面</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> alipayClient.pageExecute(alipayRequest).getBody();</span><br><span class="line">        log.info(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description : 处理异步回调的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/7/25</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/notifyNotice&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">alipayNotifyNotice</span><span class="params">(HttpServletRequest request, HttpServletRequest response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;支付成功, 进入异步通知接口...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取支付宝POST过来反馈信息</span></span><br><span class="line">        Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        Map&lt;String, String[]&gt; requestParams = request.getParameterMap();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext();) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) iter.next();</span><br><span class="line">            String[] values = (String[]) requestParams.get(name);</span><br><span class="line">            <span class="type">String</span> <span class="variable">valueStr</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">                valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i] : valueStr + values[i] + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 乱码解决，这段代码在出现乱码时使用</span></span><br><span class="line">            <span class="comment">// valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;utf-8&quot;);</span></span><br><span class="line">            params.put(name, valueStr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">signVerified</span> <span class="operator">=</span> AlipaySignature.rsaCheckV1(params, AlipayConfig.alipayPublicKey, AlipayConfig.charset,</span><br><span class="line">                AlipayConfig.signType); <span class="comment">// 调用SDK验证签名</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ——请在这里编写您的程序（以下代码仅作参考）——</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 实际验证过程建议商户务必添加以下校验： 1、需要验证该通知数据中的out_trade_no是否为商户系统中创建的订单号，</span></span><br><span class="line"><span class="comment">         * 2、判断total_amount是否确实为该订单的实际金额（即商户订单创建时的金额）， 3、校验通知中的seller_id（或者seller_email)</span></span><br><span class="line"><span class="comment">         * 是否为out_trade_no这笔单据的对应的操作方（有的时候，一个商户可能有多个seller_id/seller_email）</span></span><br><span class="line"><span class="comment">         * 4、验证app_id是否为该商户本身。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (signVerified) &#123;<span class="comment">// 验证成功</span></span><br><span class="line">            <span class="comment">// 商户订单号</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">out_trade_no</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;out_trade_no&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 支付宝交易号</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">trade_no</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;trade_no&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 交易状态</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">trade_status</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;trade_status&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 付款金额</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">total_amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;total_amount&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//在支付接口中保存在session中uid</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">passback_params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;passback_params&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            <span class="comment">//对传回的数据进行编码的逆过程，对参数进行解码</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uidStr</span> <span class="operator">=</span> URLDecoder.decode(passback_params,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (trade_status.equals(<span class="string">&quot;TRADE_FINISHED&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// 判断该笔订单是否在商户网站中已经做过处理</span></span><br><span class="line">                <span class="comment">// 如果没有做过处理，根据订单号（out_trade_no）在商户网站的订单系统中查到该笔订单的详细，并执行商户的业务程序</span></span><br><span class="line">                <span class="comment">// 如果有做过处理，不执行商户的业务程序</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 注意： 尚自习的订单没有退款功能, 这个条件判断是进不来的, 所以此处不必写代码</span></span><br><span class="line">                <span class="comment">// 退款日期超过可退款期限后（如三个月可退款），支付宝系统发送该交易状态通知</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (trade_status.equals(<span class="string">&quot;TRADE_SUCCESS&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// 判断该笔订单是否在商户网站中已经做过处理</span></span><br><span class="line">                <span class="comment">// 如果没有做过处理，根据订单号（out_trade_no）在商户网站的订单系统中查到该笔订单的详细，并执行商户的业务程序</span></span><br><span class="line">                <span class="comment">// 如果有做过处理，不执行商户的业务程序</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 注意：</span></span><br><span class="line">                <span class="comment">// 付款完成后，支付宝系统发送该交易状态通知</span></span><br><span class="line">                <span class="comment">// 编写自己的订单支付成功的业务逻辑</span></span><br><span class="line">                <span class="comment">//将上方取到的uid和将订单号转换为包装类</span></span><br><span class="line">                <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> Integer.valueOf(uidStr);</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">oid</span> <span class="operator">=</span> Integer.valueOf(out_trade_no);</span><br><span class="line">                <span class="comment">//调用订单业务层修改订单状态信息</span></span><br><span class="line">                orderService.updateOrderStatusByOid(oid,uid,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                log.info(<span class="string">&quot;********************** 支付成功(支付宝异步通知) **********************&quot;</span>);</span><br><span class="line">                log.info(<span class="string">&quot;* 当前支付用户的id: &#123;&#125;&quot;</span>, passback_params);</span><br><span class="line">                log.info(<span class="string">&quot;* 订单号: &#123;&#125;&quot;</span>, out_trade_no);</span><br><span class="line">                log.info(<span class="string">&quot;* 支付宝交易号: &#123;&#125;&quot;</span>, trade_no);</span><br><span class="line">                log.info(<span class="string">&quot;* 实付金额: &#123;&#125;&quot;</span>, total_amount);</span><br><span class="line">                log.info(<span class="string">&quot;***************************************************************&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(<span class="string">&quot;支付成功...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">// 验证失败</span></span><br><span class="line">            log.info(<span class="string">&quot;支付, 验签失败...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description : 同步回调方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/7/25</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/returnNotice&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">alipayReturnNotice</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;支付成功, 进入同步通知接口...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取支付宝GET过来反馈信息</span></span><br><span class="line">        Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        Map&lt;String, String[]&gt; requestParams = request.getParameterMap();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext();) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) iter.next();</span><br><span class="line">            String[] values = (String[]) requestParams.get(name);</span><br><span class="line">            <span class="type">String</span> <span class="variable">valueStr</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">                valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i] : valueStr + values[i] + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 乱码解决，这段代码在出现乱码时使用</span></span><br><span class="line">            valueStr = <span class="keyword">new</span> <span class="title class_">String</span>(valueStr.getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            params.put(name, valueStr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">signVerified</span> <span class="operator">=</span> AlipaySignature.rsaCheckV1(params, AlipayConfig.alipayPublicKey, AlipayConfig.charset,</span><br><span class="line">                AlipayConfig.signType); <span class="comment">// 调用SDK验证签名</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ——请在这里编写您的程序（以下代码仅作参考）——</span></span><br><span class="line">        <span class="keyword">if</span> (signVerified) &#123;</span><br><span class="line">            <span class="comment">// 商户订单号</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">out_trade_no</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;out_trade_no&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 支付宝交易号</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">trade_no</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;trade_no&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 付款金额</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">total_amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;total_amount&quot;</span>).getBytes(<span class="string">&quot;ISO-8859-1&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//同步调用方法中返回到指定的界面</span></span><br><span class="line">            <span class="comment">//携带订单号并跳转到支付成功的界面</span></span><br><span class="line">            response.sendRedirect(request.getContextPath() + <span class="string">&quot;/web/paySuccess.html?oid=&quot;</span> + out_trade_no);</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">&quot;********************** 支付成功(支付宝同步通知) **********************&quot;</span>);</span><br><span class="line">            log.info(<span class="string">&quot;* 订单号: &#123;&#125;&quot;</span>, out_trade_no);</span><br><span class="line">            log.info(<span class="string">&quot;* 支付宝交易号: &#123;&#125;&quot;</span>, trade_no);</span><br><span class="line">            log.info(<span class="string">&quot;* 实付金额: &#123;&#125;&quot;</span>, total_amount);</span><br><span class="line">            log.info(<span class="string">&quot;***************************************************************&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;支付, 验签失败...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="支付订单"><a href="#支付订单" class="headerlink" title="支付订单"></a>支付订单</h3><h4 id="后端-持久层-19"><a href="#后端-持久层-19" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#根据订单号查询订单</span><br><span class="line">select * from t_order where oid = #&#123;oid&#125;</span><br><span class="line"></span><br><span class="line">#根据订单号修改状态</span><br><span class="line">update t_order set status = #&#123;status&#125;,pay_time = #&#123;payTime&#125; where oid = #&#123;oid&#125;</span><br><span class="line"></span><br><span class="line">#根据oid能从order_item表中找到对应的orderItem信息</span><br><span class="line">SELECT * FROM t_order_item WHERE oid = #&#123;oid&#125;</span><br><span class="line"></span><br><span class="line">#根据uid和pid删除对应的t_cart表中的数据</span><br><span class="line">DELETE FROM t_cart WHERE uid = #&#123;uid&#125; AND pid = #&#123;pid&#125; </span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据订单号查询订单</span></span><br><span class="line">Order <span class="title function_">queryOrderByOid</span><span class="params">(Integer oid)</span>;</span><br><span class="line"><span class="comment">//根据订单号修改支付状态和支付时间</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateStatusByOidInt</span><span class="params">(Integer oid, Integer status, Date payTime)</span>;</span><br><span class="line"><span class="comment">//根据oid能从order_item表中找到对应的pid信息</span></span><br><span class="line">List&lt;OrderItem&gt; <span class="title function_">queryOrderItemByOid</span><span class="params">(Integer oid)</span>;</span><br><span class="line"><span class="comment">//根据uid和pid删除对应的t_cart表中的数据</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteCartByUidAndPid</span><span class="params">(Integer uid,Integer pid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写对应的映射文件</p>
<ul>
<li>篇幅较长，就不放这了</li>
</ul>
<p>4.单元测试</p>
<h4 id="后端-业务层-19"><a href="#后端-业务层-19" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，查询订单不存在，修改订单失败</p>
<p>2.定义service层的抽象方法</p>
<p>3.编写具体的业务逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在ICartService业务层接口编写这个根据uid和pid删除对应的t_cart表中的数据的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">deleteCartByUidAndPid</span><span class="params">(Integer uid,Integer pid)</span>;</span><br><span class="line"><span class="comment">//在IOrderService业务层接口编写这个根据oid能从order_item表中找到对应的OrderItem信息的抽象方法</span></span><br><span class="line">List&lt;OrderItem&gt; <span class="title function_">queryOrderItemByOid</span><span class="params">(Integer oid)</span>;</span><br><span class="line"><span class="comment">//根据oid修改oid的订单状态的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateOrderStatusByOid</span><span class="params">(Integer oid,Integer uid,Integer status)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据uid和pid删除对应的t_cart表中的数据的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteCartByUidAndPid</span><span class="params">(Integer uid, Integer pid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> cartMapper.deleteCartByUidAndPid(uid, pid);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeleteException</span>(<span class="string">&quot;服务器异常，删除购物车商品失败!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据订单oid查询orderItem信息的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title function_">queryOrderItemByOid</span><span class="params">(Integer oid)</span> &#123;</span><br><span class="line">    List&lt;OrderItem&gt; orderItems = orderMapper.queryOrderItemByOid(oid);</span><br><span class="line">    <span class="keyword">if</span> (orderItems.size() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderNotExistsException</span>(<span class="string">&quot;订单不存在！！！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> orderItems;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据订单oid修改订单状态的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateOrderStatusByOid</span><span class="params">(Integer oid, Integer uid, Integer status)</span> &#123;</span><br><span class="line">    <span class="comment">//先查询一下订单信息</span></span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.queryOrderByOid(oid);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//status == 0代表刚刚创建</span></span><br><span class="line">    <span class="keyword">if</span> (order.getStatus() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//修改支付时间</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">payTime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        result = orderMapper.updateStatusByOidInt(oid, status,payTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据oid查找具体的OrderItem信息</span></span><br><span class="line">        List&lt;OrderItem&gt; orderItems = orderMapper.queryOrderItemByOid(oid);</span><br><span class="line">        <span class="keyword">for</span> (OrderItem o: orderItems) &#123;</span><br><span class="line">            <span class="comment">//从OrderItem中取得pid</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">pid</span> <span class="operator">=</span> o.getPid();</span><br><span class="line">            <span class="comment">//根据pid和uid删除购物车中的商品</span></span><br><span class="line">            cartService.deleteCartByUidAndPid(uid, pid);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//除了status == 0的状况其他的都可以直接修改其状态</span></span><br><span class="line">        <span class="comment">//修改订单状态</span></span><br><span class="line">        result = orderMapper.updateStatusByOidInt(oid,status,order.getPayTime());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;服务器异常，修改订单状态失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-19"><a href="#后端-控制层-19" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.控制异常，将异常加入全局管理</p>
<p>2.设计请求</p>
<p>请求地址：①&#x2F;order&#x2F;queryOrder ②&#x2F;order&#x2F;updateStatus</p>
<p>请求参数：①Integer oid ；②Integet oid，HttpSession session,Integer status</p>
<p>请求类型：①get ②post</p>
<p>响应类型：①JsonResult&lt; Order&gt;   ②JsonResult&lt; Void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理根据订单oid查询order信息的请求</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/queryOrder&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Order&gt; <span class="title function_">queryOrderByOid</span><span class="params">(Integer oid)</span>&#123;</span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.queryOrderByOid(oid);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,order);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 处理根据订单oid修改订单状态的请求</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/updateStatus&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">updateStatusByOid</span><span class="params">(Integer oid,Integer status)</span>&#123;</span><br><span class="line">    <span class="comment">//修改订单状态</span></span><br><span class="line">    orderService.updateOrderStatusByOid(oid,status);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-20"><a href="#前端页面-20" class="headerlink" title="前端页面"></a>前端页面</h4><p>①在页面加载完成的时候根据上个页面传递的参数查询order</p>
<p>②给确认付款按钮绑定单击事件，发送修改订单状态ajax请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getOrderByOid</span>(<span class="params">oid</span>)&#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        url : <span class="string">&quot;/order/queryOrder&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="string">&quot;oid=&quot;</span> + oid,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="comment">//修改订单号和支付金额</span></span><br><span class="line">                <span class="keyword">let</span> order = res.<span class="property">data</span></span><br><span class="line">                $(<span class="string">&quot;#orderId&quot;</span>).<span class="title function_">html</span>(order.<span class="property">oid</span>)</span><br><span class="line">                $(<span class="string">&quot;#orderPrice&quot;</span>).<span class="title function_">html</span>(order.<span class="property">totalPrice</span>)</span><br><span class="line">                $(<span class="string">&quot;#rightPrice&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;¥&quot;</span> + order.<span class="property">totalPrice</span> + <span class="string">&quot;&amp;nbsp;&quot;</span>)</span><br><span class="line">                <span class="comment">//给隐藏域的属性赋值</span></span><br><span class="line">                $(<span class="string">&quot;#oid&quot;</span>).<span class="title function_">val</span>(order.<span class="property">oid</span>)</span><br><span class="line">                $(<span class="string">&quot;#totalPrice&quot;</span>).<span class="title function_">val</span>(order.<span class="property">totalPrice</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">3000</span>)&#123;</span><br><span class="line">                location.<span class="property">href</span> = <span class="string">&quot;500.html&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (error.<span class="property">status</span> === <span class="number">400</span> )&#123;</span><br><span class="line">                location.<span class="property">href</span> = <span class="string">&quot;500.html&quot;</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;服务器出现故障，请等待攻城狮修复！！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//引入公共头部、中间导航条以及页脚</span></span><br><span class="line">    $(<span class="string">&quot;.header&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;components/head.html&quot;</span>)</span><br><span class="line">    $(<span class="string">&quot;.footer&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;components/footer.html&quot;</span>)</span><br><span class="line">    $(<span class="string">&quot;.middleNavigation&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;components/middleNavigationBar.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取上个网页传来的参数</span></span><br><span class="line">    <span class="keyword">let</span> oid = <span class="title function_">getPidFromLastHtml</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自动发送ajax请求查询订单信息</span></span><br><span class="line">    <span class="title function_">getOrderByOid</span>(oid);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="查看订单详情"><a href="#查看订单详情" class="headerlink" title="查看订单详情"></a>查看订单详情</h3><h4 id="后端-持久层-20"><a href="#后端-持久层-20" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#根据oid查询order信息</span><br><span class="line">SELECT od.`oid`,od.`aid`,od.`recv_name`,od.`total_price`,</span><br><span class="line">       od.`status`,od.`created_time`,</span><br><span class="line">       orm.`image`,orm.`title`,</span><br><span class="line">       orm.`price`,orm.`num`</span><br><span class="line">FROM t_order od </span><br><span class="line">LEFT JOIN t_order_item orm</span><br><span class="line">ON od.`oid` = orm.`oid`</span><br><span class="line">WHERE od.oid = #&#123;oid&#125;</span><br><span class="line">ORDER BY orm.`price` DESC;</span><br></pre></td></tr></table></figure>

<p>2.定义mapper接口的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据oid查询值对象</span></span><br><span class="line">List&lt;OrderVo&gt; <span class="title function_">queryOrderVoByOid</span><span class="params">(Integer oid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写对应的映射文件</p>
<h4 id="后端-业务层-20"><a href="#后端-业务层-20" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，没有新异常</p>
<p>2.定义service层的抽象接口和创建值对象OrderVo</p>
<p>3.编写具体的业务逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据订单oid查询订单的抽象方法</span></span><br><span class="line">List&lt;OrderVo&gt; <span class="title function_">queryOrderVoByOid</span><span class="params">(Integer oid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据订单oid查询订单的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;OrderVo&gt; <span class="title function_">queryOrderVoByOid</span><span class="params">(Integer oid)</span> &#123;</span><br><span class="line">    List&lt;OrderVo&gt; orderVos = orderMapper.queryOrderVoByOid(oid);</span><br><span class="line">    <span class="keyword">for</span> (OrderVo vo: orderVos) &#123;</span><br><span class="line">        <span class="comment">//根据每个订单的oid查询地址信息</span></span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressService.queryAddressByAid(vo.getAid());</span><br><span class="line">        <span class="comment">//补全OrderVo值对象中的空白字段</span></span><br><span class="line">        vo.setZip(address.getZip());</span><br><span class="line">        vo.setPhone(address.getPhone());</span><br><span class="line">        vo.setProvinceName(address.getProvinceName());</span><br><span class="line">        vo.setCityName(address.getCityName());</span><br><span class="line">        vo.setAreaName(address.getAreaName());</span><br><span class="line">        vo.setAddress(address.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> orderVos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="后端-控制层-20"><a href="#后端-控制层-20" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.无异常，不需要处理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;order&#x2F;queryOrderVo</p>
<p>请求参数：Integer oid</p>
<p>请求方式：get</p>
<p>响应类型：JsonResult&lt;List&lt; OrderVo&gt;&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理根据oid查询订单的请求</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/queryOrderVo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;List&lt;OrderVo&gt;&gt;  <span class="title function_">queryOrderVo</span><span class="params">(Integer oid)</span>&#123;</span><br><span class="line">    List&lt;OrderVo&gt; orderVos = orderService.queryOrderVoByOid(oid);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,orderVos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-21"><a href="#前端页面-21" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li>在这个页面加载完成之前需要先根据上个页面传来的参数查询订单信息</li>
</ul>
<p><font color='red'><strong>篇幅过长，不做展示，在&#x2F;web&#x2F;orderInfo.html页面下可查看</strong></font> </p>
<h3 id="查看所有订单"><a href="#查看所有订单" class="headerlink" title="查看所有订单"></a>查看所有订单</h3><h4 id="后端-持久层-21"><a href="#后端-持久层-21" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT od.`oid`,od.`aid`,od.`recv_name`,od.`total_price`,</span><br><span class="line">       od.`status`,od.`order_time`,</span><br><span class="line">       orm.`image`,orm.`title`,</span><br><span class="line">       orm.`price`,orm.`num`</span><br><span class="line">FROM t_order od </span><br><span class="line">LEFT JOIN t_order_item orm</span><br><span class="line">ON od.`oid` = orm.`oid`</span><br><span class="line">WHERE od.uid = #&#123;uid&#125;</span><br><span class="line">ORDER BY od.`order_time` DESC;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象接口的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据uid查询值对象</span></span><br><span class="line">List&lt;OrderVo&gt; <span class="title function_">queryOrderVoByUid</span><span class="params">(Integer uid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写对应的mapper映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-21"><a href="#后端-业务层-21" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.无新异常</p>
<p>2.定义接口的抽象方法</p>
<p>3.编写具体业务逻辑</p>
<ul>
<li>由于与上个 的逻辑相似，就不再重复了</li>
</ul>
<h4 id="后端-控制层-21"><a href="#后端-控制层-21" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><ul>
<li>与上个 相似</li>
</ul>
<h4 id="前端页面-22"><a href="#前端页面-22" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li>糙，这一个页面的js代码写的是真折磨人，写了快3个小时还有各种bug！</li>
<li><strong>订单 的其余查看其他项所用的持久层、业务层、控制层已经在支付订单 中写好了</strong></li>
</ul>
<p><font color='red'><strong>篇幅过长，不做展示，在&#x2F;web&#x2F;orders.html页面下可查看</strong></font> </p>
<hr>
<h2 id="收藏管理"><a href="#收藏管理" class="headerlink" title="收藏管理"></a>收藏管理</h2><h3 id="创建数据表-6"><a href="#创建数据表-6" class="headerlink" title="创建数据表"></a>创建数据表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_favorites(</span><br><span class="line">fid INT PRIMARY KEY AUTO_INCREMENT COMMENT &#x27;收藏商品在数据表的id&#x27;,</span><br><span class="line">uid INT COMMENT &#x27;归属的用户id&#x27;,</span><br><span class="line">pid INT COMMENT &#x27;归属的商品id&#x27;,</span><br><span class="line">image VARCHAR(255) COMMENT &#x27;商品图片保存地址&#x27;,</span><br><span class="line">price BIGINT COMMENT &#x27;商品的价格&#x27;,</span><br><span class="line">title VARCHAR(255) COMMENT &#x27;商品的标题&#x27;,</span><br><span class="line">sell_point VARCHAR(255) COMMENT &#x27;商品的卖点&#x27;,</span><br><span class="line">status INT COMMENT &#x27;商品的收藏状态&#x27;</span><br><span class="line">); </span><br></pre></td></tr></table></figure>

<h3 id="创建实体类-6"><a href="#创建实体类-6" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对应数据表t_favorites的实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Favorites</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer fid;</span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> Long price;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String sellPoint;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在Springboot中如何使用pageHelper插件"><a href="#在Springboot中如何使用pageHelper插件" class="headerlink" title="在Springboot中如何使用pageHelper插件"></a>在Springboot中如何使用pageHelper插件</h3><ul>
<li><p>因为商品数据有可能有多条，因此决定使用分页插件进行过滤查询，下面的商品搜索也用得上</p>
<p>也由于我不怎么熟悉springboot使用pageHelper分页插件，也正好记录一下</p>
<p><a target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md">github官方参考资料</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43469899/article/details/100119116?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-100119116-blog-119714502.pc_relevant_multi_platform_whitelistv2_exp3w&spm=1001.2101.3001.4242.1&utm_relevant_index=3">csdn参考资料</a></p>
</li>
</ul>
<p>①从github上引入分页插件的依赖到项目的pom文件中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;version&gt;最新版本&lt;/version&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②在yml配置文件中进行部分内容配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置mybatis配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">top.year21.computerstore.entity</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#开启在mybatis处理过程中打印出对应的sql语句功能</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">    <span class="comment">#开启数据库字段自动转换为驼峰命名</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#配置分页插件 </span></span><br><span class="line"><span class="comment">#照着写就行，别问为什么</span></span><br><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">  <span class="attr">dialect:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">reasonable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">support-methods-arguments:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">params:</span> <span class="string">count=countSql</span></span><br></pre></td></tr></table></figure>

<p>③<font color='red'><strong>在程序启动类中注册一个Pagehelper类，否则会报错或者取不到数据，这一步很关键！&gt;</strong></font></p>
<p>​	或者是在配置类(标注了@Configuration的类)中进行注册也可以</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PageHelper <span class="title function_">pageHelper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">PageHelper</span> <span class="variable">pageHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageHelper</span>();</span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    properties.setProperty(<span class="string">&quot;offsetAsPageNum&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    properties.setProperty(<span class="string">&quot;rowBoundsWithCount&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    properties.setProperty(<span class="string">&quot;reasonable&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    properties.setProperty(<span class="string">&quot;dialect&quot;</span>, <span class="string">&quot;mysql&quot;</span>);</span><br><span class="line">    pageHelper.setProperties(properties);</span><br><span class="line">    <span class="keyword">return</span> pageHelper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>④控制层调用业务层，业务层调用持久层查询，且分页功能必须在select查询语句之前开启，</p>
<p>​	所以在service层的实现类调用持久层的方法之前使用pagehelper.start方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IFavoritesServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IFavoritesService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FavoritesMapper favoritesMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IProductService productService;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//根据uid和商品收藏状态查询收藏数据的具体逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;Favorites&gt; <span class="title function_">queryFavorites</span><span class="params">(Integer uid, Integer pageNum,Integer pageSize,Integer status)</span> &#123;</span><br><span class="line">        <span class="comment">//开启分页功能，pageNum是当前页，pageSize是每页显示的数据量，这两个值都可以选择让前端传或者自己调整</span></span><br><span class="line">         PageHelper.startPage(pageNum,pageSize);</span><br><span class="line">        List&lt;Favorites&gt; favorites = favoritesMapper.queryFavoritesByUidAndStatus(uid, status);</span><br><span class="line">        PageInfo&lt;Favorites&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(favorites);</span><br><span class="line">        <span class="keyword">return</span> pageInfo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>⑤控制层将数据返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/favorites&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FavoritesController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IFavoritesService favoritesService;</span><br><span class="line">    <span class="comment">//处理查询收藏商品的请求</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/queryFavorites&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;PageInfo&lt;Favorites&gt;&gt; <span class="title function_">queryFavorites</span><span class="params">(HttpSession session, Integer pageNum,Integer pageSize,Integer status)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">        PageInfo&lt;Favorites&gt; favorites = favoritesService.queryFavorites(uid, pageNum,pageSize,status);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,favorites);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>⑥分页功能如何使用到此结束</p>
<hr>
<h3 id="加入收藏"><a href="#加入收藏" class="headerlink" title="加入收藏"></a>加入收藏</h3><h4 id="后端-持久层-22"><a href="#后端-持久层-22" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句编写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into t_favorite(uid,pid,image,price,title,sell_point,status)</span><br><span class="line">					values(#&#123;uid&#125;,#&#123;pid&#125;,#&#123;image&#125;,#&#123;price&#125;,#&#123;sellPoint&#125;,#&#123;status&#125;)</span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增收藏商品的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addFavorites</span><span class="params">(Favorites favorites)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写对应的mapper映射文件</p>
<h4 id="后端-业务层-22"><a href="#后端-业务层-22" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.异常规划，添加失败</p>
<p>2.定义抽象方法</p>
<p>3.编写具体业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加收藏商品的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addFavorites</span><span class="params">(Favorites favorites)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加收藏商品的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addFavorites</span><span class="params">(Integer uid,Integer pid)</span> &#123;</span><br><span class="line">    <span class="type">Favorites</span> <span class="variable">favorites</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Favorites</span>();</span><br><span class="line">    <span class="comment">//根据pid查询商品信息</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productService.queryProductById(pid);</span><br><span class="line">    <span class="comment">//填充favorites对象空白字段</span></span><br><span class="line">    favorites.setUid(uid);</span><br><span class="line">    favorites.setPid(pid);</span><br><span class="line">    favorites.setImage(product.getImage());</span><br><span class="line">    favorites.setPrice(product.getPrice());</span><br><span class="line">    favorites.setTitle(product.getTitle());</span><br><span class="line">    favorites.setSellPoint(product.getSellPoint());</span><br><span class="line">    favorites.setStatus(<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> favoritesMapper.addFavorites(favorites);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsertException</span>(<span class="string">&quot;服务器异常，收藏商品失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//取出fid返回给前端页面，以便在搜索界面取消收藏使用</span></span><br><span class="line">    <span class="keyword">return</span> favorites.getFid();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-22"><a href="#后端-控制层-22" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.异常已添加过</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;favorites&#x2F;addFavorites</p>
<p>请求类型： HttpSession session,Integer pid</p>
<p>请求方式：post</p>
<p>响应类型：JsonResult&lt; Integer&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/addFavorites&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Integer&gt; <span class="title function_">addFavorites</span><span class="params">(HttpSession session,Integer pid)</span>&#123;</span><br><span class="line">    <span class="comment">//从session中取出uid</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">    <span class="comment">//执行插入操作并返回fid</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">fid</span> <span class="operator">=</span> favoritesService.addFavorites(uid, pid);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,fid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-23"><a href="#前端页面-23" class="headerlink" title="前端页面"></a>前端页面</h4><p>①给加入收藏按钮绑定单击事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给加入收藏按钮绑定点击事件</span></span><br><span class="line">$(<span class="string">&quot;#btn-add-to-collect&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/favorites/addFavorites&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;<span class="attr">pid</span>:pid&#125;,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;收藏成功！&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        error : <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;服务器出现错误，加入购物车失败！&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="收藏商品展示"><a href="#收藏商品展示" class="headerlink" title="收藏商品展示"></a>收藏商品展示</h3><h4 id="后端-持久层-23"><a href="#后端-持久层-23" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句编写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#根据uid和收藏商品状态查询收藏的商品信息</span><br><span class="line">select * from t_favorites where uid= #&#123;uid&#125; and status =#&#123;status&#125;</span><br></pre></td></tr></table></figure>

<p>2.创建mapper文件和定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据uid和收藏商品状态查询收藏的商品信息</span></span><br><span class="line">List&lt;Favorites&gt; <span class="title function_">queryFavoritesByUidAndStatus</span><span class="params">(Integer uid,Integer status)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写对应的映射文件</p>
<p>4.单元测试</p>
<h4 id="后端-业务层-23"><a href="#后端-业务层-23" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，无异常</p>
<p>2.创建service层接口和定义抽象方法</p>
<p>3.编写具体的业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询收藏商品的抽象方法</span></span><br><span class="line">PageInfo&lt;Favorites&gt; <span class="title function_">queryFavorites</span><span class="params">(Integer uid, Integer pageNum, Integer pageSize,Integer status)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据uid和商品收藏状态查询收藏数据的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageInfo&lt;Favorites&gt; <span class="title function_">queryFavorites</span><span class="params">(Integer uid, Integer pageNum,Integer pageSize,Integer status)</span> &#123;</span><br><span class="line">        <span class="comment">//开启分页功能，pageNum是当前页，pageSize是每页显示的数据量，这两个值都可以选择让前端传或者自己调整</span></span><br><span class="line">        PageHelper.startPage(pageNum,pageSize);</span><br><span class="line">        List&lt;Favorites&gt; favorites = favoritesMapper.queryFavoritesByUidAndStatus(uid, status);</span><br><span class="line">        PageInfo&lt;Favorites&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(favorites);</span><br><span class="line">        <span class="keyword">return</span> pageInfo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="后端-控制层-23"><a href="#后端-控制层-23" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.不需要处理异常</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;favorites&#x2F;queryFavorites</p>
<p>请求类型：Httpsession session,Integer status</p>
<p>请求方式：get</p>
<p>响应类型：JsonResult&lt; Favorites&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理查询收藏商品的请求</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/queryFavorites&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult&lt;PageInfo&lt;Favorites&gt;&gt; <span class="title function_">queryFavorites</span><span class="params">(HttpSession session, Integer pageNum,Integer pageSize,Integer status)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">        PageInfo&lt;Favorites&gt; favorites = favoritesService.queryFavorites(uid, pageNum,pageSize,status);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,favorites);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-24"><a href="#前端页面-24" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li><font color='red'><strong>js代码较长，到&#x2F;web&#x2F;favorites.html下可以查看</strong></font></li>
</ul>
<hr>
<h3 id="取消收藏"><a href="#取消收藏" class="headerlink" title="取消收藏"></a>取消收藏</h3><ul>
<li>可以选择直接将数据库对应数据删除，但为了测试方便，决定添加一个字段status表示收藏状态</li>
</ul>
<h4 id="后端-持久层-24"><a href="#后端-持久层-24" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句编写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update t_favorites set status = #&#123;status&#125; where fid = #&#123;fid&#125; and uid = #&#123;uid&#125;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据收藏商品pid和用户uid取消对应商品收藏</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateFavoritesStatus</span><span class="params">(Integer status,Integer fid,Integer uid)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写对应的mapper映射文件</p>
<h4 id="后端-业务层-24"><a href="#后端-业务层-24" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.规划异常，修改状态失败</p>
<p>2.定义抽象方法</p>
<p>3.编写具体业务处理逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据收藏商品pid和用户uid取消对应商品收藏的抽象方法</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updateFavoritesStatus</span><span class="params">(Integer status,Integer fid,Integer uid)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据收藏商品pid和用户uid取消对应商品收藏的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateFavoritesStatus</span><span class="params">(Integer status, Integer fid, Integer uid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> favoritesMapper.updateFavoritesStatus(status, fid, uid);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UpdateException</span>(<span class="string">&quot;服务器异常，取消收藏失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="后端-控制层-24"><a href="#后端-控制层-24" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.异常无需进行处理，前面已经处理过</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;favorites&#x2F;updateStatus</p>
<p>请求参数：HttpSession session，Integer fid，Integer status</p>
<p>请求类型：post</p>
<p>响应类型：JsonResult&lt; void&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理取消收藏的请求</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/updateStatus&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;Void&gt; <span class="title function_">cancelFavorites</span><span class="params">(HttpSession session,Integer status,Integer fid)</span>&#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">uid</span> <span class="operator">=</span> getUserIdFromSession(session);</span><br><span class="line">    favoritesService.updateFavoritesStatus(status,fid,uid);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-25"><a href="#前端页面-25" class="headerlink" title="前端页面"></a>前端页面</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取消收藏</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stopCollect</span>(<span class="params">fid</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&quot;确定要取消对该商品的收藏吗？&quot;</span>))&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/favorites/updateStatus&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;<span class="attr">fid</span>:fid,<span class="attr">status</span>:<span class="number">0</span>&#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;取消成功&quot;</span>)</span><br><span class="line">                location.<span class="title function_">reload</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">            error : <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;服务器出现错误，取消失败！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="加入购物车-1"><a href="#加入购物车-1" class="headerlink" title="加入购物车"></a>加入购物车</h3><ul>
<li>持久层、业务层、控制层在购物车管理模块已经全部实现</li>
</ul>
<h4 id="前端页面-26"><a href="#前端页面-26" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li>前端页面只需要将product.html页面的ajax请求进行cv，修改一下传递的参数即可</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加入购物车</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addCollectToCart</span>(<span class="params">pid,price</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&quot;确定要将此商品加入购物车吗？&quot;</span>))&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/cart/addCart&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;<span class="attr">pid</span>:pid,<span class="attr">price</span>:price,<span class="attr">num</span>:<span class="number">1</span>&#125;,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;已成功加入购物车，在购物车等您结算哟！&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            error : <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;服务器出现错误，加入购物车失败！&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="商品搜索"><a href="#商品搜索" class="headerlink" title="商品搜索"></a>商品搜索</h2><h3 id="模糊搜索"><a href="#模糊搜索" class="headerlink" title="模糊搜索"></a>模糊搜索</h3><h4 id="后端-持久层-25"><a href="#后端-持久层-25" class="headerlink" title="后端-持久层"></a>后端-持久层</h4><p>1.sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,title,sell_point,price,image</span><br><span class="line">FROM t_product </span><br><span class="line">WHERE STATUS = 1</span><br><span class="line">AND title LIKE &#x27;%$&#123;title&#125;%&#x27; </span><br><span class="line">ORDER BY priority DESC;</span><br></pre></td></tr></table></figure>

<p>2.定义抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据指定的名称关键字进行模糊查询</span></span><br><span class="line">List&lt;Product&gt; <span class="title function_">queryProductByTitle</span><span class="params">(String title)</span>;</span><br></pre></td></tr></table></figure>

<p>3.编写映射文件</p>
<p>4.单元检测</p>
<h4 id="后端-业务层-25"><a href="#后端-业务层-25" class="headerlink" title="后端-业务层"></a>后端-业务层</h4><p>1.简单查询无异常不需要规划</p>
<p>2.定义抽象方法</p>
<p>3.编写具体逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据名称进行模糊查询的抽象方法</span></span><br><span class="line">PageInfo&lt;Product&gt; <span class="title function_">queryProductByTitle</span><span class="params">(Integer pageNum, Integer pageSize,String title)</span>;</span><br><span class="line"><span class="comment">//根据名称进行模糊查询的具体逻辑</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageInfo&lt;Product&gt; <span class="title function_">queryProductByTitle</span><span class="params">(Integer pageNum, Integer pageSize,String title)</span> &#123;</span><br><span class="line">    <span class="comment">//开启分页功能</span></span><br><span class="line">    PageHelper.startPage(pageNum,pageSize);、</span><br><span class="line">    <span class="comment">//调用持久层方法进行查询</span></span><br><span class="line">    List&lt;Product&gt; products = productMapper.queryProductByTitle(title);</span><br><span class="line">    <span class="comment">//返回分页数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(products);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.单元测试</p>
<h4 id="后端-控制层-25"><a href="#后端-控制层-25" class="headerlink" title="后端-控制层"></a>后端-控制层</h4><p>1.无异常需要处理</p>
<p>2.设计请求</p>
<p>请求路径：&#x2F;product&#x2F;queryByTitle</p>
<p>请求参数：Integer pageNum，Integer pageSize，String title</p>
<p>请求类型：get</p>
<p>响应类型：JsonResult&lt;PageInfo&lt; Product&gt;&gt;</p>
<p>3.处理请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理根据产品关键字进行模糊查询的请求</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;pageNum&#125;/&#123;pageSize&#125;/&#123;title&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> JsonResult&lt;PageInfo&lt;Product&gt;&gt; <span class="title function_">quertByTitle</span><span class="params">(<span class="meta">@PathVariable(&quot;pageNum&quot;)</span> Integer pageNum,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize,</span></span><br><span class="line"><span class="params">                                                  <span class="meta">@PathVariable(&quot;title&quot;)</span> String title)</span>&#123;</span><br><span class="line">    PageInfo&lt;Product&gt; lists = productService.queryProductByTitle(pageNum, pageSize, title);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JsonResult</span>&lt;&gt;(OK,lists);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端页面-27"><a href="#前端页面-27" class="headerlink" title="前端页面"></a>前端页面</h4><ul>
<li><font color='red'><strong>前端页面搜索数据的展示、加入购物车、加入收藏基于其他页面疯狂copy，稍微改动即可完成</strong></font></li>
<li><font color='red'><strong>同样js代码过长，放在了&#x2F;web&#x2F;search.html页面下</strong></font></li>
</ul>
<hr>
<h2 id="抽离公共页面"><a href="#抽离公共页面" class="headerlink" title="抽离公共页面"></a>抽离公共页面</h2><ul>
<li>抽离头部、页面、中间导航条</li>
</ul>
<p>①新建一个名为head.html(简称head)的文件，将需要抽离页面的head标签内的全部内容粘贴到</p>
<p>head文件中，并且在抽离页面的原处使用一个div进行占位，可以在任意地方js的load方法进行引入</p>
<p>②新建一个名为middleNavigation.html(简称middle)的文件，将需要抽离页面的导航标签内的内容粘贴到</p>
<p>middle文件中，并且在抽离页面的原处使用一个div进行占位，可以在任意地方js的load方法进行引入</p>
<p>③新建一个名为footer.html(简称footer)的文件，将需要抽离页面的footer标签内的全部内容粘贴到</p>
<p>footer文件中，并且在抽离页面的原处使用一个div进行占位，可以在任意地方js的load方法进行引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--头部开始--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--头部结束--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--中间导航条开始 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middleNavigation&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--中间导航条结束--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--页脚开始--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--页脚结束--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span> (<span class="params"></span>)  &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//引入公共头部、中间导航条以及页脚</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;.header&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;components/head.html&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;.footer&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;components/footer.html&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;.middleNavigation&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;components/middleNavigationBar.html&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><font color='red'><strong>PS：因为是把整体都抽离了，因此有些页面需要一开始就要加载的功能可以使用js代码在</strong></font></p>
<p><font color='red'>		<strong>head或者footer文件进行加载，如下完整的head.html页面所示：</strong></font></p>
<ul>
<li>这个部分最为棘手，需要谨慎操作</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--完整的head.html页面代码--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--电脑商城logo--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../images/index/stumalllogo.png&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--快捷选项--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-9 top-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;topMenu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;list-inline pull-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;favorites.html&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-heart&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="symbol">&amp;nbsp;</span>收藏<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;li-split&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;orders.html&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-file-text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="symbol">&amp;nbsp;</span>订单<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;li-split&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;cart.html&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-cart-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="symbol">&amp;nbsp;</span>购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;li-split&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--下列列表按钮 ：管理--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-link dropdown-toggle&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;top-dropdown-btn&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-gears&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="symbol">&amp;nbsp;</span>管理 <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;menuCaret&quot;</span> <span class="attr">class</span>=<span class="string">&quot;caret&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;uiMenu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu top-dropdown-ul&quot;</span> <span class="attr">role</span>=<span class="string">&quot;menu&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;password.html&quot;</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;userdata.html&quot;</span>&gt;</span>个人资料<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;upload.html&quot;</span>&gt;</span>上传头像<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;address.html&quot;</span>&gt;</span>收货管理	<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;li-split&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;login.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;loginStatus&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">     $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">//必须随着页面加载先执行，不然有缓存界面会显示bug</span></span></span><br><span class="line"><span class="language-javascript">         <span class="comment">//未登录状态下改变最上面的管理行</span></span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">if</span> (sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;user&quot;</span>) === <span class="literal">null</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">//设置显示登录</span></span></span><br><span class="line"><span class="language-javascript">         $(<span class="string">&quot;#loginStatus&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;&amp;nbsp;&amp;nbsp;&quot;</span> + <span class="string">&quot;登录&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">//移除管理模块的class样式并清空元素</span></span></span><br><span class="line"><span class="language-javascript">         $(<span class="string">&quot;#menuCaret&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;caret&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">         $(<span class="string">&quot;#uiMenu&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;dropdown-menu top-dropdown-ul&quot;</span>).<span class="title function_">empty</span>()</span></span><br><span class="line"><span class="language-javascript">         &#125;<span class="keyword">else</span>&#123; <span class="comment">//不为空则已经登录</span></span></span><br><span class="line"><span class="language-javascript">             $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                 url : <span class="string">&quot;http://localhost:8080/user/queryUser&quot;</span> ,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                     <span class="comment">//用户登录了则改变最上面的导航条</span></span></span><br><span class="line"><span class="language-javascript">                     <span class="title function_">changeMenu</span>(res)</span></span><br><span class="line"><span class="language-javascript">                 &#125;</span></span><br><span class="line"><span class="language-javascript">             &#125;);</span></span><br><span class="line"><span class="language-javascript">         &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">     &#125;)</span></span><br><span class="line"><span class="language-javascript">     <span class="comment">//登录状态下改变最上面的管理行</span></span></span><br><span class="line"><span class="language-javascript">     <span class="keyword">function</span> <span class="title function_">changeMenu</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">let</span> user = res.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">//不为空代表已经登录</span></span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">if</span> (user.<span class="property">username</span> != <span class="literal">null</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="comment">//修改为登录的用户名</span></span></span><br><span class="line"><span class="language-javascript">             $(<span class="string">&quot;#loginStatus&quot;</span>).<span class="title function_">html</span>(<span class="string">&quot;&amp;nbsp;&quot;</span> + user.<span class="property">username</span>)</span></span><br><span class="line"><span class="language-javascript">             <span class="comment">//添加退出按钮</span></span></span><br><span class="line"><span class="language-javascript">             <span class="keyword">let</span> exitStr = <span class="string">&quot;&lt;li class=\&quot;li-split\&quot;&gt;|&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                 + <span class="string">&quot;&lt;li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                 + <span class="string">&quot;&lt;span class=\&quot;fa fa-sign-out\&quot;&gt;&lt;/span&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                 + <span class="string">&quot;&lt;a href=\&quot;javascript:void(0)\&quot; onclick=\&quot;exitLogin()\&quot;&gt;&amp;nbsp;退出&lt;/a&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                 + <span class="string">&quot;&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">             $(<span class="string">&quot;#topMenu&quot;</span>).<span class="title function_">append</span>(exitStr)</span></span><br><span class="line"><span class="language-javascript">             <span class="comment">//移除跳转属性</span></span></span><br><span class="line"><span class="language-javascript">             <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;loginStatus&quot;</span>).<span class="title function_">removeAttribute</span>(<span class="string">&quot;href&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">         &#125;</span></span><br><span class="line"><span class="language-javascript">     &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">     <span class="comment">//退出功能</span></span></span><br><span class="line"><span class="language-javascript">     <span class="keyword">function</span> <span class="title function_">exitLogin</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">         <span class="keyword">if</span> (sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;user&quot;</span>) == <span class="literal">null</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="title function_">alert</span>(<span class="string">&quot;尚未登录，请先登录！&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">         &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">             $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/user/exit&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                     <span class="keyword">if</span> (res.<span class="property">status</span> === <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                         <span class="title function_">alert</span>(<span class="string">&quot;退出成功!&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                         sessionStorage.<span class="title function_">removeItem</span>(<span class="string">&quot;user&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                         location.<span class="property">href</span> = <span class="string">&quot;index.html&quot;</span></span></span><br><span class="line"><span class="language-javascript">                     &#125;</span></span><br><span class="line"><span class="language-javascript">                 &#125;,</span></span><br><span class="line"><span class="language-javascript">                 <span class="attr">error</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                     <span class="title function_">alert</span>(<span class="string">&quot;服务器出现未知异常，退出登录失败&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">                 &#125;</span></span><br><span class="line"><span class="language-javascript">             &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">         &#125;</span></span><br><span class="line"><span class="language-javascript">     &#125;</span></span><br><span class="line"><span class="language-javascript"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="引入kaptcha验证码"><a href="#引入kaptcha验证码" class="headerlink" title="引入kaptcha验证码"></a>引入kaptcha验证码</h2><ul>
<li>参考资料  —&gt; <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40065776/article/details/101481607">csdn引入kaptcha</a></li>
</ul>
<p>①引入依赖包到pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入验证码 kaptcha的依赖  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.penggle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②创建并编写kaptcha的配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.year21.computerstore.config;</span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;</span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.util.Config;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hcxs1986</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: kaptcha配置类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/24 1:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KaptchaConfig</span> &#123;</span><br><span class="line">    <span class="comment">//kaptcha</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultKaptcha <span class="title function_">getKaptcheCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultKaptcha</span> <span class="variable">defaultKaptcha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultKaptcha</span>();</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.border&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.color&quot;</span>, <span class="string">&quot;black&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.width&quot;</span>, <span class="string">&quot;100&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.image.height&quot;</span>, <span class="string">&quot;36&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.size&quot;</span>, <span class="string">&quot;30&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.obscurificator.impl&quot;</span>, <span class="string">&quot;com.google.code.kaptcha.impl.ShadowGimpy&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.session.key&quot;</span>, <span class="string">&quot;code&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.noise.impl&quot;</span>, <span class="string">&quot;com.google.code.kaptcha.impl.NoNoise&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.background.clear.from&quot;</span>, <span class="string">&quot;232,240,254&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.background.clear.to&quot;</span>, <span class="string">&quot;232,240,254&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.char.length&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;kaptcha.textproducer.font.names&quot;</span>, <span class="string">&quot;彩云,宋体,楷体,微软雅黑&quot;</span>);</span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>(properties);</span><br><span class="line">        defaultKaptcha.setConfig(config);</span><br><span class="line">        <span class="keyword">return</span> defaultKaptcha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>③创建并编写kaptcha控制层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.year21.computerstore.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.Constants;</span><br><span class="line"><span class="keyword">import</span> com.google.code.kaptcha.Producer;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletOutputStream;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hcxs1986</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: kaptcha的控制层,kaptcha调用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/24 1:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/kaptcha&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KaptchaController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/kaptcha-image&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getKaptchaImage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        response.setDateHeader(<span class="string">&quot;Expires&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-store, no-cache, must-revalidate&quot;</span>);</span><br><span class="line">        response.addHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;post-check=0, pre-check=0&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Pragma&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">capText</span> <span class="operator">=</span> producer.createText();</span><br><span class="line">        log.info(<span class="string">&quot;******************当前验证码为：&#123;&#125;******************&quot;</span>, capText);</span><br><span class="line">        <span class="comment">// 将验证码存于session中</span></span><br><span class="line">        request.getSession().setAttribute(Constants.KAPTCHA_SESSION_KEY, capText);</span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">bi</span> <span class="operator">=</span> producer.createImage(capText);</span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="comment">// 向页面输出验证码</span></span><br><span class="line">        ImageIO.write(bi, <span class="string">&quot;jpg&quot;</span>, out);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 清空缓存区</span></span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭输出流</span></span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>④在前端调用kaptcha的控制层接口</p>
<ul>
<li><p>给图片绑定点击事件进行刷新时一定要在请求接口完整的地址上带上一个时间参数</p>
<p>如下图所示</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;img id=<span class="string">&quot;kaptcha&quot;</span> src=<span class="string">&quot;http://localhost:8080/kaptcha/kaptcha-image&quot;</span> onclick=<span class="string">&quot;reFlashImg(&#x27;kaptcha&#x27;)&quot;</span> /&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//给图片验证码绑定点击事件，刷新验证码</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reFlashImg</span>(<span class="params">imgId</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> kaptcha = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(imgId)</span><br><span class="line">    kaptcha.<span class="property">src</span> = <span class="string">&quot;http://localhost:8080/kaptcha/kaptcha-image?time=&quot;</span>+ <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<hr>
<h2 id="统计业务方法耗时"><a href="#统计业务方法耗时" class="headerlink" title="统计业务方法耗时"></a>统计业务方法耗时</h2><ul>
<li><p>如果想要对某些方法同时添加相同 需求，且在不改变原有的业务逻辑 的基础上进行完成</p>
<p>那么就是可以使用AOP的切面编程进行处理</p>
</li>
</ul>
<h3 id="切面方法"><a href="#切面方法" class="headerlink" title="切面方法"></a>切面方法</h3><p><font color='red'><strong>切面方法就是在切面类的方法，所谓的切面类就是增强类</strong></font></p>
<p>1.切面方法修饰符必须是public</p>
<p>2.切面方法的返回值可以是void或Object，但如果这个方法被@Around环绕通知注解所修饰，那么</p>
<p>​	这个方法必须声明为Object类型，除此之外，随意。</p>
<p>3.切面方法的方法名可以自定义</p>
<p>4.切面方法可以接受参数，参数是ProccedingJoinPoint接口类型的参数，但是被@Around环绕通知</p>
<p>   注解所修饰的方法必须要传递这个参数，除此之外，随意。</p>
<h3 id="怎么实现AOP操作？"><a href="#怎么实现AOP操作？" class="headerlink" title="怎么实现AOP操作？"></a>怎么实现AOP操作？</h3><p><font color='red'><strong>怎么做？</strong></font></p>
<p>①导入aop的依赖到pom文件中，不需要版本，springboot会自动进行版本仲裁</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    引入aspectj的依赖    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>②创建切面类(增强类)，并在这个类中定义切面方法（编写增强逻辑）</p>
<p>③进行通知的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是用于统计业务方法执行的事件的增强类</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//将当前类标记为切面类，并生成代理对象，底层使用的是动态代理</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//将当前类对象的创建和管理交由spring容器维护</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimerAspect</span> &#123;</span><br><span class="line">    <span class="comment">//ProceedingJoinPoint接口表示指向目标方法的对象</span></span><br><span class="line">    <span class="comment">//切入点表达式解析</span></span><br><span class="line">    <span class="comment">// 第一个*表示不关注方法返回值</span></span><br><span class="line">    <span class="comment">//第二个* top.year21.computerstore.service.impl.* 表示包下的哪个实现类也不关注</span></span><br><span class="line">    <span class="comment">//第三个* 表示哪个方法名字也不关注</span></span><br><span class="line">    <span class="comment">//第四个(..)表示哪个方法中的参数列表也不关注</span></span><br><span class="line">    <span class="comment">//&quot;execution(* top.year21.computerstore.service.*.*(..))&quot;</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* top.year21.computerstore.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//先记录业务执行前的时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">startedTime</span>  <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed(); <span class="comment">//调用目标方法，例如login方法</span></span><br><span class="line">         <span class="comment">//还可以在这个位置记录一下每个方法的执行名字和时间，并建议一张数据表记录</span></span><br><span class="line">        <span class="comment">//插入数据库</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//先记录业务执行前的时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span>  <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//计算耗时</span></span><br><span class="line">        System.out.println(<span class="string">&quot;业务方法总共耗时：&quot;</span> + (endTime - startedTime));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>④启动项目，随机访问一个 进行测试</p>
<h2 id="汇总信息"><a href="#汇总信息" class="headerlink" title="汇总信息"></a>汇总信息</h2><p>1.注册 单元测试报错提示：Invalid bound statement (not found)</p>
<p>说明：本次是由于没有在yml配置文件中设置mapper映射文件对应的位置</p>
<p>解决方法：将mapper映射文件的位置在yml配置文件中进行对应的设置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<p>2.注册 单元测试报错：nested exception is org.apache.ibatis.binding.BindingException: Parameter ‘xxx‘ not found</p>
<p>说明：由于传参的是实体类对象，因此实体类对象不需要用@Param修饰</p>
<p>3.登录 由于还没设计表单就使用postman测试后端业务层接口时，报错提示状态码415，Unsupported Media Type</p>
<p>说明：业务层的控制器方法的形参加了 @RequestBody注解 ，只能解析json类型的数据，而在postman中</p>
<p>​			测试发送的请求Content-Type类型是multipart&#x2F;form-data; 所以才导致了这个错误</p>
<p>解决方法：将对应的控制器方法形参的 @RequestBody注解去掉即可</p>
<p>4.登录 写完js代码后发现点击事件没有绑定成功</p>
<p>解决方法：原因在于js代码没有设置为在页面加载完成后执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在网页加载完成后执行</span></span><br><span class="line"> $(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>5.修改个人资料 的js代码不是很熟悉</p>
<p>val()用于获取标签中的value属性的值</p>
<p>6.在上传头像页面，<font color='red'><strong>表单使用sumbit提交知道action默认跳转行为如何阻止？</strong></font> —&gt;<a target="_blank" rel="noopener" href="https://blog.csdn.net/u013992330/article/details/80085678?spm=1001.2101.3001.6650.3&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-3-80085678-blog-88689411.pc_relevant_multi_platform_whitelistv2&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-3-80085678-blog-88689411.pc_relevant_multi_platform_whitelistv2&utm_relevant_index=4">解决表单默认提交跳转行为</a></p>
<p>7.关于@PathVariable、@RequestParam、@Param注解</p>
<p>@PathVariable、@RequestParam用于后端控制层与前端页面交互时获取请求参数使用</p>
<p>@Param是用于后端业务层和持久层交互时，sql语句填充占位符所用</p>
<p>8.js中的serialize()方法、FormData类</p>
<p>serialize()方法：可以将表单数据自动拼接成key&#x3D;value的形式提交给服务器，但一般提交的都是</p>
<p>​							普通控件类型中的数据(text&#x2F;password&#x2F;radio&#x2F;checkbox)等等</p>
<p>FormData类：将表单中的数据保持原有结构的形式进行提交。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先要创建一个Data对象，通过js的选择器找到对应的表单</span></span><br><span class="line"><span class="comment">//[0]是将jquery对象转为dom对象，其中的0表示form表单中的第一个控件，每个标签代表一个控件</span></span><br><span class="line"><span class="comment">//FormData对象能够存储文件类型的数据</span></span><br><span class="line"><span class="title class_">Data</span> data = <span class="keyword">new</span> <span class="title class_">FormData</span>($(<span class="string">&quot;#form&quot;</span>)[<span class="number">0</span>]); </span><br><span class="line"></span><br><span class="line"><span class="comment">//使用formdata发送ajax请求如下</span></span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/test&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="keyword">new</span> <span class="title class_">FormData</span>($(<span class="string">&quot;#form&quot;</span>)[<span class="number">0</span>]),</span><br><span class="line">    <span class="attr">processData</span>: <span class="literal">false</span>, <span class="comment">//处理数据的形式，关闭处理数据</span></span><br><span class="line">    <span class="attr">contentType</span>: <span class="literal">false</span>,<span class="comment">//表示提交数据的形式，关闭默认提交数据的形式</span></span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(res.<span class="property">status</span><span class="string">&quot;,修改成功&quot;</span>)</span><br><span class="line">        <span class="comment">//因为它这里后端返回的数据是图片的访问地址</span></span><br><span class="line">        $(<span class="string">&quot;#img&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;src&quot;</span>,res.<span class="property">data</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">error</span>: <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;修改失败&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>9.<font color='red'><strong>如果后端持久层接收的是一个实体类对象的参数，必须在标签中使用parameterType&#x3D;”实体类对象”，</strong></font></p>
<p>​	这样才能根据前端传值和实体类对象的属性匹配自动完成注入，不然保存</p>
<p>10.给当一个方法的参数是必须在标签内填写，怎么解决？</p>
<p>使用正则表达式替换，<font color='red'>能够替换的前提是str这个串中必须包含对应的占位符信息</font></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str = <span class="string">&quot;&lt;a href=&#x27;javascript:void(0);&#x27; onclick=&#x27;deleteAddress(#&#123;deleteAid&#125;,#&#123;isDefault&#125;)&#x27; &quot;</span></span><br><span class="line"><span class="comment">//使用正则表达式替换获取该地址的aid值，#&#123;deleteAid&#125;只是一个占位符的含义，没其他含义</span></span><br><span class="line">str = str.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;deleteAid&#125;&quot;</span>,address.<span class="property">aid</span>)</span><br><span class="line">str = str.<span class="title function_">replace</span>(<span class="string">&quot;#&#123;isDefault&#125;&quot;</span>,address.<span class="property">isDefault</span>)</span><br></pre></td></tr></table></figure>

<p>11.如何给a标签绑定事件并携带参数呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&lt;a href=&#x27;javascript:void(0);&#x27; onclick=&#x27;updateAddress(#&#123;editAid&#125;)&#x27; &gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//为修改绑定点击事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateAddress</span>(<span class="params">aid</span>)&#123;</span><br><span class="line">    <span class="comment">//执行跳转到指定页面</span></span><br><span class="line">    <span class="title function_">jumpWithParam</span>(aid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//携带数据进行跳转</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">jumpWithParam</span>(<span class="params">param</span>)&#123;</span><br><span class="line">    <span class="comment">//拼接跳转连接并带上需要查询的aid值</span></span><br><span class="line">    url = <span class="string">&quot;editAddress.html?aid=&quot;</span> + param;</span><br><span class="line">    location.<span class="property">href</span> = url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在指定页面这么接收</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showThisUserAddress</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//接收上一个页面传来的连接</span></span><br><span class="line">    <span class="keyword">var</span> hrefUrl = location.<span class="property">href</span>;</span><br><span class="line">    <span class="comment">//以url中的&quot;=&quot;为截断点，形成一个数组</span></span><br><span class="line">    <span class="keyword">var</span> param = hrefUrl.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)</span><br><span class="line">    <span class="comment">//decodeURI解码得到想要的参数</span></span><br><span class="line">    <span class="keyword">var</span> aid = <span class="built_in">decodeURI</span>(param[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>12.<font color='red'><strong>当在进行多表查询之后，查询的结果集无法和任何实体类进行映射怎么办？</strong></font></p>
<ul>
<li>重新创建一个Value Object(值对象)与查询出来的结果集形成映射关系</li>
</ul>
<p>VO(Value Object)：用于接收无法和任何实体类形成映射关系的vo对象，实际上就是根据结果集的字段，</p>
<pre><code>                              对应创建一个有相对应属性的一个实体类
</code></pre>
<p>13.<font color='red'><strong>当前端发送的值是多个同名属性时，后端应该怎么接收？</strong></font></p>
<blockquote>
<p>根本没想到前端可以直接在ajax请求的data直接发送cids&#x3D;5&amp;cids&#x3D;4&amp;cids&#x3D;6这样的数据，惊呆了</p>
</blockquote>
<p>e.g. http:localhost:8080&#x2F;cart&#x2F;queryCids?cids&#x3D;5&amp;cids&#x3D;4</p>
<p>后端可以以一个同参数名的数组进行接收</p>
<p>e.g. public JsonResult&lt;List&lt; Cart&gt;&gt; queryCids(Integer[] cids){}</p>
<p>14.持久层需要的数据，如果在业务层的逻辑中可以手动生成，那么在业务层的形参列表中就不必要求输入</p>
<p>15.业务层需要的数据可以根据持久层的抽象方法的形参列表进行对比得出</p>
<p>16.如何阻止form表单使用sumbit默认跳转的解决方式二</p>
<ul>
<li>通过给form表单设置一个id，并使用id选择器给这个form表单绑定一个onsumbit提交事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用id选择器给这个form表单绑定一个onsumbit提交事件</span></span><br><span class="line"><span class="comment">//检测用户是否已经选择了商品来决定是否放行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkIsNotChoose</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> chooseNum = $(<span class="string">&quot;input[type=&#x27;checkbox&#x27;]:checked&quot;</span>).<span class="property">length</span></span><br><span class="line">    <span class="comment">//如果chooseNum的值等于0代表用户没任何选择商品不允许跳转</span></span><br><span class="line">    <span class="keyword">if</span> (chooseNum === <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;请先选择需要结算的购物车商品！！！&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//参考案例二</span></span><br><span class="line">&lt;form  id=<span class="string">&quot;searchForm&quot;</span></span><br><span class="line">        onsubmit=<span class="string">&quot;return checkIfHaveVal()&quot;</span></span><br><span class="line">        action= <span class="string">&quot;http://localhost:8080/web/search.html&quot;</span></span><br><span class="line">        <span class="keyword">class</span>=<span class="string">&quot;form-inline pull-right&quot;</span></span><br><span class="line">        role=<span class="string">&quot;form&quot;</span>&gt;&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> <span class="title function_">checkIfHaveVal</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> val = $(<span class="string">&quot;#search&quot;</span>).<span class="title function_">val</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (val === <span class="string">&#x27;&#x27;</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">alert</span>(<span class="string">&quot;请先输入搜索内容！&quot;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="17">
<li>.children(expr)  例如：children(“:eq(4)”)</li>
</ol>
<pre><code>children()是一个筛选器，顾名思义就是筛选孩子，筛选那些符合条件的孩子。  

其中children是筛选器的名称，expr是表达式，所有选择器中的表达式都可以用在这，

比如按标签名&quot;div&quot;,按类名&quot;.class&quot;,按序号&quot;:first&quot;等等，

如果表达式为空，那么返回的是所有的孩子，返回的结果仍为jQuery对象。
</code></pre>
<p>18.模糊查询报错<font color='red'><strong>Could not set parameters for mapping</strong></font></p>
<p>模糊查询,只能使用${},若使用#{}，占位符会被解析成？，当中参数里面的一部分，导致报错</p>
<p>如果想要强行使用#{}，只能这么写  like concat(‘%’,#{username},’%’) ；</p>
<p>或者 like “%”#{username}”%”;</p>
<p>19.<font color='red'><strong>拦截器白名单失效假象</strong></font></p>
<p>表现是在拦截中配置了对某些资源和接口放行，但发现使用浏览器请求还被重定向拦截器指定页面</p>
<p>原因如下：我们访问一个页面时候 <strong>springboot发现我们这个页面不存在自动会跳转至error页面</strong>，</p>
<p>这个时候跳转至error页面其实是被拦截器拦截了，所以会觉得是excludePathPatterns失效了。</p>
<p>我们只需要白名单放行的路径中把error页面排除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册拦截器并添加拦截规则</span></span><br><span class="line">registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">    .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">    <span class="comment">//也可以用一个List&lt;String&gt; 来设置排除拦截的资源</span></span><br><span class="line">    <span class="comment">//放行静态资源</span></span><br><span class="line">    .excludePathPatterns(<span class="string">&quot;/web/login.html&quot;</span>,<span class="string">&quot;/web/index.html&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;/web/register.html&quot;</span>,<span class="string">&quot;/web/product.html&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;/web/components/**&quot;</span>,<span class="string">&quot;/web/search.html&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;/user/**&quot;</span>,<span class="string">&quot;/address/**&quot;</span>,<span class="string">&quot;/file/**&quot;</span>,<span class="string">&quot;/district/**&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;/images/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>)</span><br><span class="line">    .excludePathPatterns(<span class="string">&quot;/error&quot;</span>); <span class="comment">//不放行error页面有可能导致白名单失效假象</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Year21</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://year21.top/2022/07/25/ComputerStore">http://year21.top/2022/07/25/ComputerStore</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xxxccc1986.github.io" target="_blank">Year 21's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/BootStrap/">BootStrap</a><a class="post-meta__tags" href="/tags/MyBatis/">MyBatis</a></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/x8/wallhaven-x8rgz3.png" data-sites="facebook,twitter,wechat,qq"></div><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/07/07/DeployPersonalProjectsOnLinux/"><img class="prev-cover" src="https://w.wallhaven.cc/full/d5/wallhaven-d59deo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">如何在Linux上部署SpringBoot项目？</div></div></a></div><div class="next-post pull-right"><a href="/2022/07/30/RabbitMQ/"><img class="next-cover" src="https://s1.ax1x.com/2022/07/30/vF9x2j.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RabbitMQ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/07/07/ManagementSystem/" title="SpringBoot+Vue的前后端分离项目"><img class="cover" src="https://w.wallhaven.cc/full/k7/wallhaven-k7q797.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-07</div><div class="title">SpringBoot+Vue的前后端分离项目</div></div></a></div><div><a href="/2022/05/23/SpringBoot/" title="SpringBoot"><img class="cover" src="https://s1.ax1x.com/2022/05/23/X9ra5D.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-23</div><div class="title">SpringBoot</div></div></a></div><div><a href="/2022/04/22/SSM-CRUD/" title="SSM-CRUD整合"><img class="cover" src="https://w.wallhaven.cc/full/o3/wallhaven-o3mp39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-22</div><div class="title">SSM-CRUD整合</div></div></a></div><div><a href="/2022/04/22/MyBatis/" title="MyBatis"><img class="cover" src="https://w.wallhaven.cc/full/28/wallhaven-28xmr9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-22</div><div class="title">MyBatis</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s4.ax1x.com/2022/01/18/7BWTQx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Year 21</div><div class="author-info__description">昨天   今天   明天</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxccc1986"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1483501858&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://t.me/year_21_xx" target="_blank" title="Telegram"><i class="fab fa-telegram"></i></a><a class="social-icon" href="mailto:masicjokersic@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一个不知名的初学者，欢迎指教。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">前置介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.1.</span> <span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="toc-number">3.2.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">3.3.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C"><span class="toc-number">3.4.</span> <span class="toc-text">注册</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-number">3.4.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">3.4.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">3.4.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.4.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">3.5.</span> <span class="toc-text">登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-1"><span class="toc-number">3.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-1"><span class="toc-number">3.5.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-1"><span class="toc-number">3.5.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-1"><span class="toc-number">3.5.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="toc-number">3.6.</span> <span class="toc-text">修改密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-2"><span class="toc-number">3.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-2"><span class="toc-number">3.6.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-2"><span class="toc-number">3.6.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-2"><span class="toc-number">3.6.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99"><span class="toc-number">3.7.</span> <span class="toc-text">个人资料</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-3"><span class="toc-number">3.7.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-3"><span class="toc-number">3.7.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-3"><span class="toc-number">3.7.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-3"><span class="toc-number">3.7.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E5%83%8F%E4%B8%8A%E4%BC%A0"><span class="toc-number">3.8.</span> <span class="toc-text">头像上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-4"><span class="toc-number">3.8.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-4"><span class="toc-number">3.8.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-4"><span class="toc-number">3.8.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-4"><span class="toc-number">3.8.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">地址管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-1"><span class="toc-number">4.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-1"><span class="toc-number">4.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%9C%B0%E5%9D%80"><span class="toc-number">4.3.</span> <span class="toc-text">新增地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-5"><span class="toc-number">4.3.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-5"><span class="toc-number">4.3.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-5"><span class="toc-number">4.3.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-5"><span class="toc-number">4.3.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9C%81%E5%B8%82%E5%8C%BA%E5%88%97%E8%A1%A8"><span class="toc-number">4.4.</span> <span class="toc-text">获取省市区列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-2"><span class="toc-number">4.4.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-2"><span class="toc-number">4.4.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-6"><span class="toc-number">4.4.3.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-6"><span class="toc-number">4.4.4.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-6"><span class="toc-number">4.4.5.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-6"><span class="toc-number">4.4.6.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%9C%B0%E5%9D%80"><span class="toc-number">4.5.</span> <span class="toc-text">获取用户地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-7"><span class="toc-number">4.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-7"><span class="toc-number">4.5.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-7"><span class="toc-number">4.5.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-7"><span class="toc-number">4.5.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%9C%B0%E5%9D%80"><span class="toc-number">4.6.</span> <span class="toc-text">设置默认地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-8"><span class="toc-number">4.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-8"><span class="toc-number">4.6.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-8"><span class="toc-number">4.6.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-8"><span class="toc-number">4.6.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%9C%B0%E5%9D%80"><span class="toc-number">4.7.</span> <span class="toc-text">删除地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-9"><span class="toc-number">4.7.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-9"><span class="toc-number">4.7.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-9"><span class="toc-number">4.7.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-9"><span class="toc-number">4.7.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9C%B0%E5%9D%80"><span class="toc-number">4.8.</span> <span class="toc-text">修改地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-10"><span class="toc-number">4.8.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-10"><span class="toc-number">4.8.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-10"><span class="toc-number">4.8.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-10"><span class="toc-number">4.8.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">商品管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-3"><span class="toc-number">5.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-3"><span class="toc-number">5.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E9%94%80%E6%8E%92%E8%A1%8C"><span class="toc-number">5.3.</span> <span class="toc-text">热销排行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-11"><span class="toc-number">5.3.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-11"><span class="toc-number">5.3.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-11"><span class="toc-number">5.3.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-11"><span class="toc-number">5.3.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E6%96%B0%E4%BA%A7%E5%93%81"><span class="toc-number">5.4.</span> <span class="toc-text">最新产品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%95%86%E5%93%81"><span class="toc-number">5.5.</span> <span class="toc-text">显示商品</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-12"><span class="toc-number">5.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-12"><span class="toc-number">5.5.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-12"><span class="toc-number">5.5.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-12"><span class="toc-number">5.5.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%8B%E5%8D%B3%E8%B4%AD%E4%B9%B0"><span class="toc-number">5.6.</span> <span class="toc-text">立即购买</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-13"><span class="toc-number">5.6.1.</span> <span class="toc-text">前端页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%AD%E7%89%A9%E8%BD%A6%E7%AE%A1%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">购物车管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-4"><span class="toc-number">6.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-4"><span class="toc-number">6.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">6.3.</span> <span class="toc-text">加入购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-13"><span class="toc-number">6.3.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-13"><span class="toc-number">6.3.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-13"><span class="toc-number">6.3.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-14"><span class="toc-number">6.3.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">6.4.</span> <span class="toc-text">展示购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-14"><span class="toc-number">6.4.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-14"><span class="toc-number">6.4.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-14"><span class="toc-number">6.4.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-15"><span class="toc-number">6.4.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%95%86%E5%93%81"><span class="toc-number">6.5.</span> <span class="toc-text">删除商品</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-15"><span class="toc-number">6.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-15"><span class="toc-number">6.5.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-15"><span class="toc-number">6.5.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-16"><span class="toc-number">6.5.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E9%87%8F%E5%A2%9E%E5%87%8F"><span class="toc-number">6.6.</span> <span class="toc-text">数量增减</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-16"><span class="toc-number">6.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-16"><span class="toc-number">6.6.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-16"><span class="toc-number">6.6.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-17"><span class="toc-number">6.6.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%BB%93%E7%AE%97"><span class="toc-number">6.7.</span> <span class="toc-text">商品结算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-17"><span class="toc-number">6.7.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-17"><span class="toc-number">6.7.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-17"><span class="toc-number">6.7.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-18"><span class="toc-number">6.7.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">订单管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-5"><span class="toc-number">7.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-5"><span class="toc-number">7.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95"><span class="toc-number">7.3.</span> <span class="toc-text">创建订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-18"><span class="toc-number">7.3.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-18"><span class="toc-number">7.3.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-18"><span class="toc-number">7.3.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-19"><span class="toc-number">7.3.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E6%94%AF%E4%BB%98"><span class="toc-number">7.4.</span> <span class="toc-text">集成支付宝沙箱支付</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E8%AE%A2%E5%8D%95"><span class="toc-number">7.5.</span> <span class="toc-text">支付订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-19"><span class="toc-number">7.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-19"><span class="toc-number">7.5.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-19"><span class="toc-number">7.5.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-20"><span class="toc-number">7.5.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85"><span class="toc-number">7.6.</span> <span class="toc-text">查看订单详情</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-20"><span class="toc-number">7.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-20"><span class="toc-number">7.6.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-20"><span class="toc-number">7.6.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-21"><span class="toc-number">7.6.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E8%AE%A2%E5%8D%95"><span class="toc-number">7.7.</span> <span class="toc-text">查看所有订单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-21"><span class="toc-number">7.7.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-21"><span class="toc-number">7.7.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-21"><span class="toc-number">7.7.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-22"><span class="toc-number">7.7.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B6%E8%97%8F%E7%AE%A1%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">收藏管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8-6"><span class="toc-number">8.1.</span> <span class="toc-text">创建数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-6"><span class="toc-number">8.2.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8Springboot%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8pageHelper%E6%8F%92%E4%BB%B6"><span class="toc-number">8.3.</span> <span class="toc-text">在Springboot中如何使用pageHelper插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E6%94%B6%E8%97%8F"><span class="toc-number">8.4.</span> <span class="toc-text">加入收藏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-22"><span class="toc-number">8.4.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-22"><span class="toc-number">8.4.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-22"><span class="toc-number">8.4.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-23"><span class="toc-number">8.4.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E8%97%8F%E5%95%86%E5%93%81%E5%B1%95%E7%A4%BA"><span class="toc-number">8.5.</span> <span class="toc-text">收藏商品展示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-23"><span class="toc-number">8.5.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-23"><span class="toc-number">8.5.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-23"><span class="toc-number">8.5.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-24"><span class="toc-number">8.5.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E6%94%B6%E8%97%8F"><span class="toc-number">8.6.</span> <span class="toc-text">取消收藏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-24"><span class="toc-number">8.6.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-24"><span class="toc-number">8.6.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-24"><span class="toc-number">8.6.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-25"><span class="toc-number">8.6.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6-1"><span class="toc-number">8.7.</span> <span class="toc-text">加入购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-26"><span class="toc-number">8.7.1.</span> <span class="toc-text">前端页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%90%9C%E7%B4%A2"><span class="toc-number">9.</span> <span class="toc-text">商品搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2"><span class="toc-number">9.1.</span> <span class="toc-text">模糊搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8C%81%E4%B9%85%E5%B1%82-25"><span class="toc-number">9.1.1.</span> <span class="toc-text">后端-持久层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%B8%9A%E5%8A%A1%E5%B1%82-25"><span class="toc-number">9.1.2.</span> <span class="toc-text">后端-业务层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A7%E5%88%B6%E5%B1%82-25"><span class="toc-number">9.1.3.</span> <span class="toc-text">后端-控制层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-27"><span class="toc-number">9.1.4.</span> <span class="toc-text">前端页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E7%A6%BB%E5%85%AC%E5%85%B1%E9%A1%B5%E9%9D%A2"><span class="toc-number">10.</span> <span class="toc-text">抽离公共页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5kaptcha%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">11.</span> <span class="toc-text">引入kaptcha验证码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E4%B8%9A%E5%8A%A1%E6%96%B9%E6%B3%95%E8%80%97%E6%97%B6"><span class="toc-number">12.</span> <span class="toc-text">统计业务方法耗时</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E9%9D%A2%E6%96%B9%E6%B3%95"><span class="toc-number">12.1.</span> <span class="toc-text">切面方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0AOP%E6%93%8D%E4%BD%9C%EF%BC%9F"><span class="toc-number">12.2.</span> <span class="toc-text">怎么实现AOP操作？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%87%E6%80%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">13.</span> <span class="toc-text">汇总信息</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/DeploySpringCloudOnLinux/" title="如何在Linux上部署SpringCloud项目？"><img src="https://w.wallhaven.cc/full/9m/wallhaven-9m5y98.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何在Linux上部署SpringCloud项目？"/></a><div class="content"><a class="title" href="/2022/09/14/DeploySpringCloudOnLinux/" title="如何在Linux上部署SpringCloud项目？">如何在Linux上部署SpringCloud项目？</a><time datetime="2022-09-14T13:50:02.000Z" title="发表于 2022-09-14 21:50:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/OnlineEducation/" title="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目"><img src="https://w.wallhaven.cc/full/dp/wallhaven-dp9y1m.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目"/></a><div class="content"><a class="title" href="/2022/09/14/OnlineEducation/" title="SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目">SpringCloud + Vue + Nuxt + ElementUi 前后端分离开发的B2C项目</a><time datetime="2022-09-14T13:45:02.000Z" title="发表于 2022-09-14 21:45:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/" title="其他技术"><img src="https://w.wallhaven.cc/full/9m/wallhaven-9m3v7d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="其他技术"/></a><div class="content"><a class="title" href="/2022/09/14/%E5%85%B6%E4%BB%96%E6%8A%80%E6%9C%AF/" title="其他技术">其他技术</a><time datetime="2022-09-14T13:33:02.000Z" title="发表于 2022-09-14 21:33:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/14/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" title="前端技术"><img src="https://w.wallhaven.cc/full/rd/wallhaven-rdv95q.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端技术"/></a><div class="content"><a class="title" href="/2022/09/14/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" title="前端技术">前端技术</a><time datetime="2022-09-14T13:13:02.000Z" title="发表于 2022-09-14 21:13:02">2022-09-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/17/SpringCloud/" title="SpringCloud"><img src="https://w.wallhaven.cc/full/kw/wallhaven-kwov61.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud"/></a><div class="content"><a class="title" href="/2022/08/17/SpringCloud/" title="SpringCloud">SpringCloud</a><time datetime="2022-08-17T12:32:02.000Z" title="发表于 2022-08-17 20:32:02">2022-08-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://w.wallhaven.cc/full/x8/wallhaven-x8rgz3.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 By Year 21</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">心之所向，皆可抵达</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://jsdelivr.pai233.top/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://jsdelivr.pai233.top/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://jsdelivr.pai233.top/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'FdeA2Fr167tRipdBpVUi0fvz-gzGzoHsz',
      appKey: 'roCcb1ljCCFK13sNVcwK4VJi',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://jsdelivr.pai233.top/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="6712227171" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://jsdelivr.pai233.top/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script>(function(d, w, c) {
    w.ChatraID = 'Z2tPHYia3jhnSPJ3K';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://jsdelivr.pai233.top/npm/aplayer/dist/APlayer.min.js"></script><script src="https://jsdelivr.pai233.top/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://jsdelivr.pai233.top/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>